<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template_page.xhtml"
                xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:p="http://primefaces.org/ui" 
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core">
    <ui:define name="headPage"> 
        <h:form prependId="false" id="entete_groupe_user_00">  
            <h:panelGrid columns="2" style="float: left" rendered="#{managedGroupePublic.selectGroupeDiffusion}">
                <p:commandButton value="Modifier" rendered="#{managedGroupePublic.optionUpdate}" actionListener="#{managedGroupePublic.updateBean()}"/>
                <p:splitButton value="Autres options">                    
                    <p:menuitem value="Supprimer" onclick="dlgConfirmDelete.show()"/> 
                </p:splitButton>
            </h:panelGrid>
            <h:panelGrid columns="2" style="float: left" rendered="#{!managedGroupePublic.viewList}">
                <p:commandButton value="Enregistrer" actionListener="#{managedGroupePublic.saveNew()}"/>
                <p:commandButton value="Nouveau" actionListener="#{managedGroupePublic.resetFiche()}"/>
            </h:panelGrid>
            <h:panelGrid columns="1" style="float: right">
                <p:commandButton value="#{(managedGroupePublic.viewList)?'Creation':'Liste'}" update="@this" 
                                 actionListener="#{managedGroupePublic.changeView()}"/>
            </h:panelGrid>
        </h:form>
        <div style="clear: right"/>
    </ui:define>
    <ui:define name="restPage">  
        <h:form prependId="false">
            <p:dialog widgetVar="dlgUsers" width="500" height="150" closeOnEscape="true"
                      dynamic="true" resizable="false" modal="true" header="Selectionner les utilisateurs">
                #{managedGroupePublic.loadAllUser()}
                <p:dataTable value="#{managedGroupePublic.listUsers}" var="usr" rowKey="#{usr.id}" selectionMode="single"
                             scrollable="true" scrollHeight="400" id="data_contact_groupe_00">
                    <p:ajax event="rowSelect" listener="#{managedGroupePublic.loadOnViewUsers}"/>
                    <p:ajax event="rowUnselect" listener="#{managedGroupePublic.unLoadOnViewUsers}"/>
                    <p:column width="15">
                        <h:graphicImage library="img" name="#{(usr.selectActif)?'connecte.png':'deconnecte.png'}" width="15" height="15"/>
                    </p:column>
                    <p:column headerText="Nom et Prenom">
                        #{usr.nomUsers}
                    </p:column>
                    <p:column headerText="Agence">
                        #{usr.agence.designation}
                    </p:column>
                </p:dataTable>
                <f:facet name="footer">
                    <p:outputPanel id="footer_contact_groupe_00">
                        <p:commandButton value="Ajouter" style="width: 100%" oncomplete="dlgUsers.hide()" 
                                         actionListener="#{managedGroupePublic.addContactInGroupe()}" disabled="#{!managedGroupePublic.selectUsers}"/>
                    </p:outputPanel>
                </f:facet>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?">
                <p:commandButton value="Oui" actionListener="#{managedGroupePublic.deleteBean()}" oncomplete="dlgConfirmDelete.hide()"/>
                <p:commandButton value="Non" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>     
        #{managedGroupePublic.loadAll()}
        <script type="text/javascript">
            $(function() {
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
            });
        </script>
        <h:form prependId="false" id="body_groupe_user_00">
            <p:outputPanel id="form_groupe_user_00">
                <p:dataTable value="#{managedGroupePublic.listGroupeDiffusion}" var="gpe" rowKey="#{gpe.id}" selectionMode="single"
                             rendered="#{managedGroupePublic.viewList}">
                    <p:ajax event="rowSelect" listener="#{managedGroupePublic.loadOnView}"/>
                    <p:ajax event="rowUnselect" listener="#{managedGroupePublic.unLoadOnView}"/>
                    <p:column width="15">
                        <h:graphicImage library="img" name="#{(gpe.selectActif)?'connecte.png':'deconnecte.png'}" width="15" height="15"/>
                    </p:column>
                    <p:column headerText="Designation">
                        #{gpe.reference}
                    </p:column>
                    <p:column headerText="Description">
                        #{gpe.libelle}
                    </p:column>
                </p:dataTable>
            </p:outputPanel>
            <p:outputPanel id="form_groupe_user_01">
                <p:outputPanel rendered="#{!managedGroupePublic.viewList}">
                    <h:panelGrid columns="1" style="width: 95%;margin: auto">
                        <p:panelGrid style="width: 100%">
                            <p:row>
                                <p:column>
                                    Designation
                                </p:column>
                                <p:column>
                                    <h:inputText value="#{groupeDiffusion.reference}">
                                        <p:ajax event="valueChange" global="false"/>
                                    </h:inputText>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    Description
                                </p:column>
                                <p:column>
                                    <h:inputTextarea value="#{groupeDiffusion.libelle}" style="width: 80%">
                                        <p:ajax event="valueChange" global="false"/>
                                    </h:inputTextarea>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </h:panelGrid>
                    <h:panelGrid columns="1" style="width: 95%;margin: auto" rendered="#{managedGroupePublic.updateGroupeDiffusion}">
                        <p:outputPanel id="form_groupe_user_02">
                            <p:separator style="width: 95%"/>
                            <h:panelGrid columns="2" style="width: 100%">
                                <p:commandButton value="Supprimer" rendered="#{managedGroupePublic.selectDiffusionContact}" actionListener="#{managedGroupePublic.deleteContactOnGroupe()}"/>
                                <p:commandButton type="button" value="Ajouter" onclick="dlgUsers.show()" style="float: right"/>
                            </h:panelGrid>
                            <p:dataTable value="#{groupeDiffusion.diffusionContactList}" var="cont" rowKey="#{cont.id}" selectionMode="single">
                                <p:ajax event="rowSelect" listener="#{managedGroupePublic.loadOnViewDiffusionContact}"/>
                                <p:ajax event="rowUnselect" listener="#{managedGroupePublic.unLoadOnViewDiffusionContact}"/>
                                <p:column width="15">
                                    <h:graphicImage library="img" name="#{(cont.selectActif)?'connecte.png':'deconnecte.png'}" width="15" height="15"/>
                                </p:column>
                                <p:column headerText="Nom et Prenom">
                                    #{cont.user.nomUsers}
                                </p:column>
                                <p:column headerText="Agence">
                                    #{cont.user.agence.designation}
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </h:panelGrid>
                </p:outputPanel>
            </p:outputPanel>
        </h:form>
    </ui:define>
</ui:composition>