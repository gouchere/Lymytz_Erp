<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Bon Provisoire','modCompta', 'smenBonProvisoire', true)}
    </ui:define>        
    <ui:define name="contents"> 
        #{managedMission.doNothing()}  
        #{managedFactureAchat.doNothing()}  
        #{managedDocDivers.doNothing()}  
        #{managedReglementAchat.doNothing()}  
        #{managedReglementMission.doNothing()}  

        #{managedTypeDocDivers.loadAllByCodeAcces()}
        #{managedBonProvisoire.loadAll()}
        #{managedTiers.loadTiersByType(null, true)}
        #{managedCaisses.loadAllCaisseActif(true)}  
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 135);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('bon_provisoire');
            });
            function _slideShow(node) {
            }
        </script>

        <h:form prependId="false" id="form_ppte_valid_bonp">
            <p:dialog header="#{lab.LC_PA_propriete_validation}" widgetVar="dlgppteValid" width="60%" >
                <p:dataTable value="#{managedBonProvisoire.bonProvisoire.etapesValidations}" var="iValid" id="table_ppte_valid_bonp">
                    <p:column headerText="#{lab.LCF_PBP_etapes}" >#{iValid.etape.labelStatut}</p:column>
                    <p:column headerText="#{lab.LC_PA_valide_par}" >
                        <h:outputText value="#{iValid.author.users.nomUsers}" rendered="#{iValid.etapeValid or iValid.motif != null}" />
                    </p:column>
                    <p:column headerText="#{lab.L_dates} " style="text-align: center">
                        <h:outputText value="#{iValid.dateUpdate}" converter="DATETIME" rendered="#{iValid.etapeValid}"/>
                    </p:column>
                    <p:column headerText="#{lab.LC_PA_motif} " >
                        <h:outputText value="#{managedBonProvisoire.resumeText(iValid.motif)}"/>
                    </p:column>
                </p:dataTable>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog hideEffect="explode" widgetVar="dglAssociedDoc" closeOnEscape="true" header="Justification du bon" width="35%">
                <p:commandLink value="#{lab.LCF_PBP_avec_mission}" actionListener="#{managedBonProvisoire.openListMission(managedBonProvisoire.selectBon, true)}"
                               style="border: 2px solid black; border-radius: 5px;padding: 2px" oncomplete="dglAssociedDoc.hide()"/>
                <p:spacer style="width: 5px"/>
                <p:commandLink value="#{lab.LCF_PBP_avec_achat}" actionListener="#{managedBonProvisoire.openListAchat(managedBonProvisoire.selectBon, true)}"
                               style="border: 2px solid black; border-radius: 5px;padding: 2px"  oncomplete="dglAssociedDoc.hide()"/>
                <p:spacer style="width: 5px"/>
                <p:commandLink value="#{lab.LCF_PBP_avec_op_diverse}" actionListener="#{managedBonProvisoire.openListDivers(managedBonProvisoire.selectBon, true)}"
                               style="border: 2px solid black; border-radius: 5px;padding: 2px"  oncomplete="dglAssociedDoc.hide()"/>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main-motif_etap_bonp">
            <p:dialog hideEffect="explode" widgetVar="dglMotifCancelEtape" closeOnEscape="true" header="#{lab.LC_PA_motif_annulation_etape}" width="35%">
                <h:panelGrid id="value_motif_etap_bonp" columns="1" cellpadding="0" cellspacing="0" style="width: 100%">
                    <h:inputTextarea value="#{managedBonProvisoire.motifEtape}" style="width: 100%" rows="4"/>                
                    <f:facet name="footer">
                        <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedBonProvisoire.annulEtapeOrdre()}" oncomplete="dglMotifCancelEtape.hide();" style="float: right" rendered="#{!managedBonProvisoire.lastEtape}"
                                         update=":main_bon_provisoire:data_bon_provisoire :main_bon_provisoire:etapes_valide_bon_provisoire"/>
                    </f:facet>
                </h:panelGrid>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgListTiers"  width="70%" closeOnEscape="true" footer="&copy; Lymytz" header="Liste des Tiers">
                <div class="dlg_part_fixe">
                    <h:selectOneMenu value="true"  style="font-size: 0.7em">
                        <f:selectItem itemLabel="#{lab.L_actif}" itemValue="#{true}" />
                        <f:selectItem itemLabel="#{lab.L_inactif}" itemValue="#{false}" />
                    </h:selectOneMenu>
                    <p:watermark for="txt_code_tiers_bon" value="#{lab.L_rechercher}..." />
                    <h:inputText value="#{managedTiers.numSearch_}" style="font-size: 0.7em" id="txt_code_tiers_bon">
                        <p:ajax event="blur" listener="#{managedTiers.searchByNum()}" update="data_tiers_bon_provisoire" />
                    </h:inputText>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedTiers.init(false)}" global="false" update="data_tiers_bon_provisoire" icon="ui-icon-circle-triangle-w" disabled="#{managedTiers.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedTiers.paginator.currentPage}/#{managedTiers.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedTiers.init(true)}" global="false" update="data_tiers_bon_provisoire" icon="ui-icon-circle-triangle-e" disabled="#{managedTiers.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedTiers.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedTiers.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedTiers.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_tiers_bon_provisoire"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div>
                <p:dataTable id="data_tiers_bon_provisoire" value="#{managedTiers.listTiers}" var="clt" rowKey="#{clt.id}" rowIndexVar="cltIdx" 
                             style="max-height: 500px; overflow-y: auto; clear: right" selectionMode="single" emptyMessage="#{lab.LCF_PPC_aucun_tiers}">
                    <p:ajax event="rowSelect"  listener="#{managedBonProvisoire.loadOnTiers}" oncomplete="dlgListTiers.hide()"
                            update=":main_bon_provisoire:chmp_tiers_bon_provisoire"/>
                    <p:column width="30"  headerText="N°" style="text-align: center">
                        <span>#{cltIdx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_code}" width="90">
                        <span>#{clt.codeTiers}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_nom}" width="120">
                        <span>#{clt.nom_prenom}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_groupe}" width="80">
                        <span>#{(clt.client)?lab.LDB_PT_client:''}</span>
                        <span>#{(clt.fournisseur and clt.client)?lab.LDB_PT_fournisseur:(clt.fournisseur)?lab.LCF_PBAA_fournisseurs:''}</span>
                        <span>#{(clt.employe and (clt.client or clt.fournisseur))?lab.LCF_PBP_employe:(clt.employe)?lab.LCF_PBP_employe:''}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_region}" width="80">
                        <span>#{clt.region}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_actif}" width="25" style="text-align: center">
                        <h:graphicImage library="img"  name="#{(clt.actif)?'yes.png':'no.png'}" width="15" height="15"/>
                    </p:column>
                </p:dataTable>   
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.L_plus_option}" width="40%"  closeOnEscape="true" widgetVar="dlgPlusOption" resizable="false"> 
                <h:panelGrid id="blog_more_option_bon_provisoire" columns="2" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">   
                    <h:panelGroup>
                        <h:outputText value="#{lab.LCF_PRV_statut_paiement}" style="float:left;margin-top: 2px"/>
                        <h:selectOneMenu value="#{managedBonProvisoire.egalitePaiement}" style="float:right;margin-right: 5px;height: 20px; font-size: 0.8em">
                            <f:selectItem itemLabel="#{lab.L_egale}" itemValue="="/>
                            <f:selectItem itemLabel="#{lab.L_different}" itemValue="!="/>
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamStatutPaiement()}" oncomplete="collapseList('bon_provisoire')"/>
                        </h:selectOneMenu>  
                    </h:panelGroup>
                    <h:selectOneMenu value="#{managedBonProvisoire.statutPaiement}" style="width: 100%">
                        <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                        <f:selectItem itemLabel="#{lab.L_en_attente}" itemValue="#{constantes.ETAT_ATTENTE}"/>
                        <f:selectItem itemLabel="#{lab.L_annulers}" itemValue="#{constantes.ETAT_ANNULE}"/>
                        <f:selectItem itemLabel="#{lab.LCF_PGG_payer}" itemValue="#{constantes.ETAT_REGLE}"/>
                        <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamStatutPaiement()}" oncomplete="collapseList('bon_provisoire')"/>
                    </h:selectOneMenu> 
                    <h:panelGroup>
                        <h:outputText value="#{lab.LCF_PBP_statut_justifier}" style="float:left;margin-top: 2px"/>
                        <h:selectOneMenu value="#{managedBonProvisoire.egaliteJustify}" style="float:right;margin-right: 5px;height: 20px; font-size: 0.8em">
                            <f:selectItem itemLabel="#{lab.L_egale}" itemValue="="/>
                            <f:selectItem itemLabel="#{lab.L_different}" itemValue="!="/>
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamStatutJustify()}" oncomplete="collapseList('bon_provisoire')"/>
                        </h:selectOneMenu>  
                    </h:panelGroup>
                    <h:selectOneMenu value="#{managedBonProvisoire.statutJustify}" style="width: 100%">
                        <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                        <f:selectItem itemLabel="#{lab.L_en_attente}" itemValue="#{constantes.ETAT_ATTENTE}"/>
                        <f:selectItem itemLabel="#{lab.LCF_PBP_injustifier}" itemValue="#{constantes.ETAT_INJUSTIFIE}"/>
                        <f:selectItem itemLabel="#{lab.LCF_PBP_justifier}" itemValue="#{constantes.ETAT_JUSTIFIE}"/>
                        <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamStatutJustify()}" oncomplete="collapseList('bon_provisoire')"/>
                    </h:selectOneMenu> 
                    <h:outputText value="#{lab.LCF_PBP_pour_missions}"/>
                    <h:selectOneMenu value="#{managedBonProvisoire.forMissionSearch}" style="width: 100%">
                        <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                        <f:selectItem itemLabel="#{lab.L_oui.toUpperCase()}" itemValue="#{true}"/>
                        <f:selectItem itemLabel="#{lab.L_non.toUpperCase()}" itemValue="#{false}"/>
                        <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamForMission()}" oncomplete="collapseList('bon_provisoire')"/>
                    </h:selectOneMenu> 
                    <span>Validé par</span>
                    <h:inputText value="#{managedBonProvisoire.validateursearch}">
                        <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamValidateur()}" oncomplete="collapseList('bon_provisoire')"/>
                    </h:inputText> 
                    <h:panelGroup>
                        <h:outputText value="#{lab.LDB_PC_dates} modification"  />
                        <h:selectBooleanCheckbox value="#{managedBonProvisoire.date_up}" title="#{lab.LDB_PC_dates_last_modif}" style="float: right">
                            <p:ajax event="valueChange" global="false" update="blog_date_search_client"  listener="#{managedBonProvisoire.addParamDates()}" oncomplete="collapseList('bon_provisoire')" />
                        </h:selectBooleanCheckbox>
                    </h:panelGroup>
                    <h:panelGroup id="blog_date_search_client">
                        <p:calendar value="#{managedBonProvisoire.dateDebut_}" pattern="dd-MM-yyyy" navigator="true" size="10" disabled="#{!managedBonProvisoire.date_up}">
                            <p:ajax event="dateSelect" global="false" listener="#{managedBonProvisoire.addParamDates}"  oncomplete="collapseList('bon_provisoire')"/>
                        </p:calendar>
                        <p:spacer style="width: 5px;background: black"/>
                        <p:calendar value="#{managedBonProvisoire.dateFin_}" pattern="dd-MM-yyyy" navigator="true" size="10" disabled="#{!managedBonProvisoire.date_up}">
                            <p:ajax event="dateSelect" global="false" listener="#{managedBonProvisoire.addParamDates}" oncomplete="collapseList('bon_provisoire')"/>
                        </p:calendar>
                    </h:panelGroup>

                </h:panelGrid>  
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="#{lab.LCF_PBP_text}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonProvisoire.deleteBean()}" oncomplete="dlgConfirmDelete.hide();" />
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete_" closeOnEscape="true"
                             message="#{lab.LCF_PBP_text}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonProvisoire.deleteBean_()}" oncomplete="dlgConfirmDelete_.hide();" />
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete_.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmSuspensPC" closeOnEscape="true"
                             message="#{lab.LCF_PBP_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonProvisoire.suspendBon()}" oncomplete="dlgConfirmSuspensPC.hide();" update=":main_bon_provisoire:data_bon_provisoire"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmSuspensPC.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog hideEffect="explode" widgetVar="dlgConfirmValidePC" closeOnEscape="true" header="#{lab.L_confirmation}">
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <span>#{lab.L_caisse} : </span>
                    <h:selectOneMenu id="chmp_caisse_bon_provisoire" value="#{managedBonProvisoire.selectBon.caisse.id}" style="min-width: 200px">
                        <f:selectItem itemLabel="--" itemValue="0" />
                        <f:selectItems value="#{managedCaisses.caisses}" var="itemCaiss" itemLabel="#{itemCaiss.intitule}" itemValue="#{itemCaiss.id}" />       
                        <p:ajax event="valueChange" global="false"/>             
                    </h:selectOneMenu>
                    <span>#{lab.L_date} </span>
                    <p:calendar value="#{managedBonProvisoire.selectBon.datePayer}" pattern="dd-MM-yyyy" size="8" />
                </h:panelGrid>
                <f:facet name="footer">
                    <span>#{lab.LCF_PBP_text2}</span>
                    <h:panelGrid style="float: right;margin-top: -5px;margin-left: 5px" columns="2" cellpadding="0" cellspacing="0">
                        <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonProvisoire.valideBon()}" 
                                         oncomplete="dlgConfirmValidePC.hide();" update=":main_bon_provisoire:data_bon_provisoire"/>
                        <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmValidePC.hide()"/>
                    </h:panelGrid>
                </f:facet>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog id="cfm_bon_mission" hideEffect="explode" widgetVar="dlgConfirmBonProvisoire" closeOnEscape="true" header="#{lab.L_confirmation}"
                             message="#{lab.LCF_PBP_text3} #{managedBonProvisoire.selectBon.bonMission.mission.mission.numeroMission}.#{lab.LCF_PBP_text4}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonProvisoire.forceOnViewMission()}" oncomplete="dlgConfirmBonProvisoire.hide();"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmBonProvisoire.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgBonPieceMission" width="80%" closeOnEscape="true" footer="&copy; Lymytz" header="#{lab.LCF_PBP_liste_reglement_mission}">
                <p:dataTable value="#{managedBonProvisoire.bonProvisoire.mission.reglements}" var="rReg" id="data_piece_mission_bon" rowIndexVar="iReg" rowKey="#{rReg.id}" selectionMode="single"> 
                    <p:ajax event="rowSelect" listener="#{managedBonProvisoire.loadOnViewPieceMission}" oncomplete="dlgBonPieceMission.hide()"/>                    
                    <p:column headerText="N°" width="35" styleClass="etat_#{rReg.statutPiece}" style="text-align: center">
                        #{iReg+1}
                    </p:column>
                    <p:column headerText="#{lab.L_numero}" width="150" styleClass="etat_#{rReg.statutPiece}">
                        <h:outputText value="#{rReg.numeroPiece}"/> 
                        <h:graphicImage library="img" name="P.png" width="12" height="12" rendered="#{rReg.statutPiece=='P'}" style="float: right"/>
                    </p:column>
                    <p:column headerText="#{lab.LC_PFA_date_edition}" style="text-align: center" width="80" styleClass="etat_#{rReg.statutPiece}">
                        <h:outputText value="#{rReg.datePiece}" converter="DATE"/> 
                    </p:column>
                    <p:column headerText="#{lab.LCF_PRV_paiement_prevu_le}" style="text-align: center" width="80" styleClass="etat_#{rReg.statutPiece}">                            
                        <h:outputText value="#{rReg.datePaimentPrevu}" converter="DATE"/>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PRM_mode_paiement}" width="100" styleClass="etat_#{rReg.statutPiece}">
                        <h:outputText value="#{rReg.model.designation}"/> 
                    </p:column>
                    <p:column headerText="#{lab.L_caisse} " width="100" styleClass="etat_#{rReg.statutPiece}">
                        <span>#{rReg.caisse.intitule}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_montant}" width="80" style="text-align: right" styleClass="etat_#{rReg.statutPiece}">
                        <h:outputText value="#{rReg.montant}" converter="DN"/>
                    </p:column>
                </p:dataTable>   
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgBonMission" width="80%" closeOnEscape="true" footer="&copy; Lymytz" header="#{lab.LCF_PBP_liste_mission}">
                <div class="dlg_part_fixe">
                    <p:watermark for="txt_num_mission_bon" value="#{lab.L_rechercher}..." />
                    <p:watermark for="txt_mat_mission_bon" value="#{lab.LCF_PBP_employe}..." />
                    <h:inputText value="#{managedMission.referenceF}" style="font-size: 0.7em" id="txt_num_mission_bon" >
                        <p:ajax event="valueChange" listener="#{managedMission.addParamReference()}" update="data_mission_bon"/>
                    </h:inputText>
                    <h:inputText value="#{managedMission.matriculeF}" style="font-size: 0.7em" id="txt_mat_mission_bon"  >
                        <p:ajax event="valueChange" listener="#{managedMission.findByEmploye()}" update="data_mission_bon"/>
                    </h:inputText>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedMission.pagineResult_(false)}" global="false" update="data_mission_bon" icon="ui-icon-circle-triangle-w" disabled="#{managedMission.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedMission.paginator.currentPage}/#{managedMission.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedMission.pagineResult_(true)}" global="false" update="data_mission_bon" icon="ui-icon-circle-triangle-e" disabled="#{managedMission.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedMission.imax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedMission.changePage}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedMission.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_mission_bon"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div>
                <p:dataTable value="#{managedMission.listMission}" var="item2" id="data_mission_bon" rowIndexVar="lineMission" rowKey="#{item2.id}" selectionMode="single"> 
                    <p:ajax event="rowSelect"   listener="#{managedBonProvisoire.loadOnViewMission}" oncomplete="dlgBonMission.hide()"/>                    
                    <p:column headerText="N°" width="35" styleClass="statutMiss_#{item2.statutMission}" style="text-align: center">
                        #{lineMission+1}
                        <h:graphicImage library="img/icones" name="cloch.jpg" width="15" height="15" rendered="#{item2.dateFin.before(managedMission.currentDate) and item2.statutMission!='C'}" />
                        <h:graphicImage library="icones" name="lock.png" width="15" height="15" rendered="#{item2.statutMission=='C'}" />
                    </p:column>
                    <p:column headerText="#{lab.LCF_PBP_employes}" width="150" styleClass="statutMiss_#{item2.statutMission}">
                        <h:outputText value="#{item2.employe.nom_prenom}"/> 
                    </p:column>
                    <p:column headerText="#{lab.L_numero}" width="100" styleClass="statutMiss_#{item2.statutMission}" style="text-align: center">
                        <h:outputText value="#{item2.numeroMission}"/> 
                    </p:column>
                    <p:column headerText="#{lab.L_reference}" styleClass="statutMiss_#{item2.statutMission}" width="100" >                            
                        <h:outputText value="#{item2.referenceMission} #{item2.fraisMissions.size()}" style="width: 50px" title="#{item2.ordre}"/>
                    </p:column>
                    <p:column headerText="#{lab.LC_PPV_lieu} " width="100" styleClass="statutMiss_#{item2.statutMission}">
                        <h:outputText value="#{item2.lieu.libele}"/> 
                    </p:column>
                    <p:column headerText="#{lab.LCF_PBP_duree} " width="60" style="text-align: center" styleClass="statutMiss_#{item2.statutMission}">
                        <span>(#{item2.dureeMission} Jours)</span>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PC_reste}" width="100" style="text-align: right" styleClass="statutMiss_#{item2.statutMission}">
                        <h:outputText value="#{item2.totalReste}" converter="DN"/>
                    </p:column>
                </p:dataTable>   
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog id="cfm_bon_achat" hideEffect="explode" widgetVar="dlgConfirmBonProvAchat" closeOnEscape="true" header="#{lab.L_confirmation}"
                             message="#{lab.LCF_PBP_text5} #{managedBonProvisoire.selectBon.bonAchat.piece.achat.numDoc}. #{lab.LCF_PBP_text4}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonProvisoire.forceOnViewAchat()}" oncomplete="dlgConfirmBonProvAchat.hide();"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmBonProvAchat.hide()"/>
            </p:confirmDialog>
            <p:dialog widgetVar="dlgBonPieceAchat" width="80%" closeOnEscape="true" footer="&copy; Lymytz" header="#{lab.LCF_PBP_liste_reglement_achat}">
                <p:dataTable value="#{managedBonProvisoire.bonProvisoire.achat.reglements}" var="rRega" id="data_piece_achat_bon" rowIndexVar="iReg" rowKey="#{rRega.id}" selectionMode="single"> 
                    <p:ajax event="rowSelect" listener="#{managedBonProvisoire.loadOnViewPieceAchat}" oncomplete="dlgBonPieceAchat.hide()"/>                    
                    <p:column headerText="N°" width="35" styleClass="etat_#{rRega.statutPiece}" style="text-align: center">
                        #{iReg+1}
                    </p:column>
                    <p:column headerText="#{lab.L_numero}" width="150" styleClass="etat_#{rRega.statutPiece}">
                        <h:outputText value="#{rRega.numeroPiece}"/> 
                        <h:graphicImage library="img" name="P.png" width="12" height="12" rendered="#{rRega.statutPiece=='P'}" style="float: right"/>
                    </p:column>
                    <p:column headerText="#{lab.LC_PFA_date_edition}" style="text-align: center" width="80" styleClass="etat_#{rRega.statutPiece}">
                        <h:outputText value="#{rRega.datePiece}" converter="DATE"/> 
                    </p:column>
                    <p:column headerText="#{lab.LCF_PRV_paiement_prevu_le}" style="text-align: center" width="80" styleClass="etat_#{rRega.statutPiece}">                            
                        <h:outputText value="#{rRega.datePaimentPrevu}" converter="DATE"/>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PRM_mode_paiement}" width="100" styleClass="etat_#{rRega.statutPiece}">
                        <h:outputText value="#{rRega.model.designation}"/> 
                    </p:column>
                    <p:column headerText="#{lab.L_caisse} " width="100" styleClass="etat_#{rRega.statutPiece}">
                        <span>#{rRega.caisse.intitule}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_montant}" width="80" style="text-align: right" styleClass="etat_#{rRega.statutPiece}">
                        <h:outputText value="#{rRega.montant}" converter="DN"/>
                    </p:column>
                </p:dataTable>   
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgBonAchat" width="80%" closeOnEscape="true" footer="&copy; Lymytz" header="Liste des factures d'achats">
                <div class="dlg_part_fixe">
                    <p:watermark for="txt_num_achat_bon" value="#{lab.L_rechercher}..." />
                    <p:watermark for="txt_mat_achat_bon" value="#{lab.LCF_PBAA_fournisseur}..." />
                    <h:inputText value="#{managedFactureAchat.numSearch_}" style="font-size: 0.7em" id="txt_num_achat_bon" >
                        <p:ajax event="valueChange" listener="#{managedFactureAchat.searchByNum()}" update="data_achat_bon"/>
                    </h:inputText>
                    <h:inputText value="#{managedFactureAchat.codeFsseur_}" style="font-size: 0.7em" id="txt_mat_achat_bon"  >
                        <p:ajax event="valueChange" listener="#{managedFactureAchat.addParamFsseur()}" update="data_achat_bon"/>
                    </h:inputText>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedFactureAchat.init(false)}" update="data_achat_bon" icon="ui-icon-circle-triangle-w" disabled="#{managedFactureAchat.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedFactureAchat.paginator.currentPage}/#{managedFactureAchat.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedFactureAchat.init(true)}" update="data_achat_bon" icon="ui-icon-circle-triangle-e" disabled="#{managedFactureAchat.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedFactureAchat.imax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedFactureAchat.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedFactureAchat.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_achat_bon"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div>
                <p:dataTable id="data_achat_bon" value="#{managedFactureAchat.documents}" var="bon" rowKey="#{bon.id}" 
                             rowIndexVar="bonIdx" selectionMode="single">
                    <p:ajax event="rowSelect"   listener="#{managedBonProvisoire.loadOnViewAchat}" oncomplete="dlgBonAchat.hide()"/>   
                    <p:column width="30" headerText="N°" styleClass="statut_#{bon.statut}">
                        <h:graphicImage title="#{lab.L_cloturer}" library="img" name="blocked.png" width="15" height="15" rendered="#{bon.cloturer}"/>     
                        <span>#{bonIdx+1}</span>
                        <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{bon.id eq managedFactureAchat.docAchat.id}"/>
                        <h:graphicImage title="#{lab.LC_PFA_validation_incomplete}" library="icones" name="alert.png" width="15" height="15" rendered="#{bon.validIncomplet}" style="float: right"/>  
                    </p:column>
                    <p:column headerText="#{lab.L_reference}" style="width: 18%" styleClass="statut_#{bon.statut}">
                        <span>#{bon.numDoc}</span>
                        <h:panelGroup style="float: right">
                            <h:outputText title="#{lab.LC_PRA_facture_reglee}" value="R" rendered="#{bon.statutRegle == constantes.ETAT_REGLE}" styleClass="style_statut"/>
                            <p:spacer width="2" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}"/>
                            <h:outputText title="#{lab.LC_PFA_commande_recue}" value="L" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}" styleClass="style_statut"/>
                        </h:panelGroup>
                    </p:column>
                    <p:column headerText="#{lab.LC_PBRA_date_facture}" style="text-align: center;width: 12%" styleClass="statut_#{bon.statut}">
                        <h:outputText value="#{bon.dateDoc}" converter="DDMMYYYY"/>
                    </p:column>
                    <p:column headerText="#{lab.LC_PBRA_fournisseur}" styleClass="statut_#{bon.statut}">
                        <h:outputText value="#{bon.fournisseur.tiers.nom_prenom}"/>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PBP_plan_paiement}" styleClass="statut_#{bon.statut}">
                        <h:outputText value="#{bon.modelReglement.reference}"/>
                        <h:panelGroup style="float: right">
                            <h:outputText title="#{lab.LCF_PMC_comptabiliser}" value="C" rendered="#{bon.comptabilised}" styleClass="style_statut"/>
                        </h:panelGroup>
                    </p:column>
                    <p:column headerText="#{lab.LC_PFA_piece_externe}" style="width: 18%" styleClass="statut_#{bon.statut}">
                        <span>#{bon.numPiece}</span>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PBP_etapes}"  width="60" styleClass="statut_#{bon.statut}" style="font-size: 0.8em;text-align: center">
                        <h:outputText value="#{bon.libEtapes}" />
                    </p:column>
                </p:dataTable>   
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog id="cfm_bon_divers" hideEffect="explode" widgetVar="dlgConfirmBonProvDivers" closeOnEscape="true" header="#{lab.L_confirmation}"
                             message="#{lab.LCF_PBP_text5} #{managedBonProvisoire.selectBon.bonDivers.piece.docDivers.numPiece}. #{lab.LCF_PBP_text4}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonProvisoire.forceOnViewDivers()}" oncomplete="dlgConfirmBonProvDivers.hide();"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmBonProvDivers.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgBonPieceDivers" width="80%" closeOnEscape="true" footer="&copy; Lymytz" header="#{lab.LCF_PBP_liste_reglement_od}">
                <p:dataTable value="#{managedBonProvisoire.bonProvisoire.divers.reglements}" var="pc_d" id="data_piece_divers_bon" rowIndexVar="mensIdx" rowKey="#{pc_d.id}" selectionMode="single"> 
                    <p:ajax event="rowSelect" listener="#{managedBonProvisoire.loadOnViewPieceDivers}" oncomplete="dlgBonPieceDivers.hide()"/>                    
                    <p:column headerText="N°" style="width: 5%" styleClass="statut_#{pc_d.statutPiece}">
                        <span>#{mensIdx+1}</span>
                        <h:panelGroup style="float: right">
                            <h:outputText title="#{lab.LCF_PMC_comptabiliser}" value="C" rendered="#{managedSaisiePiece.isComptabilise(pc_d.id, constantes.SCR_CAISSE_DIVERS)}" styleClass="style_statut"/>
                        </h:panelGroup>
                    </p:column>
                    <p:column headerText="Id" style="width: 5%" styleClass="statut_#{pc_d.statutPiece}" rendered="#{docCaissesDivers.reglements.size() gt 0 ? docCaissesDivers.reglements.get(0).id gt 0 : false}">
                        <span>#{pc_d.id}</span>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PRV_a_payer_le}" style="text-align: center;width: 10%" styleClass="statut_#{pc_d.statutPiece}">
                        <h:outputText value="#{pc_d.datePaimentPrevu}" converter="DDMMYYYY"/>
                    </p:column>
                    <p:column headerText="#{lab.L_numero}"  styleClass="statut_#{pc_d.statutPiece}">
                        <h:outputText value="#{pc_d.numPiece}" />
                        <span style="display: #{(pc_d.phasesReglement.size() gt 0)?'inline-block':'none'}; width: 10px; height: 10px; background: #99ccff" title="#{lab.LC_PFA_phase_reglement_generer}"></span>
                        <h:panelGroup style="float: right">
                            <h:graphicImage library="img" name="P.png" width="12" height="12" rendered="#{pc_d.statutPiece=='P'}"/>
                            <h:panelGroup rendered="#{pc_d.justificatif}">
                                <span title="#{lab.LCF_PPC_bp_ordonne_par} : #{pc_d.justify.bon.ordonnateur.nomUsers}" style="font-style: italic; font-size: 0.8em;font-weight: bold">BP</span>
                            </h:panelGroup>
                        </h:panelGroup>
                    </p:column>
                    <p:column headerText="#{lab.L_montant}" style="text-align: right;width: 10%" styleClass="statut_#{pc_d.statutPiece}">
                        <h:outputText value="#{pc_d.montant}" converter="DNS"/>
                    </p:column>
                    <p:column headerText="#{lab.LC_PFV_mode}" style="text-align: right;width: 15%" styleClass="statut_#{pc_d.statutPiece}">
                        <h:outputText value="#{pc_d.modePaiement.designation}" />
                    </p:column>
                    <p:column headerText="#{lab.L_caisse}" style="text-align: right;width: 20%" styleClass="statut_#{pc_d.statutPiece}">
                        <h:outputText value="#{pc_d.caisse.intitule}" />
                    </p:column>
                    <p:column headerText="#{lab.LCF_PPC_a_ordre_de}"  styleClass="statut_#{pc_d.statutPiece}" style="text-align: right;">
                        <h:outputText value="#{managedDocDivers.resumeText(pc_d.beneficiaire, 20)}" title="#{pc_d.beneficiaire}"/>
                    </p:column>
                </p:dataTable>   
            </p:dialog>

            <p:dialog widgetVar="dlgBonDivers" width="80%" closeOnEscape="true" footer="&copy; Lymytz" header="#{lab.LCF_PBP_liste_od}">
                <div class="dlg_part_fixe">
                    <p:watermark for="txt_num_divers_bon" value="#{lab.L_rechercher}..." />
                    <p:watermark for="txt_mat_divers_bon" value="#{lab.L_tiers}..." />
                    <h:inputText value="#{managedDocDivers.numSearch}" style="font-size: 0.7em" id="txt_num_divers_bon" >
                        <p:ajax event="valueChange" listener="#{managedDocDivers.searchByNum()}" update="data_divers_bon"/>
                    </h:inputText>
                    <h:inputText value="#{managedDocDivers.codeTiers}" style="font-size: 0.7em" id="txt_mat_divers_bon"  >
                        <p:ajax event="valueChange" listener="#{managedDocDivers.addParamTiers()}" update="data_divers_bon"/>
                    </h:inputText>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedDocDivers.init(false)}" update="data_divers_bon" icon="ui-icon-circle-triangle-w" disabled="#{managedDocDivers.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedDocDivers.paginator.currentPage}/#{managedDocDivers.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedDocDivers.init(true)}" update="data_divers_bon" icon="ui-icon-circle-triangle-e" disabled="#{managedDocDivers.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedDocDivers.imax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedDocDivers.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedDocDivers.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_divers_bon"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div>  
                <p:dataTable id="data_divers_bon" value="#{managedDocDivers.documents}" var="oth" rowKey="#{oth.id}" rowIndexVar="othIdx" selectionMode="single">
                    <p:ajax event="rowSelect"  listener="#{managedBonProvisoire.loadOnViewDivers}" oncomplete="dlgBonDivers.hide()"/>
                    <p:column width="40" styleClass="statut_#{oth.statutDoc}">                            
                        <span title="#{oth.description}">#{othIdx+1}</span>
                        <h:graphicImage title="#{lab.L_nouveau}" library="img" name="redo.png" width="15" height="15" rendered="#{oth.new_}"/>  
                        <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{oth.id eq docCaissesDivers.id}"/>                                               
                    </p:column>                            
                    <p:column headerText="#{lab.LC_PFA_numero_piece}" styleClass="statut_#{oth.statutDoc}" width="100">
                        <span title="#{oth.description}">#{oth.numPiece}</span>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PBP_numero_ref}" styleClass="statut_#{oth.statutDoc}" width="100">
                        <span title="#{oth.description}" style="float: left">#{managedDocDivers.resumeText(oth.referenceExterne, 30)}</span>
                        <h:panelGroup style="float: right;margin-top: 4px">
                            <h:graphicImage library="img" name="P.png" width="12" height="12" rendered="#{oth.statutRegle eq constantes.ETAT_REGLE}" title="Opération réglée"/>
                        </h:panelGroup>
                    </p:column>
                    <p:column headerText="#{lab.LDB_PTT_compte_g}" styleClass="statut_#{oth.statutDoc}" width="80">
                        <span title="#{oth.compteGeneral.intitule}">#{oth.compteGeneral.numCompte}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_tiers}" styleClass="statut_#{oth.statutDoc}" width="100">
                        <span title="#{oth.description}">#{managedDocDivers.findNameTiers(oth.idTiers, oth.tableTiers)}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_date}" width="80" styleClass="statut_#{oth.statutDoc}">
                        <h:outputText value="#{oth.dateDoc}" converter="DDMMYYYY" title="#{oth.description}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_montant}" style="text-align: right;" width="100" styleClass="statut_#{oth.statutDoc}">
                        <h:outputText value="#{oth.montant}" converter="DN" style="padding-right: 2px" title="#{oth.description}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_description}" style="text-align: right;" width="100" styleClass="statut_#{oth.statutDoc}">
                        <h:outputText value="#{managedDocDivers.resumeText(oth.description)}" style="padding-left: 2px" title="#{oth.description}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_agence}" style="text-align: center" width="40" styleClass="statut_#{oth.statutDoc}">
                        <span>#{oth.agence.designation}</span>
                    </p:column>
                    <p:column headerText="#{lab.LDB_PPC_plan}" style="text-align: center" width="40" styleClass="statut_#{oth.statutDoc}">
                        <h:outputText title="#{lab.LDB_PU_planifier}?" value="#{(oth.abonnements.size() gt 0)?'yes':'no'}" style="font-weight: bold; size: 0.8px"/>
                    </p:column>
                    <p:column headerText="#{lab.LCF_PBP_etapes}" width="60" styleClass="statut_#{oth.statutDoc}" style="font-size: 0.8em; text-align: center">
                        <h:outputText value="#{oth.libEtapes}" />
                    </p:column>
                    <p:column width="20" style="text-align: center" styleClass="statut_#{oth.statutDoc}"> 
                        <h:graphicImage library="img/icones" name="#{(oth.mouvement == 'R' )?'in.png':'out.png'}"
                                        width="15" height="15" title="#{(oth.mouvement == 'R' )?'Recettes':'Dépenses'}"/>
                    </p:column>
                </p:dataTable> 
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgListUsers"  width="70%" closeOnEscape="true" footer="&copy; Lymytz" header="#{lab.LC_PCP_liste_users}">
                <div class="dlg_part_fixe">
                    <p:watermark for="txt_code_users_bon" value="#{lab.L_rechercher}..." />
                    <h:inputText value="#{managedUser.numSearch}" style="font-size: 0.7em" id="txt_code_users_bon">
                        <p:ajax event="blur" listener="#{managedUser.addParamUsers()}" update="data_users_bon" />
                    </h:inputText>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedUser.loadAll(false,false)}" global="false" update="data_users_bon" icon="ui-icon-circle-triangle-w" disabled="#{managedUser.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedUser.paginator.currentPage}/#{managedUser.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedUser.loadAll(true,false)}" global="false" update="data_users_bon" icon="ui-icon-circle-triangle-e" disabled="#{managedUser.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedUser.imax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedUser.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedUser.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_users_bon"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div>
                <p:dataTable id="data_users_bon" value="#{managedUser.listUser}" var="usr" rowKey="#{usr.id}" rowIndexVar="cltIdx" 
                             style="max-height: 500px; overflow-y: auto; clear: right" selectionMode="single" emptyMessage="#{lab.LCF_PBP_aucun_users}">
                    <p:ajax event="rowSelect"  listener="#{managedBonProvisoire.loadOnUsers}" oncomplete="dlgListUsers.hide()"
                            update=":main_bon_provisoire:chmp_users_bon_provisoire"/>
                    <p:column width="30"  headerText="N°" style="text-align: center">
                        <span>#{cltIdx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_code}" width="90">
                        <span>#{usr.codeUsers}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_nom}" width="120">
                        <span>#{usr.nomUsers}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_agence}" width="80">
                        <h:outputText value="#{usr.agence.designation}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_actif}" width="25" style="text-align: center">
                        <h:graphicImage library="img"  name="#{(usr.actif)?'yes.png':'no.png'}" width="15" height="15"/>
                    </p:column>
                </p:dataTable>   
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog  header="#{lab.L_confirmation}"
                              width="40%" widgetVar="dlgValidDoc" message="#{lab.LCF_PBP_text6}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedBonProvisoire.validerOrder()}"
                                 update=":main_bon_provisoire:data_bon_provisoire :main_bon_provisoire:etapes_valide_bon_provisoire" oncomplete="dlgValidDoc.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgValidDoc.hide()" />
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgConfirmCancelDoc" message="#{lab.LCF_PBP_text6}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedBonProvisoire.confirmCancelDocDiver(false, true)}"
                                 update=":main_bon_provisoire:data_bon_provisoire :main_bon_provisoire:etapes_valide_bon_provisoire" oncomplete="dlgConfirmCancelDoc.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgConfirmCancelDoc.hide()" />
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgConfirmCancelForcer" message="#{lab.LCF_PBP_text7}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedBonProvisoire.confirmCancelDocDiver(true, true)}"
                                 update=":main_bon_provisoire:data_bon_provisoire :main_bon_provisoire:etapes_valide_bon_provisoire" oncomplete="dlgConfirmCancelForcer.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgConfirmCancelForcer.hide()" />
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgConfirmEditDoc" message="#{lab.LCF_PBP_text8}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedBonProvisoire.confirmCancelDocDiver(false, false)}"
                                 update=":main_bon_provisoire:data_bon_provisoire :main_bon_provisoire:etapes_valide_bon_provisoire" oncomplete="dlgConfirmEditDoc.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgConfirmEditDoc.hide()" />
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgConfirmChangeJustify" message="#{lab.LCF_PBP_text9}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedBonProvisoire.chooseForBon(true, true)}"
                                 update=":main_bon_provisoire:blog_document_bon" oncomplete="dlgConfirmChangeJustify.hide()"/>
                <p:commandButton value="#{lab.L_non}" icon="ui-icon-circle-close" actionListener="#{managedBonProvisoire.chooseForBon(true, false)}"
                                 update=":main_bon_provisoire:blog_document_bon" oncomplete="dlgConfirmChangeJustify.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_bon_provisoire">
            <div class="part_fix">         
                <div style="float: left">      
                    <p:splitButton value="#{lab.L_enregistrer}" id="save_bon_provisoire" actionListener="#{managedBonProvisoire.saveNew()}"
                                   update=":main_bon_provisoire:data_bon_provisoire entete_bon_provisoire" icon="ui-icon-disk">
                        <p:menuitem value="#{lab.L_nouveau}" icon="ui-icon-document" id="cancel_others" 
                                    actionListener="#{managedBonProvisoire.resetFiche()}" oncomplete="collapseForm('bon_provisoire');" /> 
                        <p:separator />
                        <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false"
                                    oncomplete="dlgConfirmDelete.show();" />  
                    </p:splitButton>

                    <p:commandButton value="#{lab.L_supprimer}" icon="ui-icon-trash" id="delete_bon_provisoire" global="false"
                                     oncomplete="dlgConfirmDelete.show();" />  
                </div>     
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedBonProvisoire.parcoursInAllResult(false)}" update="txt_one_by_one_bon" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('bon_provisoire')"/>
                    <h:inputText value="#{managedBonProvisoire.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_one_by_one_bon"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedBonProvisoire.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                    </p:outputPanel>
                    <p:commandButton actionListener="#{managedBonProvisoire.parcoursInAllResult(true)}" update="txt_one_by_one_bon" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('bon_provisoire')"/>
                </h:panelGroup>  
                <div style="float: right">     
                    <h:link title="#{lab.L_mode_formulaire}" onclick="collapseForm('bon_provisoire');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link title="#{lab.L_mode_liste}" onclick="collapseList('bon_provisoire');
                            return false" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>                         
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->                
                <div class="yvs_form_bon_provisoire" style="width: 99%; margin: auto; background: white">
                    <p:outputPanel autoUpdate="true" id="entete_bon_provisoire" >
                        <h:panelGrid columns="2" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0" style="font-size: 0.9em;float: left" rendered="#{managedBonProvisoire.bonProvisoire.id gt 0}">
                            <span>#{lab.L_numero} : </span>
                            <h:outputText value="#{managedBonProvisoire.bonProvisoire.numero}" style="float: left;background: black;color: white;font-size: 1.2em"/>                   
                        </h:panelGrid>
                        <h:panelGroup style="float: left;margin-top: 2px;margin-left: 1.5%" rendered="#{managedBonProvisoire.bonProvisoire.id gt 0}">
                            <h:outputText value="#{(managedBonProvisoire.bonProvisoire.statutPaiement == constantes.STATUT_DOC_PAYER)?'Payé ':(managedBonProvisoire.bonProvisoire.statutPaiement == constantes.STATUT_DOC_ENCOUR)?'En cours de paiement':'Paiement en attente'}"
                                          styleClass="button-stateOF #{(managedBonProvisoire.bonProvisoire.statutPaiement == constantes.STATUT_DOC_PAYER)?'button-stateOF_actif':''}"  style="font-size: 1em"/>
                        </h:panelGroup>
                        <h:panelGrid columns="1" style="margin-top: 2px;margin-left: 25%; float: left">
                            <span style="font-size: 0.8em;text-align: center">Bons non Justifiés( Fcfa)</span>
                            <h:outputText value="#{managedBonProvisoire.totalNonJustifie}" id="zone_total" converter="#{managedBonProvisoire.getConverter(constantes.CONVERTER_MONNAIE)}"
                                          styleClass="button-stateOF"  style="font-size: 1em; width: 250px; text-align: center; padding-left: 30px; padding-right: 30px"/>
                        </h:panelGrid>
                        <p:overlayPanel for="zone_total">
                            <h:panelGrid columns="3" style="width: 100%" cellpadding="10" cellspacing="10">
                                <span >Total Agence</span>
                                <h:outputText value="#{managedBonProvisoire.totalNonJustifie}" style="float: right" converter="#{managedBonProvisoire.getConverter(constantes.CONVERTER_MONNAIE)}"/>
                                <h:outputText value="#{managedBonProvisoire.nbBpNonJustifAgence}" style="float: right" converter="#{managedBonProvisoire.getConverter(constantes.CONVERTER_MONNAIE)}"/>
                                <span >Total Société</span>
                                <h:outputText value="#{managedBonProvisoire.totalNonJustifieInscte}"  style="float: right" converter="#{managedBonProvisoire.getConverter(constantes.CONVERTER_MONNAIE)}"/>
                                <h:outputText value="#{managedBonProvisoire.nbMaxNonJustfScte}"  style="float: right" converter="#{managedBonProvisoire.getConverter(constantes.CONVERTER_MONNAIE)}"/>
                                <span >Total validé par moi</span>
                                <h:outputText value="#{managedBonProvisoire.totalNonJustifieByUser}"   style="float: right" converter="#{managedBonProvisoire.getConverter(constantes.CONVERTER_MONNAIE)}"/>
                                <h:outputText value="#{managedBonProvisoire.nbMaxNonJustifUser}"   style="float: right" converter="#{managedBonProvisoire.getConverter(constantes.CONVERTER_MONNAIE)}"/>
                            </h:panelGrid>
                        </p:overlayPanel>
                        <h:panelGroup style="float: right;margin-top: 5px" rendered="#{managedBonProvisoire.bonProvisoire.id gt 0}">    
                            <p:outputPanel id="etapes_valide_bon_provisoire" styleClass="yvs_form_of">
                                <h:panelGroup style="float: left">
                                    <p:commandLink value="#{managedBonProvisoire.writeEtape(((managedBonProvisoire.bonProvisoire.statut==constantes.ETAT_EDITABLE)?lab.L_en_edition:lab.L_editable), managedBonProvisoire.bonProvisoire.firstEtape)}" type="button"
                                                   styleClass="#{(managedBonProvisoire.bonProvisoire.statut==constantes.STATUT_DOC_EDITABLE)?'statut_valide':'etat_formation_true'}" onclick="dlgConfirmEditDoc.show()" global="false"/>   
                                </h:panelGroup>
                                <ui:repeat value="#{managedBonProvisoire.bonProvisoire.etapesValidations}" var="etapeM"  >
                                    <p:contextMenu for="etape_valide_doc_divers" style="font-size: 0.7em" rendered="#{etapeM.etapeValid or etapeM.motif != null}">
                                        <p:menuitem icon="ui-icon-newwin" value="#{lab.LC_PFA_proprietes}" title="#{lab.LC_PFA_voir_proprietes_validations}" oncomplete="dlgppteValid.show()" rendered="#{etapeM.etapeValid}"
                                                    update=":form_ppte_valid_bonp:table_ppte_valid_bonp"/>
                                        <p:menuitem icon="ui-icon-clipboard" value="#{lab.LC_PA_motif_annulation}" title="#{lab.LC_PA_voir_motif_annulation}" oncomplete="dglMotifCancelEtape.show()" rendered="#{etapeM.motif != null}"
                                                    update=":main-motif_etap_bonp:value_motif_etap_bonp" actionListener="#{managedBonProvisoire.motifEtapeFacture(etapeM.motif, true)}"/>
                                        <p:separator rendered="#{etapeM.etapeValid}"/>
                                        <p:menuitem icon="ui-icon-circle-arrow-w" value="#{lab.L_annuler}" oncomplete="dglMotifCancelEtape.show()" rendered="#{etapeM.etapeValid}"
                                                    update=":main-motif_etap_bonp:value_motif_etap_bonp" actionListener="#{managedBonProvisoire.annulEtapeOrdre(etapeM, false)}"/>
                                    </p:contextMenu>
                                    <p:commandLink id="etape_valide_doc_divers" value="#{etapeM.etape.labelStatut}" disabled="#{(!etapeM.etapeActive or etapeM.etapeValid)}" title="#{etapeM.etape.titreEtape}" 
                                                   styleClass="#{(etapeM.etapeValid)?'statu_valide':'etat_formation_true'}" actionListener="#{managedBonProvisoire.validEtapeOrdre(etapeM, false)}"
                                                   update=":main_bon_provisoire:data_bon_provisoire :main_bon_provisoire:etapes_valide_bon_provisoire" />                        
                                    <h:outputText value=" #{lab.L_a} " rendered="#{!etapeM.etapeValid and etapeM.motif ne null}" title="#{lab.LC_PA_annuler_pour} : #{etapeM.motif}" style="position: relative;left: -10px; top: 5px; font-size: 0.7em; color: #FFF; background: red; border-radius: 5px;"/>
                                </ui:repeat>
                                <h:panelGroup style="float: right">
                                    <p:commandLink value="#{(managedBonProvisoire.bonProvisoire.statut==constantes.STATUT_DOC_VALIDE)?lab.L_valide:lab.L_valider}" 
                                                   disabled="#{(managedBonProvisoire.bonProvisoire.statut == constantes.STATUT_DOC_VALIDE)}"
                                                   styleClass="#{(managedBonProvisoire.bonProvisoire.statut==constantes.STATUT_DOC_VALIDE)?'statut_valide':'etat_formation_true'}" 
                                                   onclick="dlgValidDoc.show()" 
                                                   rendered="#{(managedBonProvisoire.bonProvisoire.etapesValidations.size() le 0) and managedBonProvisoire.bonProvisoire.id gt 0}" type="button"/>  
                                    <p:commandLink value="#{managedBonProvisoire.writeEtape(((managedBonProvisoire.bonProvisoire.statutJustify==constantes.STATUT_DOC_JUSTIFIER)?lab.LCF_PBP_injustifier:lab.LCF_PBP_justifier), managedBonProvisoire.bonProvisoire.firstEtape)}"
                                                   actionListener="#{managedBonProvisoire.justifybon()}" styleClass="etat_formation_true" disabled="#{managedBonProvisoire.bonProvisoire.statut!=constantes.STATUT_DOC_VALIDE}"
                                                   update=":main_bon_provisoire:data_bon_provisoire :main_bon_provisoire:etapes_valide_bon_provisoire"
                                                   title="#{lab.LCF_PBP_justifier_par} #{managedBonProvisoire.bonProvisoire.statutJustify==constantes.STATUT_DOC_JUSTIFIER?managedBonProvisoire.selectBon.justifyBy.nomUsers:'---'}"/>                               
                                </h:panelGroup>
                            </p:outputPanel>                      
                        </h:panelGroup>
                    </p:outputPanel>
                    <p:outputPanel id="blog_form_bon_provisoire">
                        <div style="clear: both"/>
                        <h:panelGrid columns="4" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0" id="form_bon_provisoire">
                            <f:facet name="header">
                                <p:watermark for="txt_description_bon" value="#{lab.L_description}" />
                                <h:panelGroup id="blog_bon_provisoire">
                                    <h:panelGroup style="float: left">                                        
                                        <span>#{lab.LCF_PBP_type_bon} : </span>
                                        <h:selectOneMenu value="#{managedBonProvisoire.bonProvisoire.typeDoc.id}" style="min-width: 120px">
                                            <f:selectItem itemLabel="--" itemValue="#{0}" />
                                            <f:selectItems value="#{managedTypeDocDivers.typesDocDivers}" var="id_ty" itemValue="#{id_ty.id}" itemLabel="#{id_ty.libelle}" />
                                        </h:selectOneMenu>    
                                    </h:panelGroup>
                                    <h:panelGroup id="blog_document_bon" style="float: right">
                                        <span style="font-weight: normal">#{lab.LCF_PBP_document} : </span> 
                                        <h:selectOneMenu value="#{managedBonProvisoire.bonProvisoire.bonFor}">
                                            <f:selectItem itemValue="O" itemLabel="#{lab.LDB_PCB_autres.toUpperCase()}"/>
                                            <f:selectItem itemValue="M" itemLabel="#{lab.LDB_PCB_missions.toUpperCase()}"/>
                                            <f:selectItem itemValue="A" itemLabel="#{lab.LDB_PCB_achats.toUpperCase()}"/>
                                            <f:selectItem itemValue="D" itemLabel="#{lab.LCF_PBP_op_divers}"/>
                                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.chooseForBon(false, true)}" update="blog_document_bon"/>
                                        </h:selectOneMenu>  
                                        <h:panelGroup style="float: right">
                                            <h:panelGroup id="blog_mission_bon" rendered="#{managedBonProvisoire.bonProvisoire.bonFor == 'M'}">
                                                <span> --> </span>
                                                <h:inputText value="#{managedBonProvisoire.bonProvisoire.numeroExterne}" style="color: #{managedBonProvisoire.bonProvisoire.mission.error?'red':'normal'};width: 150px">
                                                    <p:ajax event="valueChange" listener="#{managedBonProvisoire.searchMission()}" update="blog_mission_bon"/>
                                                </h:inputText>
                                                <p:commandButton icon="ui-icon-search" style="width: 20px; height: 20px; margin-left: 5px; display: inline" actionListener="#{managedBonProvisoire.openListMission(null, false)}"/>
                                                <h:outputText value="#{managedBonProvisoire.bonProvisoire.mission.employe.nom_prenom}" style="font-size: 0.8em;margin-left: 5px; font-weight: normal"/>
                                            </h:panelGroup><br />
                                            <h:panelGroup layout="block" rendered="#{managedBonProvisoire.bonProvisoire.mission.bonsProvisoire.size() gt 0}">
                                                <ui:repeat value="#{managedBonProvisoire.bonProvisoire.mission.bonsProvisoire}" var="missBp">
                                                    <span style="font-style: normal; font-size: 0.6em; color: #990000; display: #{(missBp.piece.id ne managedBonProvisoire.bonProvisoire.id)?'inline':'none'}"> :#{missBp.piece.numero} ;</span>
                                                </ui:repeat>
                                            </h:panelGroup>
                                        </h:panelGroup>
                                        <h:panelGroup style="float: right">
                                            <h:panelGroup id="blog_achat_bon" rendered="#{managedBonProvisoire.bonProvisoire.bonFor == 'A'}">
                                                <span> --> </span>
                                                <h:inputText value="#{managedBonProvisoire.bonProvisoire.numeroExterne}" style="color: #{managedBonProvisoire.bonProvisoire.achat.error?'red':'normal'};width: 150px">
                                                    <p:ajax event="valueChange" listener="#{managedBonProvisoire.searchAchat()}" update="blog_achat_bon"/>
                                                </h:inputText>
                                                <p:commandButton icon="ui-icon-search" style="width: 20px; height: 20px; margin-left: 5px; display: inline" actionListener="#{managedBonProvisoire.openListAchat(null, false)}"/>
                                                <h:outputText value="#{managedBonProvisoire.bonProvisoire.achat.fournisseur.nom_prenom}" style="font-size: 0.8em;margin-left: 5px; font-weight: normal"/>
                                            </h:panelGroup><br />
                                            <h:panelGroup layout="block" rendered="#{managedBonProvisoire.bonProvisoire.achat.bonsProvisoire.size() gt 0}">
                                                <ui:repeat value="#{managedBonProvisoire.bonProvisoire.achat.bonsProvisoire}" var="achatBp">
                                                    <span style="font-style: normal; font-size: 0.6em; color: #990000; display: #{(achatBp.piece.id ne managedBonProvisoire.bonProvisoire.id)?'inline':'none'}"> :#{achatBp.piece.numero} ;</span>
                                                </ui:repeat>
                                            </h:panelGroup>
                                        </h:panelGroup>
                                        <h:panelGroup style="float: right">
                                            <h:panelGroup id="blog_divers_bon" rendered="#{managedBonProvisoire.bonProvisoire.bonFor == 'D'}">
                                                <span> --> </span>
                                                <h:inputText value="#{managedBonProvisoire.bonProvisoire.numeroExterne}" style="color: #{managedBonProvisoire.bonProvisoire.divers.error?'red':'normal'};width: 150px">
                                                    <p:ajax event="valueChange" listener="#{managedBonProvisoire.searchDivers()}" update="blog_divers_bon"/>
                                                </h:inputText>
                                                <p:commandButton icon="ui-icon-search" style="width: 20px; height: 20px; margin-left: 5px; display: inline" actionListener="#{managedBonProvisoire.openListDivers(null, false)}"/>
                                                <h:outputText value="#{managedBonProvisoire.resumeText(managedBonProvisoire.bonProvisoire.divers.description)}" style="font-size: 0.8em;margin-left: 5px; font-weight: normal"/>
                                            </h:panelGroup><br />
                                            <h:panelGroup layout="block" rendered="#{managedBonProvisoire.bonProvisoire.divers.bonsProvisoire.size() gt 0}">
                                                <ui:repeat value="#{managedBonProvisoire.bonProvisoire.divers.bonsProvisoire}" var="diversBp">
                                                    <span style="font-style: normal; font-size: 0.6em; color: #990000; display: #{(diversBp.piece.id ne managedBonProvisoire.bonProvisoire.id)?'inline':'none'}"> :#{diversBp.bon.numero} ;</span>
                                                </ui:repeat>
                                            </h:panelGroup>
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </h:panelGroup>
                            </f:facet>
                            <span>#{lab.LCF_PBP_date_bon}</span>                                                      
                            <p:calendar value="#{managedBonProvisoire.bonProvisoire.dateBon}" navigator="true" pattern="dd-MM-yyyy" size="10"/>   
                            <span>#{lab.L_montant}</span>      
                            <h:panelGroup id="chmp_montant_bon_provisoire">
                                <pe:inputNumber value="#{managedBonProvisoire.bonProvisoire.montant}" style="text-align: right" decimalPlaces="0" autocomplete="false" >
                                    <p:ajax event="blur" global="false" />
                                </pe:inputNumber>  
                                <h:panelGroup style="float: right">
                                    <h:outputText value="#{lab.LCF_PBP_reste_a_justifier} :"/>
                                    <h:outputText title="#{lab.LCF_PBP_en_attente_validation} : #{managedBonProvisoire.bonProvisoire.attente}" value="#{managedBonProvisoire.bonProvisoire.reste}" 
                                                  style="font-size: 0.9em;margin-left: 5px;font-weight: bold" converter="DNA"/>
                                </h:panelGroup>
                            </h:panelGroup>                               
                            <span>#{lab.LCF_PBP_beneficiaire}</span>
                            <h:panelGroup id="chmp_tiers_bon_provisoire">        
                                <h:inputText value="#{managedBonProvisoire.bonProvisoire.beneficiaire}" style="color: #{managedBonProvisoire.bonProvisoire.tiers.error?'red':''};width: 70%">
                                    <p:ajax event="valueChange" global="false" listener="#{managedBonProvisoire.searchTiers()}" update="chmp_tiers_bon_provisoire"/>
                                </h:inputText> 
                                <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="#{lab.LDB_PC_liste_tiers}" global="false"
                                                 onclick="dlgListTiers.show()"/>
                                <h:outputText value="#{managedBonProvisoire.bonProvisoire.tiers.codeTiers}" style="font-size: 0.9em;float: right;font-weight: bold;margin-top: 5px"/>
                            </h:panelGroup>
                            <span>#{lab.L_caisse}</span>
                            <h:panelGroup>
                                <h:selectOneMenu value="#{managedBonProvisoire.bonProvisoire.caisse.id}" style="min-width: 200px">
                                    <f:selectItem itemLabel="--" itemValue="0" />
                                    <f:selectItems value="#{managedCaisses.caisses}" var="iCais" itemLabel="#{iCais.intitule}" itemValue="#{iCais.id}" />       
                                    <p:ajax event="valueChange" global="false" listener="#{managedBonProvisoire.chooseCaisse()}" update="chmp_caissier_bon"/>             
                                </h:selectOneMenu>
                                <h:panelGroup id="chmp_caissier_bon" style="float: right">
                                    <h:outputText value="Caissier :" rendered="#{managedBonProvisoire.bonProvisoire.caissier.id gt 0}"/>
                                    <h:outputText value="#{managedBonProvisoire.bonProvisoire.caissier.nomUsers}" style="font-size: 0.9em;margin-left: 5px;font-weight: bold"/>
                                </h:panelGroup>
                            </h:panelGroup>
                            <f:facet name="footer">  
                                <h:outputText value="#{lab.L_description}" style="float: left"/>
                                <h:inputTextarea rows="3"  value="#{managedBonProvisoire.bonProvisoire.description}" id="txt_description_bon" style="width: 100%;margin-bottom: 5px">
                                    <p:ajax event="valueChange" global="false" />
                                </h:inputTextarea> 
                                <div align="center" style="font-weight: bold">
                                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0" styleClass="yvs_noStyle" style="font-size: 0.8em; float: left">
                                        <span>#{lab.LCF_PBP_valider_le} </span>
                                        <h:outputText value="#{managedBonProvisoire.bonProvisoire.dateValider}" converter="DATE" style="font-weight: bold"/>
                                        <span>#{lab.LCF_PBP_payer_le}</span>
                                        <h:outputText value="#{managedBonProvisoire.bonProvisoire.datePayer}" converter="DATE" style="font-weight: bold"/>
                                    </h:panelGrid>   
                                    <div style="clear: left" />
                                    <span>#{lab.LCF_PBP_ordonnateur} : </span>
                                    <h:panelGroup id="chmp_users_bon_provisoire">
                                        <h:inputText value="#{managedBonProvisoire.bonProvisoire.ordonnateur.codeUsers}" style="color: #{managedBonProvisoire.bonProvisoire.ordonnateur.error?'red':'normal'}" disabled="true">
                                            <p:ajax event="blur" global="false" listener="#{managedBonProvisoire.findOrdonnateur()}" update="chmp_users_bon_provisoire"/>
                                        </h:inputText>
                                        <p:commandButton icon="ui-icon-note" style="width: 20px; height: 20px; margin-left: 5px; display: inline" actionListener="#{managedBonProvisoire.openListUsers()}" rendered="false"/>
                                        <h:outputText value="#{managedBonProvisoire.bonProvisoire.ordonnateur.nomUsers}" style="font-size: 0.9em;margin-left: 5px"/>
                                    </h:panelGroup>                                    
                                </div>
                            </f:facet>
                        </h:panelGrid>  
                        <p:dataTable id="data-justificatifs_bon_provisoire" value="#{managedBonProvisoire.bonProvisoire.justificatifs}" var="justif_" rowKey="#{justif_.id}" rowIndexVar="jIdx">
                            <f:facet name="header">
                                <div align="left" style="font-size: 1.1em;font-weight: bold">
                                    <span style="color: black; letter-spacing: 2px;">#{lab.LCF_PBP_justificatifs}</span>                                      
                                </div>
                            </f:facet>       
                            <p:column width="40" styleClass="statut_#{justif_.statutPiece}">                            
                                <span title="#{managedBonProvisoire.resumeText(justif_.numeroPiece)}">#{justif_Idx+1}</span>                      
                            </p:column>
                            <p:column headerText="#{lab.LCF_PBP_numero_piece}" styleClass="statut_#{justif_.statutPiece}" width="100">
                                <span >#{justif_.numeroPiece}</span>
                                <h:panelGroup style="float: right;margin-top: 5px">
                                    <h:graphicImage library="img" name="P.png" width="12" height="12" rendered="#{justif_.statutPiece == constantes.STATUT_DOC_PAYER}"/>
                                </h:panelGroup>
                            </p:column>
                            <p:column headerText="#{lab.LCF_PBP_numero_ref}." styleClass="statut_#{justif_.statutPiece}" width="100">
                                <span   style="float: left">#{justif_.refExterne}</span>
                            </p:column>
                            <p:column headerText="#{lab.L_caisse}." styleClass="statut_#{justif_.statutPiece}" width="80">
                                <span >#{justif_.caisse.intitule}</span>
                            </p:column>
                            <p:column headerText="#{lab.L_tiers}" styleClass="statut_#{justif_.statutPiece}" width="100">
                                <span  >#{justif_.tiers.nom_prenom}</span>
                            </p:column>
                            <p:column headerText="#{lab.L_date}" width="80" styleClass="statut_#{justif_.statutPiece}">
                                <h:outputText value="#{justif_.dateJustifier}" converter="DDMMYYYY" />
                            </p:column>
                            <p:column headerText="#{lab.L_montant}" style="text-align: right;" width="100" styleClass="statut_#{justif_.statutPiece}">
                                <h:outputText value="#{justif_.montant}" converter="DN" style="padding-right: 2px" />
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_bon_provisoire" style="width: 99%; margin: auto; background: white">
                    <h:inputHidden id="input_hide_bon_provisoire" value="#{managedBonProvisoire.tabIds}"/>
                    <p:dataTable id="data_bon_provisoire" value="#{managedBonProvisoire.documents}" var="bon" rowKey="#{bon.id}" rowIndexVar="Idx" selectionMode="single">
                        <p:ajax event="rowSelect" global="false" listener="#{managedBonProvisoire.loadOnView}" 
                                oncomplete="collapseForm('bon_provisoire')" update=":main_bon_provisoire:etapes_valide_bon_provisoire :main_bon_provisoire:input_hide_bon_provisoire"/>
                        <p:column width="40" styleClass="statut_#{bon.statut}">          
                            <div style="float: left">
                                <span title="#{managedBonProvisoire.resumeText(bon.description)}">#{Idx+1}</span>
                                <h:graphicImage title="#{lab.L_nouveau}" library="img" name="redo.png" width="15" height="15" rendered="#{bon.new_}"/>  
                            </div>
                            <h:panelGroup style="float: right">
                                <h:outputText value="M" class="indice_statut" rendered="#{bon.bonMission.id gt 0}" title="#{lab.LCF_PBP_pour_mission_n} #{bon.bonMission.mission.mission.referenceMission}}"/>
                                <h:outputText value="A" class="indice_statut" rendered="#{bon.bonAchat.id gt 0}" title="#{lab.LCF_PBP_pour_facture_n} #{bon.bonAchat.piece.achat.numDoc}}"/>
                            </h:panelGroup>  
                        </p:column>                            
                        <p:column headerText="#{lab.L_numero}" styleClass="statut_#{bon.statut}" width="100">
                            <span title="#{managedBonProvisoire.resumeText(bon.description)}" style="float: left">#{bon.numero}</span>
                            <h:panelGroup style="float: right">
                                <h:outputText value="P" class="indice_statut" rendered="#{bon.statutPaiement=='P'}" title="#{lab.LCF_PVC_payer}"/>
                            </h:panelGroup>
                        </p:column>
                        <p:column headerText="#{lab.LCF_PBP_date_bon}" styleClass="statut_#{bon.statut}" width="80" style="text-align: center">
                            <h:outputText title="#{managedBonProvisoire.resumeText(bon.description)}" value="#{bon.dateBon}" converter="DDMMYYYY"/>
                        </p:column>
                        <p:column headerText="#{lab.L_montant}" styleClass="statut_#{bon.statut}" width="80" style="text-align: right">
                            <h:outputText title="#{managedBonProvisoire.resumeText(bon.description)}" value="#{bon.montant}" converter="DN"/>
                        </p:column>
                        <p:column headerText="#{lab.LCF_PBP_beneficiaire}" styleClass="statut_#{bon.statut}" width="100">
                            <span title="#{managedBonProvisoire.resumeText(bon.description)}" style="float: left">#{bon.beneficiaire}</span>
                            <h:panelGroup style="float: right">
                                <h:outputText value="J" class="indice_statut" rendered="#{bon.statutJustify eq constantes.ETAT_JUSTIFIE}" title="#{lab.LCF_PBP_justifie}"/>
                                <h:outputText value="E" class="indice_statut" rendered="#{bon.countJustif() gt 0 and bon.statutJustify ne constantes.ETAT_JUSTIFIE}" title="#{lab.LCF_PBP_encours}"/>
                            </h:panelGroup>
                        </p:column>
                        <p:column headerText="#{lab.LCF_PBP_ordonnateur}" styleClass="statut_#{bon.statut}" width="100">
                            <span title="#{managedBonProvisoire.resumeText(bon.description)}">#{bon.ordonnateur.nomUsers}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_caisse}" styleClass="statut_#{bon.statut}" width="100">
                            <span title="#{managedBonProvisoire.resumeText(bon.description)}">#{bon.caisse.intitule}</span>
                        </p:column>
                        <p:column headerText="Date paiement" styleClass="statut_#{bon.statut}" width="80" style="text-align: center">
                            <h:outputText title="#{managedBonProvisoire.resumeText(bon.description)}" value="#{bon.datePayer}" converter="DDMMYYYY"/>
                        </p:column>
                        <p:column headerText="#{lab.LCF_PBP_justifier_par}" styleClass="statut_#{bon.statut}" width="80" style="text-align: center">
                            <h:outputText title="#{bon.justifyBy.nomUsers}" value="#{managedBonProvisoire.resumeText(bon.justifyBy.nomUsers, 10)}"/>
                        </p:column>
                        <p:column headerText="Validé par" styleClass="statut_#{bon.statut}" width="80" style="text-align: center">
                            <h:outputText title="#{bon.validerBy.nomUsers}" value="#{managedBonProvisoire.resumeText(bon.validerBy.nomUsers, 20)}"/>
                        </p:column>
                        <p:column headerText="#{lab.LCF_PBP_etapes}" width="60" styleClass="statut_#{bon.statut}" style="font-size: 0.8em; text-align: center">
                            <h:outputText value="#{bon.libEtapes}" />
                        </p:column>
                        <p:column width="20" style="text-align: center" styleClass="statut_#{bon.statut}">                            
                            <p:contextMenu for="btn_option_bonp" event="left click" styleClass="context_menu">                                
                                <p:menuitem value="#{lab.LCF_PBP_associer}" icon="ui-icon-shuffle" actionListener="#{managedBonProvisoire.setSelectBon(bon)}"
                                            rendered="#{!bon.canJustify()}" oncomplete="dglAssociedDoc.show()"/>
                                <p:menuitem value="#{lab.LCF_PBP_payer}" icon="ui-icon-circle-check" title="#{lab.LCF_PBP_payer_bon_provisoire}" actionListener="#{managedBonProvisoire.openDlgConfirmValid(bon)}"
                                            rendered="#{bon.statutPaiement != constantes.STATUT_DOC_PAYER}" />   
                                <p:menuitem value="#{bon.statutJustify != constantes.STATUT_DOC_JUSTIFIER?lab.L_justifier:lab.LCF_PBP_injustifier.toLowerCase()}" icon="#{bon.statutJustify != constantes.STATUT_DOC_JUSTIFIER?'ui-icon-circle-check':'ui-icon-circle-close'}"
                                            title="#{bon.statutJustify != constantes.STATUT_DOC_JUSTIFIER?lab.L_justifier:lab.LCF_PBP_injustifier.toLowerCase()} #{lab.LCF_PBP_le_bon_provisoire}"
                                            actionListener="#{managedBonProvisoire.justifyBon(bon)}" rendered="#{bon.statutPaiement == constantes.STATUT_DOC_PAYER}" />         
                                <p:menuitem value="#{lab.L_annuler}" icon="ui-icon-circle-close" title="#{lab.LCF_PBP_annuler_bon_provisoire}" actionListener="#{managedBonProvisoire.openDlgConfirmSuspens(bon)}"
                                            rendered="#{bon.statutPaiement == constantes.STATUT_DOC_PAYER}" /> 
                                <p:separator />
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedBonProvisoire.deleteBean_(bon)}" oncomplete="dlgConfirmDelete_.show()" />
                            </p:contextMenu>
                            <p:commandButton icon="ui-icon-gear" id="btn_option_bonp" type="button" style="width: 18px; height: 18px"/>
                        </p:column> 
                        <p:column width="25" style="text-align: center" styleClass="statut_#{bon.statut}">
                            <f:facet name="header">
                                <h:selectBooleanCheckbox styleClass="chek_all_line_bon_provisoire" value="false" onclick="selectionAllLineTab(#{managedBonProvisoire.documents.size()}, 'bon_provisoire')"/>
                            </f:facet>
                            <h:selectBooleanCheckbox styleClass="chek_line_bon_provisoire" onclick="selectionLineTab(#{Idx}, 'bon_provisoire')"/>
                        </p:column> 
                    </p:dataTable>                               
                    <span class="nbSelectbon_provisoire" style="font-size: .8em; font-style: italic; color: #828c95;"></span>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedBonProvisoire.avancer(false)}" update="data_bon_provisoire" icon="ui-icon-circle-triangle-w" disabled="#{managedBonProvisoire.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedBonProvisoire.paginator.currentPage}/#{managedBonProvisoire.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedBonProvisoire.avancer(true)}" update="data_bon_provisoire" icon="ui-icon-circle-triangle-e" disabled="#{managedBonProvisoire.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedBonProvisoire.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedBonProvisoire.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedBonProvisoire.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_bon_provisoire"/>
                        </p:selectOneMenu>
                    </p:outputPanel>          
                </div> 
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>  
            <div class="zone_find">
                <div class="yvs_form_bon_provisoire display_auteur" align="right"  style="font-style: italic;">
                    <p:outputPanel autoUpdate="true" layout="block">
                        <span style="float: left">#{lab.L_enregistrer_le} <h:outputText value="#{managedBonProvisoire.selectBon.dateSave}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span> 
                        <span>#{lab.L_modifier_le} <h:outputText value="#{managedBonProvisoire.selectBon.dateUpdate}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span>
                        <span>#{lab.L_par} <h:outputText value="#{managedBonProvisoire.selectBon.author.users.nomUsers}"  styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <h:panelGrid id="blog_search_bon_provisoire" columns="2" style="width: 100%" cellpadding="0" cellspacing="0">
                    <h:panelGrid columns="10" style="float: left; font-size: 0.8em" cellpadding="0" cellspacing="0">
                        <h:outputText value="" />
                        <h:panelGroup>
                            <h:selectBooleanCheckbox value="#{managedBonProvisoire.addDate}">
                                <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamDate()}" update="blog_date_search_bon_provisoire"/>
                            </h:selectBooleanCheckbox>
                            <h:outputText value="#{lab.L_date}" />
                        </h:panelGroup>
                        <h:outputText value="#{lab.LCF_PBP_beneficiaire}" />
                        <h:outputText value="#{lab.LCF_PBP_ordonnateur}" />
                        <h:panelGroup>
                            <h:outputText value="#{lab.L_statut}" style="float:left;margin-top: 2px"/>
                            <h:selectOneMenu value="#{managedBonProvisoire.egaliteStatut}" style="float:right;margin-right: 5px; ">
                                <f:selectItem itemLabel="#{lab.L_egale}" itemValue="="/>
                                <f:selectItem itemLabel="#{lab.L_different}" itemValue="!="/>
                                <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamStatut()}" oncomplete="collapseList('bon_provisoire')"/>
                            </h:selectOneMenu>  
                        </h:panelGroup>
                        <h:outputText value="#{lab.L_caisse}" />
                        <h:outputText value="#{lab.L_reference}" />
                        <h:outputText value="#{lab.LCF_PBP_a_faire}" />
                        <h:outputText value="" />
                        <span>&nbsp;</span>
                        <p:commandButton icon="ui-icon-bullet" actionListener="#{managedBonProvisoire.clearParams()}" title="#{lab.L_reset_param}" style="width: 20px; height: 22px"
                                         oncomplete="collapseList('bon_provisoire')"  />
                        <h:panelGroup id="blog_date_search_bon_provisoire">
                            <p:calendar value="#{managedBonProvisoire.dateDebutSearch}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedBonProvisoire.addDate}" size="10" style="font-size: 0.8em">
                                <p:ajax event="dateSelect" listener="#{managedBonProvisoire.addParamDate()}"/>
                            </p:calendar>
                            <p:spacer width="5px" style="background: black"/>
                            <p:calendar value="#{managedBonProvisoire.dateFinSearch}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedBonProvisoire.addDate}" size="10" style="font-size: 0.8em">
                                <p:ajax event="dateSelect" listener="#{managedBonProvisoire.addParamDate()}"/>
                            </p:calendar>
                        </h:panelGroup>
                        <h:inputText value="#{managedBonProvisoire.tiersSearch}">
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamTiers()}" oncomplete="collapseList('bon_provisoire')"/>
                        </h:inputText>
                        <h:inputText value="#{managedBonProvisoire.usersSearch}">
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamUsers()}" oncomplete="collapseList('bon_provisoire')"/>
                        </h:inputText> 
                        <h:selectOneMenu value="#{managedBonProvisoire.statutSearch}" style="min-width: 120px">
                            <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                            <f:selectItem itemLabel="#{lab.L_editable}" itemValue="#{constantes.ETAT_EDITABLE}"/>
                            <f:selectItem itemLabel="#{lab.L_annulers}" itemValue="#{constantes.ETAT_ANNULE}"/>
                            <f:selectItem itemLabel="#{lab.L_en_cours}" itemValue="#{constantes.ETAT_ENCOURS}"/>
                            <f:selectItem itemLabel="#{lab.L_valider}" itemValue="#{constantes.ETAT_VALIDE}"/>
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamStatut()}" oncomplete="collapseList('bon_provisoire')"/>
                        </h:selectOneMenu> 
                        <h:selectOneMenu value="#{managedBonProvisoire.caisseSearch}" style="max-width: 200px;min-width: 200px">
                            <f:selectItem itemLabel="--" itemValue="0" />
                            <f:selectItems value="#{managedCaisses.caisses}" var="sCais" itemLabel="#{sCais.intitule}" itemValue="#{sCais.id}" />       
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamCaisse()}" oncomplete="collapseList('bon_provisoire')"/>             
                        </h:selectOneMenu>
                        <h:inputText value="#{managedBonProvisoire.numSearch}">
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamNumero()}" oncomplete="collapseList('bon_provisoire')"/>
                        </h:inputText>
                        <h:selectOneMenu value="#{managedBonProvisoire.toValideLoad}" style="min-width: 80px">
                            <f:selectItem itemLabel="#{lab.L_oui.toUpperCase()}" itemValue="#{true}"/>
                            <f:selectItem itemLabel="#{lab.L_non.toUpperCase()}" itemValue="#{false}"/>
                            <p:ajax event="valueChange" listener="#{managedBonProvisoire.addParamToValide()}" oncomplete="collapseList('bon_provisoire')"/>
                        </h:selectOneMenu> 
                        <p:commandLink style="border: 2px solid black; border-radius: 5px;padding: 2px;font-size: 0.8em" 
                                       onclick="dlgPlusOption.show()" global="false" value="#{lab.L_plus_option}"/>
                    </h:panelGrid>                        
                    <h:panelGroup style="float: right">

                    </h:panelGroup>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

