<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Evénements','modMutuelle', 'smenEvenement', true,managedEvenement)}
    </ui:define>   
    <ui:define name="contents"> 
        #{managedMutualiste.loadActif(true)}
        #{managedMutualiste.loadCompte(constantes.MUT_TYPE_COMPTE_ASSURANCE)}
        #{managedMutuelle.loadCaisse(constantes.MUT_TYPE_COMPTE_ASSURANCE)}
        #{Mdico.loadPays()}
        #{Mdico.loadVilles()}
        #{managedTypeEvenement.loadAll()}
        #{managedEvenement.loadAll()}
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 140);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('evenement');
                collapseForm('cout_evenement');
                collapseForm('participant_evenement');
                collapseForm('contribution_evenement');
            });
        </script>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmCreate" closeOnEscape="true"
                             message="#{lab.LM_PM_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" onclick="dlgConfirmCreate.hide()" oncomplete="dlgAddExercice.show()" global="false"/>
                <p:commandButton type="button" value="#{lab.L_non}" onclick="dlgConfirmCreate.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.LDB_PEX_creation_exercice}" widgetVar="dlgAddExercice" 
                      width="25%" modal="true" closeOnEscape="true">
                <h:panelGrid columns="1" styleClass="yvs_table" style="width: 100%">
                    <h:panelGrid columns="2" styleClass="yvs_table" style="width: 98%;margin: auto"> 
                        <span>#{lab.L_reference} </span>  
                        <h:inputText value="#{exercice.reference}"/>
                        <span>#{lab.L_date_debut} </span> 
                        <p:calendar value="#{exercice.dateDebut}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_date_fin} </span>
                        <p:calendar value="#{exercice.dateFin}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_actif} </span>
                        <h:selectBooleanCheckbox value="#{exercice.actif}"/>
                    </h:panelGrid>
                    <p:commandButton value="#{lab.L_enregistre}" actionListener="#{managedExercice.saveNew()}"
                                     oncomplete="dlgAddExercice.hide(); saveBeanEvenement_()" style="width: 100%"/> 
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form>    

        <!-->
        *****************************************************************************
        Boite de dialogue de details des evenements
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgViewEvenement_">
            <p:dialog id="dlgViewEvenement_" header="#{lab.LM_PE_details_evenement}" widgetVar="dlgViewEvenement" 
                      modal="true" width="40%"  closeOnEscape="true" showEffect="clip" hideEffect="clip" > 
                <h:panelGrid columns="2"  id="view_detail_evenement" styleClass="yvs_table" style="width: 98%;margin:auto" cellpadding="0" cellspacing="0"> 
                    <span>#{lab.LM_PE_type_evenement} </span> 
                    <h:selectOneMenu value="#{evenement.type.id}">
                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                        <f:selectItems value="#{typeEvenements}" var="type_" 
                                       itemLabel="#{type_.designation}" itemValue="#{type_.id}" />
                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                    </h:selectOneMenu>                                   
                    <span>#{lab.LM_PE_mutualiste} </span> 
                    <h:panelGroup>
                        <h:inputText id="txt_mutualiste_evenement_" value="#{evenement.mutualiste.employe.nom}" readonly="true"/>
                        <p:commandButton icon="ui-icon-search" global="false" onclick="dlgListMutualistes.show();" style="width: 22px; height: 22px"/>
                    </h:panelGroup>
                    <span>#{lab.L_date_debut} </span>
                    <h:panelGroup>
                        <p:calendar value="#{evenement.dateDebut}" navigator="true" pattern="dd-MM-yyyy" size="8"/>
                        <p:spacer width="1"/>
                        <pe:timePicker value="#{evenement.heureDebut}"/>
                    </h:panelGroup>
                    <span>#{lab.L_date_fin} </span>
                    <h:panelGroup>
                        <p:calendar value="#{evenement.dateFin}" navigator="true" pattern="dd-MM-yyyy" size="8"/>
                        <p:spacer width="1"/>
                        <pe:timePicker value="#{evenement.heureFin}"/>
                    </h:panelGroup>
                    <span>#{lab.L_ville} </span>
                    <h:selectOneMenu value="#{evenement.lieu.id}">
                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                        <f:selectItems value="#{Mdico.villes}" var="dic1_" 
                                       itemLabel="#{dic1_.libele}" itemValue="#{dic1_.id}" />
                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                        <p:ajax event="valueChange" global="false" listener="#{managedEvenement.chooseVille()}"/>
                    </h:selectOneMenu>   
                    <span>#{lab.L_montant} </span>
                    <h:inputText value="#{evenement.montantObligatoire}"/>
                    <f:facet name="footer">
                        <span>#{lab.L_description} </span>
                        <h:inputTextarea value="#{evenement.description}" style="width: 98%" rows="5"/>
                    </f:facet>
                </h:panelGrid>
                <p:commandButton value="#{lab.L_nouveau}" style="float: left" actionListener="#{managedEvenement.resetFiche()}" 
                                 update="view_detail_evenement"/>
                <p:commandButton value="#{lab.L_enregistrer}" style="float: right" actionListener="#{managedEvenement.saveNew()}"
                                 oncomplete="dlgViewEvenement.hide()"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de villes et pays
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.LDB_PTT_creation_pays}" widgetVar="dlgAddPays" modal="true" width="25%"  closeOnEscape="true" > 
                <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%" >
                    <span>#{lab.L_designation} </span>
                    <h:inputText value="#{Mdico.etat.libelle}"/>
                    <p:commandButton value="#{lab.L_enregistrer}" oncomplete="dlgAddPays.hide()"
                                     actionListener="#{Mdico.saveNewPays()}" update="pays_ville_evt" style="float: right"/>
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
            <p:dialog header="#{lab.L_ville}" widgetVar="dlgAddVille" modal="true" width="25%" closeOnEscape="true"> 
                <h:panelGrid columns="2" style="width: 98%;margin: auto">
                    <span>#{lab.L_designation} </span>
                    <h:inputText value="#{Mdico.ville.libelle}"/>
                    <span>#{lab.L_pays} </span>
                    <h:selectOneMenu value="#{Mdico.idPays}" id="pays_ville_evt" onchange="openDialog(dlgAddPays, $(this));">
                        <f:selectItem itemLabel="--" itemValue="0"/>
                        <f:selectItems value="#{Mdico.pays}" var="pys" 
                                       itemLabel="#{pys.libele}" itemValue="#{pys.id}" />
                        <f:selectItem itemLabel="--" itemValue="0"/>
                        <f:selectItem itemLabel="#{lab.L_creer}" itemValue="-1"/>
                    </h:selectOneMenu>   
                </h:panelGrid>
                <p:commandButton value="#{lab.L_enregister}" style="float: right" oncomplete="dlgAddVille.hide()"
                                 actionListener="#{Mdico.saveNewVilleById(Mdico.idPays)}" update=":main_evt:ville_evenement "/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de creation des type d'evenement
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.LM_PE_type_evenement}" widgetVar="dlgTypeEvenement" modal="true" width="35%"  closeOnEscape="true" > 
                <h:panelGrid columns="2" styleClass="yvs_table" style="width: 100%" cellpadding="0" cellspacing="0">
                    <span>#{lab.L_designation} </span>
                    <h:inputText value="#{typeEvenement.designation}"/>
                    <span>#{lab.LM_PE_nombre_participant} </span>
                    <pe:inputNumber value="#{typeEvenement.nombreRepresentant}"/>
                    <span>#{ab.LM_PPG_lier_mutualiste} </span>
                    <h:selectBooleanCheckbox value="#{typeEvenement.lierMutualiste}"/>
                    <f:facet name="footer">
                        <span>#{lab.L_description} </span>
                        <h:inputTextarea value="#{typeEvenement.description}" rows="3" style="width: 98%"/>
                    </f:facet>
                </h:panelGrid>
                <p:commandButton value="#{lab.L_description}" style="float: right" oncomplete="dlgTypeEvenement.hide()"
                                 actionListener="#{managedTypeEvenement.saveNew()}" update=":main_evt:select_type_evenement"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:dialog header="#{lab.LM_PEA_mutualistes}" widgetVar="dlgListMutualistes" modal="true" width="50%"  height="465" closeOnEscape="true">  
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:panelGroup>
                        <h:inputText value="#{managedMutualiste.numSearch}" >
                            <p:ajax event="blur" listener="#{managedMutualiste.addParamReference()}" update="data_mutualiste_evt data_mutualiste_participant" />
                        </h:inputText>
                    </h:panelGroup>
                    <h:panelGroup style="float: right">
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedMutualiste.paginer(false)}" update="data_mutualiste_evt data_mutualiste_participant" icon="ui-icon-circle-triangle-w"  disabled="#{managedMutualiste.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedMutualiste.paginator.currentPage}/#{managedMutualiste.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedMutualiste.paginer(true)}" update="data_mutualiste_evt data_mutualiste_participant" icon="ui-icon-circle-triangle-e"  disabled="#{managedMutualiste.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedMutualiste.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedMutualiste.choosePaginator}">
                                <f:selectItems value="#{managedMutualiste.paginations}" />
                                <p:ajax event="valueChange"  update="data_mutualiste_evt data_mutualiste_participant" />
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </h:panelGroup>
                </h:panelGrid>
                <p:dataTable id="data_mutualiste_evt" value="#{managedMutualiste.mutualistes}" var="mutua_" rowKey="#{mutua_.id}" rowIndexVar="mutua_Idx"
                             scrollable="true" scrollHeight="400" selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedEvenement.loadOnViewMutualiste}" oncomplete="dlgListMutualistes.hide()"/>
                    <p:column headerText="N°" style="width: 1%;text-align: center">
                        <span>#{mutua_Idx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.LDB_PD_matricule}" width="60">
                        <span>#{mutua_.employe.matricule}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.LM_PM_mutualiste}" width="150">
                        <span>#{mutua_.employe.nom_prenom}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.L_agence}" width="60">
                        <span>#{mutua_.employe.agence.designation}</span>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
            <p:dialog header="#{lab.LM_PEA_mutualistes}" widgetVar="dlgListParticipant" modal="true" width="50%"  height="465" closeOnEscape="true">  
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:panelGroup>
                        <h:inputText value="#{managedMutualiste.numSearch}" >
                            <p:ajax event="keyup" listener="#{managedMutualiste.addParamReference()}" update="data_mutualiste_evt data_mutualiste_participant"/>
                        </h:inputText>
                    </h:panelGroup>
                    <h:panelGroup style="float: right">
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedMutualiste.paginer(false)}" update="data_mutualiste_evt data_mutualiste_participant" icon="ui-icon-circle-triangle-w"  disabled="#{managedMutualiste.paginator.disPrev}"
                                             />
                            <p:outputPanel ><p:outputLabel value="#{managedMutualiste.paginator.currentPage}/#{managedMutualiste.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedMutualiste.paginer(true)}" update="data_mutualiste_evt data_mutualiste_participant" icon="ui-icon-circle-triangle-e"  disabled="#{managedMutualiste.paginator.disNext}"
                                             />
                            <p:selectOneMenu value="#{managedMutualiste.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedMutualiste.choosePaginator}">
                                <f:selectItems value="#{managedMutualiste.paginations}" />
                                <p:ajax event="valueChange"  update="data_mutualiste_evt data_mutualiste_participant"  />
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </h:panelGroup>
                </h:panelGrid>
                <p:dataTable id="data_mutualiste_participant" value="#{managedMutualiste.mutualistes}" var="mutua_" rowKey="#{mutua_.id}" rowIndexVar="mutua_Idx"
                             scrollable="true" scrollHeight="400" selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedEvenement.loadOnViewMutualisteParticipant}" oncomplete="dlgListParticipant.hide()"/>
                    <p:column headerText="N°" style="width: 1%;text-align: center">
                        <span>#{mutua_Idx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.LDB_PD_matricule}" width="60">
                        <span>#{mutua_.employe.matricule}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.LM_PM_mutualiste}" width="150">
                        <span>#{mutua_.employe.nom_prenom}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.L_agence}" width="60">
                        <span>#{mutua_.employe.agence.designation}</span>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false" id="main_montant_contribution">
            <p:dialog showHeader="false" widgetVar="dlgSetMontant" 
                      width="25%" modal="true" closeOnEscape="true" resizable="false">
                <h:panelGrid columns="3" styleClass="yvs_nostyle" style="width: 100%" cellpadding="0" cellspacing="0">
                    <span>#{lab.L_montant}</span>
                    <pe:inputNumber value="#{managedEvenement.contribution.montant}" decimalPlaces="0" style="width: 100px;text-align: center"/>
                    <p:commandButton value="#{lab.L_enregistrer}" icon="ui-icon-disk" update=":main_evt:data_evenement"
                                     actionListener="#{managedEvenement.saveNewContribution()}" oncomplete="dlgSetMontant.hide()" /> 
                </h:panelGrid>
            </p:dialog>
        </h:form> 

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="#{lab.LDB_PD_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedEvenement.deleteBean()}" oncomplete="dlgConfirmDelete.hide(); afterDeleteCredit()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
       
        <!-->
        *****************************************************************************
        Début du formulaire
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="main_evt">   
            <div class="part_fix">
                <p:splitButton value="#{lab.L_enregistrer}" id="save_evenement" actionListener="#{managedEvenement.saveNew()}"
                               update="blog_form_evenement" icon="ui-icon-disk">
                    <p:menuitem value="#{lab.L_nouveau}" id="cancel_evenement" global="false" actionListener="#{managedEvenement.resetFiche()}"
                                update="blog_form_evenement" icon="ui-icon-document" />
                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" onclick="dlgConfirmDelete.show()"/>
                </p:splitButton>
                <p:commandButton value="#{lab.L_supprimer}" id="delete_evenement" icon="ui-icon-trash" global="false" onclick="dlgConfirmDelete.show()"/>
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedEvenement.parcoursInAllResult(false)}" update="txt_parc_linear_evenement" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('evenement')"/>
                    <h:inputText value="#{managedEvenement.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_parc_linear_evenement"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedEvenement.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedEvenement.parcoursInAllResult(true)}" update="txt_parc_linear_evenement" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('evenement')"/>
                </h:panelGroup>                
                <div style="float: right">
                    <h:panelGrid columns="5" cellpadding="0" cellspacing="0">
                        <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('evenement');
                            return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <p:spacer />
                        <h:link title="#{lab.L_mode_liste}" onclick="collapseList('evenement');
                            return false" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>  
                        <p:spacer />
                        <h:link title="#{lab.L_mode_liste}" onclick="collapseGrid('evenement');
                            return false" >
                            <p:graphicImage library="icones" name="ico_arbre_2.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>  
                    </h:panelGrid>
                </div>
            </div>
            <div  class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_evenement">
                    <p:outputPanel id="blog_form_evenement" style="width: 99%; margin: auto; background: white">
                        <h:panelGrid columns="1" style="width: 100%">
                            <h:panelGrid columns="1" styleClass="yvs_nostyle" style="width: 100%">
                                <h:panelGroup style="padding: 1px;float: right; position: relative; margin-bottom: -1%;margin-top: -5px ;font-size: 0.8em" rendered="#{evenement.idEvt gt 0}">
                                    <p:outputPanel id="grp_btn_etat_16" styleClass="yvs_form_of">                                    
                                        <p:commandLink value="#{lab.LC_PFA_en_attente}" styleClass="button-stateOF #{(evenement.etat == constantes.ETAT_EDITABLE)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(evenement.etat == constantes.ETAT_VALIDE
                                                                   or evenement.etat == constantes.ETAT_ANNULE)}"
                                                       actionListener="#{managedEvenement.changeStatut(constantes.ETAT_EDITABLE)}"
                                                       process="@this" update="grp_btn_etat_16" global="false"/>
                                        <p:commandLink value="#{lab.LCF_PPC_valider}" styleClass="button-stateOF #{(evenement.etat == constantes.ETAT_VALIDE)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(evenement.etat == constantes.ETAT_EDITABLE)}"
                                                       actionListener="#{managedEvenement.changeStatut(constantes.ETAT_VALIDE)}"
                                                       process="@this" update="grp_btn_etat_16" global="false"/>
                                        <p:commandLink value="#{lab.LRH_PNF_refusee}" styleClass="button-stateOF #{(evenement.etat == constantes.ETAT_ANNULE)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(evenement.etat == constantes.ETAT_EDITABLE
                                                                   or evenement.etat == constantes.ETAT_VALIDE)}"
                                                       actionListener="#{managedEvenement.changeStatut(constantes.ETAT_ANNULE)}"
                                                       process="@this" update="grp_btn_etat_16" global="false"/>
                                        <p:commandLink value="#{lab.LC_PFA_en_cours}" styleClass="button-stateOF #{(evenement.etat==constantes.ETAT_ENCOURS)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(evenement.etat == constantes.ETAT_VALIDE)}"
                                                       actionListener="#{managedEvenement.changeStatut(constantes.ETAT_ENCOURS)}"
                                                       process="@this" update="grp_btn_etat_16" global="false"/>
                                        <p:commandLink value="#{lab.LDB_PEX_cloture}" styleClass="button-stateOF #{(evenement.etat==constantes.ETAT_CLOTURE)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(evenement.etat == constantes.ETAT_ENCOURS)}"
                                                       actionListener="#{managedEvenement.clotureEvt()}"
                                                       process="@this" update="grp_btn_etat_16" global="false"/>
                                    </p:outputPanel>                                                
                                </h:panelGroup>                                     
                            </h:panelGrid> 
                            <p:outputPanel>
                                <div style="width: 50%;float: left">
                                    <h:panelGrid columns="2" styleClass="yvs_table" style="width: 100%" cellpadding="0" cellspacing="0">  
                                        <f:facet name="header">
                                            <div align="left">
                                                <span>#{lab.L_type} : </span> 
                                                <h:selectOneMenu value="#{evenement.type.id}" id="select_type_evenement" disabled="#{evenement.idEvt gt 0}" style="min-width: 250px">
                                                    <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                                    <f:selectItems value="#{managedTypeEvenement.types}" var="type_" 
                                                                   itemLabel="#{type_.designation}" itemValue="#{type_.id}" />
                                                    <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                                    <f:selectItem itemLabel="#{lab.L_creer}" itemValue="-1"/>
                                                    <p:ajax event="valueChange" global="false" listener="#{managedEvenement.chooseType()}"/>
                                                </h:selectOneMenu>  
                                                <h:outputText value="#{evenement.idEvt}" style="font-size: 0.9em; padding: 3px; border: 1px solid #333; float: right" />
                                            </div>
                                        </f:facet>
                                        <span>#{lab.LM_PM_mutualiste} </span> 
                                        <h:panelGroup id="txt_mutualiste_evenement">                                             
                                            <h:inputText value="#{evenement.mutualiste.matricule}" style="color: #{evenement.mutualiste.error?'red':''}">
                                                <p:ajax event="blur" global="false" listener="#{managedEvenement.searchMutualiste()}" update="txt_mutualiste_evenement"/>
                                            </h:inputText>    
                                            <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="#{lab.LC_PPL_liste_client}" global="false"
                                                             actionListener="#{managedEvenement.initMutualistes()}" oncomplete="dlgListMutualistes.show()"/> 
                                            <h:outputText value="#{evenement.mutualiste.employe.nom_prenom}" style="margin-left: 10px;color: #009999"/>
                                        </h:panelGroup>
                                        <span>#{lab.L_date_debut} </span>
                                        <h:panelGroup>
                                            <p:calendar value="#{evenement.dateDebut}" navigator="true" pattern="dd-MM-yyyy" size="8"/>
                                            <p:spacer width="1"/>
                                            <pe:timePicker value="#{evenement.heureDebut}" style="width: 80px"/>
                                        </h:panelGroup>
                                        <span>#{lab.L_date_fin} </span>
                                        <h:panelGroup>
                                            <p:calendar value="#{evenement.dateFin}" navigator="true" pattern="dd-MM-yyyy" size="8"/>
                                            <p:spacer width="1"/>
                                            <pe:timePicker value="#{evenement.heureFin}"  style="width: 80px" />
                                        </h:panelGroup>
                                        <span>#{lab.L_ville} </span>
                                        <h:selectOneMenu value="#{evenement.lieu.id}" id="ville_evenement">
                                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                            <f:selectItems value="#{Mdico.villes}" var="vil" 
                                                           itemLabel="#{vil.libele}" itemValue="#{vil.id}" />
                                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                            <f:selectItem itemLabel="#{lab.L_creer}" itemValue="-1"/>
                                            <p:ajax event="valueChange" global="false" listener="#{managedEvenement.chooseVille()}"/>
                                        </h:selectOneMenu>   
                                        <span>#{lab.LM_PE_periode_contribution} </span>
                                        <h:panelGroup>
                                            <p:calendar value="#{evenement.dateOuvertureContribution}" navigator="true" pattern="dd-MM-yyyy" size="8"/>
                                            <span> #{lab.L_a} </span>
                                            <p:calendar value="#{evenement.dateClotureContribution}" navigator="true" pattern="dd-MM-yyyy" size="8"/>
                                        </h:panelGroup>
                                        <span>#{lab.LM_PE_montant_cotisation} </span>
                                        <h:panelGroup>
                                            <h:inputText value="#{evenement.montantObligatoire}" style="text-align: right"/>
                                            <span title="#{lab.LC_PEV_selectionner_caisse} ">#{lab.L_caisse} : </span>
                                            <h:selectOneMenu value="#{evenement.caisse.id}" style="min-width: 200px">
                                                <f:selectItem itemLabel="--" itemValue="-1" noSelectionOption="true"/>
                                                <f:selectItems value="#{managedMutuelle.caisses}" var="cai" 
                                                               itemLabel="#{cai.referenceCaisse}" itemValue="#{cai.id}" />
                                            </h:selectOneMenu>                                            
                                        </h:panelGroup>
                                        <span>#{lab.LM_PE_montant_attendu} </span>
                                        <h:inputText value="#{managedEvenement.montantAttendu()}" style="text-align: right" readonly="true" id="txt_montant_attendu_evement"/>
                                        <f:facet name="footer">
                                            <span style="margin-top: 3px">Description </span>
                                            <h:inputTextarea value="#{evenement.description}" style="width: 100%;margin-top: 2px;margin-bottom: 1px" rows="3"/>                                            
                                        </f:facet>
                                    </h:panelGrid>
                                </div>
                                <div style="margin-left: 50%">
                                    <span style="display: inline-block; background: #CCC; width: 100%;" >
                                        #{lab.LM_PPG_contributions} 
                                        <p:contextMenu for="btn_opt_contrib" event="left click">
                                            <p:menuitem value="#{lab.LM_PE_contributeur}" title="#{lab.LM_PE_ajouter_mutualiste}" icon="ui-icon-person" onclick="dlgListParticipant.show()" global="false"/>
                                            <p:menuitem value="#{lab.LM_PE_tous} " title="#{lab.LM_PE_ajouter_tous_mutualistes} " icon="ui-icon-newwin" actionListener="#{managedEvenement.saveAllContribution()}"
                                                        />
                                        </p:contextMenu>
                                        <p:commandButton icon="ui-icon-plus" type="button" id="btn_opt_contrib" style="float: right; width: 22px; height: 22px"/>
                                    </span>
                                    <p:dataTable id="data_tab_contribution" value="#{evenement.contributions}" var="cpt" rowKey="#{cpt.id}" rowIndexVar="Idx"
                                                 paginator="true" rows="30" paginatorAlwaysVisible="false" rowsPerPageTemplate="5,10,15,20,30" editMode="cell" editable="true">
                                        <p:column headerText="N°" width="30" style="text-align: center">
                                            <span>#{Idx+1}</span>
                                        </p:column>
                                        <p:column headerText="#{lab.LM_PE_mutualiste}" filterBy="#{cpt.compte.mutualiste.employe.nom}" styleClass="line_#{cpt.etat}">
                                            <span>#{cpt.compte.mutualiste.employe.nom_prenom}</span>
                                        </p:column>
                                        <p:column headerText="#{lab.L_compte}"  >
                                            <span>#{cpt.compte.reference}</span>
                                        </p:column>
                                        <p:column headerText="#{lab.LM_PE_montant_verse}" sortBy="#{cpt.montantVerse}" style="text-align: right;width: 15%">
                                            <p:cellEditor>
                                                <f:facet name="output">
                                                    <h:outputText value="#{cpt.montantVerse}" converter="DNA" style="text-align: right"/>
                                                </f:facet>
                                                <f:facet name="input">
                                                    <h:inputText value="#{cpt.montantVerse}" style="width: 100%"/>
                                                </f:facet>
                                            </p:cellEditor>                                             
                                        </p:column>
                                        <p:column headerText="#{lab.LM_PE_solde_compte}" sortBy="#{cpt.compte.mutualiste.montantTotalAssurance}" style="text-align: right;width: 15%">
                                            <h:outputText value="#{cpt.compte.solde}" converter="DNA" style="text-align: right"/>
                                        </p:column>
                                        <p:column width="30" style="text-align: center">
                                            <p:contextMenu for="btn_opt_contrib_act" event="left click">
                                                <p:menuitem value="#{lab.L_modifier}"  icon="ui-icon-check" />
                                                <p:menuitem value="#{lab.L_annuler}"  icon="ui-icon-circle-close" />
                                            </p:contextMenu>
                                            <p:commandButton icon="ui-icon-gear" actionListener="#{managedEvenement.addContribution(cpt)}" id="btn_opt_contrib_act"
                                                             style="width: 22px;height: 22px" update=":main_montant_contribution" />
                                        </p:column>
                                    </p:dataTable>
                                    <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%;margin-top: 5px;font-weight: bold" cellpadding="0" cellspacing="0">
                                        <h:panelGroup >
                                            <span>#{lab.LM_PE_montant_attendu} </span>
                                            <h:outputText value="#{evenement.montantAttendu}" converter="DNA"/>
                                            <span>Fcfa</span>
                                        </h:panelGroup >
                                    </h:panelGrid>
                                </div>

                            </p:outputPanel>
                        </h:panelGrid>
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_evenement" style="width: 99%; margin: auto">
                    <h:inputHidden id="input_hide_evenement" value="#{managedEvenement.tabIds}"/>
                    <p:dataTable id="data_evenement" value="#{managedEvenement.evenements}" var="evt" rowKey="#{evt.id}" rowIndexVar="evtIdx"
                                 selectionMode="single">
                        <p:ajax event="rowSelect" global="false" listener="#{managedEvenement.loadOnView}" update=":main_evt:input_hide_evenement"
                                oncomplete="collapseForm('evenement');"/>
                        <p:column width="30" headerText="N°" style="text-align: center">
                            <span>#{evtIdx+1}</span>
                        </p:column>
                        <p:column width="30" headerText="Id" style="text-align: center">
                            <span>#{evt.id}</span>
                        </p:column>
                        <p:column headerText="#{lab.LM_PE_mutualiste}">
                            <span>#{evt.mutualiste.employe.prenom} #{evt.mutualiste.employe.nom}</span>
                        </p:column>
                        <p:column headerText="#{lab.LM_PE_evenement}">
                            <span>#{evt.type.designation}</span>
                        </p:column>
                        <p:column headerText="#{lab.LM_PE_date_evenement}">
                            <h:outputText value="#{evt.dateDebut}" converter="DATE"/>
                            <span> #{lab.L_a} </span>
                            <h:outputText value="#{evt.heureDebut}" converter="TIME"/>
                        </p:column>
                        <p:column headerText="#{lab.LRH_PM_lieu}" style="text-align: center;width: 15%">
                            <span>#{evt.lieu.libele}</span>
                        </p:column>
                        <p:column headerText="#{lab.LM_PE_montant_attendu}" style="text-align: right;width: 10%">
                            <h:outputText value="#{evt.montantAttendu}" converter="DN"/>
                        </p:column>
                        <p:column headerText="#{lab.LM_PE_montant_recu}" style="text-align: right;width: 10%">
                            <h:outputText value="#{evt.montantRecu}" converter="DN"/>
                        </p:column>
                        <p:column headerText="#{lab.LM_PE_fiance_a} " style="text-align: right;width: 10%">
                            <h:outputText value="#{managedEvenement.montantFinancement(evt)}" converter="DN"/>
                        </p:column>
                        <p:column width="20" style="text-align: center">
                            <p:contextMenu for="option_evenement" event="left click" style="font-size: 0.8em">
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedEvenement.deleteBean(evt)}" update="data_evenement"/>
                            </p:contextMenu>                           
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="option_evenement" type="button"/> 
                        </p:column> 
                        <p:column width="25" style="text-align: center">
                            <f:facet name="header">
                                <h:selectBooleanCheckbox styleClass="chek_all_line_evenement" value="false"
                                                         onclick="selectionAllLineTab(#{managedEvenement.evenements.size()}, 'evenement')">
                                </h:selectBooleanCheckbox>
                            </f:facet>
                            <h:selectBooleanCheckbox  value="#{evt.selectActif }" styleClass="chek_line_evenement" 
                                                      onclick="selectionLineTab(#{evtIdx}, 'evenement')">
                            </h:selectBooleanCheckbox>
                        </p:column>
                    </p:dataTable>                              
                    <span class="nbSelectevenement" style="font-size: .8em; font-style: italic; color: #828c95;"></span>                   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                        <p:commandButton actionListener="#{managedEvenement.paginer(false)}" update=":main_evt:data_evenement" icon="ui-icon-circle-triangle-w"  disabled="#{managedEvenement.paginator.disPrev}"
                                         />
                        <p:outputPanel ><p:outputLabel value="#{managedEvenement.paginator.currentPage}/#{managedEvenement.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton action="#{managedEvenement.paginer(true)}" update=":main_evt:data_evenement" icon="ui-icon-circle-triangle-e"  disabled="#{managedEvenement.paginator.disNext}"
                                         />
                        <p:selectOneMenu value="#{managedEvenement.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em;" 
                                         valueChangeListener="#{managedEvenement.choosePaginator}">
                            <f:selectItems value="#{managedEvenement.paginations}" />
                            <p:ajax event="valueChange" update=":main_evt:data_evenement" />
                        </p:selectOneMenu>
                    </p:outputPanel>                                          
                </div> 
                <!-->
                 *****************************************************************************
                 Vue Calendrier
                 *****************************************************************************
                <-->
                <div class="yvs_grid_evenement" style="width: 99%; margin: auto">
                    <p:outputPanel  id="cal_evenement">
                        <p:schedule id="schedule_ev" value="#{managedEvenement.eventModel}" widgetVar="myschedule" timeFormat="" 
                                    locale="fr"  aspectRatio="2.8" timeZone="GMT+1" resizable="true" >
                            <p:ajax event="dateSelect" listener="#{managedEvenement.onDateSelect}" oncomplete="dlgViewEvenement.show();" />
                            <p:ajax event="eventSelect" listener="#{managedEvenement.onEventSelect}" oncomplete="dlgViewEvenement.show();" />
                            <p:ajax event="eventMove" listener="#{managedEvenement.onEventMove}" />
                            <p:ajax event="eventResize" listener="#{managedEvenement.onEventResize}"/>
                        </p:schedule>
                    </p:outputPanel>
                </div>
            </div>
        </h:form> 
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false">
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>                    
            <div class="zone_find">                                                              
                <h:panelGrid columns="5" style="font-size: 1.0em; float: left">
                    <h:outputText value="#{lab.L_date}" />
                    <h:outputText value="#{lab.LM_PE_mutualiste} " />
                    <h:outputText value="#{lab.L_type} " />  
                    <h:outputText value="#{lab.LRH_PM_lieu} " />  
                    <span>&nbsp;</span>
                    <h:panelGroup>
                        <h:selectBooleanCheckbox value="#{managedEvenement.dateSearch}">
                            <p:ajax event="valueChange" listener="#{managedEvenement.addParamDates()}" update="dates_search_evt" oncomplete="collapseList('evenement')"/>
                        </h:selectBooleanCheckbox>
                        <h:panelGroup id="dates_search_evt" style="margin-top: -2px;float: right">
                            <p:calendar value="#{managedEvenement.debutSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedEvenement.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedEvenement.addParamDates()}" oncomplete="collapseList('evenement')"/>
                            </p:calendar>
                            <p:calendar value="#{managedEvenement.finSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedEvenement.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedEvenement.addParamDates()}" oncomplete="collapseList('evenement')"/>
                            </p:calendar>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:inputText value="#{managedEvenement.mutualisteSearch}" >
                        <p:ajax event="keyup" listener="#{managedEvenement.addParamMutualiste()}" oncomplete="collapseList('evenement')" />
                    </h:inputText>
                    <h:selectOneMenu value="#{managedEvenement.typeSearch}">
                        <f:selectItem itemValue="0" itemLabel="#{lab.L_tout}" /> 
                        <f:selectItem itemValue="0" itemLabel="--" /> 
                        <f:selectItems value="#{managedTypeEvenement.types}" var="typ" itemValue="#{typ.id}" itemLabel="#{typ.designation}" /> 
                        <p:ajax event="valueChange" listener="#{managedEvenement.addParamType()}" oncomplete="collapseList('evenement')"/>
                    </h:selectOneMenu>
                    <h:selectOneMenu value="#{managedEvenement.lieuSearch}">
                        <f:selectItem itemValue="0" itemLabel="#{lab.L_tout}" /> 
                        <f:selectItem itemValue="0" itemLabel="--" /> 
                        <f:selectItems value="#{Mdico.villes}" var="vil" itemValue="#{vil.id}" itemLabel="#{vil.libele}" /> 
                        <p:ajax event="valueChange" listener="#{managedEvenement.addParamLieu()}" oncomplete="collapseList('evenement')"/>
                    </h:selectOneMenu>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

