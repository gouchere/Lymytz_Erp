<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                 xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="contents"> 
        #{managedPieceTresorerie.loadAll()}
        <script type="text/javascript">
            $(function() {
                collapseForm('piece_tresor');
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
            });
        </script>
        <h:form>
            <p:remoteCommand name="updateTabAchats_" global="false" actionListener="#{managedPieceTresorerie.loadAllAchats()}"/>
        </h:form>
        <h:form>
            <p:remoteCommand name="updateTabVentes_" global="false" actionListener="#{managedPieceTresorerie.loadAllVentes()}"/>
        </h:form>
        <h:form>
            <p:remoteCommand name="updateTabDivers_" global="false" actionListener="#{managedPieceTresorerie.loadAllDivers()}"/>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de facture de vente
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgListVente_">
            <p:dialog id="dlgListVente_" header="Facture Vente" footer="#{lab.L_copy}" widgetVar="dlgListVente" modal="true" width="60%"  closeOnEscape="true"> 
                <p:dataTable id="data_ventes" value="#{managedPieceTresorerie.ventes}" var="fichfV" rowKey="#{fichfV.id}" selectionMode="single"
                             paginator="true" paginatorAlwaysVisible="false" rows="20">
                    <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnViewVente}" oncomplete="dlgListVente.hide()"/>
                    <p:ajax event="rowUnselect" global="false" listener="#{managedPieceTresorerie.unLoadOnViewVente}"/>
                    <p:column style="width: 23%" headerText="Reference" styleClass="etat_#{fichfV.statut}">
                        <span>#{fichfV.numDoc}</span>
                    </p:column>
                    <p:column headerText="Date Doc" style="width: 20%;text-align: center" styleClass="etat_#{fichfV.statut}" sortBy="#{fichfV.enteteDoc.dateEntete}">
                        <h:outputText value="#{fichfV.enteteDoc.dateEntete}" converter="DDMMYYYY"/>
                    </p:column>
                    <p:column headerText="Client" styleClass="etat_#{fichfV.statut}" sortBy="#{fichfV.client.tiers.nom_prenom}">
                        <h:outputText value="#{fichfV.client.tiers.nom_prenom}"/>
                    </p:column>
                </p:dataTable> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de facture d'achat
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgListAchat_">
            <p:dialog id="dlgListAchat_" header="Facture Achat" footer="#{lab.L_copy}" widgetVar="dlgListAchat" modal="true" width="60%"  closeOnEscape="true"> 
                <p:dataTable id="data_achats"  value="#{managedPieceTresorerie.achats}" var="fichfA" rowKey="#{fichfA.id}" selectionMode="single"
                             paginator="true" paginatorAlwaysVisible="false" rows="20">
                    <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnViewAchat}" oncomplete="dlgListAchat.hide()"/>
                    <p:ajax event="rowUnselect" global="false" listener="#{managedPieceTresorerie.unLoadOnViewAchat}"/>
                    <p:column headerText="Reference" style="width: 23%" styleClass="etat_#{fichfA.statut}">
                        <span>#{fichfA.numDoc}</span>
                    </p:column>
                    <p:column headerText="Date Doc" style="width: 20%;text-align: center" styleClass="etat_#{fichfA.statut}" sortBy="#{fichfA.dateDoc}">
                        <h:outputText value="#{fichfA.dateDoc}" converter="DDMMYYYY"/>
                    </p:column>
                    <p:column headerText="Fournisseur" styleClass="etat_#{fichfA.statut}" sortBy="#{fichfA.fournisseur.tiers.nom_prenom}">
                        <h:outputText value="#{fichfA.fournisseur.tiers.nom_prenom}"/>
                    </p:column>  
                </p:dataTable> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de facture de divers
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgListDivers_">
            <p:dialog id="dlgListDivers_" header="Opération Diverse" footer="#{lab.L_copy}" widgetVar="dlgListDivers" modal="true" width="60%"  closeOnEscape="true"> 
                <p:dataTable id="data_divers"  value="#{managedPieceTresorerie.divers}" var="fichfD" rowKey="#{fichfD.id}" selectionMode="single"
                             paginator="true" paginatorAlwaysVisible="false" rows="20">
                    <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnViewDivers}" oncomplete="dlgListDivers.hide()"/>
                    <p:ajax event="rowUnselect" global="false" listener="#{managedPieceTresorerie.unLoadOnViewDivers}"/>
                    <p:column style="width: 23%" headerText="Reference" styleClass="etat_#{fichfD.statut}">
                        <span>#{fichfD.numDoc}</span>
                    </p:column>
                    <p:column headerText="Date Doc" style="width: 20%;text-align: center" styleClass="etat_#{fichfD.statut}" sortBy="#{fichfD.dateDoc}">
                        <h:outputText value="#{fichfD.dateDoc}" converter="DDMMYYYY"/>
                    </p:column>
                    <p:column headerText="Tiers" styleClass="etat_#{fichfD.statut}" sortBy="#{fichfD.tiers.nom_prenom}">
                        <h:outputText value="#{fichfD.tiers.nom_prenom}"/>
                    </p:column>
                </p:dataTable>   
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de rechercher sur les dates
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgSearchDates_">
            <p:dialog id="dlgSearchDates_" header="Entrer la plage de date" footer="#{lab.L_copy}"
                      widgetVar="dlgSearchDates" modal="true" width="30%"  closeOnEscape="true"> 
                <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%">
                    <p:panelGrid columns="2" style="width: 98%;margin: auto">
                        <span>Date.Début</span>
                        <p:calendar value="#{managedPieceTresorerie.dateDebutSearch}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>Date.Fin</span>
                        <p:calendar value="#{managedPieceTresorerie.dateFinSearch}" navigator="true" pattern="dd-MM-yyyy"/>
                    </p:panelGrid>
                    <p:commandButton actionListener="#{managedPieceTresorerie.searchOnDates()}" style="width: 100%"
                                     oncomplete="dlgSearchDates.hide()" value="Enregistrer"/>
                </h:panelGrid>
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de rechercher sur le client
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgSearchClient_">
            <p:dialog id="dlgSearchClient_" header="Entrer le client" footer="#{lab.L_copy}"
                      widgetVar="dlgSearchClient" modal="true" width="18%"  closeOnEscape="true"> 
                <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%">
                    <p:autoComplete value="#{managedPieceTresorerie.clientSelect}" completeMethod="#{managedPieceTresorerie.completeClient}" style="width: 100%"
                                    var="theme" itemLabel="#{theme.tiers.nom_prenom}" itemValue="#{theme}" converter="clientConverter" forceSelection="true">
                        <p:ajax event="itemSelect" listener="#{managedPieceTresorerie.onClientSelect}" global="false"/>
                    </p:autoComplete>
                    <p:commandLink actionListener="#{managedPieceTresorerie.searchOnClient()}" style="width: 100%"
                                   oncomplete="dlgSearchClient.hide()" title="Rechercher">
                        <h:graphicImage library="icones" name="search.png" width="25" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </p:commandLink>
                </h:panelGrid>
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de rechercher sur le fournisseur
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgSearchFsseur_">
            <p:dialog id="dlgSearchFsseur_" header="Entrer le fournisseur" footer="#{lab.L_copy}"
                      widgetVar="dlgSearchFsseur" modal="true" width="18%"  closeOnEscape="true"> 
                <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%">
                    <p:autoComplete value="#{managedPieceTresorerie.fournisseurSelect}" completeMethod="#{managedPieceTresorerie.completeFournisseur}" style="width: 100%"
                                    var="theme" itemLabel="#{theme.tiers.nom_prenom}" itemValue="#{theme}" converter="fournisseurConverter" forceSelection="true">
                        <p:ajax event="itemSelect" listener="#{managedPieceTresorerie.onFournisseurSelect}" global="false"/>
                    </p:autoComplete>
                    <p:commandLink actionListener="#{managedPieceTresorerie.searchOnFsseur()}" style="width: 100%"
                                   oncomplete="dlgSearchFsseur.hide()" title="Rechercher">
                        <h:graphicImage library="icones" name="search.png" width="25" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </p:commandLink>
                </h:panelGrid>
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de rechercher sur le tiers
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgSearchTiers_">
            <p:dialog id="dlgSearchTiers_" header="Entrer le tiers" footer="#{lab.L_copy}"
                      widgetVar="dlgSearchTiers" modal="true" width="18%"  closeOnEscape="true"> 
                <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%">
                    <p:autoComplete value="#{managedPieceTresorerie.tiersSelect}" completeMethod="#{managedPieceTresorerie.completeTiers}" style="width: 100%"
                                    var="theme" itemLabel="#{theme.nom_prenom}" itemValue="#{theme}" converter="tiersConverter" forceSelection="true">
                        <p:ajax event="itemSelect" listener="#{managedPieceTresorerie.onTiersSelect}" global="false"/>
                    </p:autoComplete>
                    <p:commandLink actionListener="#{managedPieceTresorerie.searchOnTiers()}" style="width: 100%"
                                   oncomplete="dlgSearchTiers.hide()" title="Rechercher">
                        <h:graphicImage library="icones" name="search.png" width="25" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </p:commandLink>
                </h:panelGrid>
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedPieceTresorerie.deleteBean()}" oncomplete="dlgConfirmDelete.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete_" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedPieceTresorerie.deleteBean_()}" oncomplete="dlgConfirmDelete_.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDelete_.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false">    
            <div class="part_fix">
                <div style="float: left;width: 18%">
                    <p:commandButton value="Enregistrer" id="save_piece_tresor" actionListener="#{managedPieceTresorerie.saveNew()}"/>
                    <p:commandButton value="Nouveau" id="cancel_piece_tresor" global="false" actionListener="#{managedPieceTresorerie.resetFiche()}" update="blog_form_piece_tresor" oncomplete="collapseForm('piece_tresor')"/>
                    <p:commandButton value="Modifier" rendered="false" id="update_piece_tresor" actionListener="#{managedPieceTresorerie.updateBean()}" oncomplete="collapseForm('piece_tresor');return false"/>
                    <p:commandButton value="Supprimer" id="delete_piece_tresor" global="false" onclick="dlgConfirmDelete.show()"/>
                </div>
                <div id="save_entete" style="width: 75%;float: left">
                    <div style="border: 2px solid #045491; border-radius: 5px;padding: 3px;background-color: white" title="Source">
                        <h:panelGrid id="blog_source" columns="3" style="width: 100%">
                            <h:panelGrid columns="3" styleClass="yvs_nostyle">
                                <h:selectBooleanCheckbox title="Voir Tout" value="#{managedPieceTresorerie.inSolde}">
                                    <p:ajax event="valueChange" global="false" listener="#{managedPieceTresorerie.chooseSolde()}"/>
                                </h:selectBooleanCheckbox>
                                <h:selectOneMenu value="#{managedPieceTresorerie.piece.source}" id="select_source">
                                    <f:selectItem itemLabel="#{constantes.SCR_ACHAT_NAME}" itemValue="#{constantes.SCR_ACHAT}"/>
                                    <f:selectItem itemLabel="#{constantes.SCR_VENTE_NAME}" itemValue="#{constantes.SCR_VENTE}"/>
                                    <f:selectItem itemLabel="#{constantes.SCR_DIVERS_NAME}" itemValue="#{constantes.SCR_DIVERS}"/>
                                    <p:ajax event="valueChange" global="false" listener="#{managedPieceTresorerie.chooseSource()}"
                                            update="infos_piece img_source"/>
                                </h:selectOneMenu>                                           
                            </h:panelGrid>
                            <h:panelGrid id="blog_document" columns="7" styleClass="yvs_nostyle" style="font-size: medium;background-color: black;color: white">
                                <p:outputPanel style="float: left">
                                    <p:commandLink id="select_date0" style="float: right" global="false">
                                        <div style="border: 2px solid white; border-radius: 5px;padding: 1px;" title="Date Document">
                                            <h:graphicImage library="icones" name="ico_calendar.png" width="15" height="15"/> 
                                        </div>
                                    </p:commandLink>
                                    <p:overlayPanel for="select_date0" hideEffect="fade">
                                        <h:outputText value="#{managedPieceTresorerie.date}" converter="DDMMYYYY" style="font-weight: bold"/>
                                    </p:overlayPanel>
                                </p:outputPanel>
                                <span>N°.Piece.: </span>
                                <h:outputText value="#{managedPieceTresorerie.num}" style="font-weight: bold;text-decoration: underline"/>
                                <span>-.TTC.: </span>
                                <h:outputText value="#{managedPieceTresorerie.TTC}" converter="DN" style="font-weight: bold;text-decoration: underline"/>
                                <span>-.Reste.: </span>
                                <h:outputText value="#{managedPieceTresorerie.netApayer}" converter="DN" style="font-weight: bold;text-decoration: underline"/>
                            </h:panelGrid>  
                            <h:panelGroup id="img_source" style="float: right"> 
                                <p:outputPanel rendered="#{managedPieceTresorerie.piece.source == constantes.SCR_ACHAT}">
                                    <p:commandLink onclick="dlgListAchat.show()" global="false">
                                        <div style="border: 1px solid black; border-radius: 5px;padding: 2px" title="Ouvrir Liste Facture Achat">
                                            <p:graphicImage library="img/icones" width="15" height="15" name="out.png" style="padding-top: 2px"/> 
                                        </div>
                                    </p:commandLink>
                                </p:outputPanel>
                                <p:outputPanel rendered="#{managedPieceTresorerie.piece.source == constantes.SCR_VENTE}">
                                    <p:commandLink onclick="dlgListVente.show()" global="false">
                                        <div style="border: 1px solid black; border-radius: 5px;padding: 2px" title="Ouvrir Liste Facture Vente">
                                            <p:graphicImage library="img/icones" width="15" height="15" name="in.png" style="padding-top: 2px"/> 
                                        </div>
                                    </p:commandLink>
                                </p:outputPanel>
                                <p:outputPanel rendered="#{managedPieceTresorerie.piece.source == constantes.SCR_DIVERS}">
                                    <p:commandLink onclick="dlgListDivers.show()" global="false">
                                        <div style="border: 1px solid black; border-radius: 5px;padding: 2px" title="Ouvrir Liste Opération Divers">
                                            <p:graphicImage library="img/icones" width="15" height="15" name="in_out.png" style="padding-top: 2px"/>
                                        </div>
                                    </p:commandLink>
                                </p:outputPanel>                                         
                            </h:panelGroup>
                            <div style="clear: right"/>
                        </h:panelGrid>  
                    </div>
                </div>
                <div style="float: right;width: 5%">     
                    <div style="float: right">     
                        <h:link title="Vue Formulaire" onclick="collapseForm('piece_tresor');
                                collapseForm('entete');
                                return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <p:spacer />
                        <h:link title="Vue Liste" onclick="collapseList('piece_tresor');
                                collapseList('entete');
                                return false" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>   
                    </div>
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_piece_tresor" style="width: 99%; margin: auto; background: white">
                    <h:panelGrid id="blog_form_piece_tresor" columns="1" style="width: 100%">
                        <p:outputPanel id="entete_form6">
                            <div style="width: 45%;float: left">
                                <h:panelGrid columns="2" styleClass="yvs_nostyle" rendered="#{managedPieceTresorerie.piece.update}" style="float: left;font-size: large;background: black;color: white;margin-top: 5px;margin-left: 10px">                                            
                                    <span style="font-size: initial">Reference : </span>
                                    <h:outputText id="txt_reference_document6" value="#{managedPieceTresorerie.piece.numRef}"/>
                                </h:panelGrid>
                            </div>
                            <div style="width: 54%;margin-left: 46%">
                                <h:panelGroup rendered="#{managedPieceTresorerie.piece.update}" style="padding: 7px;float: right; position: relative; margin-top: 1%">
                                    <p:outputPanel id="grp_btn_etat6" styleClass="yvs_form_of">                                    
                                        <p:commandLink value="Editable" styleClass="button-stateOF #{(managedPieceTresorerie.piece.statut == constantes.ETAT_EDITABLE)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(managedPieceTresorerie.piece.statut == constantes.ETAT_SOUMIS
                                                                   or managedPieceTresorerie.piece.statut == constantes.ETAT_VALIDE
                                                                   or managedPieceTresorerie.piece.statut == constantes.ETAT_ANNULE)}"
                                                       actionListener="#{managedPieceTresorerie.annulerOrder()}"
                                                       process="@this" update="grp_btn_etat6" global="false"/>
                                        <p:commandLink value="Valider" styleClass="button-stateOF #{(managedPieceTresorerie.piece.statut==constantes.ETAT_VALIDE)?'button-stateOF_actif':''}" 
                                                       disabled="#{(managedPieceTresorerie.piece.statut != constantes.ETAT_EDITABLE)}" 
                                                       actionListener="#{managedPieceTresorerie.validerOrder()}"
                                                       process="@this" update="grp_btn_etat6" global="false"/>
                                        <p:commandLink value="Refusé" styleClass="button-stateOF #{(managedPieceTresorerie.piece.statut==constantes.ETAT_ANNULE)?'button-stateOF_actif':''}" 
                                                       disabled="#{(managedPieceTresorerie.piece.statut != constantes.ETAT_VALIDE)}" 
                                                       actionListener="#{managedPieceTresorerie.refuserOrder()}"
                                                       process="@this" update="grp_btn_etat6" global="false"/>
                                        <p:commandLink value="Reglé" styleClass="button-stateOF #{(managedPieceTresorerie.piece.statut==constantes.ETAT_REGLE)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(managedPieceTresorerie.piece.source == constantes.SCR_DIVERS
                                                                   and managedPieceTresorerie.piece.statut == constantes.ETAT_VALIDE)}" 
                                                       actionListener="#{managedPieceTresorerie.reglerOrder()}"
                                                       process="@this" update="grp_btn_etat6" global="false"/>
                                    </p:outputPanel>                                                
                                </h:panelGroup>                                          
                            </div>
                        </p:outputPanel>
                        <p:outputPanel id="infos_piece">                                
                            <div style="width: 45%;float: left">
                                <h:panelGrid columns="1">
                                    <p:outputPanel>
                                        <p:outputPanel rendered="#{managedPieceTresorerie.piece.source == constantes.SCR_ACHAT}">
                                            <fieldset class="header-panel">
                                                <legend>
                                                    mensualités achats
                                                </legend>
                                                <p:dataTable id="data_mensualite_achats" value="#{managedPieceTresorerie.mensualites_achat}" var="mensA"
                                                             rowKey="#{mensA.id}" selectionMode="single" selection="#{managedPieceTresorerie.selectMensualite_achat}">
                                                    <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnViewMensAchat}"/>
                                                    <p:ajax event="rowUnselect" global="false" listener="#{managedPieceTresorerie.unLoadOnViewMensAchat}"/>
                                                    <p:column headerText="Date Mensualite" style="text-align: center" sortBy="#{mensA.dateMensualite}" styleClass="etat_#{mensA.etat}">
                                                        <h:outputText value="#{mensA.dateMensualite}" converter="DDMMYYYY"/>
                                                    </p:column>
                                                    <p:column headerText="Montant" style="text-align: right" sortBy="#{mensA.montant}" styleClass="etat_#{mensA.etat}">
                                                        <h:outputText value="#{mensA.montant}" converter="DN"/>
                                                        <span> Fcfa</span>
                                                    </p:column>
                                                </p:dataTable> 
                                            </fieldset>                                        
                                        </p:outputPanel>
                                        <p:outputPanel rendered="#{managedPieceTresorerie.piece.source == constantes.SCR_VENTE}">
                                            <fieldset class="header-panel">
                                                <legend>
                                                    mensualités ventes
                                                </legend>
                                                <p:dataTable id="data_mensualite_ventes" value="#{managedPieceTresorerie.mensualites_vente}" var="mensV"
                                                             rowKey="#{mensV.id}" selectionMode="single" selection="#{managedPieceTresorerie.selectMensualite_vente}">
                                                    <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnViewMensVente}"/>
                                                    <p:ajax event="rowUnselect" global="false" listener="#{managedPieceTresorerie.unLoadOnViewMensVente}"/>
                                                    <p:column headerText="Date Mensualite" style="text-align: center" sortBy="#{mensV.dateMensualite}" styleClass="etat_#{mensV.etat}">
                                                        <h:outputText value="#{mensV.dateMensualite}" converter="DDMMYYYY"/>
                                                    </p:column>
                                                    <p:column headerText="Montant" style="text-align: right" sortBy="#{mensV.montant}" styleClass="etat_#{mensV.etat}">
                                                        <h:outputText value="#{mensV.montant}" converter="DN"/>
                                                        <span> Fcfa</span>
                                                    </p:column>
                                                </p:dataTable> 
                                            </fieldset>                                        
                                        </p:outputPanel>
                                        <p:outputPanel rendered="#{managedPieceTresorerie.piece.source == constantes.SCR_DIVERS}">
                                            <fieldset class="header-panel">
                                                <legend>
                                                    mensualités divers
                                                </legend>
                                                <p:dataTable id="data_mensualite_others0" value="#{managedPieceTresorerie.mensualites_diver}" var="mensO"
                                                             rowKey="#{mensO.id}" selectionMode="single" selection="#{managedPieceTresorerie.selectMensualite_diver}">
                                                    <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnViewMensDivers}"/>
                                                    <p:ajax event="rowUnselect" global="false" listener="#{managedPieceTresorerie.unLoadOnViewMensDivers}"/>
                                                    <p:column headerText="Date Mensualite" style="text-align: center" sortBy="#{mensO.dateMensualite}" styleClass="etat_#{mensO.etat}">
                                                        <h:outputText value="#{mensO.dateMensualite}" converter="DDMMYYYY"/>
                                                    </p:column>
                                                    <p:column headerText="Montant" style="text-align: right" sortBy="#{mensO.montant}" styleClass="etat_#{mensO.etat}">
                                                        <h:outputText value="#{mensO.montant}" converter="DN"/>
                                                        <span> Fcfa</span>
                                                    </p:column>
                                                </p:dataTable> 
                                            </fieldset>                                        
                                        </p:outputPanel>
                                    </p:outputPanel>
                                    <p:outputLabel>
                                        <fieldset class="header-panel">
                                            <legend>
                                                Infos Piéce
                                            </legend>
                                            <h:panelGrid id="blog_infos" columns="1" styleClass="yvs_nostyle" style="width: 100%">
                                                <p:panelGrid columns="2" style="width: 100%">
                                                    <span>Libelle </span>
                                                    <h:inputText value="#{managedPieceTresorerie.piece.libelle}" style="width: 95%"/>
                                                    <span>Date </span>
                                                    <p:calendar value="#{managedPieceTresorerie.piece.datePiece}" navigator="true" pattern="dd-MM-yyyy"/>
                                                    <span>Montant </span>
                                                    <h:panelGroup id="txt_montant_mensualite0">
                                                        <pe:inputNumber value="#{managedPieceTresorerie.piece.montant}" symbol=" Fcfa" symbolPosition="suffixe"
                                                                        style="width: 35%"/>
                                                        <span> / </span>
                                                        <h:outputText value="#{managedPieceTresorerie.piece.montantMens}" converter="DN" style="font-weight: bold"/>
                                                        <span> Fcfa</span>
                                                    </h:panelGroup>
                                                    <span>Mode.Paiement </span> 
                                                    <h:selectOneMenu value="#{managedPieceTresorerie.piece.mode.id}">
                                                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                                        <f:selectItems value="#{managedPieceTresorerie.modes}" var="mo" 
                                                                       itemLabel="#{mo.typePaiement}" itemValue="#{mo.id}" />                  
                                                        <p:ajax event="valueChange" global="false" listener="#{managedPieceTresorerie.chooseMode()}"/>
                                                    </h:selectOneMenu> 
                                                </p:panelGrid>
                                                <br/>
                                                <span>Commentaire </span>
                                                <h:inputTextarea value="#{managedPieceTresorerie.piece.description}" rows="5" style="width: 98%"/>
                                                <p:commandButton value="Nouveau" global="false" style="float: right" rendered="#{managedPieceTresorerie.netApayer>0}"
                                                                 actionListener="#{managedPieceTresorerie.resetFiche_()}" update="blog_infos" oncomplete="collapseForm('piece_tresor')"/>
                                            </h:panelGrid>
                                        </fieldset>
                                    </p:outputLabel>
                                </h:panelGrid>
                            </div>
                            <div style="width: 54%;margin-left: 46%">
                                <p:outputPanel>
                                    <fieldset class="header-panel">
                                        <legend>
                                            Historiques Pieces
                                        </legend>
                                        <p:dataTable id="data_piece_tresor_hist" value="#{managedPieceTresorerie.historiques}" var="piec_"
                                                     rowKey="#{piec_.id}" rowIndexVar="inveIdx_" selectionMode="single" scrollable="true" scrollHeight="311">
                                            <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnView_}"/>
                                            <p:ajax event="rowUnselect" global="false" listener="#{managedPieceTresorerie.unLoadOnView}"/>
                                            <p:column headerText="N°" style="width: 10%;text-align: center" styleClass="etat_#{piec_.mouvement}_#{piec_.statut}">
                                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{piec_.new_}"/>
                                                <h:graphicImage title="Cloturer" library="img" name="blocked.png" width="15" height="15" rendered="#{piec_.cloturer}"/>  
                                                <span>#{inveIdx_+1}</span>
                                            </p:column>
                                            <p:column headerText="Libelle" styleClass="etat_#{piec_.mouvement}_#{piec_.statut}">
                                                <span>#{piec_.libelle}</span>
                                            </p:column>
                                            <p:column headerText="Date Piece" style="width: 22%;text-align: center" styleClass="etat_#{piec_.mouvement}_#{piec_.statut}" sortBy="#{piec_.datePiece}">
                                                <h:outputText value="#{piec_.datePiece}" converter="DDMMYYYY"/>
                                            </p:column>
                                            <p:column headerText="Montant" style="width: 27%;text-align: right" styleClass="etat_#{piec_.mouvement}_#{piec_.statut}" sortBy="#{piec_.montant}">
                                                <h:outputText value="#{piec_.montant}" converter="DN"/>
                                                <span> Fcfa</span>
                                            </p:column>
                                        </p:dataTable>  
                                    </fieldset>  
                                </p:outputPanel>
                            </div>    
                        </p:outputPanel>
                    </h:panelGrid>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_piece_tresor" style="width: 99%; margin: auto; background: white">
                    <div  class="part_list">
                        <h:inputHidden id="input_hide_piece_tresor" value="#{managedPieceTresorerie.tabIds}"/>
                        <p:dataTable id="data_piece_tresor" value="#{managedPieceTresorerie.pieces}" var="piec"
                                     rowKey="#{piec.id}" rowIndexVar="inveIdx" selectionMode="single">
                            <p:ajax event="rowSelect" global="false" listener="#{managedPieceTresorerie.loadOnView}" oncomplete="collapseForm('piece_tresor');collapseForm('entete')"/>
                            <p:column headerText="N°" style="width: 5%;text-align: center" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <h:graphicImage title="Cloturer" library="img" name="blocked.png" width="15" height="15" rendered="#{piec.cloturer}"/>  
                                <span>#{inveIdx+1}</span>
                            </p:column>
                            <p:column headerText="Libelle" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <span>#{piec.libelle}</span>
                            </p:column>
                            <p:column headerText="N°.Piece" style="width: 13%" sortBy="#{piec.numPiece}" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <span>#{piec.numPiece}</span>
                            </p:column>
                            <p:column headerText="Reference" style="width: 22%" sortBy="#{piec.numPiece}" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <span>#{piec.numRef}</span>
                            </p:column>
                            <p:column headerText="Date Piece" style="text-align: center;width: 12%" sortBy="#{piec.datePiece}" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <h:outputText value="#{piec.datePiece}" converter="DDMMYYYY"/>
                            </p:column>
                            <p:column headerText="Montant" style="text-align: right;width: 10%" sortBy="#{piec.montant}" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <h:outputText value="#{piec.montant}" converter="DN"/>
                            </p:column>
                            <p:column headerText="Mode Paiement" style="text-align: center;width: 10%" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <span>#{piec.modePaiement.typePaiement}</span>
                            </p:column>
                            <p:column width="20" style="text-align: center" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <p:commandLink global="false" actionListener="#{managedPieceTresorerie.deleteBean_(piec)}" oncomplete="dlgConfirmDelete_.show()">
                                    <h:graphicImage library="img" name="del.png" width="20" height="20" title="Supprimer"/>      
                                </p:commandLink>
                            </p:column> 
                            <p:column style="width: 5%;text-align: center" styleClass="etat_#{piec.mouvement}_#{piec.statut}">
                                <f:facet name="header">
                                    <h:selectBooleanCheckbox styleClass="chek_all_line_piece_tresor" value="false"
                                                             onclick="selectionAllLineTab(#{managedPieceTresorerie.pieces.size()}, 'piece_tresor')">
                                    </h:selectBooleanCheckbox>
                                </f:facet>
                                <h:selectBooleanCheckbox value="#{piec.selectActif}" styleClass="chek_line_piece_tresor" 
                                                         onclick="selectionLineTab(#{piec.id}, 'piece_tresor')">
                                </h:selectBooleanCheckbox>
                            </p:column>
                            <f:facet name="header">
                                <p:commandLink disabled="#{managedPieceTresorerie.disablePrev}" actionListener="#{managedPieceTresorerie.init(false)}" global="false" 
                                               title="afficher les prochains enregistrements" update="data_piece_tresor" style="float: left;margin-top: -5px;width: 10px">
                                    <h:graphicImage library="img" name="dnavigation.png"  width="25" height="25"/>
                                </p:commandLink>
                                <h:panelGroup style="color: white">
                                    <span style="font-size: 0.8em">Page #{managedPieceTresorerie.currentPage} / #{managedPieceTresorerie.totalPage}</span>
                                    <span style="font-size: 0.8em">(#{managedPieceTresorerie.nbMax} lignes par chargement) </span>  
                                </h:panelGroup>
                                <p:commandLink disabled="#{managedPieceTresorerie.disableNext}" actionListener="#{managedPieceTresorerie.init(true)}" global="false" 
                                               title="afficher les prochains enregistrements" update="data_piece_tresor" style="float: right;margin-top: -5px;width: 25px;height: 0%">
                                    <h:graphicImage library="img" name="gnavigation.png" width="25" height="25" />
                                </p:commandLink>                                    
                            </f:facet>
                            <f:facet name="footer">
                                <p:commandLink disabled="#{managedPieceTresorerie.disablePrev}" actionListener="#{managedPieceTresorerie.init(false)}" global="false" 
                                               title="afficher les prochains enregistrements" update="data_piece_tresor" style="float: left;margin-top: -5px;width: 10px">
                                    <h:graphicImage library="img" name="dnavigation.png"  width="25" height="25"/>
                                </p:commandLink>
                                <h:panelGroup>
                                    <span style="font-size: 0.8em">Page #{managedPieceTresorerie.currentPage} / #{managedPieceTresorerie.totalPage}</span>
                                    <span style="font-size: 0.8em">(#{managedPieceTresorerie.nbMax} lignes par chargement) </span>  
                                </h:panelGroup>
                                <p:commandLink disabled="#{managedPieceTresorerie.disableNext}" actionListener="#{managedPieceTresorerie.init(true)}" global="false" 
                                               title="afficher les prochains enregistrements" update="data_piece_tresor" style="float: right;margin-top: -5px;width: 25px">
                                    <h:graphicImage library="img" name="gnavigation.png" width="25" height="25" />
                                </p:commandLink>                 
                            </f:facet> 
                        </p:dataTable>         
                    </div>
                    <div  class="part_search" style="position: absolute;bottom: 50px;width: 96%;margin: auto;height: 3.5%;background: white;">
                        <h:panelGrid columns="3" style="width: 100%;margin: auto">
                            <h:panelGrid columns="2" style="float: left">
                                <h:selectBooleanCheckbox value="#{managedPieceTresorerie.date_}">
                                    <p:ajax event="valueChange" listener="#{managedPieceTresorerie.chooseDateSearch()}" global="false" update="blog_date_search6 data_piece_tresor"/>
                                </h:selectBooleanCheckbox>
                                <h:panelGrid columns="2">
                                    <h:panelGroup id="blog_date_search6">
                                        <p:calendar value="#{managedPieceTresorerie.dateDebut_}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedPieceTresorerie.date_}">
                                            <p:ajax event="dateSelect" listener="#{managedPieceTresorerie.chooseDateSearch()}" global="false" update="data_piece_tresor"/>
                                        </p:calendar>
                                        <p:spacer width="5px" style="background: black"/>
                                        <p:calendar value="#{managedPieceTresorerie.dateFin_}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedPieceTresorerie.date_}">
                                            <p:ajax event="dateSelect" listener="#{managedPieceTresorerie.chooseDateSearch()}" global="false" update="data_piece_tresor"/>
                                        </p:calendar>
                                    </h:panelGroup>
                                </h:panelGrid>
                            </h:panelGrid>  
                            <h:panelGroup id="txt_indice_num_search3">
                                <h:outputText value="#{managedPieceTresorerie.indiceNumsearch_}" style="text-align: right;font-weight: bold"/>
                                <h:inputText value="#{managedPieceTresorerie.numSearch_}" style="background: #AFAFAF">
                                    <p:ajax event="keyup" global="false" listener="#{managedPieceTresorerie.searchTranferts()}"/>
                                </h:inputText>
                            </h:panelGroup>
                            <h:panelGrid columns="4" style="float: right">
                                <h:selectOneMenu value="#{managedPieceTresorerie.entree_}" valueChangeListener="#{managedPieceTresorerie.chooseMouv}" title="Mouvement">
                                    <f:selectItem itemLabel="ENTREE/SORTIE" itemValue="#{null}"/>
                                    <f:selectItem itemLabel="ENTREE" itemValue="#{true}"/>
                                    <f:selectItem itemLabel="SORTIE" itemValue="#{false}"/>
                                    <p:ajax event="valueChange" global="false" update="data_piece_tresor"/>
                                </h:selectOneMenu>
                                <h:selectOneMenu value="#{managedPieceTresorerie.nbMax}" valueChangeListener="#{managedPieceTresorerie.choosePaginator}">
                                    <f:selectItems value="#{managedPieceTresorerie.paginations}"/>
                                    <p:ajax event="valueChange" global="false" update="data_piece_tresor"/>
                                </h:selectOneMenu> 
                                <h:selectOneMenu value="#{managedPieceTresorerie.statut_}"  valueChangeListener="#{managedPieceTresorerie.chooseStatut}">
                                    <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                                    <f:selectItems value="#{constantes.ETATS_T}"/>
                                    <p:ajax event="valueChange" global="false" update="data_piece_tresor"/>
                                </h:selectOneMenu>
                                <h:selectOneMenu value="#{managedPieceTresorerie.cloturer_}" valueChangeListener="#{managedPieceTresorerie.chooseCloturer}" title="Cloturer">
                                    <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                                    <f:selectItem itemLabel="CLOTURER" itemValue="#{true}"/>
                                    <f:selectItem itemLabel="OUVERT" itemValue="#{false}"/>
                                    <p:ajax event="valueChange" global="false" update="data_piece_tresor"/>
                                </h:selectOneMenu>
                            </h:panelGrid>
                        </h:panelGrid>   
                    </div> 
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>