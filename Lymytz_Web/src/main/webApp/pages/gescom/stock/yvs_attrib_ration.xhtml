<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Attribution des rations','modGescom', 'smenAttribRation', true,managedRations)}
    </ui:define> 
    <ui:define name="contents">   
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 180);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('attrib_ration');
            });
        </script>
        #{Marticle.doNothing()}
        #{managedLotReception.doNothing()}

        #{managedAgence.loadAllUsable()}
        #{managedExercice.loadAllExrecice()}  
        #{managedDepot.loadAllDepotActif(true)}
        #{managedDepot.loadAllTypes('')}
        #{managedParamRation.addParamCurrentExo()}
        #{managedRations.loadAll()}
        
        <h:form prependId="false">
            <p:dialog header="Liste lot de reception" widgetVar="dlgListLotReception" modal="true" closeOnEscape="true" width="60%"> 
                <p:dataTable value="#{managedRations.ration.lots}" var="aRL" rowKey="#{aRL.id}"
                             id="data-ration_require_lot" editable="true">
                    <p:ajax event="rowEdit" listener="#{managedRations.onRowLotEdit}"/>
                    <f:facet name="header">
                        <div align="right">
                            <p:commandButton  icon="ui-icon-disk" value="Terminer" actionListener="#{managedRations.validAndSaveRation(managedRations.force)}" oncomplete="dlgListLotReception.hide()"/>
                        </div>
                    </f:facet>
                    <p:column headerText="Numero" style="text-align: left">
                        #{aRL.numero}
                    </p:column>
                    <p:column headerText="Date de fabrication" style="text-align: center">
                        <h:outputText value="#{aRL.dateFabrication}" converter="DATE" rendered="#{aRL.id gt 0}"/>
                        <h:outputText value="----" rendered="#{aRL.id lt 1}"/>
                    </p:column>
                    <p:column headerText="Date d'expiration" style="text-align: center">
                        <h:outputText value="#{aRL.dateExpiration}" converter="DATE" rendered="#{aRL.id gt 0}"/>
                        <h:outputText value="----" rendered="#{aRL.id lt 1}"/>
                    </p:column>
                    <p:column headerText="Stock" style="text-align: right">
                        <h:outputText value="#{aRL.stock}" converter="#{managedRations.converterStock}"/>
                        <span title="#{managedRations.ration.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{managedRations.ration.conditionnement.unite.reference}</span>
                    </p:column>
                    <p:column headerText="Quantitée" style="text-align: center">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{aRL.quantitee}"/>
                                <span title="#{managedRations.ration.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{managedRations.ration.conditionnement.unite.reference}</span>
                            </f:facet>
                            <f:facet name="input">
                                <h:inputText value="#{aRL.quantitee}" style="width:100%;text-align: right"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="text-align: center;width: 5px">
                        <p:rowEditor rendered="#{aRL.id gt 0}"/>
                    </p:column>  
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>
        
        <h:form prependId="false">
            <p:dialog widgetVar="dlgDetailsRation" width="50%" header="#{lab.LC_PRPF_detail_periodique}" height="500">
                <p:dataTable value="#{managedRations.listDetailsRationsTiers}" var="iDet" rowIndexVar="line_idx" rowKey="#{iDet.id}" id="table_dlgDetailsRation"
                             style="max-height: 450px; overflow-y: auto">
                    <p:column headerText="N°" >
                        <h:outputText value="#{line_idx+1}" />
                    </p:column>
                    <p:column headerText="#{lab.L_date}" >
                        <h:outputText value="#{iDet.dateRation}" converter="DATE" />
                    </p:column>
                    <p:column headerText="#{lab.LC_PRPF_articles}" >
                        #{iDet.article.designation}
                    </p:column>
                    <p:column headerText="#{lab.LC_PRPF_quantite}" >
                        #{iDet.quantite}
                    </p:column>
                </p:dataTable>
            </p:dialog>            
        </h:form>
        
        <h:form prependId="false">
            <p:dialog showHeader="false" widgetVar="dlgChoosePeriode" header="#{lab.LC_PRPF_selectionner_periode}" width="40%" closeOnEscape="true" position="top">
                <span>#{lab.LC_PAR_exercice}</span>
                <h:selectOneMenu value="#{managedParamRation.idExoSearch}" valueChangeListener="#{managedParamRation.choixExercice}">
                    <f:selectItem itemLabel="" itemValue="#{null}" />
                    <f:selectItems value="#{managedExercice.exercices}" var="iexo" itemLabel="#{iexo.reference}" itemValue="#{iexo.id}" />
                    <p:ajax event="valueChange" update="data_periode_param_ration :main_ration:select_periode_dpc_ration" />
                </h:selectOneMenu>
                <p:dataTable id="data_periode_param_ration" value="#{managedParamRation.periodes}" var="pe" rowKey="#{pe.id}" rowIndexVar="y"
                             selection="#{managedRations.selectedPeriode}" style="max-height: 500px; overflow-y: auto">
                    <p:column style="width: 10%">
                        <span>#{y+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_reference}">
                        <span>#{pe.referencePeriode}</span>
                    </p:column>
                    <p:column selectionMode="single" style="width:16px;text-align:center"/>
                </p:dataTable>
                <f:facet name="footer">
                    <p:commandButton icon="ui-icon-seek-next" value="#{lab.L_continuer}" actionListener="#{managedRations.selectPeriode()}" style="float: right" onclick="dlgChoosePeriode.hide()"/>
                </f:facet>
            </p:dialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false">
            <p:confirmDialog widgetVar="dlgConfirmChangeInventaireByValid" closeOnEscape="true" header="#{lab.LC_PRPF_attention}"
                             message="#{lab.LC_PRPF_text1}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedRations.validAndSaveRation(true)}"
                                 oncomplete="dlgConfirmChangeInventaireByValid.hide()"/>
                <p:commandButton value="#{lab.L_non}" icon="ui-icon-circle-close" type="button" onclick="dlgConfirmChangeInventaireByValid.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDelRation" closeOnEscape="true"
                             message="#{lab.LC_PRPF_text2}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedRations.annulReceptionRation()}" oncomplete="dlgDelRation.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgDelRation.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDisRation" closeOnEscape="true"
                             message="#{lab.LC_PRPF_text3}" header="#{lab.L_confirmation}">
                <p:commandButton icon="ui-icon-check" value="#{lab.L_oui}" actionListener="#{managedRations.disableRationTiers()}" oncomplete="dlgDisRation.hide()"/>
                <p:commandButton icon="ui-icon-close" type="button"  value="#{lab.L_non}" onclick="dlgDisRation.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmSuspendRation" closeOnEscape="true"
                             message="#{lab.LC_PRPF_text4}" header="#{lab.L_confirmation}">
                <p:commandButton icon="ui-icon-check" value="#{lab.L_oui}" actionListener="#{managedRations.suspensionRationTiers()}" oncomplete="dlgConfirmSuspendRation.hide()"/>
                <p:commandButton  icon="ui-icon-close" type="button"  value="#{lab.L_non}" onclick="dlgConfirmSuspendRation.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false" id="main_ration">
            <p:dialog width="50%" header="#{lab.LC_PRPF_creer_fiche_ration}" footer="&copy;Lymytz 2014" widgetVar="dlgCreateDoc" closeOnEscape="true" >
                <h:panelGrid columns="1" style="width: 100%; font-size: 0.8em; background: #FFF" cellpadding="0" cellspacing="0"
                             id="form_edit_doc_ration"> 
                    <h:panelGrid columns="4" style="width: 100%; background: #bbb" cellpadding="0" cellspacing="0" styleClass="yvs_nostyle">
                        <span>#{lab.L_numero}</span>
                        <h:inputText value="#{managedRations.document.numDoc}" disabled="true"/>
                        <h:outputText value="#{lab.LC_PRPF_reference_externe}" />
                        <h:inputText value="#{managedRations.document.numReference}"/>
                    </h:panelGrid>
                    <h:panelGrid columns="5" styleClass="yvs_table" style="width: 100%; font-size: 0.8em" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.L_date} " />
                        <h:outputText value="#{lab.LC_PRPF_periode}" />
                        <h:outputText value="#{lab.LC_PRPF_depot}" />
                        <h:outputText value="#{lab.LC_PRPF_tranche}" />
                        <h:outputText value="#{labLC_PRPF_nbre_jour_usine}" />
                        <p:calendar value="#{managedRations.document.dateFiche}"  pattern="dd-MM-yyyy" size="8" >
                            <p:ajax event="dateSelect" listener="#{managedRations.chooseDate}" update="select_periode_dpc_ration"/>
                        </p:calendar>
                        <h:selectOneMenu id="select_periode_dpc_ration" value="#{managedRations.document.periode.id}" valueChangeListener="#{managedRations.paginePeriodeOthers}">
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItems value="#{managedParamRation.periodes}" var="ipe" itemValue="#{ipe.id}" itemLabel="#{ipe.referencePeriode}"/>
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItem itemValue="-1" itemLabel="#{lab.LC_PRPF_choisir_periode}" />
                            <p:ajax event="valueChange" global="false" listener="#{managedRations.openViewPeriode()}"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedRations.document.depot.id}" valueChangeListener="#{managedRations.pagineDepotOthers}">
                            <f:selectItem itemValue="-1" itemLabel="...#{lab.LC_PRPF_precedent}..."/>
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItems value="#{managedDepot.depots}" var="ide" itemValue="#{ide.id}" itemLabel="#{ide.code}"/>
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItem itemValue="-2" itemLabel="...#{lab.LC_PRPF_suivant}..."/>
                            <p:ajax event="valueChange" update="@this chp_tranche_ration" />
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedRations.document.creneauHoraire.id}" style="min-width: 160px" id="chp_tranche_ration">
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItems value="#{managedRations.document.depot.tranches}" var="iCre" itemValue="#{iCre.id}" itemLabel="#{iCre.tranche.titre}"/>
                            <p:ajax event="valueChange" update="@this" listener="#{managedRations.chooseTranche()}" />
                        </h:selectOneMenu>
                        <h:inputText value="#{managedRations.document.nbrJrUsine}" disabled="#{!accesRessource.ra_change_jr_usine}"/>
                    </h:panelGrid>
                    <f:facet name="footer">
                        <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedRations.saveNew()}" style="float: right"/>
                    </f:facet>
                </h:panelGrid>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main_update_unite">
            <p:dialog header="#{lab.LC_PRPF_modifier_conditionnement}" footer="&copy;Lymytz 2014" widgetVar="dlgUpdateUnite" closeOnEscape="true" resizable="false"
                      width="20%">
                <h:panelGrid columns="2" styleClass="yvs_table" cellpadding="0" cellspacing="0" style="width: 100%">
                    <f:facet name="header">
                        <h:outputText   value="#{managedRations.selectedRation.id}" />
                    </f:facet>
                    <h:selectOneMenu value="#{managedRations.selectedRation.conditionnement.id}">
                        <f:selectItem itemValue="0" itemLabel=""/>
                        <f:selectItems value="#{managedRations.selectedRation.article.conditionnements}" var="cond" itemValue="#{cond.id}" itemLabel="#{cond.unite.reference}"/>
                        <p:ajax event="valueChange" listener="#{managedRations.chooseConditionnement()}" update="txt_libelle_unite_rtion"/>
                    </h:selectOneMenu>
                    <h:outputText id="txt_libelle_unite_rtion" value="#{managedRations.selectedRation.conditionnement.unite.libelle}" style="margin-left: 5px"/>
                </h:panelGrid>
                <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedRations.updateConditionnement()}" style="float: right" oncomplete="dlgUpdateUnite.hide()"/>
            </p:dialog>
        </h:form>
        <h:form prependId="false"  id="main_form_attrib_ra">      
            <div class="part_fix">  
                <p:contextMenu styleClass="context_menu" for="btn_param_r_ration" event="left click">
                    <p:menuitem value="#{lab.LC_PRPF_ajouter_doc}" icon="ui-icon-calendar" title="#{lab.LC_PRPF_creer_document_ration}" oncomplete="dlgCreateDoc.show()"
                                actionListener="#{managedRations.resetFiche()}" update=":main_ration:form_edit_doc_ration"/> 
                </p:contextMenu>
                <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px"  id="btn_param_r_ration" type="button"/> 
                <h:panelGroup style="margin-left: 40%">
                    <p:commandButton actionListener="#{managedRations.parcoursInAllResult(false)}" update="txt_parc_linear_attrib_ration :main_form_attrib_ra:table_documents_rations" 
                                     icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('attrib_ration')"/>
                    <h:inputText value="#{managedRations.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_parc_linear_attrib_ration"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedRations.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedRations.parcoursInAllResult(true)}" update="txt_parc_linear_attrib_ration :main_form_attrib_ra:table_documents_rations" 
                                     icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('attrib_ration')"/>
                </h:panelGroup>  
                <div style="float: right">
                    <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('attrib_ration');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link title="#{lab.L_mode_liste}" onclick="collapseList('attrib_ration');
                            return false" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>   
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_attrib_ration" style="width: 99%; margin: auto; background: white">
                    <p:outputPanel id="param_ration_zone_attrib_form">               
                        <p:outputPanel id="blog_periode_ration" autoUpdate="true">                                   
                            <h:panelGrid columns="3" style="width: 100%" rendered="#{managedRations.selectedDoc.id gt 0}">       
                                <h:panelGroup>
                                    <span>N° </span>
                                    <span style="font-size: 0.9em; font-weight: bold">#{managedRations.selectedDoc.numDoc}</span>
                                </h:panelGroup>                            
                                <h:panelGroup>
                                    <span>#{lab.LC_PRPF_periode} : </span>
                                    <span style="font-size: 0.9em; font-weight: bold;">[#{managedRations.selectedDoc.periode.referencePeriode}] </span>
                                    <h:outputText value="#{managedRations.selectedDoc.periode.dateDebut}" converter="DATE" style="font-size: 0.8em"/>
                                    <span> - </span>
                                    <h:outputText value="#{managedRations.selectedDoc.periode.fin}" converter="DATE" style="font-size: 0.8em"/>
                                </h:panelGroup>
                                <p:outputPanel id="btn_valid_r_ration" styleClass="yvs_form_of" style="float: right;font-size: 0.8em">                                    
                                    <p:commandLink value="#{lab.L_editable}" styleClass="button-stateOF #{(managedRations.selectedDoc.statut == constantes.ETAT_EDITABLE)?'button-stateOF_actif':''}" 
                                                   disabled="#{!(managedRations.selectedDoc.statut == constantes.ETAT_VALIDE)}"
                                                   actionListener="#{managedRations.changeStatutDocRation()}"
                                                   process="@this" update="table_documents_rations"/>
                                    <p:commandLink value="#{(managedRations.selectedDoc.statut == constantes.ETAT_ENCOURS)?'CONTROL&Eacute;':'CONTROLER'}" styleClass="button-stateOF #{(managedRations.selectedDoc.statut == constantes.ETAT_ENCOURS)?'button-stateOF_actif':''}" 
                                                   disabled="#{!(managedRations.selectedDoc.statut == constantes.ETAT_EDITABLE)}"
                                                   actionListener="#{managedRations.changeStatutDocRation()}"
                                                   process="@this" update="table_documents_rations"/> 
                                    <p:commandLink value="#{(managedRations.selectedDoc.statut == constantes.ETAT_VALIDE)?'VALID&Eacute;':'VALIDER'}" styleClass="button-stateOF #{(managedRations.selectedDoc.statut == constantes.ETAT_VALIDE)?'button-stateOF_actif':''}" 
                                                   disabled="#{!(managedRations.selectedDoc.statut == constantes.ETAT_ENCOURS)}"
                                                   actionListener="#{managedRations.changeStatutDocRation()}"
                                                   process="@this" update="table_documents_rations"/>
                                </p:outputPanel> 
                            </h:panelGrid>
                        </p:outputPanel>
                        <h:panelGrid id="form_ration_zone_attrib_form" columns="2"  style="width: 100%">                 
                            <f:facet name="header">
                                <div align="right">
                                    <h:panelGroup style="font-size: 0.7em; color: #666;margin-top: 10px;float: right;margin-bottom: -10px">
                                        <span>#{managedRations.ration.article.designation}</span>
                                        <span style="float: right">
                                            <span style="color: black;margin-right: 5px;margin-left: 5px;font-weight: normal">: </span>
                                            <h:outputText value="#{managedRations.ration.stock}" converter="#{managedRations.converterStock}" /> 
                                            <span style="color: black;font-weight: normal">#{managedRations.ration.conditionnement.unite.reference} en stock.</span>
                                        </span>
                                    </h:panelGroup>                                    
                                </div>
                            </f:facet>      
                            <h:panelGrid columns="#{managedRations.ration.article.requiereLot?'7':'6'}" cellpadding="2" cellspacing="0" style="font-size: 0.8em"> 
                                <h:outputText value="#{lab.L_date}"/>
                                <h:outputText value="#{lab.LC_PRPF_tiers}"/>
                                <h:outputText value="#{lab.LC_PRPF_article}"/>
                                <h:outputText value="#{lab.LC_PRPF_quantite}"/>
                                <h:outputText value="#{lab.LC_PRPF_lot}" rendered="#{managedRations.ration.article.requiereLot}"/>
                                <h:outputText value="#{lab.L_code}"/>
                                <h:outputText value=""/>
                                <p:calendar value="#{managedRations.dateRation}" pattern="dd-MM-yyyy" size="8"/>
                                <h:inputText value="#{managedRations.ration.personnel.nom}" disabled="true"/>
                                <h:inputText value="#{managedRations.ration.article.refArt}" style="width: 100px" disabled="true"/>                                               
                                <h:panelGroup>
                                    <h:inputText disabled="true" value="#{managedRations.ration.quantite}" style="width: 70px"/>                        
                                    <span style="font-weight: bold" title=" #{managedRations.ration.conditionnement.unite.libelle}"> #{managedRations.ration.conditionnement.unite.reference}</span>
                                </h:panelGroup>
                                <h:inputText id="select_lot_ration" value="#{managedRations.ration.lot.numero}" ondblclick="dlgListLotReception.show()"
                                             readonly="true" title="Cliquer deux fois pour ouvrir la liste des lots de reception"
                                             rendered="#{managedRations.ration.article.requiereLot}"/>  
                                <h:inputSecret value="#{managedRations.ration.codeRation}" style="width: 150px"/>
                                <p:commandButton value="Ok"   actionListener="#{managedRations.validAndSaveRation()}" icon="ui-icon-circle-check" style="margin-left: 25px; height: 22px;" />
                            </h:panelGrid>                               
                        </h:panelGrid>   
                        <p:dataTable value="#{managedRations.selectedDoc.listRations}" var="pr" rowIndexVar="line_r" rowKey="#{pr.id}"
                                     selectionMode="single" id="table_param_attrib_rations" >
                            <p:ajax event="rowSelect" listener="#{managedRations.selectLineRation}" update=":main_form_attrib_ra:form_ration_zone_attrib_form" />
                            <p:column headerText="N°" style="text-align: center" width="20">
                                <h:graphicImage library="img" name="redo.png" width="15" height="15" title="#{lab.LC_PRPF_text5}"
                                                rendered="#{pr.last ne null ? pr.last.id ne managedRations.selectedDoc.id : false}"/>
                                #{line_r+1}
                                <h:graphicImage library="img" name="erase-128.png" width="15" height="15" rendered="#{!pr.actif}" title="#{lab.L_desactiver}"/>
                            </p:column>
                            <p:column headerText="#{lab.LC_PRPF_code_tiers}" styleClass="#{(pr.id gt 0)?'line_actiftrue':'-'}">
                                #{pr.personnel.codeTiers}
                            </p:column>
                            <p:column headerText="#{lab.LC_PRPF_tiers}">
                                #{pr.personnel.nom_prenom}
                            </p:column>
                            <p:column headerText="#{lab.LC_PRPF_articles}" >
                                <h:outputText value="[#{pr.article.refArt}] " style="font-weight: bold"/>
                                <h:outputText value="#{pr.article.designation}" />
                            </p:column>
                            <p:column headerText="#{lab.LC_PRPF_quantite}" style="text-align: center" >
                                <h:outputText value="#{pr.quantite}" converter="#{managedRations.converterStock}"/>
                                <h:outputText value="#{pr.conditionnement.unite.reference}" style="font-size: 0.6em;color: #003399; float: right" title="#{pr.conditionnement.unite.libelle}"/>                                
                            </p:column>
                            <p:column headerText="#{lab.LC_PRPF_qte_cumule}" style="text-align: center" >
                                <h:outputText value="#{pr.qtePrise}" converter="#{managedRations.converterStock}"/>/
                                <h:outputText value="#{pr.qteMax}" converter="#{managedRations.converterStock}"/>                                
                            </p:column>
                            <p:column headerText=""  style="text-align: center" width="15">
                                <p:contextMenu styleClass="context_menu" for="btn_param_ration" event="left click" style="font-size: 0.8em;width: 200px">
                                    <p:menuitem value="#{lab.LC_PRPF_voir_detail}" icon="ui-icon-newwin" actionListener="#{managedRations.loadAllRationTiersPeriode(pr)}" />
                                    <p:menuitem value="#{pr.actif?'Désactiver':'Activer'}" icon="#{pr.actif?'ui-icon-circle-close':'ui-icon-circle-check'}" 
                                                actionListener="#{managedRations.openToDisableRationTiers(pr)}" rendered="#{pr.id le 0}"/>
                                    <p:menuitem value="#{pr.calculPr?'Désactiver':'Activer'} le calcul du pr" icon="#{pr.calculPr?'ui-icon-pause':'ui-icon-play'}"
                                                actionListener="#{managedRations.changeCalculPr(pr)}" rendered="#{pr.id gt 0}" update="table_param_attrib_rations"/>
                                    <p:menuitem value="#{lab.LC_PRPF_suspendre}" icon="ui-icon-circle-close" actionListener="#{managedRations.openToSuspendRationTiers(pr)}" rendered="#{pr.id le 0}"/>
                                    <p:menuitem value="#{lab.L_modifier}" icon="ui-icon-pencil" title="#{lab.LC_PRPF_modifier_conditionnement}" actionListener="#{managedRations.setSelectedRation(pr)}" oncomplete="dlgUpdateUnite.show()"
                                                update=":main_update_unite" rendered="#{pr.id gt 0}"/>
                                    <p:separator />
                                    <p:menuitem value="#{lab.L_annuler}" icon="ui-icon-cancel" title="#{lab.LC_PRPF_supprimer_ration_tiers}" actionListener="#{managedRations.openToAnnulReceptionRation(pr)}" rendered="#{pr.id gt 0}"/>
                                </p:contextMenu>
                                <p:commandButton style="width: 22px; height: 22px" icon="ui-icon-gear" id="btn_param_ration" type="button"/>
                            </p:column>
                        </p:dataTable>
                        <p:outputPanel>                                
                            <p:watermark for="search_ration_by_tiers" value="#{lab.LC_PRPF_tiers}...." />
                            <p:watermark for="search_ration_by_article" value="#{lab.LC_PRPF_article}...." />
                            <h:panelGrid columns="2" style="float: left;margin-left: -10px" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                                <h:inputText id="search_ration_by_tiers" value="#{managedRations.tiersSearch}">
                                    <p:ajax event="valueChange" listener="#{managedRations.addParamTiers()}" update="table_param_attrib_rations"/>
                                </h:inputText>
                                <h:inputText id="search_ration_by_article" value="#{managedRations.articleSearch}">
                                    <p:ajax event="valueChange" listener="#{managedRations.addParamArticle()}" update="table_param_attrib_rations"/>
                                </h:inputText>     
                            </h:panelGrid>
                            <h:panelGroup style="float: right">                                    
                                <p:outputPanel autoUpdate="true" layout="block">
                                    <p:commandButton actionListener="#{managedRations.loadParamRation(false, false)}" update="table_param_attrib_rations"  icon="ui-icon-circle-triangle-w" disabled="#{managedRations.pa.disPrev}"/>
                                    <p:outputPanel >
                                        <p:inplace label="#{managedRations.pa.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                            <pe:inputNumber value="#{managedRations.pa.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                                <p:ajax event="valueChange" listener="#{managedRations.gotoPagePaginatorRation()}" update="table_param_attrib_rations"/>
                                            </pe:inputNumber>
                                        </p:inplace><p:outputLabel value="/#{managedRations.pa.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                                    </p:outputPanel>
                                    <p:commandButton actionListener="#{managedRations.loadParamRation(false, true)}" update="table_param_attrib_rations"  icon="ui-icon-circle-triangle-e" disabled="#{managedRations.pa.disNext}"/>
                                    <p:selectOneMenu value="#{managedRations.pa.rows}" label="#{lab.L_nombre_max_resultat}" 
                                                     valueChangeListener="#{managedRations.choosePaginatorRation}" style="float: right; margin-top: 3px;min-width: 50px" >
                                        <f:selectItems value="#{managedRations.paginations}"/>
                                        <p:ajax event="valueChange" update="table_param_attrib_rations"/>
                                    </p:selectOneMenu>
                                </p:outputPanel>
                            </h:panelGroup>
                        </p:outputPanel>                 
                        <p:outputPanel autoUpdate="true" layout="block">
                            <h:panelGroup style="clear: both;margin-left: 10px">
                                <p:dataTable id="data_article_doc_ration" value="#{1}" var="art" rowIndexVar="row" rowKey="#{art}">
                                    <p:columnGroup type="header">
                                        <p:row>
                                            <c:forEach items="#{managedRations.articlesRation}" var="head" varStatus="_head">
                                                <p:column headerText="#{head.refArt}" style="width: 15%" colspan="4"/>
                                            </c:forEach>
                                        </p:row>
                                        <p:row>
                                            <c:forEach items="#{managedRations.articlesRation}" var="head" varStatus="_head">
                                                <p:column headerText="#{lab.LC_PRPF_distribuer}" style="width: 15%" colspan="2"/>
                                                <p:column headerText="#{lab.LC_PRPF_parametrer}" style="width: 15%" colspan="2"/>
                                            </c:forEach>
                                        </p:row>
                                        <p:row>
                                            <c:forEach items="#{managedRations.articlesRation}" var="head" varStatus="_head">
                                                <p:column headerText="#{lab.LC_PRPF_prec}." style="width: 15%"/>
                                                <p:column headerText="#{lab.LC_PRPF_courant}" style="width: 15%"/>
                                                <p:column headerText="#{lab.LC_PRPF_prec}." style="width: 15%"/>
                                                <p:column headerText="#{lab.LC_PRPF_courant}" style="width: 15%"/>
                                            </c:forEach>
                                        </p:row>
                                    </p:columnGroup>
                                    <c:forEach items="#{managedRations.articlesRation}" varStatus="_head">
                                        <p:column style="width: 15%;text-align: right">
                                            <h:outputText value="#{managedRations.articlesRation.get(_head.index).quantitePrec}" converter="#{managedRations.converterStock}"/>
                                        </p:column>
                                        <p:column style="width: 15%;text-align: right">
                                            <h:outputText value="#{managedRations.articlesRation.get(_head.index).quantite}" converter="#{managedRations.converterStock}"/>
                                        </p:column>
                                        <p:column style="width: 15%;text-align: right">
                                            <h:outputText value="#{managedRations.articlesRation.get(_head.index).quantitePrevuPrec}" converter="#{managedRations.converterStock}"/>
                                        </p:column>
                                        <p:column style="width: 15%;text-align: right">
                                            <h:outputText value="#{managedRations.articlesRation.get(_head.index).quantitePrevu}" converter="#{managedRations.converterStock}"/>
                                        </p:column>
                                    </c:forEach>
                                </p:dataTable>
                            </h:panelGroup>
                        </p:outputPanel>                          
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_attrib_ration" style="width: 99%; margin: auto; background: white">
                    <p:dataTable value="#{managedRations.documents}" var="doc" rowIndexVar="line_" rowKey="#{doc.id}"
                                 selectionMode="single" id="table_documents_rations" selection="#{managedRations.selectedDoc}">
                        <p:ajax event="rowSelect" listener="#{managedRations.loadOnView}" oncomplete="collapseForm('attrib_ration')" update="table_documents_rations"/>
                        <p:column headerText="N°" style="text-align: center" width="15" styleClass="statut_#{doc.statut}">
                            <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{doc.id eq managedRations.selectedDoc.id}"/>
                            #{line_+1}
                        </p:column>
                        <p:column headerText="#{lab.L_numero}" styleClass="statut_#{doc.statut}" >
                            #{doc.numDoc}
                            <h:graphicImage library="icones" name="lock.png" width="15" height="15" style="float: right" rendered="#{doc.cloturer}"/>
                        </p:column>
                        <p:column headerText="#{lab.L_reference}" styleClass="statut_#{doc.statut}" >
                            #{doc.numReference}
                        </p:column>
                        <p:column headerText="#{lab.LC_PRPF_depots}" styleClass="statut_#{doc.statut}" >
                            #{doc.depot.designation}
                        </p:column>
                        <p:column headerText="#{lab.LC_PRPF_tranche}" styleClass="statut_#{doc.statut}" style="text-align: center" width="90" >
                            #{doc.creneauHoraire.tranche.titre}
                        </p:column>
                        <p:column headerText="#{lab.LC_PRPF_periode}" styleClass="statut_#{doc.statut}">
                            #{doc.periode.referencePeriode}
                        </p:column>
                        <p:column headerText="#{lab.L_date}" styleClass="statut_#{doc.statut}" style="text-align: center" width="80">
                            <h:outputText value="#{doc.dateFiche}" converter="DATE" />
                        </p:column>
                        <p:column headerText="#{lab.LC_PRPF_jrs_usine}" style="text-align: center" width="15">
                            #{doc.nbrJrUsine}
                        </p:column>                     
                        <p:column headerText="#{lab.LC_PRPF_editeur}" style="text-align: center" width="15">
                            #{doc.magasinier.nomUsers}
                        </p:column>                     
                        <p:column headerText="#{lab.L_actif}"  style="text-align: center" width="15">
                            <p:contextMenu styleClass="context_menu" for="btn_opt_doc_ration" event="left click">
                                <p:menuitem value="#{lab.L_modifier}" icon="ui-icon-refresh" title="#{lab.LC_PRPF_modifier_fiche_ration}" actionListener="#{managedRations.updateBean(doc)}"
                                            oncomplete="dlgCreateDoc.show()" update=":main_ration:form_edit_doc_ration"/>            
                                <p:separator />                    
                                <p:menuitem value="#{lab.LC_PRPF_telecharger_brouillard}" icon="ui-icon-print" global="false" actionListener="#{managedRations.print(doc)}" ajax="false"/>
                                <p:menuitem value="#{lab.LC_PRPF_telecharger_situation}" icon="ui-icon-print" global="false" actionListener="#{managedRations.printSituation(doc)}" ajax="false"/>
                                <p:separator />
                                <p:menuitem value="#{doc.cloturer?'Dévérouiller':'Vérouiller'}" icon="#{doc.cloturer?'ui-icon-unlocked':'ui-icon-locked'}"  actionListener="#{managedRations.cloturerFiche(doc)}"
                                            update="table_documents_rations"/>
                                <p:separator />
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" title="#{lab.LC_PRPF_supprimer_fiche_ration}" actionListener="#{managedRations.deleteRation(doc)}"
                                            update="table_documents_rations"/>
                            </p:contextMenu>
                            <p:commandButton style="width: 22px; height: 22px" icon="ui-icon-gear" id="btn_opt_doc_ration" type="button"/>
                        </p:column>
                    </p:dataTable>
                    <h:panelGroup style="float: right">
                        <p:commandButton actionListener="#{managedRations.paginer(false)}" update="table_documents_rations" icon="ui-icon-circle-triangle-w" disabled="#{managedRations.paginator.disPrev}"/>
                        <p:outputPanel >
                            <p:inplace label="#{managedRations.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                <pe:inputNumber value="#{managedRations.paginator.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                    <p:ajax event="valueChange" listener="#{managedRations.gotoPagePaginator()}" update="table_documents_rations"/>
                                </pe:inputNumber>
                            </p:inplace><p:outputLabel value="/#{managedRations.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                        </p:outputPanel>
                        <p:commandButton actionListener="#{managedRations.paginer(true)}" update="table_documents_rations" icon="ui-icon-circle-triangle-e" disabled="#{managedRations.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedRations.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedRations.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedRations.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="table_documents_rations"/>
                        </p:selectOneMenu>
                    </h:panelGroup>
                </div> 
            </div>
        </h:form>
    </ui:define>    
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>  
            <div class="zone_find">
                <div class="yvs_form_attrib_ration display_auteur" align="right" style="font-style: italic;">
                    <p:outputPanel autoUpdate="true">
                        <span style="float: left">#{lab.L_enregistrer_le} <h:outputText value="#{managedRations.selectedDoc.dateSave}" converter="LD" styleClass="valeur" style="font-weight: bold"/></span> 
                        <span>#{lab.L_modifier_le} <h:outputText value="#{managedRations.selectedDoc.dateUpdate}" converter="DTL" styleClass="valeur" style="font-weight: bold"/></span>
                        <span>#{lab.L_par} <h:outputText value="#{managedRations.selectedDoc.author.users.nomUsers}"  styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <h:panelGrid  columns="2" style="width: 100%; font-size: 0.8em;" cellpadding="0" cellspacing="0">
                    <h:panelGrid columns="10" style="float: left; font-size: 1.0em" id="ration_fiche_zone_search" cellpadding="0" cellspacing="0">
                        <span>&nbsp;</span>
                        <h:panelGroup>
                            <h:selectBooleanCheckbox value="#{managedRations.addDateSearch}">
                                <p:ajax event="valueChange" listener="#{managedRations.addParamDates()}" update="blog_date_search_ration :main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                            </h:selectBooleanCheckbox>
                            <h:outputText value="#{lab.L_date}" />
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PRPF_periode}" />
                        <h:outputText value="#{lab.LC_PRPF_depot}" />
                        <h:outputText value="#{lab.LC_PRPF_tranche}" />
                        <h:panelGroup>
                            <h:outputText value="#{lab.LC_PRPF_statut}" style="float:left;margin-top: 2px"/>
                            <h:selectOneMenu value="#{managedRations.egaliteStatut}" style="float:right;margin-right: 5px;">
                                <f:selectItem itemLabel="#{lab.LC_PRPF_egale}" itemValue="="/>
                                <f:selectItem itemLabel="#{lab.LC_PRPF_different}" itemValue="!="/>
                                <p:ajax event="valueChange" update=":main_form_attrib_ra:table_documents_rations" listener="#{managedRations.addParamStatut()}" oncomplete="collapseList('attrib_ration')"/>
                            </h:selectOneMenu>  
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PRPF_cloturer}" />
                        <h:outputText value="#{lab.LC_PRPF_magasinier}" />
                        <h:outputText value="#{lab.L_reference}" />
                        <span>&nbsp;</span>
                        <p:commandButton icon="ui-icon-bullet" update="ration_fiche_zone_search :main_form_attrib_ra:table_documents_rations" style="width: 22px; height: 22px" actionListener="#{managedRations.clearParams()}"/>
                        <h:panelGroup id="blog_date_search_ration">
                            <p:calendar value="#{managedRations.debutSearch}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedRations.addDateSearch}" size="10" style="font-size: 0.8em">
                                <p:ajax event="dateSelect" listener="#{managedRations.addParamDates()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                            </p:calendar>
                            <p:spacer width="5px" style="background: black"/>
                            <p:calendar value="#{managedRations.finSearch}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedRations.addDateSearch}" size="10" style="font-size: 0.8em">
                                <p:ajax event="dateSelect" listener="#{managedRations.addParamDates()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                            </p:calendar>
                        </h:panelGroup>
                        <h:selectOneMenu value="#{managedRations.periodeSearch}" style="min-width: 120px">
                            <f:selectItem itemLabel="--" itemValue="0"/>
                            <f:selectItems value="#{managedParamRation.periodes}" var="per" itemLabel="#{per.referencePeriode}" itemValue="#{per.id}" />                                 
                            <p:ajax event="valueChange" listener="#{managedRations.addParamPeriode()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                        </h:selectOneMenu> 
                        <h:selectOneMenu value="#{managedRations.depotSearch}" style="min-width: 120px">
                            <f:selectItem itemLabel="--" itemValue="0"/>
                            <f:selectItems value="#{managedDepot.depots}" var="dep" itemLabel="#{dep.designation}" itemValue="#{dep.id}" />                                 
                            <p:ajax event="valueChange" listener="#{managedRations.addParamDepot()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                        </h:selectOneMenu> 
                        <h:selectOneMenu value="#{managedRations.trancheSearch}" style="min-width: 120px">
                            <f:selectItem itemLabel="--" itemValue="0"/>
                            <f:selectItems value="#{managedDepot.types}" var="trh" itemLabel="#{trh.titre}" itemValue="#{trh.id}" />                                  
                            <p:ajax event="valueChange" listener="#{managedRations.addParamTranche()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                        </h:selectOneMenu> 
                        <h:selectOneMenu value="#{managedRations.statutSearch}" style="min-width: 120px">
                            <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                            <f:selectItem itemLabel="#{lab.L_editable}" itemValue="#{constantes.ETAT_EDITABLE}"/>
                            <f:selectItem itemLabel="#{lab.L_annuler}" itemValue="#{constantes.ETAT_ANNULE}"/>
                            <f:selectItem itemLabel="#{lab.L_valider}" itemValue="#{constantes.ETAT_VALIDE}"/>
                            <p:ajax event="valueChange" listener="#{managedRations.addParamStatut()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedRations.clotureSearch}" style="min-width: 120px">
                            <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                            <f:selectItem itemLabel="#{lab.L_oui}" itemValue="#{true}"/>
                            <f:selectItem itemLabel="#{lab.L_non}" itemValue="#{false}"/>
                            <p:ajax event="valueChange" listener="#{managedRations.addParamCloturer()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                        </h:selectOneMenu>
                        <h:inputText value="#{managedRations.usersSearch}">
                            <p:ajax event="valueChange" listener="#{managedRations.addParamUsers()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                        </h:inputText>
                        <h:inputText value="#{managedRations.numeroSearch}">
                            <p:ajax event="valueChange" listener="#{managedRations.addParamReference()}" update=":main_form_attrib_ra:table_documents_rations" oncomplete="collapseList('attrib_ration')"/>
                        </h:inputText>
                    </h:panelGrid>
                    <h:panelGroup style="float: right">

                    </h:panelGroup>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

