<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Factures Avoir Vente','modCompta', 'smenFactureAvoirVente', true,managedBonAvoirVente)}
    </ui:define>     
    <ui:define name="contents"> 
        #{managedVente.doNothing()}  
        #{managedSaisiePiece.doNothing()}  
        #{managedClient.doNothing()}   
        #{Marticle.doNothing()}  
        #{managedVente.doNothing()}  
        #{managedFactureVenteV2.doNothing()}

        #{managedAgence.loadAllUsable()}
        #{managedStockArticle.load(null)}
        #{managedCatCompt.loadAllCategorieVente()}    
        #{managedUser.loadActif(true)}
        #{managedPointVente.loadPointVenteByMax(0)} 
        #{managedCaisses.loadAllCaisseActif(true)}  
        #{managedModeReglement.loadModels('C')}
        #{managedReglementVente.loadAll()}  
        #{managedBonAvoirVente.loadAll(constantes.TYPE_FAV)}
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 140);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('contenu_avoir_vente');
                collapseForm('avoir_vente');
            });
        </script>

        <h:form prependId="false" enctype="multipart/form-data">
            <p:dialog widgetVar="dlgUploadImgXLS" width="300" height="100" closeOnEscape="true"
                      dynamic="true" resizable="false">
                <p:fileUpload sizeLimit="1000000"  id="file_import_02"  mode="advanced" dragDropSupport="true" 
                              allowTypes="/(\.|\/)(xls|xls?x)$/" fileUploadListener="#{managedBonAvoirVente.handleFileUploadXLS}"
                              uploadLabel="#{lab.L_envoyer}" label="#{lab.L_parcourir}" auto="true"
                              oncomplete="dlgUploadImgXLS.hide()"> 
                </p:fileUpload>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main-agence">
            <p:dialog widgetVar="dlgAgenceForPoint" header="Selectionner une agence" width="50%" closeOnEscape="true"> 
                <p:dataTable value="#{managedAgence.agences}" var="ag" rowKey="#{ag.id}" selectionMode="single" id="table_agence" rowIndexVar="line_ag">
                    <p:ajax event="rowSelect" listener="#{managedPointVente.onSelectAgenceForAction}" update=":main_avoir_vente:select_point_avoir_vente" oncomplete="dlgAgenceForPoint.hide()"/>
                    <p:column headerText="#{lab.L_code}" width="200">
                        <h:outputText value="#{ag.codeagence}"/>
                    </p:column>                                
                    <p:column headerText="#{lab.L_designation}">
                        <h:outputText value="#{ag.designation}"/>
                    </p:column>
                </p:dataTable>
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue des clients
        *****************************************************************************
        <-->
        <h:form prependId="false">                    
            <p:dialog header="#{lab.LC_PC_liste_clients}" widgetVar="dlgListClients" closeOnEscape="true" width="50%" height="450" modal="true" dynamic="true">   
                <p:watermark for="txt_search_client_fav" value="#{lab.LC_PC_code_client}" />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_client_fav" value="#{managedClient.numSearch_}" style="float: left;text-align: center;margin-left: -10px">
                        <p:ajax event="valueChange" global="false" listener="#{managedClient.searchByNum()}" update="data_client_fav"/>
                    </h:inputText>   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedClient.init(false)}" global="false" update="data_client_fav" icon="ui-icon-circle-triangle-w" disabled="#{managedClient.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedClient.paginator.currentPage}/#{managedClient.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedClient.init(true)}" global="false" update="data_client_fav" icon="ui-icon-circle-triangle-e" disabled="#{managedClient.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedClient.max}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedClient.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedClient.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_client_fav"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </h:panelGrid>                               
                <p:dataTable id="data_client_fav"  value="#{managedClient.clients}" var="clt_" rowKey="#{clt_.id}"
                             selectionMode="single" rowIndexVar="cltIdx" scrollable="true" scrollHeight="385">
                    <p:ajax event="rowSelect" global="false" listener="#{managedBonAvoirVente.loadOnViewClient}" oncomplete="dlgListClients.hide()"/>
                    <p:column headerText="N°" style="width: 10%;">
                        <span>#{cltIdx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_code}" style="width: 20%">
                        <span>#{clt_.codeClient}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_PC_nom}">
                        <span>#{clt_.nom_prenom}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_PC_zone}">
                        <span>#{clt_.tiers.region}</span>
                    </p:column>
                </p:dataTable> 
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *************************************BeanCaisse****************************************
        Boite de dialogue des articles
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.LDB_PA_liste_articles}" widgetVar="dlgListArticle" modal="true" width="70%" height="450" closeOnEscape="true"> 
                <p:watermark for="txt_search_article_fav" value="Reference article..." />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_article_fav" value="#{managedStockArticle.article.article.refArt}">
                        <p:ajax event="valueChange" listener="#{managedStockArticle.searchArticleActifByPoint(false)}" update="data_articles_fav"/>
                    </h:inputText> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedStockArticle.loadActifArticleByPoint(false, false)}" update="data_articles_fav" icon="ui-icon-circle-triangle-w" disabled="#{managedStockArticle.pv.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedStockArticle.pv.currentPage}/#{managedStockArticle.pv.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedStockArticle.loadActifArticleByPoint(true, false)}" update="data_articles_fav" icon="ui-icon-circle-triangle-e" disabled="#{managedStockArticle.pv.disNext}"/>
                        <p:selectOneMenu value="#{managedStockArticle.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedStockArticle._choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{managedStockArticle.paginations}"/>
                            <p:ajax event="valueChange" update="data_articles_fav"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </h:panelGrid>
                <div style="height: 385px">
                    <p:dataTable id="data_articles_fav" value="#{managedStockArticle.articles}" var="art" rowKey="#{art.id}"
                                 selectionMode="single" rowIndexVar="line_art" style="overflow-y: auto">
                        <p:ajax event="rowSelect" listener="#{managedBonAvoirVente.loadOnViewArticles}" oncomplete="dlgListArticle.hide()"/>
                        <p:column headerText="N°" style="width : 5%">
                            <span title="#{art.designation}">#{line_art+1}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_reference}" style="width : 15%">
                            <span title="#{art.designation}" style="font-size: 0.9em">#{art.refArt}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_designation}" style="width : 45%">
                            <span title="#{art.designation}" style="font-size: 0.9em">#{art.designation}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_categorie}" style="width : 15%">
                            <span title="#{art.designation}" style="font-size: 0.9em">#{art.categorie}</span>
                        </p:column>
                        <p:column headerText="#{lab.LC_POV_prix_a}" width="10" style="text-align: right; width : 10%">
                            <h:outputText value="#{art.pua}" title="#{art.designation}" converter="#{managedBonAvoirVente.converter}" style="font-size: 0.9em" />
                        </p:column>
                        <p:column headerText="#{lab.LC_POV_prix_v}" width="10" style="text-align: right; width : 10%">
                            <h:outputText value="#{art.puv}" title="#{art.designation}" converter="#{managedBonAvoirVente.converter}" style="font-size: 0.9em" />
                        </p:column>
                    </p:dataTable>
                </div>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false" id="form_pptes_compta">
            <p:dialog  width="60%" widgetVar="dlgPpteCompta" closeOnEscape="true" header="Pièces comptable">
                <ui:include src="../../finance_compta/compta_general/yvs_schema_compta.xhtml" />
                <f:facet name="footer">
                    &copy;Lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form>

        <h:form>
            <p:remoteCommand name="updateBeanCaisse_" actionListener="#{managedBonAvoirVente.updateBean()}"/>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de bon de commande
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog position="relative" widgetVar="dlg_filter_factures" header="Filtrer..."
                      width="40%" >
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">                        
                    <span>Agence</span>
                    <h:selectOneMenu value="#{managedFactureVenteV2.agence_}" id="_select_agence2" style="width: 100%">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{managedAgence.agences}" var="ag"
                                       itemLabel="#{ag.designation}" itemValue="#{ag.id}"/>
                        <p:ajax event="valueChange" listener="#{managedFactureVenteV2._chooseAgence()}" 
                                update=":form_data_fv:data_fv_retour_fav fav-list-point"/>
                    </h:selectOneMenu>
                    <span>Numéro facture</span>
                    <h:inputText id="stat_fav_num_fv" value="#{managedFactureVenteV2.numSearch_}" style="color: #009999">
                        <p:ajax event="valueChange"  listener="#{managedFactureVenteV2.searchByNum()}" update=":form_data_fv:data_fv_retour_fav"/>
                    </h:inputText>   
                    <span>Statut</span>
                    <h:selectOneMenu value="#{managedFactureVenteV2.statut_}" 
                                     valueChangeListener="#{managedFactureVenteV2.chooseStatut}" style="min-width: 120px" title="Statut de la facture">
                        <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                        <f:selectItem itemLabel="#{lab.L_editable}" itemValue="#{constantes.ETAT_EDITABLE}"/>
                        <f:selectItem itemLabel="#{lab.L_valide}" itemValue="#{constantes.ETAT_VALIDE}"/>
                        <p:ajax event="valueChange" global="false" update=":form_data_fv:data_fv_retour_fav"/>
                    </h:selectOneMenu>
                    <span>Statut Livraison</span>
                    <h:selectOneMenu value="#{managedFactureVenteV2.statutLivre_}" 
                                     valueChangeListener="#{managedFactureVenteV2.chooseStatutLivre}" style="min-width: 120px">
                        <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                        <f:selectItem itemLabel="#{lab.L_attente}" itemValue="#{constantes.STATUT_DOC_ATTENTE}"/>
                        <f:selectItem itemLabel="#{lab.L_en_cours}" itemValue="#{constantes.STATUT_DOC_ENCOUR}"/>
                        <f:selectItem itemLabel="#{lab.L_livrer}" itemValue="#{constantes.STATUT_DOC_LIVRER}"/>
                        <p:ajax event="valueChange" update=":form_data_fv:data_fv_retour_fav"/>
                    </h:selectOneMenu>
                    <span>Client</span>
                    <h:inputText value="#{managedFactureVenteV2.codeClient_}" id="stat_fav_client">
                        <p:ajax event="valueChange" listener="#{managedFactureVenteV2.searchByClient()}"
                                update=":form_data_fv:data_fv_retour_fav"/>
                    </h:inputText>
                    <span>Vendeur</span>
                    <h:inputText value="#{managedFactureVenteV2.codeVendeur_}" id="stat_fav_vendeur">
                        <p:ajax event="valueChange" listener="#{managedFactureVenteV2._searchVendeur()}"  
                                update=":form_data_fv:data_fv_retour_fav"/>
                    </h:inputText>  
                    <span>Point de vente</span>
                    <h:selectOneMenu value="#{managedFactureVenteV2.point_}" style="min-width: 120px" id="fav-list-point">
                        <f:selectItem itemLabel="--#{lab.LDB_PPC_precedent}--" itemValue="-1"/>
                        <f:selectItem itemLabel="--" itemValue="0"/>
                        <f:selectItems value="#{managedPointVente.pointsvente_all}" var="_po" 
                                       itemLabel="#{_po.libelle}" itemValue="#{_po.id}" />  
                        <f:selectItem itemLabel="--" itemValue="0"/>
                        <f:selectItem itemLabel="--#{lab.LDB_PPC_suivant}--" itemValue="-2"/>  
                        <p:ajax event="valueChange" listener="#{managedFactureVenteV2._choosePoint()}"
                                update=":form_data_fv:data_fv_retour_fav @this"/>
                    </h:selectOneMenu>      
                </h:panelGrid>                                                               
            </p:dialog>
        </h:form>

        <h:form prependId="false" id="form_data_fv">                    
            <p:dialog header="#{lab.LC_PRA_liste_facture}" widgetVar="dlgListFactures" closeOnEscape="true" width="90%"  
                      dynamic="true" resizable="false" height="500">                                  
                <div style="height: 100%">
                    <div class="dlg_part_fixe">
                        <p:commandButton type="button" value="Filtrer..." id="fav-filter-btn" onclick="dlg_filter_factures.show()"/>
                        <p:outputPanel autoUpdate="true" style="float: right;" layout="block" >
                            <p:commandButton actionListener="#{managedFactureVenteV2.init(false)}"  update=":form_data_fv:data_fv_retour_fav" icon="ui-icon-circle-triangle-w" disabled="#{managedFactureVenteV2.paginator.disPrev}"/>
                            <p:outputPanel >
                                <p:inplace label="#{managedFactureVenteV2.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                    <pe:inputNumber value="#{managedFactureVenteV2.paginator.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                        <p:ajax event="valueChange" listener="#{managedFactureVenteV2.gotoPagePaginator()}" update=":form_data_fv:data_fv_retour_fav"/>
                                    </pe:inputNumber>
                                </p:inplace><p:outputLabel value="/#{managedFactureVenteV2.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                            </p:outputPanel>
                            <p:commandButton actionListener="#{managedFactureVenteV2.init(true)}"  update=":form_data_fv:data_fv_retour_fav" icon="ui-icon-circle-triangle-e" disabled="#{managedFactureVenteV2.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedFactureVenteV2.imax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedFactureVenteV2.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                                <f:selectItems value="#{managedFactureVenteV2.paginations}"/>
                                <p:ajax event="valueChange"  update=":form_data_fv:data_fv_retour_fav"  />
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </div>
                    <div class="dlg_part_scroll" style="clear: right">
                        <p:dataTable id="data_fv_retour_fav"  value="#{managedFactureVenteV2.documents}" var="bon" rowKey="#{bon.id}"
                                     selectionMode="single" rowIndexVar="fichfAIdx">
                            <p:ajax event="rowSelect" listener="#{managedBonAvoirVente.loadOnViewDoc}" oncomplete="dlgListFactures.hide()"/>
                            <p:column headerText="N°" style="width: 7%" styleClass="statut_#{bon.statut}">
                                <span>#{fichfAIdx+1}</span>
                            </p:column>
                            <p:column headerText="#{lab.L_reference}" styleClass="statut_#{bon.statut}">
                                <span>#{bon.numDoc}</span>
                                <h:panelGroup style="float: right">
                                    <h:outputText title="#{lab.LC_PFA_facture_regler}" value="R" rendered="#{bon.statutRegle == constantes.ETAT_REGLE}"
                                                  style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                    <p:spacer width="2" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}"/>
                                    <h:outputText title="#{lab.LC_PFA_facture_livrer}" value="L" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}"
                                                  style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                    <p:spacer width="2" rendered="#{bon.consigner}"/>
                                    <h:outputText title="#{lab.LC_PCV_facture_consignee}" value="C" rendered="#{bon.consigner}"
                                                  style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                </h:panelGroup>
                            </p:column>
                            <p:column headerText="#{lab.L_date} " style="text-align: center" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.enteteDoc.dateEntete}" converter="DATE"/>
                            </p:column>
                            <p:column headerText="#{lab.LC_PFV_client}" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.nom_client}"/>
                            </p:column>
                            <p:column headerText="#{lab.LCF_PBAV_vendeur}" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.enteteDoc.creneau.users.nomUsers}"/>
                            </p:column>
                            <p:column headerText="#{lab.LC_PEV_point}" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.enteteDoc.creneau.creneauPoint.point.libelle}"/>
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de la commande liée a la facture
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="data_contenus_fv_fav">
            <p:dialog widgetVar="dlgContenuFVFAV" modal="true" width="80%"  closeOnEscape="true"> 
                <f:facet name="header">
                    <span>Facture N° </span>           
                    <p:commandLink style="color:white" value="#{managedBonAvoirVente.selectDoc.documentLie.numDoc}" actionListener="#{managedBonAvoirVente.onSelectDistantObject(managedBonAvoirVente.selectDoc.documentLie)}"/>
                    <p:spacer width="5" height="5" styleClass="#{managedBonAvoirVente.selectDoc.documentLie.statutLivre}" title="Statut : #{managedBonAvoirVente.giveNameStatut(managedBonAvoirVente.selectDoc.documentLie.statutLivre)}"
                              style="border: 2px solid white; border-radius: 5px;padding: 3px;margin-top: 2px;margin-left: 10px;float: right;cursor: pointer"/>
                </f:facet>
                <p:dataTable value="#{managedBonAvoirVente.selectDoc.documentLie.contenus}" var="y" rowKey="#{y.id}" rowIndexVar="yIdx">
                    <p:column headerText="N°" style="width: 5%;color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <span title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}">#{yIdx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_ref}. " style="width: 12%;color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <span title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}">#{y.article.refArt}</span>
                        <h:graphicImage library="img" name="comment.png" width="15" height="15" rendered="#{y.onComment}" style="float: right" title="#{lab.LDB_PC_a_ete_commente}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_article}" style="color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <span title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}">#{y.article.designation}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_qte}" style="width: 8%;text-align: center;color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <h:outputText value="#{y.quantite}" converter="#{managedBonAvoirVente.converterStock}" title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_prix}" style="width: 10%;text-align: right;color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <h:outputText value="#{(y.prix-y.rabais)}" converter="#{managedBonAvoirVente.converter}" title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_rem}" style="width: 10%;text-align: right;color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <h:outputText value="#{y.remise}" converter="DNS" title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_taxe}" style="width: 10%;text-align: right;color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <h:outputText value="#{y.taxe}" converter="DNS" title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}"/>
                    </p:column>
                    <p:column headerText="#{lab.L_total}" style="width: 12%;text-align: right;color: #{y.etat()=='R'?'orange':(y.etat()=='P'?'red':'')};font-style: #{y.etat()!='E'?'italic':''}">
                        <h:outputText value="#{y.prixTotal}" converter="#{managedBonAvoirVente.converter}" title="#{lab.LCF_PBAA_numero_serie} : #{y.numSerie}"/>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue des entetes de vente
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgStatut_fav">
            <p:dialog id="dlgStatut_fav" header="Statut de la facture" modal="true" width="300px" height="20px" closeOnEscape="true" widgetVar="dlgStatut" resizable="false" style="background-color: #A0AFA0"> 
                <p:outputPanel id="grp_btn_etat_fav" styleClass="yvs_form_of" style="width: 98%;margin: auto">  
                    <p:commandLink value="#{lab.LC_PLV_editable}" styleClass="button-stateOF #{(managedBonAvoirVente.docSelect.statut == constantes.ETAT_EDITABLE)?'button-stateOF_actif':''}" 
                                   disabled="#{!(managedBonAvoirVente.docSelect.statut == constantes.ETAT_VALIDE
                                               or managedBonAvoirVente.docSelect.statut == constantes.ETAT_ANNULE)}" 
                                   actionListener="#{managedBonAvoirVente._changeStatut(constantes.ETAT_EDITABLE)}"
                                   process="@this" update="grp_btn_etat_fav" global="false"/>                                 
                    <p:commandLink value="#{lab.LC_PLV_valider}" styleClass="button-stateOF #{(managedBonAvoirVente.docSelect.statut == constantes.ETAT_VALIDE)?'button-stateOF_actif':''}" 
                                   disabled="#{!(managedBonAvoirVente.docSelect.statut == constantes.ETAT_EDITABLE)}" 
                                   actionListener="#{managedBonAvoirVente._changeStatut(constantes.ETAT_VALIDE)}"
                                   process="@this" update="grp_btn_etat_fav" global="false"/>
                    <p:commandLink value="#{lab.L_annuler}" styleClass="button-stateOF #{(managedBonAvoirVente.docSelect.statut==constantes.ETAT_ANNULE)?'button-stateOF_actif':''}" 
                                   disabled="#{!(managedBonAvoirVente.docSelect.statut == constantes.ETAT_VALIDE)}" 
                                   actionListener="#{managedBonAvoirVente._changeStatut(constantes.ETAT_ANNULE)}"
                                   process="@this" update="grp_btn_etat_fav" global="false"/>
                    <p:commandLink value="#{(managedBonAvoirVente.docSelect.cloturer)?lab.LCF_PBAA_ouvrir:lab.L_cloturer}" styleClass="button-stateOF" 
                                   actionListener="#{managedBonAvoirVente._cloturer()}"
                                   process="@this" update="grp_btn_etat_fav" global="false"/>
                </p:outputPanel>   
            </p:dialog>
        </h:form>
        <!-->
        *****************************************************************************
        Boite de dialogue des entetes de vente
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.L_plus_option}" width="40%"  closeOnEscape="true" widgetVar="dlgPlusOption" resizable="false"> 
                <h:panelGrid id="blog_entete_avoir_vente" columns="2" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                    <h:outputText value="#{lab.L_agence}" rendered="#{acces.multiAgence}"/>
                    <h:selectOneMenu value="#{managedBonAvoirVente.agence_}" id="_select_agence_fav" style="width: 100%" rendered="#{acces.multiAgence}">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{managedAgence.listAgence}" var="ag"
                                       itemLabel="#{ag.designation}" itemValue="#{ag.id}"/>
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente._chooseAgence()}" oncomplete="collapseList('avoir_vente')" 
                                update="blog_entete_avoir_vente"/>
                    </h:selectOneMenu>
                    <h:outputText value="#{lab.L_depot}"/>
                    <h:selectOneMenu value="#{managedBonAvoirVente.depot_}" style="width: 100%">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{managedDepot.depots_all}" var="de" itemLabel="#{de.designation}" itemValue="#{de.id}"/>
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente._chooseDepot()}" oncomplete="collapseList('avoir_vente')"
                                update="_select_tranche_avoir_vente"/>
                    </h:selectOneMenu>
                    <h:outputText value="#{lab.L_point_vente}"/>
                    <h:selectOneMenu value="#{managedBonAvoirVente.point_}" style="width: 100%">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{managedPointVente.pointsvente_all}" var="po"
                                       itemLabel="#{po.libelle}" itemValue="#{po.id}"/>
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente._choosePoint()}" oncomplete="collapseList('avoir_vente')"/>
                    </h:selectOneMenu>
                    <h:outputText value="#{lab.L_tranche}"/>
                    <h:selectOneMenu value="#{managedBonAvoirVente.tranche_}" id="_select_tranche_avoir_vente" style="width: 100%">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{managedBonAvoirVente.tranches_point_}" var="tr"
                                       itemLabel="#{tr.titre}" itemValue="#{tr.id}"/>
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente._chooseTranche()}" oncomplete="collapseList('avoir_vente')"/>
                    </h:selectOneMenu>
                    <h:outputText value="#{lab.LC_PBRV_client}"/>
                    <h:inputText value="#{managedBonAvoirVente.codeClient_}" style="width: 100%">
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente.searchByClient()}" oncomplete="collapseList('avoir_vente')"/>
                    </h:inputText>
                    <h:outputText value="#{lab.LCF_PBAV_vendeur}"/>
                    <h:selectOneMenu value="#{managedBonAvoirVente.users_}" style="width: 100%">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{managedBonAvoirVente.userss_}" var="us"
                                       itemLabel="#{us.nomUsers}" itemValue="#{us.id}"/>
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente._chooseVendeur()}" oncomplete="collapseList('avoir_vente')"/>
                    </h:selectOneMenu>
                    <h:outputText value="#{lab.L_statut}"/>
                    <h:selectOneMenu value="#{managedBonAvoirVente.statut}"  valueChangeListener="#{managedBonAvoirVente._chooseStatut}" style="width: 100%">
                        <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                        <f:selectItems value="#{constantes.ETATS_}"/>
                    </h:selectOneMenu> 
                    <h:panelGroup>
                        <h:outputText value="#{lab.LC_PBRA_heures}"/>
                        <h:selectBooleanCheckbox value="#{managedBonAvoirVente.date_}" style="margin-top: 2px;float: right">
                            <p:ajax event="valueChange" listener="#{managedBonAvoirVente.chooseDateSearch()}" oncomplete="collapseList('avoir_vente')"
                                    update="blog_date_search_avoir_vente :main_avoir_vente:data_avoir_vente"/>
                        </h:selectBooleanCheckbox>
                    </h:panelGroup>
                    <h:panelGroup id="blog_date_search_avoir_vente">
                        <pe:timePicker value="#{managedBonAvoirVente.dateDebut_}" disabled="#{!managedBonAvoirVente.date_}" style="width: 80px;text-align: left">
                            <p:ajax event="timeSelect" listener="#{managedBonAvoirVente.chooseDateSearch()}" update=":main_avoir_vente:data_avoir_vente" oncomplete="collapseList('avoir_vente')"/>
                        </pe:timePicker>
                        <p:spacer width="5px" style="background: black"/>
                        <pe:timePicker value="#{managedBonAvoirVente.dateFin_}" disabled="#{!managedBonAvoirVente.date_}" style="width: 80px;text-align: left">
                            <p:ajax event="timeSelect" listener="#{managedBonAvoirVente.chooseDateSearch()}" update=":main_avoir_vente:data_avoir_vente" oncomplete="collapseList('avoir_vente')"/>
                        </pe:timePicker>
                    </h:panelGroup>
                    <h:outputText value="#{lab.LCF_PBAV_facture}"/>
                    <h:inputText value="#{managedBonAvoirVente.numFacture}" style="width: 100%">
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente.chooseFacture()}" oncomplete="collapseList('avoir_vente')"/>
                    </h:inputText> 

                    <h:panelGroup>
                        <h:outputText value="#{lab.LDB_PC_dates}"  />
                        <h:selectBooleanCheckbox value="#{managedBonAvoirVente.date_up}" title="#{lab.LDB_PC_dates_last_modif}" style="float: right">
                            <p:ajax event="valueChange" global="false" update="blog_date_search_client"  listener="#{managedBonAvoirVente.addParamDates()}" oncomplete="collapseList('avoir_vente')" />
                        </h:selectBooleanCheckbox>
                    </h:panelGroup>
                    <h:panelGroup id="blog_date_search_client">
                        <p:calendar value="#{managedBonAvoirVente.dateDebut_}" pattern="dd-MM-yyyy" navigator="true" size="10" disabled="#{!managedBonAvoirVente.date_up}">
                            <p:ajax event="dateSelect" global="false" listener="#{managedBonAvoirVente.addParamDates}" update=":main_avoir_vente:data_avoir_vente" oncomplete="collapseList('avoir_vente')"/>
                        </p:calendar>
                        <p:spacer style="width: 5px;background: black"/>
                        <p:calendar value="#{managedBonAvoirVente.dateFin_}" pattern="dd-MM-yyyy" navigator="true" size="10" disabled="#{!managedBonAvoirVente.date_up}">
                            <p:ajax event="dateSelect" global="false" listener="#{managedBonAvoirVente.addParamDates}" update=":main_avoir_vente:data_avoir_vente" oncomplete="collapseList('avoir_vente')"/>
                        </p:calendar>
                    </h:panelGroup>

                    <h:outputText value="Ids"/>
                    <h:inputText value="#{managedBonAvoirVente.idsSearch}" style="width: 100%" title="#{lab.L_entrer_id_separer_virgules}">
                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente.addParamIds()}" oncomplete="collapseList('avoir_vente')"/>
                    </h:inputText>
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main-generer_other">            
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmGenererOther" closeOnEscape="true" message="Voulez-vous generer une equivalence?" header="#{lab.L_confirmation}">
                <div align="center">
                    <p:calendar value="#{managedBonAvoirVente.dateGenerer}" size="8" pattern="dd-MM-yyyy" navigator="true">
                        <p:ajax event="dateSelect" global="false"/>
                    </p:calendar>               
                </div>
                <div align="center">
                    <p:commandButton value="#{lab.L_oui}" icon="ui-icon-check" actionListener="#{managedBonAvoirVente.onGenererOther()}" oncomplete="dlgConfirmGenererOther.hide()"/>
                    <p:commandButton type="button" icon="ui-icon-close" value="#{lab.L_non}" onclick="dlgConfirmSoumis.hide()"/>
                </div>                
            </p:confirmDialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgComptabiliseDoc" message="#{lab.LCF_PBAA_text}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedSaisiePiece.comptabiliserVente(managedBonAvoirVente.selectDoc)}"
                                 update=":main_avoir_vente:btn_comptabilised_fav :main_avoir_vente:data_avoir_vente :main_avoir_vente:tabView_fav:data_mensualite_fav" oncomplete="dlgComptabiliseDoc.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgComptabiliseDoc.hide()" />
            </p:confirmDialog>
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgUnComptabiliseDoc" message="#{lab.LCF_PBAA_text1}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedSaisiePiece.unComptabiliserVente(managedBonAvoirVente.selectDoc, true)}"
                                 update=":main_avoir_vente:btn_comptabilised_fav :main_avoir_vente:data_avoir_vente :main_avoir_vente:tabView_fav:data_mensualite_fav" oncomplete="dlgUnComptabiliseDoc.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgUnComptabiliseDoc.hide()" />
            </p:confirmDialog>
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgComptabilisePiece" message="#{lab.LCF_PBAA_text2}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedSaisiePiece.comptabiliserCaisseVente(managedBonAvoirVente.selectReglement, true)}"
                                 update=":main_avoir_vente:btn_comptabilised_fav :main_avoir_vente:tabView_fav:data_mensualite_fav" oncomplete="dlgComptabilisePiece.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgComptabilisePiece.hide()" />
            </p:confirmDialog>
            <p:confirmDialog  header="#{lab.L_confirmation}" width="40%" widgetVar="dlgUnComptabilisePiece" message="#{lab.LCF_PBAV_text}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedSaisiePiece.unComptabiliserCaisseVente(managedBonAvoirVente.selectReglement, true)}"
                                 update=":main_avoir_vente:btn_comptabilised_fav :main_avoir_vente:tabView_fav:data_mensualite_fav" oncomplete="dlgUnComptabilisePiece.hide()"/>
                <p:commandButton value="#{lab.L_annuler}" icon="ui-icon-circle-close" type="button" onclick="dlgUnComptabilisePiece.hide()" />
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmAnnulePiece" closeOnEscape="true"
                             message="#{lab.LCF_PBAV_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.openConfirmPaiement()}" oncomplete="dlgConfirmAnnulePiece.hide()" 
                                 update=":main_avoir_vente:grp_btn_etat_avoir_vente :main_avoir_vente:data_avoir_vente :main_avoir_vente:tabView_fav:data_mensualite_fav"/>
                <p:commandButton type="button" value="#{lab.L_non}" onclick="dlgConfirmAnnulePiece.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteMensualite" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.deleteBeanReglement()}" oncomplete="dlgConfirmDeleteMensualite.hide();collapseForm('mensualite_facture_vente')"
                                 update=":main_avoir_vente:tabView_fav:form_mensualite_fav"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDeleteMensualite.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteMensualite_" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.deleteBeanReglement_()}" oncomplete="dlgConfirmDeleteMensualite_.hide();collapseForm('mensualite_facture_vente')"
                                 update=":main_avoir_vente:tabView_fav:form_mensualite_fav"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDeleteMensualite_.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.deleteBean()}" oncomplete="dlgConfirmDelete.hide();collapseList('avoir_vente')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete_" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.deleteBean_()}" oncomplete="dlgConfirmDelete_.hide();collapseList('avoir_vente')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete_.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog id="id_confirm_close_fav" hideEffect="explode" widgetVar="dlgConfirmClose" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text4} #{managedBonAvoirVente.selectDoc.cloturer?lab.LCF_PBAA_deverrouiller:lab.LCF_PBAA_verrouiller}?" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.cloturer()}" oncomplete="dlgConfirmClose.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmClose.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteArticle" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.deleteBeanArticle()}" update=":main_avoir_vente:tabView_fav:blog_form_contenu_avoir_vente"
                                 oncomplete="dlgConfirmDeleteArticle.hide();collapseForm('contenu_avoir_vente')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDeleteArticle.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteArticle_" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.deleteBeanArticle_()}" update=":main_avoir_vente:tabView_fav:blog_form_contenu_avoir_vente"
                                 oncomplete="dlgConfirmDeleteArticle_.hide();collapseForm('contenu_avoir_vente')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDeleteArticle_.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteArticles" closeOnEscape="true"
                             message="#{lab.LC_PLV_text9}" header="#{lab.L_confirmation}">
                <div >
                    <span>#{lab.LC_PFV_memoriser_choix_session}</span>
                    <p:selectBooleanCheckbox value="#{managedBonAvoirVente.memoriserDeleteContenu}" />
                </div>
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.deleteBeanArticles(true)}" update=":main_avoir_vente:tabView_fav:blog_form_contenu_avoir_vente"
                                 oncomplete="dlgConfirmDeleteArticles.hide();collapseForm('contenu_avoir_vente')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDeleteArticles.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmAnnuler" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text5}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.annulerOrder(true)}" oncomplete="dlgConfirmAnnuler.hide();collapseForm('ordre_transfert')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmAnnuler.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmRefuser" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text5}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.refuserOrder(true)}" oncomplete="dlgConfirmRefuser.hide();collapseForm('ordre_transfert')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmRefuser.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmSoumis" closeOnEscape="true"
                             message="#{lab.LCF_PBAA_text6}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.transmisOrder()}" oncomplete="dlgConfirmSoumis.hide();collapseForm('ordre_transfert')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmSoumis.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgSaveEntete" closeOnEscape="true"
                             message="#{lab.LCF_PBAV_text2}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.saveNewEntete()}" oncomplete="dlgSaveEntete.hide();collapseForm('avoir_vente');collapseForm('contenu_avoir_vente')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgSaveEntete.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgResetEntete" closeOnEscape="true"
                             message="#{lab.LCF_PBAV_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.resetFicheEntete()}" oncomplete="dlgResetEntete.hide();collapseForm('avoir_vente');collapseForm('contenu_avoir_vente')"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgResetEntete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgCleanEntete" closeOnEscape="true"
                             message="#{lab.LCF_PBAV_text4}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.cleanEnteteVente()}" oncomplete="dlgCleanEntete.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgCleanEntete.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgCleanVente" closeOnEscape="true"
                             message="#{lab.LCF_PBAV_text5}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedBonAvoirVente.cleanVente()}" oncomplete="dlgCleanVente.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgCleanVente.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_avoir_vente">
            <div class="part_fix">
                <div style="float: left"> 
                    <p:splitButton value="#{lab.L_enregistrer}" id="save_avoir_vente" actionListener="#{managedBonAvoirVente.saveNew()}" update="blog_form_avoir_vente data_avoir_vente"
                                   icon="ui-icon-disk">
                        <p:menuitem value="#{lab.L_nouveau}" id="cancel_avoir_vente"   actionListener="#{managedBonAvoirVente.resetFiche()}" update="blog_form_avoir_vente" oncomplete="collapseForm('avoir_vente');collapseForm('contenu_avoir_vente')"
                                    icon="ui-icon-document"/>
                        <p:separator/>
                        <p:menuitem icon="ui-icon-refresh" value="Générer retour" actionListener="#{managedBonAvoirVente.onBuildGenererOther(constantes.TYPE_BRV)}" oncomplete="dlgConfirmGenererOther.show()"/>
                        <p:separator/>
                        <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" onclick="dlgConfirmDelete.show()" global="false" />
                    </p:splitButton>
                    <p:commandButton value="#{lab.L_supprimer}" icon="ui-icon-trash" id="delete_avoir_vente" onclick="dlgConfirmDelete.show()" global="false" type="button"/>
                    <h:panelGroup id="other_avoir_vente"> 

                    </h:panelGroup>
                </div>
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedBonAvoirVente.parcoursInAllResult(false)}" update="txt_parc_linear_avoir_vente" icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('avoir_vente')"/>
                    <h:inputText value="#{managedBonAvoirVente.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_parc_linear_avoir_vente"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedBonAvoirVente.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedBonAvoirVente.parcoursInAllResult(true)}" update="txt_parc_linear_avoir_vente" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('avoir_vente')"/>
                </h:panelGroup> 
                <div style="float: right">
                    <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('avoir_vente');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link title="#{lab.L_mode_liste}" onclick="collapseList('avoir_vente');
                            return false" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>   
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_avoir_vente">
                    <p:outputPanel id="blog_form_avoir_vente" style="width: 99%; margin: auto; background: white">
                        <h:panelGrid columns="1" style="width: 100%">
                            <p:outputPanel id="form_entete_avoir_vente">
                                <h:panelGroup rendered="false"> 
                                    <p:selectOneRadio value="#{managedBonAvoirVente.docVente.typeDoc}" style="cursor: pointer">
                                        <f:selectItem itemLabel="#{constantes.TYPE_FAV_NAME}" itemValue="#{constantes.TYPE_FAV}"/>
                                        <f:selectItem itemLabel="#{constantes.TYPE_BRV_NAME}" itemValue="#{constantes.TYPE_BRV}"/>
                                        <p:ajax event="valueChange" global="false" update="infos_document_avoir_vente txt_puv_contenu_fav"/>
                                    </p:selectOneRadio>
                                </h:panelGroup>
                                <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%;margin-bottom: -8px;margin-top: -10px" cellpadding="0" cellspacing="0" rendered="#{managedBonAvoirVente.docVente.update}">
                                    <h:panelGrid columns="1" styleClass="yvs_nostyle" style="float: left;font-size: 0.9em;background: black;color: white">                                            
                                        <h:outputText id="txt_reference_document_avoir_vente" value="#{managedBonAvoirVente.docVente.numDoc}"/>
                                    </h:panelGrid>
                                    <h:panelGroup style="padding: 7px;float: right; position: relative; margin-top: 1%">
                                        <p:outputPanel id="grp_btn_etat_avoir_vente" styleClass="yvs_form_of">  
                                            <p:commandLink value="#{lab.L_editable}" styleClass="#{(managedBonAvoirVente.docVente.statut == constantes.ETAT_EDITABLE)?'statut_valide':'etat_formation_true'}" 
                                                           disabled="#{!(managedBonAvoirVente.docVente.statut == constantes.ETAT_VALIDE
                                                                       or managedBonAvoirVente.docVente.statut == constantes.ETAT_ANNULE)}" 
                                                           actionListener="#{managedBonAvoirVente.annulerOrder(false)}"
                                                           process="@this" update="grp_btn_etat_avoir_vente"/>                                 
                                            <p:commandLink value="#{lab.L_valider}" styleClass="#{(managedBonAvoirVente.docVente.statut == constantes.ETAT_VALIDE)?'statut_valide':'etat_formation_true'}" 
                                                           disabled="#{!(managedBonAvoirVente.docVente.statut == constantes.ETAT_EDITABLE)}" 
                                                           actionListener="#{managedBonAvoirVente.validerOrder()}"
                                                           process="@this" update="grp_btn_etat_avoir_vente"/>
                                            <p:commandLink value="#{lab.L_annulers}" styleClass="#{(managedBonAvoirVente.docVente.statut==constantes.ETAT_ANNULE)?'statut_valide':'etat_formation_true'}" 
                                                           disabled="#{managedBonAvoirVente.docVente.statut == constantes.ETAT_ANNULE}" 
                                                           actionListener="#{managedBonAvoirVente.refuserOrder(false)}"
                                                           process="@this" update="grp_btn_etat_avoir_vente"/>
                                            <p:commandLink value="#{managedBonAvoirVente.isComptabiliseBean(managedBonAvoirVente.docVente)?lab.L_comptabilise:lab.L_comptabiliser}"
                                                           type="button" styleClass="#{(managedBonAvoirVente.docVente.comptabilise)?'statut_valide':'etat_formation_true'}"
                                                           onclick="dlgComptabiliseDoc.show()" rendered="#{managedBonAvoirVente.docVente.statut==constantes.STATUT_DOC_VALIDE}" global="false" id="btn_comptabilised_fav"/>
                                            <p:contextMenu for="btn_comptabilised_fav" style="font-size: 0.8em">
                                                <p:menuitem icon="ui-icon-circle-arrow-w" value="#{lab.LC_PA_proprietes}" actionListener="#{managedSaisiePiece.displayPieceComptable(managedBonAvoirVente.docVente.id, constantes.SCR_AVOIR_VENTE)}" 
                                                            update=":form_pptes_compta:table_pptes_compta" oncomplete="dlgPpteCompta.show()"/>
                                                <p:separator style="width: 100%" />
                                                <p:menuitem icon="ui-icon-circle-arrow-w" value="#{lab.L_annuler}" onclick="dlgUnComptabiliseDoc.show()" disabled="#{!managedBonAvoirVente.docVente.comptabilise}" global="false"/>
                                            </p:contextMenu>
                                        </p:outputPanel>                                                
                                    </h:panelGroup>                                     
                                </h:panelGrid> 
                            </p:outputPanel>
                            <p:outputPanel>
                                <div style="width: 40%;float: left">
                                    <h:panelGrid id="infos_document_avoir_vente" styleClass="yvs_table" columns="2" style="width: 100%" cellpadding="0" cellspacing="0">
                                        <f:facet name="header">
                                            <div align="left">
                                                <p:commandLink id="btnMontantsFAV" global="false" style="float: left;border: 2px solid black; border-radius: 5px;padding: 3px;background: white" title="#{lab.LC_PBRA_montants}">
                                                    <h:graphicImage library="icones" name="ico_facture2.png" width="15" height="15"/>  
                                                </p:commandLink>
                                                <h:panelGroup style="margin-left: 10px">
                                                    <h:panelGroup>                                                        
                                                        <p:selectBooleanCheckbox value="#{managedBonAvoirVente.docVente.fromFacture}" style="float:left;margin-left: 5px;margin-top: 3px">               
                                                            <p:ajax event="valueChange" listener="#{managedBonAvoirVente.changeSource()}" update="infos_document_avoir_vente :main_avoir_vente:tabView_fav:form_contenu_avoir_vente"/>                                                    
                                                        </p:selectBooleanCheckbox>
                                                        <span style="float:left;margin-top: 2px">#{lab.LC_PBRV_rattacher_facture}</span>
                                                    </h:panelGroup>
                                                    <h:inputText id="select_document_facture_fav" value="#{managedBonAvoirVente.facture.numDoc}" disabled="#{!managedBonAvoirVente.docVente.fromFacture or managedBonAvoirVente.docVente.update}" 
                                                                 style="width: 150px;color: #{managedBonAvoirVente.facture.error?'red':''}">                
                                                        <p:ajax event="valueChange" listener="#{managedBonAvoirVente.searchFacture()}" update="data_contenu_fv_fav"/>                                                        
                                                    </h:inputText>
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.id}" styleClass="style_identifiant"/>
                                                    <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="#{lab.LC_PRA_liste_facture}" oncomplete="dlgListFactures.show()"
                                                                     disabled="#{!managedBonAvoirVente.docVente.fromFacture or managedBonAvoirVente.docVente.update}" global="false"/>
                                                    <p:commandButton icon="ui-icon-gear" style="width: 20px;height: 22px; float: right" id="btn-refresh-invoice"
                                                                     type="button" />
                                                    <p:contextMenu event="left click" for="btn-refresh-invoice" >
                                                        <p:menuitem value="#{lab.L_actualiser}" icon="ui-icon-refresh" actionListener="#{managedBonAvoirVente.actualiseAvoir()}"
                                                                    disabled="#{managedBonAvoirVente.docVente.id lt 1}" update="infos_document_avoir_vente" />
                                                        <p:menuitem value="#{lab.LCF_PBAV_contenus}" icon="ui-icon-cart"  title="#{lab.LCF_PBAV_contenu_facture}" global="false"
                                                                    update=":data_contenus_fv_fav" oncomplete="dlgContenuFVFAV.show()" disabled="#{!managedBonAvoirVente.docVente.update}"/>
                                                    </p:contextMenu>
                                                </h:panelGroup>
                                            </div>
                                        </f:facet>
                                        <span>#{lab.LCF_PBAV_date_facture} </span>
                                        <h:panelGroup rendered="#{managedBonAvoirVente.docVente.fromFacture}">
                                            <h:outputText value="#{managedBonAvoirVente.docVente.documentLie.enteteDoc.dateEntete}" converter="DATE"/>
                                            <span> #{lab.L_a} </span>
                                            <h:outputText value="#{managedBonAvoirVente.docVente.documentLie.heureDoc}" converter="TIME"/>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{!managedBonAvoirVente.docVente.fromFacture}">
                                            <p:calendar value="#{managedBonAvoirVente.docVente.documentLie.enteteDoc.dateEntete}" pattern="dd-MM-yyyy" navigator="true" size="10"/>
                                            <span> #{lab.L_a} </span>
                                            <pe:timePicker value="#{managedBonAvoirVente.docVente.documentLie.heureDoc}" style="width: 100px"/>
                                        </h:panelGroup>
                                        <span>#{lab.LCF_PBAV_client} </span>        
                                        <h:panelGroup id="txt_client_avoir_vente">
                                            <h:inputText value="#{managedBonAvoirVente.docVente.client.nom_prenom}" rendered="#{managedBonAvoirVente.docVente.fromFacture}" style="width: 95%" readonly="true"/>
                                            <h:panelGroup rendered="#{!managedBonAvoirVente.docVente.fromFacture}">
                                                <h:inputText value="#{managedBonAvoirVente.docVente.client.codeClient}" style="color: #{managedBonAvoirVente.docVente.client.error?'red':''}"
                                                             disabled="#{managedBonAvoirVente.docVente.statut != constantes.ETAT_EDITABLE}">
                                                    <p:ajax event="valueChange" listener="#{managedBonAvoirVente.searchClient()}" update="txt_client_avoir_vente"/>
                                                </h:inputText>    
                                                <h:outputText value="#{managedBonAvoirVente.docVente.nomClient}" style="margin-left: 5px"/>
                                                <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="#{lab.LC_PPL_liste_client}" global="false"
                                                                 disabled="#{managedBonAvoirVente.docVente.statut != constantes.ETAT_EDITABLE}"  oncomplete="dlgListClients.show()"/>
                                            </h:panelGroup>
                                        </h:panelGroup>                                        
                                        <span title="Categorie Comptable">Categorie </span>                                                
                                        <h:panelGroup id="txt_categorie_avoir_vente">
                                            <h:inputText value="#{managedBonAvoirVente.docVente.categorieComptable.codeCategorie}" rendered="#{managedBonAvoirVente.docVente.fromFacture}" style="width: 95%" readonly="true"/>
                                            <h:panelGroup rendered="#{!managedBonAvoirVente.docVente.fromFacture}">
                                                <h:selectOneMenu value="#{managedBonAvoirVente.docVente.categorieComptable.id}" style="width: 95%">
                                                    <f:selectItem itemLabel="--" itemValue="0"/>
                                                    <f:selectItems value="#{managedCatCompt.categoriesVente}" var="cat" 
                                                                   itemLabel="#{cat.designation}" itemValue="#{cat.id}" />  
                                                    <p:ajax event="valueChange" update="txt_categorie_avoir_vente"/>
                                                </h:selectOneMenu>   
                                            </h:panelGroup>
                                        </h:panelGroup>  
                                        <span>#{lab.L_point_vente}</span>
                                        <h:panelGroup id="txt_pv_avoir_vente">
                                            <h:panelGroup rendered="#{managedBonAvoirVente.docVente.fromFacture}">
                                                <h:inputText value="#{managedBonAvoirVente.docVente.enteteDoc.point.libelle}" style="width: 50%" readonly="true"/>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.enteteDoc.tranchePoint.heureDebut}" converter="TIME"/>
                                                    <span>- </span>
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.enteteDoc.tranchePoint.heureFin}" converter="TIME"/>
                                                </h:panelGroup>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{!managedBonAvoirVente.docVente.fromFacture}">
                                                <h:selectOneMenu value="#{managedBonAvoirVente.docVente.enteteDoc.point.id}" disabled="#{managedBonAvoirVente.docVente.enteteDoc.id gt 0}"
                                                                 valueChangeListener="#{managedBonAvoirVente.choosePoint_}" id="select_point_avoir_vente"
                                                                 style="min-width: #{managedAgence.agences.size() gt 1?'160px':'95%'}; max-width: #{managedAgence.agences.size() gt 1?'300px':'95%'}">
                                                    <f:selectItem itemLabel="--" itemValue="0"/>
                                                    <f:selectItems value="#{managedPointVente.pointsvente}" var="poi" itemLabel="#{poi.libelle}" itemValue="#{poi.id}" />  
                                                    <f:selectItem itemLabel="--" itemValue="0"/>
                                                    <p:ajax event="valueChange" update="txt_livreur_avoir_vente @this"/>
                                                </h:selectOneMenu> 
                                                <p:commandLink value="Selectionner agence" onclick="dlgAgenceForPoint.show()" global="false" rendered="#{managedAgence.agences.size() gt 1}"/>
                                            </h:panelGroup>
                                        </h:panelGroup>
                                        <span>#{lab.LCF_PBAV_vendeur} </span>
                                        <h:panelGroup id="txt_livreur_avoir_vente">
                                            <h:inputText value="#{managedBonAvoirVente.docVente.enteteDoc.users.nomUsers}" style="width: 95%" rendered="#{managedBonAvoirVente.docVente.fromFacture}" readonly="true"/>
                                            <h:panelGroup rendered="#{!managedBonAvoirVente.docVente.fromFacture}">
                                                <h:selectOneMenu value="#{managedBonAvoirVente.docVente.enteteDoc.users.id}" disabled="#{managedBonAvoirVente.docVente.enteteDoc.id gt 0}"
                                                                 valueChangeListener="#{managedBonAvoirVente.chooseVendeur}" style="width: 95%">
                                                    <f:selectItem itemLabel="--" itemValue="0"/>
                                                    <f:selectItems value="#{managedBonAvoirVente.vendeurs}" var="vend_" itemLabel="#{vend_.nomUsers}" itemValue="#{vend_.id}" />                                
                                                    <p:ajax event="valueChange" global="false"/>
                                                </h:selectOneMenu> 
                                            </h:panelGroup>
                                        </h:panelGroup>
                                        <span>#{lab.LCF_PBAV_date_avoir}</span>                                        
                                        <p:calendar value="#{managedBonAvoirVente.docVente.enteteDoc.dateEntete}" pattern="dd-MM-yyyy" size="10"/>
                                        <span>#{lab.L_reference} </span>
                                        <h:inputText id="txt_reference_avoir_vente" value="#{managedBonAvoirVente.docVente.numPiece}" style="width: 95%"
                                                     disabled="#{managedBonAvoirVente.docVente.statut != constantes.ETAT_EDITABLE}"/>
                                    </h:panelGrid>
                                    <p:overlayPanel for="btnMontantsFAV" hideEffect="fade" style="width: 35%;background: black;color: white">
                                        <p:outputPanel id="blog_form_montant_doc_fav">
                                            <h:panelGrid columns="2" style="width: 100%;font-weight: bolder;margin-top: 5px;color: white">
                                                <span>#{lab.LC_PFA_total_ht}</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantHT}" converter="#{managedBonAvoirVente.converter}"/>
                                                    <span style="font-size: small"> Fcfa</span>
                                                </h:panelGroup>
                                                <span>#{lab.LC_PFA_total_remise_article}</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantRemise}" converter="#{managedBonAvoirVente.converter}"/>
                                                    <span style="font-size: small"> Fcfa</span>
                                                </h:panelGroup>
                                                <span>#{lab.LC_PFA_total_taxe}</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantTaxe}" converter="DNS"/>
                                                    <span style="font-size: small"> Fcfa</span>
                                                </h:panelGroup>
                                                <span style="color: #E9FBF9">#{lab.LC_PFA_total_ttc}</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantTTC}" converter="#{managedBonAvoirVente.converter}" style="color: #E9FBF9"/>
                                                    <span style="font-size: small;color: #E9FBF9"> Fcfa</span>
                                                </h:panelGroup>
                                                <span style="color: #E9FBF9">#{lab.LC_PFV_total_remise_facture}</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantRemises}" converter="#{managedBonAvoirVente.converter}" style="color: #E9FBF9"/>
                                                    <span style="font-size: small;color: #E9FBF9"> Fcfa</span>
                                                </h:panelGroup>
                                                <span style="color: #E9FBF9">#{lab.LC_PFV_total_cout_suppl}</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantCS}" converter="#{managedBonAvoirVente.converter}" style="color: #E9FBF9"/>
                                                    <span style="font-size: small;color: #E9FBF9"> Fcfa</span>
                                                </h:panelGroup>
                                                <span>#{lab.LC_PFV_total_facture}</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantTotal}" converter="#{managedBonAvoirVente.converter}"/>
                                                    <span style="font-size: small"> Fcfa</span>
                                                </h:panelGroup>
                                            </h:panelGrid>
                                        </p:outputPanel>
                                    </p:overlayPanel>
                                </div>
                                <div style="width: 59%;margin-left: 41%">
                                    <p:outputPanel autoUpdate="true">
                                        <p:outputPanel rendered="#{managedBonAvoirVente.docVente.fromFacture}">
                                            <div style="background: #666;color: white;width: 100%;font-size: 1.2em">
                                                <span>
                                                    #{lab.LC_PLV_contenu_facture}
                                                </span>
                                            </div>
                                            <p:dataTable id="data_contenu_fv_fav" value="#{managedBonAvoirVente.contenus_fv}" var="artC" rowKey="#{artC.id}" 
                                                         rowIndexVar="artCIdx" selectionMode="single" scrollable="true" scrollHeight="165">
                                                <p:ajax event="rowSelect" listener="#{managedBonAvoirVente.loadOnViewArticle}" update=":main_avoir_vente:tabView_fav:form_contenu_avoir_vente"/>
                                                <p:ajax event="rowUnselect" listener="#{managedBonAvoirVente.unLoadOnViewArticle}" update=":main_avoir_vente:tabView_fav:form_contenu_avoir_vente"/>
                                                <p:column filterBy="#{artC.article.refArt}" style="width: 18%">
                                                    <span>#{artC.article.refArt}</span>
                                                </p:column>
                                                <p:column headerText="#{lab.L_article}">
                                                    <span>#{artC.article.designation}</span>
                                                </p:column>
                                                <p:column headerText="#{lab.L_qte}" style="width: 8%;text-align: center">
                                                    <h:outputText value="#{artC.quantite}" converter="#{managedBonAvoirVente.converterStock}"/>
                                                    <span title="#{artC.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{artC.conditionnement.unite.reference}</span>
                                                </p:column>
                                                <p:column headerText="#{lab.LCF_PBAV_puv}" style="width: 13%;text-align: right">
                                                    <h:outputText value="#{artC.prix}" converter="#{managedBonAvoirVente.converter}"/>
                                                </p:column>
                                                <p:column headerText="#{lab.L_rem}." style="width: 13%;text-align: right">
                                                    <h:outputText value="#{artC.remise}" converter="#{managedBonAvoirVente.converter}"/>
                                                </p:column>
                                                <p:column headerText="#{lab.L_total}" style="width: 13%;text-align: right">
                                                    <h:outputText value="#{artC.prixTotal}" converter="#{managedBonAvoirVente.converter}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </p:outputPanel>
                                        <p:outputPanel rendered="#{!managedBonAvoirVente.docVente.fromFacture}">
                                            <h1 style="padding-left: 10px">Détails du produit</h1>
                                            <div style="float: left; width: 59%; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;
                                                 border-bottom: 2px solid #bbb; padding-left: 10px; padding-bottom: 10px; padding-top: 5px">
                                                <span style="font-weight: bold;color: #000">
                                                    #{managedBonAvoirVente.contenu.article.designation}
                                                </span>
                                                <p:outputPanel rendered="#{accesRessource.base_view_article_pua}" layout="block" style="padding-top: 10px; padding-bottom: 10px">
                                                    <h:outputText value="Prix d'achat = " />
                                                    <h:outputText value="#{managedBonAvoirVente.contenu.conditionnement.prixAchat}" converter="#{managedBonAvoirVente.converter}" style="font-weight: bold;color: #000"/>
                                                    <span style="font-size: 0.8em">#{managedFactureAchat.currentScte.devise}</span>
                                                </p:outputPanel>
                                                <p:outputPanel rendered="#{accesRessource.base_view_article_puv}" layout="block" style="padding-top: 10px; padding-bottom: 10px">
                                                    <h:outputText value="Prix de vente = " />
                                                    <h:outputText value="#{managedBonAvoirVente.contenu.conditionnement.prix}" converter="#{managedBonAvoirVente.converter}" style="font-weight: bold;color: #000"/>
                                                    <span style="font-size: 0.8em">#{managedFactureAchat.currentScte.devise}</span>
                                                </p:outputPanel>
                                                <p:outputPanel rendered="#{accesRessource.base_view_article_pr}" layout="block" style="padding-top: 10px; padding-bottom: 10px">
                                                    <h:outputText value="#{lab.LC_PFA_cout_unitaire_stock} = " />
                                                    <h:outputText value="#{managedBonAvoirVente.contenu.article.pr}" converter="#{managedBonAvoirVente.converter}"  style="font-weight: bold;color: #000"/>
                                                    <span style="font-size: 0.8em">#{managedFactureAchat.currentScte.devise}</span>
                                                </p:outputPanel>
                                                <p:outputPanel layout="block" style="padding-top: 10px; padding-bottom: 10px">
                                                    <h:outputText value="#{managedBonAvoirVente.contenu.article.stock}" converter="#{managedBonAvoirVente.converterStock}" style="font-weight: bold;color: #000"/>
                                                    <h:outputText value=" #{managedBonAvoirVente.contenu.conditionnement.unite.reference} #{lab.LC_PFV_en_stock}"/>
                                                </p:outputPanel>
                                            </div>
                                            <div style="margin-left: 61%;" align="center">
                                                <h:graphicImage id="img_article" style="max-width: 100%;max-height: 180px" value="data:image/#{Marticle.photoArticle(managedBonAvoirVente.contenu.article)[1]};base64,#{Marticle.photoArticle(managedBonAvoirVente.contenu.article)[0]}"/>
                                            </div>
                                        </p:outputPanel>
                                        <p:outputPanel id="chp_fav_net_a_payer">
                                            <h:panelGrid columns="4" style="font-size: 0.8em;width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                                                <span style="float: left">#{lab.L_ttc} :</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantTotal}" converter="#{managedBonAvoirVente.converter}" style="color: dodgerblue;font-weight: bold"/>       
                                                    <span style="font-size: 0.8em">Fcfa</span>
                                                </h:panelGroup>  
                                                <span style="float: left">#{lab.L_ttc} :</span>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText value="#{managedBonAvoirVente.docVente.montantTaxe}" converter="#{managedBonAvoirVente.converter}" style="color: dodgerblue;font-weight: bold"/>       
                                                    <span style="font-size: 0.8em">Fcfa</span>
                                                </h:panelGroup>
                                            </h:panelGrid>  
                                        </p:outputPanel>
                                    </p:outputPanel> 
                                </div>
                            </p:outputPanel>                            
                            <p:tabView id="tabView_fav">
                                <p:tab title="#{lab.LCF_PBAV_contenus}">
                                    <p:outputPanel id="blog_form_contenu_avoir_vente">
                                        <h:panelGrid id="form_contenu_avoir_vente" columns="1" styleClass="yvs_nostyle" style="width: 100%;background: white;border: 2px solid #045491!important; border-radius: 5px">  
                                            <f:facet name="header" id="desc_contenu_avoir_vente">
                                                <h:panelGrid columns="2" style="width: 100%; background: #bbb" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0" rendered="#{managedBonAvoirVente.selectArt}">
                                                    <h:panelGroup style="float: left">
                                                        <span style="font-weight: bold;color: #000">#{managedBonAvoirVente.contenu.article.designation}</span>
                                                        <span> #{lab.LCF_PBAV_vendu_a} </span>
                                                        <h:outputText value="#{managedBonAvoirVente.contenu.article.puv}" converter="#{managedBonAvoirVente.converter}" style="font-weight: bold;color: #000"/>
                                                        <span>Fcfa  </span>
                                                    </h:panelGroup>
                                                    <h:panelGroup style="float: right">
                                                        <h:outputText value="#{managedBonAvoirVente.contenu.article.stock}" converter="#{managedBonAvoirVente.converterStock}" style="font-weight: bold;color: #000"/>
                                                        <h:outputText value=" #{managedBonAvoirVente.contenu.conditionnement.unite.reference}"/>
                                                        <span> #{lab.LCF_PBAA_en_stock} </span>
                                                    </h:panelGroup>
                                                </h:panelGrid>
                                            </f:facet>  
                                            <h:panelGrid columns="4" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                                <f:facet name="header">
                                                    <div align="left">
                                                        <h:panelGroup rendered="#{managedBonAvoirVente.docVente.fromFacture}">
                                                            <span>#{lab.LC_PBRV_recalculer_taxe}</span>
                                                            <h:selectBooleanCheckbox value="#{managedBonAvoirVente.recalculTaxe}" valueChangeListener="#{managedBonAvoirVente.apllyOrNotTaxes}" >
                                                                <p:ajax event="valueChange" update="txt_total_contenu_fav txt_taxes_contenu_fav"/>
                                                            </h:selectBooleanCheckbox>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{!managedBonAvoirVente.docVente.fromFacture}">
                                                            <span> #{lab.L_article} </span>
                                                            <h:inputText id="txt_article_facture_vente" value="#{managedBonAvoirVente.contenu.article.refArt}" style="color: #{managedBonAvoirVente.contenu.article.error?'red':''}" disabled="#{managedBonAvoirVente.contenu.update}" tabindex="10">
                                                                <p:ajax event="valueChange" listener="#{managedBonAvoirVente.searchArticle()}" update="form_contenu_avoir_vente"/>
                                                            </h:inputText>    
                                                            <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px;background: white;margin-top: 5px" title="Liste Articles" global="false"
                                                                             onclick="dlgListArticle.show()" disabled="#{managedBonAvoirVente.contenu.update}"/>
                                                            <h:selectOneMenu value="#{managedBonAvoirVente.contenu.conditionnement.id}" style="min-width: 120px" title="#{lab.LDB_PA_selectionner_conditionnement}">
                                                                <f:selectItem itemLabel="--" itemValue="0"/>
                                                                <f:selectItems value="#{managedBonAvoirVente.contenu.article.conditionnements}" var="un" 
                                                                               itemLabel="#{un.unite.reference}" itemValue="#{un.id}"/>
                                                                <p:ajax event="valueChange" global="false" listener="#{managedBonAvoirVente.chooseConditionnement()}" update="form_contenu_avoir_vente"/>
                                                            </h:selectOneMenu>
                                                        </h:panelGroup>
                                                    </div>
                                                </f:facet>
                                                <span>#{lab.L_prix} </span>
                                                <h:panelGroup id="txt_puv_contenu_fav">
                                                    <h:inputText value="#{managedBonAvoirVente.contenu.prix}" style="width: 30%;text-align: right" title="Reste dû">
                                                        <p:ajax event="blur" global="false" update="txt_total_contenu_fav txt_taxes_contenu_fav txt_remise_contenu_fav" 
                                                                listener="#{managedBonAvoirVente.onPrixOrQteBlur()}" />
                                                    </h:inputText>
                                                    <span> / </span>
                                                    <h:outputText value="#{managedBonAvoirVente.contenu_fv.prix}" style="width: 25%;text-align: right" converter="#{managedBonAvoirVente.converter}"/>
                                                </h:panelGroup>
                                                <span>#{lab.L_quantite} </span>
                                                <h:panelGroup>
                                                    <pe:inputNumber value="#{managedBonAvoirVente.contenu.quantite}" style="width: 30%;text-align: right" title="#{lab.LCF_PBAA_reste_du}" >
                                                        <p:ajax event="blur" global="false" update="txt_total_contenu_fav txt_taxes_contenu_fav txt_remise_contenu_fav"
                                                                listener="#{managedBonAvoirVente.onPrixOrQteBlur()}" />
                                                    </pe:inputNumber>
                                                    <span> / </span>
                                                    <h:outputText value="#{managedBonAvoirVente.contenu_fv.quantite}" style="width: 25%;text-align: right" converter="#{managedBonAvoirVente.converterStock}" />  
                                                </h:panelGroup>
                                                <span>#{lab.L_remise} </span>
                                                <h:panelGroup id="txt_remise_contenu_fav">
                                                    <pe:inputNumber value="#{managedBonAvoirVente.contenu.remise}" style="width: 30%;text-align: right" 
                                                                    title="#{lab.LCF_PBAA_reste_du}" disabled="true"/>
                                                    <span> / </span>
                                                    <h:outputText value="#{managedBonAvoirVente.contenu_fv.remise}" style="width: 25%;text-align: right" converter="DNS"/>
                                                </h:panelGroup>
                                                <span>#{lab.L_taxe} </span>
                                                <h:panelGroup id="txt_taxes_contenu_fav">
                                                    <pe:inputNumber value="#{managedBonAvoirVente.contenu.taxe}" 
                                                                    style="width: 30%;text-align: right" title="#{lab.LCF_PBAA_reste_du}" disabled="#{managedBonAvoirVente.recalculTaxe}">
                                                        <p:ajax event="blur" global="false" update="txt_total_contenu_fav txt_taxes_contenu_fav" listener="#{managedBonAvoirVente.onTaxeBlur()}" />
                                                    </pe:inputNumber>
                                                    <span> / </span>
                                                    <h:outputText value="#{managedBonAvoirVente.contenu_fv.taxe}" style="width: 25%;text-align: right" converter="DNS"/>  
                                                </h:panelGroup>
                                            </h:panelGrid> 
                                            <f:facet name="footer">
                                                <div style="width: 100%" align="center">
                                                    <span>Prix Total </span>
                                                    <h:panelGroup id="txt_total_contenu_fav">
                                                        <pe:inputNumber value="#{managedBonAvoirVente.contenu.prixTotal}" style="width: 20%;text-align: right"
                                                                        title="#{lab.LCF_PBAA_reste_du}" disabled="true"/>
                                                        <span> / </span>
                                                        <h:outputText value="#{managedBonAvoirVente.contenu_fv.prixTotal}" style="width: 20%;text-align: right" converter="#{managedBonAvoirVente.converter}"  />  
                                                    </h:panelGroup>                    
                                                    <p:commandButton value="#{lab.L_ajouter}" id="save_contenu_avoir_vente" icon="ui-icon-circle-plus" oncomplete="collapseForm('contenu_avoir_vente')"
                                                                     update="tabView_fav:blog_form_contenu_avoir_vente" actionListener="#{managedBonAvoirVente.saveNewArticle()}"/>   
                                                </div>                                                             
                                            </f:facet>       
                                        </h:panelGrid> 
                                        <p:outputPanel id="blog_contenu_avoir_vente">
                                            <h:inputHidden id="input_hide_contenu_avoir_vente" value="#{managedBonAvoirVente.tabIds_article}"/>
                                            <p:dataTable id="data_contenu_avoir_vente" value="#{managedBonAvoirVente.contenus}" var="artf" rowKey="#{artf.id}" 
                                                         rowIndexVar="artfIdx" selection="#{managedBonAvoirVente.selectContenus}">
                                                <p:ajax event="rowSelect" global="false" listener="#{managedBonAvoirVente.loadOnViewContenu}" update=":main_avoir_vente:tabView_fav:form_contenu_avoir_vente"/>
                                                <p:ajax event="rowUnselect" global="false" listener="#{managedBonAvoirVente.unLoadOnViewContenu}" update=":main_avoir_vente:tabView_fav:form_contenu_avoir_vente"/>
                                                <p:column style="width: 7%;color:#{artf.hasMessageError?'red':''}" headerText="N°">
                                                    <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{artf.new_}"/>
                                                    <span title="#{artf.dateSave.toString()}">#{artfIdx+1}</span>
                                                    <h:graphicImage title="#{lab.L_suiviEnStock}" library="img"  name="bookmark.png" width="15" height="15" rendered="#{artf.mouvStock}" style="float: right"/>
                                                    <h:graphicImage title="#{artf.messageError}" library="img" name="comment.png" width="15" height="15" rendered="#{artf.hasMessageError}" style="float: right"/>
                                                </p:column>
                                                <p:column  style="width: 15%;color:#{artf.hasMessageError?'red':''}">
                                                    <span title="#{artf.dateSave.toString()}">#{artf.article.refArt}</span>
                                                </p:column>
                                                <p:column headerText="#{lab.L_article}" style="color:#{artf.hasMessageError?'red':''}">
                                                    <span title="#{artf.dateSave.toString()}">#{artf.article.designation}</span>
                                                </p:column>
                                                <p:column headerText="#{lab.L_qte}" style="text-align: right;width: 10%;color:#{artf.hasMessageError?'red':''}">
                                                    <h:outputText value="#{artf.quantite}" converter="#{managedBonAvoirVente.converterStock}"/>
                                                    <span title="#{artf.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{artf.conditionnement.unite.reference}</span>
                                                </p:column>
                                                <p:column headerText="#{lab.L_prix}" style="text-align: right;width: 12%;color:#{artf.hasMessageError?'red':''}">
                                                    <h:outputText value="#{artf.prix}" converter="#{managedBonAvoirVente.converter}"/>
                                                </p:column>
                                                <p:column headerText="#{lab.L_rem}" style="text-align: right;width: 10%;color:#{artf.hasMessageError?'red':''}">
                                                    <h:outputText value="#{artf.remise}" converter="DNS"/>
                                                </p:column>
                                                <p:column headerText="#{lab.LCF_PBAA_taxes}" style="text-align: right;width: 10%;color:#{artf.hasMessageError?'red':''}">
                                                    <h:outputText value="#{artf.taxe}" converter="DNS"/>
                                                </p:column>
                                                <p:column headerText="#{lab.L_total}" style="text-align: right;width: 14%;color:#{artf.hasMessageError?'red':''}">
                                                    <h:outputText value="#{artf.prixTotal}" converter="#{managedBonAvoirVente.converter}"/>
                                                </p:column>
                                                <p:column style="width: 10px;text-align: center">
                                                    <f:facet name="header">
                                                        <p:contextMenu for="btn_option_contenu_avoir_vente_head" event="left click" style="font-size: 0.8em;width: 200px">
                                                            <p:menuitem value="#{lab.LC_PFV_maitenance}" icon="ui-icon-carat-2-e-w" actionListener="#{managedBonAvoirVente.onCorrectifPrixTotal()}" update="data_contenu_avoir_vente"/>
                                                            <p:menuitem value="Importer" icon="ui-icon-arrowthickstop-1-s" global="false" onclick="dlgUploadImgXLS.show()"/>
                                                            <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedBonAvoirVente.deleteBeanArticles(false)}"/>
                                                        </p:contextMenu>                           
                                                        <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_contenu_avoir_vente_head" type="button"/>
                                                    </f:facet>
                                                    <p:contextMenu for="btn_option_contenu_avoir_vente" event="left click" style="font-size: 0.8em;width: 200px" >
                                                        <p:menuitem value="#{artf.mouvStock?lab.L_desactiver:lab.L_activer} #{lab.LCF_PBAV_le_suivi_stock}" icon="ui-icon-star" global="false" actionListener="#{managedBonAvoirVente.activeMouvStock(artf)}"
                                                                    update="data_contenu_avoir_vente"/>
                                                        <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedBonAvoirVente.deleteBeanArticle_(artf)}" oncomplete="dlgConfirmDeleteArticle_.show()"/>
                                                    </p:contextMenu>                           
                                                    <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_contenu_avoir_vente" type="button"/>
                                                </p:column> 
                                                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>  
                                            </p:dataTable>  
                                            <p:commandButton icon="ui-icon-disk" value="Enregistrer" style="float:right"
                                                             oncomplete="collapseForm('contenu_avoir_vente')" rendered="#{managedBonAvoirVente.displayButtonSaveFromImport}"
                                                             update="tabView_fav:blog_form_contenu_avoir_vente" actionListener="#{managedBonAvoirVente.saveContenusFromImport()}"/>    
                                        </p:outputPanel>
                                    </p:outputPanel>
                                    <div style="clear: both"/>
                                </p:tab>
                                <p:tab title="#{lab.LCF_PBAV_reglements} (#{managedBonAvoirVente.docVente.reglements.size()})">
                                    <p:outputPanel id="form_mensualite_fav">
                                        <h:panelGrid columns="3" style="width: 100%;background: white;border: 2px solid #045491!important; border-radius: 5px" cellpadding="0" cellspacing="0" rendered="#{accesRessource.fv_create_reglement}"> 
                                            <h:panelGrid id="blog_form_mensualite_fav" columns="7" cellpadding="0" cellspacing="0" style="padding-top: 3px;padding-bottom: -5px">
                                                <h:outputText value="#{lab.LCF_PBAV_mode_reglement}" />
                                                <h:outputText value="#{lab.L_montant}" />
                                                <h:outputText value="#{lab.LCF_PBAV_date_paiement}" />
                                                <h:outputText value="#{lab.LCF_PBAV_caisse}" />
                                                <h:outputText value="#{lab.LCF_PBAV_caissier}" />
                                                <h:outputText value="#{lab.L_statut}"  />
                                                <h:outputText value="#{lab.LCF_PBAV_reference_externe}"/>
                                                <h:panelGroup>                                                    
                                                    <h:outputText value="#{managedBonAvoirVente.reglement.id}" rendered="#{managedBonAvoirVente .reglement.id gt 0}"/>
                                                    <h:selectOneMenu value="#{managedBonAvoirVente.reglement.mode.id}" id="select_model_mens_avoir_vente" style="min-width: 120px">
                                                        <f:selectItem itemLabel="--" itemValue="0"/>
                                                        <f:selectItems value="#{managedModeReglement.modes}" var="modelm" itemLabel="#{modelm.designation}" itemValue="#{modelm.id}" />     
                                                    </h:selectOneMenu>  
                                                </h:panelGroup>
                                                <pe:inputNumber value="#{managedBonAvoirVente.reglement.montant}"  style="text-align: right"/>
                                                <p:calendar value="#{managedBonAvoirVente.reglement.datePaiementPrevu}" navigator="true" pattern="dd-MM-yyyy" size="10"/>
                                                <h:selectOneMenu value="#{managedBonAvoirVente.reglement.caisse.id}" valueChangeListener="#{managedBonAvoirVente.chooseCaisses}" style="min-width: 140px">
                                                    <f:selectItem itemLabel="" itemValue="0" />
                                                    <f:selectItems value="#{managedCaisses.caisses}" var="icaiss" itemLabel="#{icaiss.intitule}" itemValue="#{icaiss.id}" />
                                                    <p:ajax event="valueChange"/>
                                                </h:selectOneMenu>
                                                <h:selectOneMenu id="chmp_caissier_reglement_fav" value="#{managedBonAvoirVente.reglement.caissier.id}" style="min-width: 140px" disabled="#{!accesRessource.compta_reg_fv_change_caissier}">
                                                    <f:selectItem itemLabel="" itemValue="0" />
                                                    <f:selectItems value="#{managedBonAvoirVente.caissiers}" var="iCaissier" itemLabel="#{iCaissier.nomUsers}" itemValue="#{iCaissier.id}" />
                                                    <p:ajax event="valueChange"/>
                                                </h:selectOneMenu>
                                                <h:selectOneMenu value="#{managedBonAvoirVente.reglement.statutPiece}" disabled="#{managedBonAvoirVente.reglement.statutPiece != constantes.STATUT_DOC_ATTENTE}">
                                                    <f:selectItem itemValue="#{constantes.STATUT_DOC_PAYER}" itemLabel="#{lab.LC_PFV_regler}" />
                                                    <f:selectItem itemValue="#{constantes.STATUT_DOC_ATTENTE}" itemLabel="#{lab.LC_PFV_en_attente}" />                                                    
                                                    <f:selectItem itemValue="#{constantes.STATUT_DOC_ENCOUR}" itemLabel="#{lab.LC_PFV_en_cours}" itemDisabled="true"/>                                                    
                                                </h:selectOneMenu>
                                                <h:panelGroup>
                                                    <h:inputText value="#{managedBonAvoirVente.reglement.numRefExterne}" />
                                                    <p:commandButton id="save_mensualite_fav" icon="ui-icon-circle-plus" style="width: 22px; height: 22px;float: right" oncomplete="collapseForm('mensualite_fav')"
                                                                     update="form_mensualite_fav" actionListener="#{managedBonAvoirVente.saveNewReglement(false)}"/>
                                                </h:panelGroup> 
                                            </h:panelGrid>                                            
                                        </h:panelGrid>    
                                        <h:inputHidden id="input_hide_mensualite_fav" value="#{managedBonAvoirVente.tabIds_mensualite}"/>
                                        <p:dataTable id="data_mensualite_fav" value="#{managedBonAvoirVente.docVente.reglements}" var="men" rowKey="#{men.id}" 
                                                     rowIndexVar="menIdx" selectionMode="single" selection="#{managedReglementVente.selectedPiece}">
                                            <p:ajax event="rowSelect" global="false" listener="#{managedBonAvoirVente.loadOnViewMensualite}" oncomplete="collapseForm('mensualite_fav')"
                                                    update=":main_avoir_vente:tabView_fav:blog_form_mensualite_fav :main_avoir_vente:tabView_fav:zone_auteur_reg_fav"/>
                                            <p:ajax event="rowUnselect" global="false" listener="#{managedBonAvoirVente.unLoadOnViewMensualite}" oncomplete="collapseForm('mensualite_fav')"
                                                    update=":main_avoir_vente:tabView_fav:blog_form_mensualite_fav :main_avoir_vente:tabView_fav:zone_auteur_reg_fav"/>
                                            <p:column headerText="N°" width="20" style="text-align: center" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <f:facet name="header">
                                                    <p:contextMenu for="chp_view_id_pcr_fav" event="left click" styleClass="context_menu">
                                                        <p:menuitem update="data_mensualite_fav" global="false" value="#{lab.LC_PCV_voir_identifiant}" actionListener="#{men.setView_id(!men.view_id)}"/>
                                                    </p:contextMenu>
                                                    <h:outputText value="N°" id="chp_view_id_pcr_fav" style="cursor: pointer"/>
                                                </f:facet>
                                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{men.new_}"/>
                                                <h:outputText value="#{menIdx+1}" rendered="#{!men.view_id}"/>
                                                <h:outputText value="#{men.id}" rendered="#{men.view_id}"/>
                                                <h:panelGroup style="float: right">
                                                    <h:outputText title="#{lab.LC_PFV_comptabilise}" value="C" rendered="#{managedReglementVente.isComptabilise(men)}" styleClass="style_statut"/>
                                                </h:panelGroup>
                                            </p:column>
                                            <p:column headerText="#{lab.LCF_PBAV_mode_reglement}" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <h:outputText value="#{men.model.designation}"/>
                                                <span style="display: #{(men.statutPiece==constantes.STATUT_DOC_ATTENTE)?'inline-block':'none'}; width: 10px; height: 10px; background: #444;" title="#{lab.LC_PFA_en_attente_paiment}"></span>
                                                <span style="display: #{(men.statutPiece==constantes.STATUT_DOC_ENCOUR)?'inline-block':'none'}; width: 10px; height: 10px; background: #f6a828" title="#{lab.LC_PFA_en_cours_paiment}"></span>
                                                <span style="display: #{(men.statutPiece==constantes.STATUT_DOC_PAYER)?'inline-block':'none'}; width: 10px; height: 10px; background: #006666" title="#{lab.LC_PFA_piece_regler}"></span>
                                                <span style="display: #{(men.phasesReglement.size() gt 0)?'inline-block':'none'}; width: 10px; height: 10px; background: #99ccff" title="#{lab.LC_PFA_phase_reglement_generer}"></span>
                                                <h:graphicImage title="#{lab.LC_PCV_text16}" library="icones" name="alert.png" width="15" height="15" rendered="#{men.error()}" style="float: right"/>  
                                            </p:column>
                                            <p:column headerText="#{lab.LCF_PBAV_piece_numero}" sortBy="#{men.datePiece}" style="text-align: center" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <h:outputText value="#{men.numeroPiece}"/>
                                                <h:outputText rendered="#{men.notifs.id gt 0}" value="A" styleClass="statut" title="#{lab.LC_PFA_paiement_lier_acompte} #{men.notifs.acompte.numRefrence}" style="float: right"/>
                                            </p:column>
                                            <p:column headerText="#{lab.LCF_PBAV_date_edition}" sortBy="#{men.datePiece}" style="text-align: center" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <h:outputText value="#{men.datePiece}" converter="DDMMYYYY"/>
                                            </p:column>
                                            <p:column headerText="#{lab.LC_PFA_date_reglement}" sortBy="#{men.datePaimentPrevu}" style="text-align: center" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <h:outputText value="#{(men.statutPiece eq constantes.STATUT_DOC_PAYER)?men.datePaiement:men.datePaimentPrevu}" converter="DATE"/>
                                            </p:column>
                                            <p:column headerText="#{lab.LCF_PBAV_caisses}" style="width: 17%;text-align: right" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <h:outputText value="#{men.caisse.intitule}" />
                                            </p:column>
                                            <p:column headerText="#{lab.L_montant}" style="width: 17%;text-align: right" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <h:outputText value="#{men.montant}" converter="#{managedBonAvoirVente.converter}"/>
                                            </p:column>
                                            <p:column headerText="#{lab.L_reference}" style="width: 17%;text-align: right" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <h:outputText value="#{men.referenceExterne}"/>
                                            </p:column>
                                            <p:column style="width: 5%;text-align: center" styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <p:contextMenu for="btn_option_mensualite_fav" event="left click" style="font-size: 0.8em" styleClass="context_menu">
                                                    <p:menuitem value="#{!men.comptabilise?lab.LC_PFV_comptabiliser:lab.LC_PJV_annuler_comptabilise}" actionListener="#{managedBonAvoirVente.setSelectReglement(men)}" 
                                                                oncomplete="#{!men.comptabilise?'dlgComptabilisePiece.show()':'dlgUnComptabilisePiece.show()'}" icon="ui-icon-arrowthick-2-e-w" 
                                                                rendered="#{men.id gt 0 and (men.statutPiece==constantes.STATUT_DOC_PAYER)}"/> 
                                                    <p:menuitem value="#{(men.statutPiece=='P')?lab.L_annuler:lab.LCF_PRV_encaisser_valider}" icon="#{(men.statutPiece=='P')?'ui-icon-circle-close':'ui-icon-circle-check'}" rendered="#{men.id gt 0 and men.phasesReglement.size() le 0}"  
                                                                actionListener="#{managedBonAvoirVente.openConfirmPaiement(men, 'F', false)}" update=":main_avoir_vente:grp_btn_etat_avoir_vente data_mensualite_fav"/>
                                                    <p:menuitem value="#{lab.L_aller_a}" icon="ui-icon-arrowthick-1-e"  actionListener="#{managedFactureVente.onSelectDistantReglement(men)}"
                                                                rendered="#{accesPage.compta_view_reg_vente and men.model.typeReglement == constantes.MODE_PAIEMENT_BANQUE and men.phasesReglement.size() gt 0}"/>
                                                    <p:menuitem value="#{lab.L_annuler}" icon="ui-icon-circle-close" title="#{lab.LC_PCV_annuler_toutes_phases_cheque}"  actionListener="#{managedReglementVente.openConfirmPaiement(men,'F', false)}"
                                                                rendered="#{men.model.typeReglement == constantes.MODE_PAIEMENT_BANQUE and men.phasesReglement.size() gt 0}"/>
                                                    <p:separator style="width: 98%;margin: auto"/>
                                                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash"  actionListener="#{managedBonAvoirVente.deleteBeanReglement_(men)}" oncomplete="dlgConfirmDeleteMensualite_.show()"/>
                                                </p:contextMenu>                           
                                                <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_mensualite_fav" type="button"/>
                                            </p:column> 
                                            <p:column style="width: 5%;text-align: center"  styleClass="statut_#{managedBonAvoirVente.giveStringStatut(men.statutPiece)}">
                                                <f:facet name="header">
                                                    <h:selectBooleanCheckbox styleClass="chek_all_line_mensualite_fav" value="false"
                                                                             onclick="selectionAllLineTab(#{managedBonAvoirVente.docVente.reglements.size()}, 'mensualite_fav')">
                                                    </h:selectBooleanCheckbox>
                                                </f:facet>
                                                <h:selectBooleanCheckbox value="#{men.selectActif}" styleClass="chek_line_mensualite_fav" 
                                                                         onclick="selectionLineTab(#{men.id}, 'mensualite_fav')">
                                                </h:selectBooleanCheckbox>
                                            </p:column>
                                        </p:dataTable>
                                        <br/>
                                        <p:commandLink actionListener="#{managedFactureVente.saveNewAllMensualite()}" update="form_mensualite_fav" oncomplete="collapseForm('mensualite_fav')" 
                                                       style="background: black;color: white;border: 2px solid #666; border-radius: 5px;margin-top: -15px;padding: 3px"
                                                       rendered="#{managedFactureVente.newMensualite and managedFactureVente.docVente.reglements.size() >0}" value="#{lab.LC_PFA_taut_enregistrer}"/>
                                    </p:outputPanel>
                                    <div style="clear: both"/>
                                    <div style="margin-bottom: -20px; font-size: 0.7em" align="right">
                                        <h:panelGroup  id="zone_auteur_reg_fav">
                                            <span>#{lab.L_par} </span>
                                            <h:outputText value="#{managedReglementVente.selectedPiece.author.users.nomUsers}" />
                                            <span>#{lab.L_le} </span>
                                            <h:outputText value="#{managedReglementVente.selectedPiece.dateUpdate}" converter="DATETIME" />
                                        </h:panelGroup>
                                    </div>
                                    <div style="clear: both"/>
                                </p:tab>
                            </p:tabView>
                        </h:panelGrid>
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_avoir_vente" style="width: 99%; margin: auto; background: white">
                    <div class="part_list">
                        <h:inputHidden id="input_hide_avoir_vente" value="#{managedBonAvoirVente.tabIds}"/>
                        <p:dataTable id="data_avoir_vente" value="#{managedBonAvoirVente.documents}" var="bon" rowKey="#{bon.id}"
                                     selectionMode="single" rowIndexVar="bonIdx" selection="#{managedBonAvoirVente.selectDoc}">
                            <p:ajax event="rowSelect" listener="#{managedBonAvoirVente.loadOnView}" oncomplete="collapseForm('avoir_vente');collapseForm('contenu_avoir_vente')"
                                    update=":main_avoir_vente:input_hide_avoir_vente"
                                    />
                            <p:column headerText="N°" width="30" styleClass="statut_#{bon.statut}">
                                <h:graphicImage title="#{lab.L_cloturer}" library="img" name="blocked.png" width="15" height="15" rendered="#{bon.cloturer}"/>  
                                <span>#{bonIdx+1}</span>
                                <h:outputText value="!" rendered="#{bon.tiers!=null?bon.tiers.id lt 1:true}" title="#{lab.LCF_PBAV_facture_sans_tiers}" style="float: right; color: red;font-weight: bold"/>
                                <h:panelGroup style="float: right">
                                    <h:outputText title="#{lab.LCF_PMC_comptabiliser}" value="C" rendered="#{managedBonAvoirVente.isComptabilise(bon)}" styleClass="style_statut"/>
                                </h:panelGroup>
                            </p:column>
                            <p:column headerText="#{lab.L_reference}" styleClass="statut_#{bon.statut}">
                                <span>#{bon.numDoc}</span>
                                <h:outputText value="#{lab.LC_PFA_vide}" style="float: right;color: blue;font-style: italic;font-size: 0.8em" rendered="#{0>=bon.contenus.size()}"/>
                                <h:panelGroup style="float: right">
                                    <h:outputText title="#{lab.LC_PFA_facture_regler}" value="L" rendered="#{bon.statutRegle == constantes.ETAT_REGLE}"
                                                  style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                </h:panelGroup>
                            </p:column>
                            <p:column headerText="#{lab.LCF_PBAV_clients}" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.client.nom_prenom}"/>
                            </p:column>
                            <p:column headerText="#{lab.L_point_vente}" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.enteteDoc.creneau.creneauPoint.point.libelle}"/>
                            </p:column>
                            <p:column headerText="#{lab.LCF_PBAV_date_doc}" style="text-align: center;width: 10%" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.enteteDoc.dateEntete}" converter="DDMMYYYY"/>
                            </p:column>
                            <p:column headerText="#{lab.LCF_PBAV_facture}" styleClass="statut_#{bon.statut}">
                                <span>#{bon.documentLie.numDoc}</span>
                                <p:spacer width="10px" style="float: right;margin-top: 2px" styleClass="#{bon.documentLie.statutRegle}" title="STATUT : #{managedBonAvoirVente.giveNameStatut(bon.documentLie.statutRegle)}"/>
                            </p:column>
                            <p:column headerText="#{lab.LCF_PBAV_auteur}" styleClass="statut_#{bon.statut}">
                                <h:outputText value="#{bon.author.users.nomUsers}" rendered="#{bon.statut!=constantes.STATUT_DOC_VALIDE}"/>
                                <h:outputText value="#{bon.validerBy.nomUsers}"  rendered="#{bon.statut==constantes.STATUT_DOC_VALIDE}"/>
                            </p:column>
                            <p:column width="20" style="text-align: center" styleClass="statut_#{bon.statut}">
                                <p:contextMenu for="btn_option_avoir_vente" event="left click" style="font-size: 0.8em">
                                    <p:menuitem icon="ui-icon-document" value="#{lab.LC_PRA_voir_facture}" actionListener="#{managedBonAvoirVente.setSelectDoc(bon)}" global="false" update=":data_contenus_fv_fav" oncomplete="dlgContenuFVFAV.show()" rendered="#{bon.documentLie.id > 0}"/>
                                    <p:menuitem value="#{bon.cloturer?lab.LCF_PBAA_deverrouiller:lab.LCF_PBAA_verrouiller}" icon="#{bon.cloturer?'ui-icon-unlocked':'ui-icon-locked'}" 
                                                global="false" actionListener="#{managedBonAvoirVente.cloturer(bon)}" oncomplete="dlgConfirmClose.show()"/>
                                    <p:menuitem icon="ui-icon-person" value="#{lab.LC_PFV_maj_tier}" actionListener="#{managedFactureVente.definedTiers(bon, true)}" title="#{lab.LC_PFV_maj_tiers}"/>
                                    <p:separator />
                                    <p:menuitem value="#{lab.L_telecharger}" icon="ui-icon-print"  actionListener="#{managedBonAvoirVente.print(bon, true)}" ajax="false"/>
                                    <p:menuitem value="#{lab.L_telecharger_sans_entete}" icon="ui-icon-print"  actionListener="#{managedBonAvoirVente.print(bon, false)}" ajax="false"/>
                                    <p:separator />
                                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedBonAvoirVente.deleteBean_(bon)}" oncomplete="dlgConfirmDelete_.show()"/>
                                </p:contextMenu>                           
                                <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_avoir_vente" type="button"/>
                            </p:column> 
                            <p:column width="25" style="text-align: center" styleClass="statut_#{bon.statut}">
                                <f:facet name="header">
                                    <h:selectBooleanCheckbox styleClass="chek_all_line_avoir_vente" value="false"
                                                             onclick="selectionAllLineTab(#{managedBonAvoirVente.documents.size()}, 'avoir_vente')">
                                    </h:selectBooleanCheckbox>
                                </f:facet>
                                <h:selectBooleanCheckbox  value="#{bon.selectActif }" styleClass="chek_line_avoir_vente" 
                                                          onclick="selectionLineTab(#{bonIdx}, 'avoir_vente')">
                                </h:selectBooleanCheckbox>
                            </p:column>
                        </p:dataTable>                               
                        <span class="nbSelectavoir_vente" style="font-size: .8em; font-style: italic; color: #828c95;"></span>
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                            <p:commandButton actionListener="#{managedBonAvoirVente.init(false)}" global="false" update="data_avoir_vente" icon="ui-icon-circle-triangle-w" disabled="#{managedBonAvoirVente.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedBonAvoirVente.paginator.currentPage}/#{managedBonAvoirVente.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton actionListener="#{managedBonAvoirVente.init(true)}" global="false" update="data_avoir_vente" icon="ui-icon-circle-triangle-e" disabled="#{managedBonAvoirVente.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedBonAvoirVente.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedBonAvoirVente.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                                <f:selectItems value="#{managedBonAvoirVente.paginations}"/>
                                <p:ajax event="valueChange" global="false" update="data_avoir_vente"/>
                            </p:selectOneMenu>
                        </p:outputPanel>  
                    </div>                                                         
                </div> 
                <!-->
                 *****************************************************************************
                 Vue Grid
                 *****************************************************************************
                <-->
                <div class="yvs_grid_avoir_vente" style="width: 99%; margin: auto; background: white">

                </div>
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>  
            <div class="zone_find">
                <div class="yvs_form_avoir_vente display_auteur" align="right"  style="font-style: italic;">
                    <p:outputPanel autoUpdate="true">
                        <span style="float: left">#{lab.L_enregistrer_le} <h:outputText value="#{managedBonAvoirVente.selectDoc.dateSave}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span>
                        <span>#{lab.L_modifier_le} <h:outputText value="#{managedBonAvoirVente.selectDoc.dateUpdate}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span>
                        <span>#{lab.L_par} <h:outputText value="#{managedBonAvoirVente.selectDoc.author.users.nomUsers}" styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <h:panelGrid columns="2" style="width: 100%; font-size: 0.8em" cellpadding="0" cellspacing="0">
                    <h:panelGrid columns="6" style="float: left; font-size: 1.0em" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.L_date}" />
                        <h:outputText value="#{lab.LCF_PBAV_livreur}" />
                        <h:outputText value="#{lab.L_statut}" />
                        <h:outputText value="#{lab.L_reference}" />
                        <h:outputText value="" />
                        <span>&nbsp;</span>
                        <h:panelGrid columns="2">
                            <h:selectBooleanCheckbox value="#{managedBonAvoirVente.date_}" valueChangeListener="#{managedBonAvoirVente.choixParamDate}">
                                <p:ajax event="valueChange" oncomplete="collapseList('avoir_vente')"
                                        update="blog_date_search_entete_avoir_vente"/>
                            </h:selectBooleanCheckbox>
                            <h:panelGroup id="blog_date_search_entete_avoir_vente">
                                <p:calendar value="#{managedBonAvoirVente.dateDebut}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedBonAvoirVente.date_}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect" listener="#{managedBonAvoirVente.addParamDate}" oncomplete="collapseList('avoir_vente')"/>
                                </p:calendar>
                                <p:spacer width="5px" style="background: black"/>
                                <p:calendar value="#{managedBonAvoirVente.dateFin}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedBonAvoirVente.date_}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect" listener="#{managedBonAvoirVente.addParamDate}" oncomplete="collapseList('avoir_vente')"/>
                                </p:calendar>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:inputText value="#{managedBonAvoirVente.codeLivreur_}" style="min-width: 120px">
                            <p:ajax event="keyup" listener="#{managedBonAvoirVente.addParamLivreur(managedBonAvoirVente.codeLivreur_)}" oncomplete="collapseList('avoir_vente')"/>
                        </h:inputText>
                        <h:selectOneMenu value="#{managedBonAvoirVente.statut_}" 
                                         valueChangeListener="#{managedBonAvoirVente.chooseStatut}" style="min-width: 120px">
                            <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                            <f:selectItem itemLabel="#{managedBonAvoirVente.giveNameStatut(constantes.ETAT_VALIDE)}" itemValue="#{constantes.ETAT_VALIDE}"/>
                            <f:selectItem itemLabel="#{managedBonAvoirVente.giveNameStatut(constantes.ETAT_EDITABLE)}" itemValue="#{constantes.ETAT_EDITABLE}"/>
                            <f:selectItem itemLabel="#{managedBonAvoirVente.giveNameStatut(constantes.ETAT_ANNULE)}" itemValue="#{constantes.ETAT_ANNULE}"/>
                            <p:ajax event="valueChange" update=":main_avoir_vente:data_avoir_vente" oncomplete="collapseList('avoir_vente')"/>
                        </h:selectOneMenu>
                        <h:inputText value="#{managedBonAvoirVente.numSearch_}">
                            <p:ajax event="valueChange" listener="#{managedBonAvoirVente.searchByNum()}" oncomplete="collapseList('avoir_vente')"/>
                        </h:inputText>
                        <p:commandLink style="border: 2px solid black; border-radius: 5px;padding: 2px;font-size: 0.8em" 
                                       onclick="dlgPlusOption.show()" global="false" value="Plus Option"/>
                    </h:panelGrid>
                    <h:panelGroup style="float: right">
                        <p:commandLink onclick="dlgCleanVente.show()" global="false" style="border: 2px solid black; border-radius: 5px;padding: 3px;" 
                                       title="#{lab.LCF_PBAA_nettoyage_stock}">
                            <h:graphicImage library="img" name="clean.png" width="15" height="18"/>  
                        </p:commandLink>
                    </h:panelGroup>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>