<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Proforma Vente','modGescom', 'smenProformaVente', true,managedProformaVente)}
    </ui:define> 
    <ui:define name="contents"> 
        #{Marticle.doNothing()}
        #{managedClient.doNothing()} 

        #{managedProformaVente.loadAll()}   
        <script type="text/javascript">
            $(function() {
                collapseForm('proforma_vente');
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
            });
        </script>
        <!-->
        *************************************BeanCaisse****************************************
        Boite de dialogue des articles
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.LC_PPV_liste_articles}" widgetVar="dlgListArticle" modal="true" width="50%"  closeOnEscape="true"> 
                <h:panelGrid columns="2" style="width: 100%;margin-bottom: -5px;margin-top: -5px" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <p:outputPanel style="float: left;margin-left: -10px">
                        <h:inputText value="#{Marticle.numSearch}">
                            <p:ajax event="valueChange" listener="#{Marticle.addParamReference()}" update="data-articles_proforma_vente_contenu"/>
                        </h:inputText>
                    </p:outputPanel>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{Marticle.loadActifArticle(false,false)}" global="false" update="data-articles_proforma_vente_contenu" icon="ui-icon-circle-triangle-w" disabled="#{Marticle.pa.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{Marticle.pa.currentPage}/#{Marticle.pa.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{Marticle.loadActifArticle(true,false)}" global="false" update="data-articles_proforma_vente_contenu" icon="ui-icon-circle-triangle-e" disabled="#{Marticle.pa.disNext}"/>
                        <p:selectOneMenu value="#{Marticle.pa.rows}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{Marticle._choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{Marticle.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data-articles_proforma_vente_contenu"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </h:panelGrid>
                <p:dataTable id="data-articles_proforma_vente_contenu" value="#{Marticle.articlesResult}" var="art" rowKey="#{art.id}" selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedProformaVente.loadOnViewArticle}" oncomplete="dlgListArticle.hide()"/>
                    <p:column filterBy="#{art.refArt}" style="width: 2%">
                        <span title="#{art.designation}">#{art.refArt}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_designation}" style="width: 6%">
                        <span title="#{art.designation}">#{art.designation}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_categorie}" style="width: 4%">
                        <span title="#{art.designation}">#{art.categorie}</span>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedProformaVente.deleteBean()}" oncomplete="dlgConfirmDelete.hide();"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteAll" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedProformaVente.deleteAll()}" oncomplete="dlgConfirmDeleteAll.hide();"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeleteAll.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteContenu" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedProformaVente.deleteContenu()}" oncomplete="dlgConfirmDeleteContenu.hide();"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeleteContenu.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_proforma_vente">    
            <div class="part_fix">
                <div style="float: left">    
                    <p:splitButton value="#{lab.L_enregistrer}" id="save_proforma_vente" actionListener="#{managedProformaVente.saveNew()}" icon="ui-icon-disk">
                        <p:menuitem value="#{lab.L_nouveau}" id="cancel_proforma_vente" actionListener="#{managedProformaVente.resetFiche()}" oncomplete="collapseForm('proforma_vente')"
                                    icon="ui-icon-document"/>
                        <p:separator />
                        <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" onclick="dlgConfirmDelete.show()"  global="false"/>
                    </p:splitButton>
                    <p:splitButton value="#{lab.L_supprimer}" id="delete_proforma_vente" icon="ui-icon-trash" onclick="dlgConfirmDeleteAll.show()"  global="false" style="font-size: 0.8em">

                    </p:splitButton>
                </div>
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedProformaVente.parcoursInAllResult(false)}" update="txt_parc_linear_proforma_vente" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('proforma_vente')"/>
                    <h:inputText value="#{managedProformaVente.offset}" style="width: 35px; text-align: center;"  title="Aller au N°..." id="txt_parc_linear_proforma_vente"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedProformaVente.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedProformaVente.parcoursInAllResult(true)}" update="txt_parc_linear_proforma_vente" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('proforma_vente')"/>
                </h:panelGroup> 
                <div style="float: right">     
                    <h:link title="Vue Formulaire" onclick="collapseForm('proforma_vente');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link title="Vue Liste" onclick="collapseList('proforma_vente');
                            return false" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>   
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_proforma_vente" style="width: 99%; margin: auto">
                    <p:outputPanel id="blog_form_proforma_vente">
                        <h:panelGrid columns="1" style="width: 100%"> 
                            <p:outputPanel id="form_entete_proforma_vente">
                                <h:panelGrid columns="2" styleClass="yvs_nostyle" style="width: 100%;margin-bottom: -5px;margin-top: -5px" cellpadding="0" cellspacing="0" rendered="#{managedProformaVente.proforma.id gt 0}">
                                    <h:panelGrid columns="2" styleClass="yvs_nostyle" style="float: left;font-size: large;background: black;color: white">                                            
                                        <span style="font-size: initial">#{lab.L_numero} : </span>
                                        <h:outputText id="txt_reference_document_proforma_vente" value="#{managedProformaVente.proforma.numero}"/>
                                    </h:panelGrid>   
                                    <h:panelGroup style="float: right">                                               
                                        <p:outputPanel id="etapes_valide_proforma_vente" styleClass="yvs_form_of">                                             
                                            <h:panelGroup style="float: right">
                                                <p:commandLink value="#{(managedProformaVente.proforma.statut == constantes.ETAT_EDITABLE)?'EN EDITION':'EDITABLE'}" process="@this" 
                                                               disabled="#{(managedProformaVente.proforma.statut == constantes.ETAT_EDITABLE)}" styleClass="#{(managedProformaVente.proforma.statut == constantes.ETAT_EDITABLE)?'statut_valide':'etat_formation_true'}"
                                                               actionListener="#{managedProformaVente.changeStatut(constantes.ETAT_EDITABLE)}" update="etapes_valide_proforma_vente"/>
                                                <p:commandLink value="#{(managedProformaVente.proforma.statut == constantes.ETAT_VALIDE)?'VALIDE':'VALIDER'}" process="@this"  
                                                               disabled="#{(managedProformaVente.proforma.statut == constantes.ETAT_VALIDE)}" styleClass="#{(managedProformaVente.proforma.statut == constantes.ETAT_VALIDE)?'statut_valide':'etat_formation_true'}"                                                           
                                                               actionListener="#{managedProformaVente.changeStatut(constantes.ETAT_VALIDE)}" update="etapes_valide_proforma_vente"/>
                                                <p:commandLink value="ANNULER" process="@this" 
                                                               disabled="#{(managedProformaVente.proforma.statut == constantes.ETAT_ANNULE)}" styleClass="#{(managedProformaVente.proforma.statut == constantes.ETAT_ANNULE)?'statut_valide':'etat_formation_true'}"
                                                               actionListener="#{managedProformaVente.changeStatut(constantes.ETAT_ANNULE)}" update="etapes_valide_proforma_vente"/>
                                            </h:panelGroup>
                                        </p:outputPanel>                                                 
                                    </h:panelGroup>                                     
                                </h:panelGrid> 
                            </p:outputPanel>
                            <p:outputPanel style="width: 100%" id="form_proforma_vente">
                                <div style="width: 61%;float: left">
                                    <h:panelGrid id="infos_facture_vente" columns="2" styleClass="yvs_table" style="width: 100%" cellpadding="0" cellspacing="0">
                                        <f:facet name="header">
                                            <div align="left">
                                                <h:panelGroup>
                                                    <h:panelGroup style="float: right;margin-right: 10px">
                                                        <h:panelGroup style="float: right; background: #FFF; color: #000; border: 1px solid #045491; padding: 3px; margin-right: -9px">
                                                            #{managedProformaVente.proforma.id}
                                                        </h:panelGroup>
                                                        <p:commandButton icon="ui-icon-gear" style="width: 25px; height: 25px" type="button" id="btn_print_opt" />
                                                        <p:contextMenu for="btn_print_opt" event="left click" style="width:220px">
                                                            <p:menuitem icon="ui-icon-print" value="#{lab.L_telecharger}" global="false" actionListener="#{managedProformaVente.print(managedProformaVente.entity)}" ajax="false" title="#{lab.LC_PFV_telecharger_facture}"/>                   
                                                            <p:separator/>
                                                            <p:menuitem icon="ui-icon-trash" value="#{lab.L_supprimer}" global="false" onclick="dlgConfirmDelete.show()"/>
                                                        </p:contextMenu>
                                                    </h:panelGroup>
                                                </h:panelGroup>
                                            </div>
                                        </f:facet>
                                        <span>Date </span> 
                                        <p:calendar value="#{managedProformaVente.proforma.dateDoc}" navigator="true" pattern="dd-MM-yyyy" size="10"/>
                                        <span>#{lab.LC_PFV_client} </span>  
                                        <h:inputText value="#{managedProformaVente.proforma.client}" style="width: 100%"/>  
                                        <span>Expire le </span> 
                                        <p:calendar value="#{managedProformaVente.proforma.dateExpiration}" navigator="true" pattern="dd-MM-yyyy" size="10"/>
                                        <span>#{lab.LC_PFV_telephone} : </span>
                                        <h:inputText value="#{managedProformaVente.proforma.telephone}" style="text-align: center"/>
                                        <span>Adresse : </span>
                                        <h:inputText value="#{managedProformaVente.proforma.adresse}" style="width: 100%"/>
                                        <f:facet name="footer">
                                            <span>Description</span>
                                            <h:inputTextarea value="#{managedProformaVente.proforma.description}" style="width: 100%" rows="2"/>
                                        </f:facet>
                                    </h:panelGrid>
                                </div>
                                <div style="margin-left: 62%;border-bottom: 1px solid #bbb; background: #FFF;">
                                    <p:outputPanel id="desc_artcile_proforma_vente" layout="block" style="margin: auto; background: white;padding-bottom: 15px">
                                        <h1 style="padding-left: 10px">Détails du produit</h1>
                                        <div style="float: left; width: 59%; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;
                                             border-bottom: 2px solid #bbb; padding-left: 10px; padding-bottom: 10px; padding-top: 5px">
                                            <span style="font-weight: bold;color: #000">
                                                #{managedProformaVente.contenu.conditionnement.article.designation}
                                            </span>
                                            <p:outputPanel rendered="#{accesRessource.base_view_article_pua}" layout="block" style="padding-top: 5px; padding-bottom: 5px">
                                                <h:outputText value="Prix d'achat = " />
                                                <h:outputText value="#{managedProformaVente.contenu.conditionnement.prixAchat}" converter="#{managedProformaVente.converter}" style="font-weight: bold;color: #000"/>
                                                <span style="font-size: 0.8em">#{managedProformaVente.currentScte.devise}</span>
                                            </p:outputPanel>
                                            <p:outputPanel rendered="#{accesRessource.base_view_article_puv}" layout="block" style="padding-top: 5px; padding-bottom: 5px">
                                                <h:outputText value="Prix de vente = " />
                                                <h:outputText value="#{managedProformaVente.contenu.conditionnement.prix}" converter="#{managedProformaVente.converter}" style="font-weight: bold;color: #000"/>
                                                <span style="font-size: 0.8em">#{managedProformaVente.currentScte.devise}</span>
                                            </p:outputPanel>
                                            <p:outputPanel rendered="#{accesRessource.base_view_article_pr}" layout="block" style="padding-top: 5px; padding-bottom: 5px">
                                                <h:outputText value="#{lab.LC_PFA_cout_unitaire_stock} = " />
                                                <h:outputText value="#{managedProformaVente.contenu.conditionnement.article.pr}" converter="#{managedProformaVente.converter}"  style="font-weight: bold;color: #000"/>
                                                <span style="font-size: 0.8em">#{managedProformaVente.currentScte.devise}</span>
                                            </p:outputPanel>
                                            <p:outputPanel layout="block" style="padding-top: 5px; padding-bottom: 5px">
                                                <h:outputText value="#{managedProformaVente.contenu.conditionnement.article.stock}" converter="#{managedProformaVente.converterStock}" style="font-weight: bold;color: #000"/>
                                                <h:outputText value=" #{managedProformaVente.contenu.conditionnement.unite.reference} #{lab.LC_PFV_en_stock}"/>
                                            </p:outputPanel>
                                        </div>
                                        <div style="margin-left: 61%;" align="center">
                                            <h:graphicImage id="img_article" style="max-width: 100%;max-height: 140px" value="data:image/#{Marticle.photoArticle(managedProformaVente.contenu.conditionnement.article)[1]};base64,#{Marticle.photoArticle(managedProformaVente.contenu.conditionnement.article)[0]}"/>
                                        </div>                                        
                                    </p:outputPanel>
                                    <p:outputPanel id="chp_fv_net_a_payer" layout="block" style="background: #FFF;padding-top:5px;margin-bottom: 22px">
                                        <div style="width: 90%;float: left">      
                                            <h:panelGrid columns="3" style="font-size: 0.8em;width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                                                <span style="float: left">TOTAL :</span>
                                                <h:panelGroup  >
                                                    <h:outputText value="#{managedProformaVente.proforma.montantTotal}" converter="#{managedProformaVente.converter}" style="color: dodgerblue;font-weight: bold"/>       
                                                    <span style="font-size: 0.8em">#{managedProformaVente.currentScte.devise}</span>
                                                </h:panelGroup>  
                                            </h:panelGrid>  
                                        </div>
                                        <div style="margin-left: 91%;width:9%">                                            
                                            
                                        </div>
                                    </p:outputPanel>
                                </div>
                            </p:outputPanel>
                            <p:tabView id="tabview-proforma_vente_contenu">
                                <p:tab title="Contenus">
                                    <p:outputPanel id="blog_form_proforma_vente_contenu">
                                        <h:panelGrid id="form-proforma_vente_contenu" columns="1" style="width: 100%;background: white;border: 2px solid #045491!important; border-radius: 5px; font-size: 0.9em" cellpadding="0" cellspacing="0">                                            
                                            <h:panelGrid styleClass="yvs_nostyle" style="font-size: 0.9em" cellpadding="0" cellspacing="0" columns="6" >  
                                                <h:outputText value="#{lab.L_article}"/>
                                                <h:outputText value="#{lab.L_conditionnement}"/>
                                                <h:outputText value="#{lab.L_quantite}" />
                                                <h:outputText value="#{lab.L_prix}"/>
                                                <h:outputText value="#{lab.L_total}"/>
                                                <h:outputText value=""/>
                                                <h:panelGroup id="blog_article_facture_vente">
                                                    <h:inputText id="txt_article_facture_vente" value="#{managedProformaVente.contenu.conditionnement.article.refArt}" style="color: #{managedProformaVente.contenu.conditionnement.article.error?'red':''};width: 80%" disabled="#{managedProformaVente.contenu.id gt 0}" tabindex="10">
                                                        <p:ajax event="valueChange" listener="#{managedProformaVente.searchArticle()}"/>
                                                    </h:inputText>    
                                                    <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px;background: white;margin-top: 5px" title="Liste Articles" global="false"
                                                                     onclick="dlgListArticle.show()" disabled="#{managedProformaVente.contenu.id gt 0}"/>
                                                </h:panelGroup> 
                                                <h:selectOneMenu value="#{managedProformaVente.contenu.conditionnement.id}" style="min-width: 120px" title="#{lab.LDB_PA_selectionner_conditionnement}" tabindex="15">
                                                    <f:selectItem itemLabel="--" itemValue="0"/>
                                                    <f:selectItems value="#{managedProformaVente.contenu.conditionnement.article.conditionnements}" var="un" 
                                                                   itemLabel="#{un.unite.reference}" itemValue="#{un.id}"/>
                                                    <p:ajax event="valueChange" listener="#{managedProformaVente.chooseConditionnement()}" update="txt_prix_proforma_vente_contenu txt_prix_total_proforma_vente_contenu"/>
                                                </h:selectOneMenu>
                                                <h:inputText value="#{managedProformaVente.contenu.quantite}" style="max-width: 100px;text-align: right" tabindex="20">
                                                    <p:ajax event="valueChange" update="txt_prix_proforma_vente_contenu txt_prix_total_proforma_vente_contenu"/>
                                                </h:inputText>
                                                <h:panelGroup id="txt_prix_proforma_vente_contenu"> 
                                                    <h:inputText value="#{managedProformaVente.contenu.prix}" style="max-width: 120px;text-align: right" tabindex="30">
                                                        <p:ajax event="valueChange" update="txt_prix_total_proforma_vente_contenu"/>
                                                    </h:inputText>
                                                    <span> #{managedProformaVente.currentScte.devise}</span>
                                                </h:panelGroup>                                         
                                                <h:panelGroup id="txt_prix_total_proforma_vente_contenu">
                                                    <h:inputText value="#{managedProformaVente.contenu.prix * managedProformaVente.contenu.quantite}" style="text-align: right" readonly="true" converter="#{managedProformaVente.converter}"/>
                                                    <span> #{managedProformaVente.currentScte.devise}</span>
                                                </h:panelGroup>
                                                <p:commandButton id="save_proforma_vente_contenu" value="Ajouter" icon="ui-icon-circle-plus" tabindex="40"
                                                                 actionListener="#{managedProformaVente.saveNewContenu()}"/>
                                            </h:panelGrid>                                        
                                        </h:panelGrid> 
                                        <p:dataTable id="data-proforma_vente_contenu" value="#{managedProformaVente.proforma.contenus}" var="artf" rowKey="#{artf.id}" 
                                                     rowIndexVar="artfIdx" selectionMode="single" style="font-size: 0.9em">
                                            <p:ajax event="rowSelect" listener="#{managedProformaVente.loadOnViewContenu}"/>
                                            <p:ajax event="rowUnselect" listener="#{managedProformaVente.unLoadOnViewContenu}"/>
                                            <p:column headerText="Id" style="width: 5%">
                                                <span title="#{artf.id}">#{artf.id}</span>
                                            </p:column>
                                            <p:column headerText="N°" style="width: 5%">
                                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{artf.new_}"/>
                                                <span title="#{managedProformaVente.ldf.format(artf.dateSave)}">#{artfIdx+1}</span>
                                            </p:column>
                                            <p:column style="width: 12%">
                                                <span title="#{managedProformaVente.ldf.format(artf.dateSave)}">#{artf.conditionnement.article.refArt}</span>
                                            </p:column>
                                            <p:column headerText="#{lab.L_article}">
                                                <span title="#{managedProformaVente.ldf.format(artf.dateSave)}">#{artf.conditionnement.article.designation}</span>
                                            </p:column>
                                            <p:column headerText="#{lab.L_quantite}" style="text-align: right;width: 10%">
                                                <h:outputText value="#{artf.quantite}" converter="#{managedProformaVente.converterStock}" title="#{managedProformaVente.ldf.format(artf.dateSave)}"/>
                                                <span title="#{artf.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{artf.conditionnement.unite.reference}</span>
                                            </p:column>
                                            <p:column headerText="#{lab.L_prix}" style="text-align: right;width: 10%">
                                                <h:outputText value="#{artf.prix}" converter="#{managedProformaVente.converter}" title="#{managedProformaVente.ldf.format(artf.dateSave)}"/>
                                            </p:column>
                                            <p:column headerText="#{lab.LC_PES_montant_total}" style="text-align: right;width: 12%">
                                                <h:outputText value="#{artf.prix * artf.quantite}" converter="#{managedProformaVente.converter}" title="#{managedProformaVente.ldf.format(artf.dateSave)}"/>
                                            </p:column>
                                            <p:column style="width: 5%;text-align: center">
                                                <p:contextMenu for="btn_option_proforma_vente_contenu" event="left click" style="font-size: 0.8em;width: 200px" styleClass="context_menu">
                                                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedProformaVente.setEntityContenu(artf)}" oncomplete="dlgConfirmDeleteContenu.show()"/>
                                                </p:contextMenu>                           
                                                <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_proforma_vente_contenu" type="button"/>
                                            </p:column> 
                                        </p:dataTable>                                        
                                    </p:outputPanel>
                                </p:tab>
                            </p:tabView>
                        </h:panelGrid>
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_proforma_vente" style="width: 99%; margin: auto; background: white">
                    <p:dataTable id="data-proforma_vente" value="#{managedProformaVente.proformas}" var="bon" rowKey="#{bon.id}" rowIndexVar="bonIdx" selectionMode="single">
                        <p:ajax event="rowSelect" global="false" listener="#{managedProformaVente.loadOnView}" oncomplete="collapseForm('proforma_vente')"
                                update=":main_proforma_vente:blog_form_proforma_vente"/>
                        <p:column width="35" headerText="N°" styleClass="statut_#{bon.statut}">
                            <span>#{bonIdx+1}</span>
                        </p:column>
                        <p:column headerText="Reference" styleClass="statut_#{bon.statut}">
                            <span>#{bon.numero}</span>
                        </p:column>
                        <p:column headerText="Date Doc" style="text-align: center" styleClass="statut_#{bon.statut}">
                            <h:outputText value="#{bon.dateDoc}" converter="DDMMYYYY"/>
                        </p:column>
                        <p:column headerText="Client" styleClass="statut_#{bon.statut}">
                            <span>#{bon.client}</span>
                        </p:column>
                        <p:column headerText="Date Exp." style="text-align: center" styleClass="statut_#{bon.statut}">
                            <h:outputText value="#{bon.dateExpiration}" converter="DDMMYYYY"/>
                        </p:column>
                        <p:column headerText="Adresse" styleClass="statut_#{bon.statut}">
                            <span>#{bon.adresse}</span>
                        </p:column>
                        <p:column headerText="Téléphone" styleClass="statut_#{bon.statut}">
                            <span>#{bon.telephone}</span>
                        </p:column>
                        <p:column style="width: 5%;text-align: center">
                            <p:contextMenu for="btn_option_proforma_vente" event="left click" style="font-size: 0.8em;width: 200px" styleClass="context_menu">                                  
                                <p:menuitem value="#{lab.L_telecharger}" icon="ui-icon-circle-arrow-s" global="false"  actionListener="#{managedProformaVente.print(bon)}" ajax="false"/>                                
                                <p:separator style="width: 100%"/>
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedProformaVente.setEntity(bon)}" oncomplete="dlgConfirmDelete.show()"/>
                            </p:contextMenu>                           
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_proforma_vente" type="button"/>
                        </p:column> 
                    </p:dataTable>   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedProformaVente.loadAll(false, false)}" global="false" update="data-proforma_vente" icon="ui-icon-circle-triangle-w" disabled="#{managedProformaVente.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedProformaVente.paginator.currentPage}/#{managedProformaVente.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedProformaVente.loadAll(true, false)}" global="false" update="data-proforma_vente" icon="ui-icon-circle-triangle-e" disabled="#{managedProformaVente.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedProformaVente.imax}" label="Nombre max Résultat" valueChangeListener="#{managedProformaVente.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedProformaVente.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data-proforma_vente"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </div> 
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="cacher"/>  
            <div class="zone_find">
                <div class="display_auteur" align="right"  style="font-style: italic;">
                    <p:outputPanel autoUpdate="true">
                        <span style="float: left">#{lab.L_enregistrer_le} <h:outputText value="#{managedProformaVente.entity.dateSave}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span> 
                        <span>#{lab.L_modifier_le} <h:outputText value="#{managedProformaVente.entity.dateUpdate}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span>
                        <span>#{lab.L_par} <h:outputText value="#{managedProformaVente.entity.author.users.nomUsers}"  styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <h:panelGrid id="blog_search_proforma_vente" columns="2" style="width: 100%" cellpadding="0" cellspacing="0">
                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                        <h:panelGrid columns="6" style="float: left; font-size: 0.8em" cellpadding="0" cellspacing="0">
                            <h:outputText value="" />
                            <h:panelGroup>
                                <h:selectBooleanCheckbox value="#{managedProformaVente.addDate}">
                                    <p:ajax event="valueChange" listener="#{managedProformaVente.addParamDates()}" oncomplete="collapseList('proforma_vente')"
                                            update="blog_date_search_proforma_vente :main_proforma_vente:data-proforma_vente"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Date" />
                            </h:panelGroup>
                            <h:outputText value="Client"/>
                            <h:outputText value="Statut" />
                            <h:outputText value="Reference" />
                            <h:outputText value="Valide" />
                            <p:commandButton icon="ui-icon-bullet" actionListener="#{managedFactureVente.clearParams()}" title="Reinitialiser les paramètres" style="width: 20px; height: 22px" 
                                             update="blog_search_proforma_vente :main_proforma_vente:data-proforma_vente"/>
                            <h:panelGroup id="blog_date_search_proforma_vente">
                                <p:calendar value="#{managedFactureVente.dateDebut}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedProformaVente.addDate}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect" update=":main_proforma_vente:data-proforma_vente" listener="#{managedProformaVente.addParamDates}" oncomplete="collapseList('proforma_vente')"/>
                                </p:calendar>
                                <p:spacer width="5px" style="background: black"/>
                                <p:calendar value="#{managedFactureVente.dateFin}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedProformaVente.addDate}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect" update=":main_proforma_vente:data-proforma_vente" listener="#{managedProformaVente.addParamDates}" oncomplete="collapseList('proforma_vente')"/>
                                </p:calendar>
                            </h:panelGroup>                    
                            <h:inputText value="#{managedProformaVente.clientSearch}" style="width: 100%">
                                <p:ajax event="valueChange" listener="#{managedProformaVente.addParamClient()}" oncomplete="collapseList('proforma_vente')"
                                        update=":main_proforma_vente:data-proforma_vente"/>
                            </h:inputText> 
                            <h:selectOneMenu value="#{managedProformaVente.statutSearch}" style="min-width: 120px">
                                <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                                <f:selectItem itemLabel="Egale à" itemValue="=" itemDisabled="true"/>
                                <f:selectItem itemLabel="EDITABLE" itemValue="=#{constantes.ETAT_EDITABLE}"/>
                                <f:selectItem itemLabel="ANNULE" itemValue="=#{constantes.ETAT_ANNULE}"/>
                                <f:selectItem itemLabel="VALIDE" itemValue="=#{constantes.ETAT_VALIDE}"/>
                                <f:selectItem itemLabel="Different de" itemValue="!=" itemDisabled="true"/>
                                <f:selectItem itemLabel="EDITABLE" itemValue="!=#{constantes.ETAT_EDITABLE}"/>
                                <f:selectItem itemLabel="ANNULE" itemValue="!=#{constantes.ETAT_ANNULE}"/>
                                <f:selectItem itemLabel="VALIDE" itemValue="!=#{constantes.ETAT_VALIDE}"/>
                                <p:ajax event="valueChange" listener="#{managedProformaVente.addParamStatut()}"
                                        update=":main_proforma_vente:data-proforma_vente" oncomplete="collapseList('proforma_vente')"/>
                            </h:selectOneMenu>                            
                            <h:inputText value="#{managedProformaVente.numeroSearch}">
                                <p:ajax event="valueChange" listener="#{managedProformaVente.addParamNumero()}"
                                        oncomplete="collapseList('proforma_vente')" update=":main_proforma_vente:data-proforma_vente"/>
                            </h:inputText>
                            <h:selectOneMenu value="#{managedProformaVente.valideSearch}" style="min-width: 120px">
                                <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                                <f:selectItem itemLabel="OUI" itemValue="#{true}"/>
                                <f:selectItem itemLabel="NON" itemValue="#{false}"/>
                                <p:ajax event="valueChange" listener="#{managedProformaVente.addParamValide()}"
                                        update=":main_proforma_vente:data-proforma_vente" oncomplete="collapseList('proforma_vente')"/>
                            </h:selectOneMenu>  
                        </h:panelGrid>
                    </h:panelGrid>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>