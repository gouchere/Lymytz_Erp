<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Modifier les ventes','modGescom', 'smenUpdateVente', true,managedFactureVente)}
    </ui:define> 
    <ui:define name="contents"> 
        #{managedVente.loadEdit(true)}
        #{managedPointVente.loadAllPointVente(0)} 
        #{managedModeReglement.loadModels('C')}
        #{managedCatCompt.loadAllCategorieVente()} 
        #{managedReglementVente.loadAll()}  
        #{managedFactureVente.loadAll()}   
        <script type="text/javascript">
            $(function() {
                collapseForm('update_vente');
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
            });
        </script>

        <!-->
        *****************************************************************************
        Boite de dialogue des clients
        *****************************************************************************
        <-->  

        <h:form prependId="false">                    
            <p:dialog header="Liste des clients" widgetVar="dlgListClients" closeOnEscape="true" width="50%" height="450" modal="true" dynamic="true">   
                <p:watermark for="txt_search_client_update_vente" value="Code Client..." />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_client_update_vente" value="#{managedClient.numSearch_}" style="float: left;text-align: center;margin-left: -10px">
                        <p:ajax event="valueChange" global="false" listener="#{managedClient.searchByNum()}" update="data_client_update_vente"/>
                    </h:inputText>   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedClient.init(false)}" global="false" update="data_client_update_vente" icon="ui-icon-circle-triangle-w" disabled="#{managedClient.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedClient.paginator.currentPage}/#{managedClient.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedClient.init(true)}" global="false" update="data_client_update_vente" icon="ui-icon-circle-triangle-e" disabled="#{managedClient.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedClient.max}" label="Nombre max Résultat" valueChangeListener="#{managedClient.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedClient.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_client_update_vente"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </h:panelGrid>                               
                <p:dataTable id="data_client_update_vente"  value="#{managedClient.clients}" var="clt_" rowKey="#{clt_.id}"
                             selectionMode="single" rowIndexVar="cltIdx" scrollable="true" scrollHeight="385">
                    <p:ajax event="rowSelect" global="false" listener="#{managedVente.loadOnViewClient}" oncomplete="dlgListClients.hide()"
                            update=":main_update_vente:select_client_update_vente"/>
                    <p:column headerText="N°" style="width: 10%;">
                        <span>#{cltIdx+1}</span>
                    </p:column>
                    <p:column headerText="Code" style="width: 20%">
                        <span>#{clt_.codeClient}</span>
                    </p:column>
                    <p:column headerText="Nom">
                        <span>#{clt_.nom_prenom}</span>
                    </p:column>
                    <p:column headerText="Zone">
                        <span>#{clt_.tiers.region}</span>
                    </p:column>
                </p:dataTable> 
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *************************************BeanCaisse****************************************
        Boite de dialogue des tranches horaires
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="main_tranche_update">
            <p:dialog header="Liste des tranches du dépôt" widgetVar="dlgListTranche" modal="true" width="40%"  closeOnEscape="true"> 
                <p:outputPanel autoUpdate="true">    
                    <p:dataTable id="data_tranche_update_fv" value="#{managedFactureVente.tranches}" var="trh" rowKey="#{trh.id}" selectionMode="single" rowIndexVar="line_trh">
                        <p:ajax event="rowSelect" global="false" listener="#{managedVente.loadOnViewTranche}" oncomplete="dlgListTranche.hide()"/>
                        <p:column headerText="N°" width="20">
                            <span>#{line_trh+1}</span>
                        </p:column>
                        <p:column headerText="Titre" width="130">
                            <span>#{trh.titre}</span>
                        </p:column>
                        <p:column headerText="Heure.Debut" width="90">
                            <h:outputText value="#{trh.heureDebut}" converter="TIME"/>
                        </p:column>
                        <p:column headerText="Heure.Fin" width="90">
                            <h:outputText value="#{trh.heureFin}" converter="TIME"/>
                        </p:column>
                    </p:dataTable>                
                </p:outputPanel>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
            <p:dialog header="Liste des tranches du point de vente" widgetVar="dlgListTranchePoint" modal="true" width="40%"  closeOnEscape="true"> 
                <p:outputPanel autoUpdate="true">     
                    <p:dataTable id="data_tranche_update_point" value="#{managedFactureVente.entete.point.listTranche}" var="cren" rowKey="#{cren.id}" selectionMode="single" rowIndexVar="line_cren">
                        <p:ajax event="rowSelect" global="false" listener="#{managedVente.loadOnViewTrancheEntete}" oncomplete="dlgListTranchePoint.hide()"/>
                        <p:column headerText="N°" width="20">
                            <span>#{line_cren+1}</span>
                        </p:column>
                        <p:column headerText="Titre" width="130">
                            <span>#{cren.tranche.titre}</span>
                        </p:column>
                        <p:column headerText="Heure.Debut" width="90">
                            <h:outputText value="#{cren.tranche.heureDebut}" converter="TIME"/>
                        </p:column>
                        <p:column headerText="Heure.Fin" width="90">
                            <h:outputText value="#{cren.tranche.heureFin}" converter="TIME"/>
                        </p:column>
                    </p:dataTable>               
                </p:outputPanel>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue des clients
        *****************************************************************************
        <-->  

        <h:form prependId="false" id="main_option_save">                    
            <p:dialog header="Modification" widgetVar="dlgSave" closeOnEscape="true" modal="true" style="max-width: 25%" dynamic="true">   
                <h:selectOneRadio value="#{managedVente.saveOption}" layout="pageDirection">
                    <f:selectItem itemLabel="Uniquement" itemValue="U"/>
                    <f:selectItem itemLabel="Avec synchronisation simple" itemValue="SS"/>
                    <f:selectItem itemLabel="Avec synchronisation forcée" itemValue="SF"/>
                    <p:ajax event="valueChange" global="false" listener="#{managedVente.changeOption()}" update="txt_msg_option_save texte_options"/>
                </h:selectOneRadio>
                <h:outputText id="txt_msg_option_save" value="#{managedVente.msgOption}" style="color: #D20005;font-size: 0.9em"/>
                <h:panelGroup id="texte_options">
                    <br />
                    <h:outputText rendered="#{managedVente.saveOption.equals('U')}" value="Modifie uniquement l'entête de la facture" style="color: #D20005;font-size: 0.9em"/>
                    <br /><h:outputText rendered="#{managedVente.saveOption.equals('SS')}" value="Modifie la facture et le contenue si possible (Annule les pièces de règlements)" style="color: #D20005;font-size: 0.9em"/>
                    <br /><h:outputText rendered="#{managedVente.saveOption.equals('SF')}" value="Modifie La facture et force la modification des éléments du contenu (Recrée les pièces de règlements)" style="color: #D20005;font-size: 0.9em"/>
                </h:panelGroup>
                <f:facet name="footer" class="yvs-dialog-footer">
                    <p:commandButton value="Confirmer" actionListener="#{managedVente.saveNew()}" style="width: 100%"/>
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmUpdate" closeOnEscape="true"
                             message="Vous voulez modifier les informations de l'entete ?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedVente.updateBean()}" oncomplete="dlgConfirmUpdate.hide()" update=":main_update_vente:data_update_vente"/>
                <p:commandButton type="button" value="Non" onclick="dlgConfirmUpdate.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirm" closeOnEscape="true" message="Vous voulez éxecuter cette action " header="Confirmation">
                <p:commandButton type="button" value="sur la journal" onclick="dlgConfirmUpdate.show()"/>
                <p:commandButton type="button" value="sur le facture" onclick="dlgSave.show()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog id="id_confirm_close_update_fv" hideEffect="explode" widgetVar="dlgConfirmClose" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir #{managedVente.selectDoc.cloturer?'dévérrouiller':'vérrouiller'}?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedVente.cloturer()}" oncomplete="dlgConfirmClose.hide()" update=":main_update_vente:data_update_vente"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmClose.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedVente.deleteBean()}" oncomplete="dlgConfirmDelete.hide();collapseList('update_vente')"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgCleanEntete" closeOnEscape="true"
                             message="Cette action supprimera touts les journaux de vente sans facture... Elle est irreversible!" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedVente.cleanEnteteVente()}" oncomplete="dlgCleanEntete.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgCleanEntete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_update_vente">    
            <div class="part_fix">
                <div style="float: left">    
                    <p:commandButton value="Modifier" id="save_update_vente" actionListener="#{managedVente.changeOption()}"  update=":main_option_save"/>
                </div>
                <div style="float: right">     
                    <h:link title="Vue Formulaire" onclick="collapseForm('update_vente');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link title="Vue Liste" onclick="collapseList('update_vente');
                            return false" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>   
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_update_vente" style="width: 99%; margin: auto; background: white">
                    <p:outputPanel id="blog_form_update_vente">
                        <div style="height: 210px"><!-->Block tableau 1<-->
                            <div style="width: 60%; float: left">
                                <div style="width: 49%; border: solid 2px; height: 100%; padding: 2px; border-radius: 5px; float: left">
                                    <span style="display: inline-block; background: #CCC; width: 100%">Entete</span>
                                    <div style="width: 99.5%;border: solid 1px; margin: auto;overflow-y: auto">                                   
                                        <h:panelGrid id="form_entete_update_vente" columns="2" styleClass="yvs_table" style="width: 100%; font-size: 0.9em" cellpadding="0" cellspacing="0">
                                            <f:facet name="header">
                                                <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                                                    <p:outputPanel>
                                                        <span style="font-weight: bold;float: left">Vendeur</span>    
                                                        <p:outputPanel autoUpdate="true" style="float: right;margin-top: -2px">
                                                            [<h:outputText value="#{managedVente.entete.users.codeUsers}" style="color: #003399"/>]
                                                        </p:outputPanel>
                                                    </p:outputPanel>
                                                    <h:panelGrid id="select_vendeur_update_vente" columns="1" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                                                        <h:selectOneMenu value="#{managedVente.entete.users.id}" id="select_vendeur" style="width: 85%">
                                                            <f:selectItem itemLabel="--" itemValue="0"/>
                                                            <f:selectItems value="#{managedVente.vendeurs}" var="vend_" itemLabel="#{vend_.nomUsers}" itemValue="#{vend_.id}" />                                
                                                            <p:ajax event="valueChange" global="false"/>
                                                        </h:selectOneMenu> 
                                                        <h:inputText value="#{managedVente.docVente.operateur.nomUsers}" style="width: 85%" disabled="true"/>                                              
                                                    </h:panelGrid>
                                                </h:panelGrid>
                                            </f:facet>
                                            <span title="Date vente">Date </span>
                                            <p:calendar value="#{managedVente.entete.dateEntete}" navigator="true" pattern="dd-MM-yyyy" title="Date vente" size="10">                     
                                                <p:ajax event="dateSelect" global="false" listener="#{managedVente.chooseDate}" update="data_contenu_update_vente"/>
                                            </p:calendar>
                                            <span title="Point de vente">Point </span>
                                            <h:selectOneMenu value="#{managedVente.entete.point.id}" style="min-width: 120px" title="Point de vente"
                                                             valueChangeListener="#{managedVente.choosePoint}">
                                                <f:selectItem itemLabel="--" itemValue="0"/>
                                                <f:selectItems value="#{managedPointVente.pointsvente}" var="poi" itemLabel="#{poi.libelle}" itemValue="#{poi.id}" />                              
                                                <p:ajax event="valueChange" update="select_tranche_entete_update_fv select_depot_livraison_update_fv select_vendeur_update_vente"/>                             
                                            </h:selectOneMenu> 
                                            <span title="Tranche de vente">Tranche </span>
                                            <h:panelGroup id="select_tranche_entete_update_fv">
                                                <h:selectOneMenu value="#{managedVente.entete.tranchePoint.id}" style="min-width: 120px" title="Tranche de vente">
                                                    <f:selectItem itemLabel="--" itemValue="0"/>
                                                    <f:selectItems value="#{managedVente.entete.point.listTranche}" var="trh_" itemLabel="#{trh_.tranche.titre}" itemValue="#{trh_.tranche.id}" />                  
                                                    <p:ajax event="valueChange" global="false" listener="#{managedVente.chooseTranche()}" update="select_tranche_entete_update_fv_"/>                          
                                                </h:selectOneMenu> 
                                                <h:panelGroup id="select_tranche_entete_update_fv_" style="float: right;border: 2px solid black; border-radius: 5px;padding: 2px;background: #CCC">
                                                    <div onclick="dlgListTranchePoint.show()" style="cursor: pointer" title="Selectionner la tranche de vente">
                                                        <h:panelGroup rendered="#{managedVente.entete.tranchePoint.id > 0}">
                                                            <h:outputText value="#{managedVente.entete.tranchePoint.heureDebut}" converter="TIME" style="font-weight: bold; font-size: 0.7em"/>
                                                            <span>-</span>
                                                            <h:outputText value="#{managedVente.entete.tranchePoint.heureFin}" converter="TIME" style="font-weight: bold; font-size: 0.7em"/>
                                                        </h:panelGroup>  
                                                        <h:outputText value="Tranche" rendered="#{0 >= managedVente.entete.tranchePoint.id}" style="font-weight: bold; font-size: 0.7em"/>
                                                    </div>
                                                </h:panelGroup>
                                            </h:panelGroup> 
                                        </h:panelGrid>
                                    </div>   
                                </div>
                                <div style="margin-left: 51%; border: solid 2px; height: 100%; padding: 2px; border-radius: 5px">
                                    <span style="display: inline-block; background: #CCC; width: 100%">
                                        Facture
                                        <h:outputText value="#{managedVente.docVente.numDoc}" style="float: right; color: #003399"/>
                                    </span>
                                    <div style="width: 99.5%;border: solid 1px; margin: auto;overflow-y: auto">
                                        <h:panelGrid id="form_facture_update_vente" columns="2" styleClass="yvs_table" style="width: 100%; font-size: 0.9em" cellpadding="0" cellspacing="0">
                                            <f:facet name="header">
                                                <h:panelGrid id="select_client_update_vente" columns="1" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                                                    <p:outputPanel>
                                                        <span style="font-weight: bold;float: left">Client</span>    
                                                        <p:outputPanel autoUpdate="true" style="float: right;margin-top: -2px">
                                                            [<h:outputText value="#{managedVente.docVente.client.codeClient}" style="color: #003399"/>]
                                                        </p:outputPanel>
                                                    </p:outputPanel>
                                                    <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                                                        <h:panelGroup>
                                                            <h:inputText value="#{managedVente.docVente.client.nom}" style="color: #{managedVente.docVente.client.error?'red':''};width: 85%">
                                                                <p:ajax event="blur" global="false" listener="#{managedVente.searchClient()}" update="select_client_update_vente"/>
                                                            </h:inputText>    
                                                            <h:panelGroup style="float: right">
                                                                <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="Liste Client" global="false"
                                                                                 actionListener="#{managedVente.initClients()}" oncomplete="dlgListClients.show()"/>
                                                            </h:panelGroup>
                                                        </h:panelGroup>       
                                                        <h:inputText value="#{managedVente.docVente.nomClient}" style="width: 85%"/>                                              
                                                    </h:panelGrid>
                                                </h:panelGrid>
                                            </f:facet>
                                            <span title="Catégorie Comptable">Catégorie C.</span>
                                            <h:selectOneMenu value="#{managedVente.docVente.categorieComptable.id}" style="min-width: 120px" title="Catégorie Comptable"
                                                             id="select_categorie_comptable_update_vente">
                                                <f:selectItem itemLabel="--" itemValue="0"/>
                                                <f:selectItems value="#{managedCatCompt.categoriesVente}" var="cat" itemLabel="#{cat.designation}" itemValue="#{cat.id}" />                               
                                                <p:ajax event="valueChange" global="false" listener="#{managedVente.chooseCategorie()}" update="data_contenu_update_vente"/>
                                            </h:selectOneMenu>
                                            <span title="Model de réglement">Model </span>
                                            <h:selectOneMenu value="#{managedVente.docVente.modeReglement.id}" style="min-width: 120px" title="Model de réglement"
                                                             id="select_model_update_vente">
                                                <f:selectItem itemLabel="--" itemValue="0"/>
                                                <f:selectItems value="#{managedModeReglement.models}" var="model" itemLabel="#{model.reference}" itemValue="#{model.id}" />                         
                                                <p:ajax event="valueChange" global="false" listener="#{managedVente.chooseModel()}" update="data_mensualite_update_vente"/>                              
                                            </h:selectOneMenu> 
                                            <span title="Dépot de Livraison prévu">Dépot </span>
                                            <h:panelGroup id="select_depot_livraison_update_fv">
                                                <h:selectOneMenu value="#{managedVente.docVente.depot.id}" style="min-width: 120px" title="Dépot de Livraison prévu">
                                                    <f:selectItem itemLabel="--" itemValue="0"/>
                                                    <f:selectItems value="#{managedFactureVente.depotsLivraison}" var="dpl" itemLabel="#{dpl.code}" itemValue="#{dpl.id}" />  
                                                    <p:ajax event="valueChange" global="false" listener="#{managedVente.chooseDepot()}" update="select_tranche_livraison_update_fv"/>                              
                                                </h:selectOneMenu> 
                                                <h:panelGroup id="select_tranche_livraison_update_fv" style="float: right;border: 2px solid black; border-radius: 5px;padding: 2px;background: #CCC">
                                                    <div onclick="dlgListTranche.show()" style="cursor: pointer" title="Selectionner la tranche de livraison prévu">
                                                        <h:panelGroup rendered="#{managedVente.docVente.tranche.id > 0}">
                                                            <h:outputText value="#{managedVente.docVente.tranche.heureDebut}" converter="TIME" style="font-weight: bold; font-size: 0.7em"/>
                                                            <span>-</span>
                                                            <h:outputText value="#{managedVente.docVente.tranche.heureFin}" converter="TIME" style="font-weight: bold; font-size: 0.7em"/>
                                                        </h:panelGroup>  
                                                        <h:outputText value="Tranche" rendered="#{0 >= managedVente.docVente.tranche.id}" style="font-weight: bold; font-size: 0.7em"/>
                                                    </div>
                                                </h:panelGroup>
                                            </h:panelGroup> 
                                        </h:panelGrid>
                                    </div>
                                </div>                                
                            </div>
                            <div style="margin-left: 61%;">
                                <div style="width: 100%; border: solid 2px; height: 100%; padding: 2px; border-radius: 5px">
                                    <span style="display: inline-block; background: #CCC; width: 100%">Mensualités</span>
                                    <div style="width: 99.5%;border: solid 1px; margin: auto;overflow-y: auto;height: 190px">    
                                        <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                            <f:facet name="header">
                                                Originales
                                            </f:facet>     
                                            <p:dataTable value="#{managedVente.docVente.mensualites}" var="men_" rowKey="#{men_.id}" rowIndexVar="menIdx">
                                                <p:column headerText="N°" style="width: 7%" styleClass="statut_#{men_.etat}">
                                                    <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{men.new_}"/>
                                                    <span>#{menIdx+1}</span>
                                                </p:column>
                                                <p:column headerText="Mode Reglement" styleClass="statut_#{men_.etat}">
                                                    <h:outputText value="#{men_.modeReglement.designation}" rendered="#{men_.modeReglement.id gt 0}"/>
                                                    <h:outputText value="AUCUN" rendered="#{0 >= men_.modeReglement.id or men_.modeReglement == null}"/>
                                                </p:column>
                                                <p:column headerText="Date Edition" sortBy="#{men_.dateMensualite}" style="text-align: center" styleClass="statut_#{men_.etat}">
                                                    <h:outputText value="#{men_.dateMensualite}" converter="DDMMYYYY"/>
                                                </p:column>
                                                <p:column headerText="Montant" style="width: 20%;text-align: right" styleClass="statut_#{men_.etat}">
                                                    <h:outputText value="#{men_.montant}" converter="#{managedVente.converter}"/>
                                                </p:column>
                                                <p:column headerText="Avance" style="width: 20%;text-align: right" styleClass="statut_#{men_.etat}">
                                                    <h:outputText value="#{men_.avance}" converter="#{managedVente.converter}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </h:panelGrid>
                                        <p:separator style="width: 98%"/>
                                        <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                            <f:facet name="header">
                                                Actualisées
                                            </f:facet>    
                                            <p:dataTable id="data_mensualite_update_vente" value="#{managedVente.mensualites}" var="men" rowKey="#{men.id}" rowIndexVar="menIdx">
                                                <p:column headerText="N°" style="width: 7%" styleClass="statut_#{men.etat}">
                                                    <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{men.new_}"/>
                                                    <span>#{menIdx+1}</span>
                                                </p:column>
                                                <p:column headerText="Mode Reglement" styleClass="statut_#{men.etat}">
                                                    <h:outputText value="#{men.modeReglement.designation}" rendered="#{men.modeReglement.id gt 0}"/>
                                                    <h:outputText value="AUCUN" rendered="#{0 >= men.modeReglement.id or men.modeReglement == null}"/>
                                                </p:column>
                                                <p:column headerText="Date Edition" sortBy="#{men.dateMensualite}" style="text-align: center" styleClass="statut_#{men.etat}">
                                                    <h:outputText value="#{men.dateMensualite}" converter="DDMMYYYY"/>
                                                </p:column>
                                                <p:column headerText="Montant" style="width: 20%;text-align: right" styleClass="statut_#{men.etat}">
                                                    <h:outputText value="#{men.montant}" converter="#{managedVente.converter}"/>
                                                </p:column>
                                                <p:column headerText="Avance" style="width: 20%;text-align: right" styleClass="statut_#{men.etat}">
                                                    <h:outputText value="#{men.avance}" converter="#{managedVente.converter}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </h:panelGrid>
                                    </div>    
                                </div>
                            </div>
                        </div><br style="clear: left"/><!-->Block tableau 2<-->
                        <div style="width: 100%; border: solid 2px; height: 50%; padding: 2px; border-radius: 5px">
                            <span style="display: inline-block; background: #CCC; width: 100%">Contenus</span>
                            <div style="width: 99.5%;border: solid 1px; margin: auto;overflow-y: auto">        
                                <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                    <f:facet name="header">
                                        Orignal
                                    </f:facet>
                                    <p:dataTable value="#{managedVente.docVente.contenus}" var="artf" rowKey="#{artf.id}" rowIndexVar="artfIdx">
                                        <p:column headerText="N°" style="width: 5%;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{artf.new_}"/>
                                            <span title="Numéro Serie : #{artf.numSerie}">#{artfIdx+1}</span>
                                        </p:column>
                                        <p:column headerText="Ref. " style="width: 12%;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <span title="Numéro Serie : #{artf.numSerie}">#{artf.article.refArt}</span>
                                            <h:graphicImage library="img" name="comment.png" width="15" height="15" rendered="#{artf.onComment}" style="float: right" title="a été commenté"/>
                                        </p:column>
                                        <p:column headerText="Article" style="color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <span title="Numéro Serie : #{artf.numSerie}">#{artf.article.designation}</span>
                                            <h:outputText title="Facture Consignée" value="C" rendered="#{artf.idReservation ne null}"
                                                          style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 1px;background: black;color: white; float: right"/>
                                        </p:column>
                                        <p:column headerText="Qté" style="width: 8%;text-align: center;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.quantite}" converter="#{managedVente.converterStock}" title="Plus #{artf.quantiteBonus} Bonus"/>
                                            <span title="#{artf.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{artf.conditionnement.unite.reference}</span>
                                        </p:column>
                                        <p:column headerText="Bonus" style="width: 8%;text-align: center;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.quantiteBonus}" converter="#{managedVente.converterStock}" title="Plus #{artf.quantiteBonus} Bonus"/>
                                        </p:column>
                                        <p:column headerText="Prix" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.prix}" converter="#{managedVente.converter}" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Rem" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.remise}" converter="DNS" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Rabais" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.quantite*artf.rabais}" converter="#{managedVente.converter}" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Taxe" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.taxe}" converter="DNS" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Total" style="width: 12%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.prixTotal}" converter="#{managedVente.converter}" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>     
                                <p:separator style="width: 98%"/>
                                <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                    <f:facet name="header">
                                        Actualisé
                                    </f:facet>     
                                    <p:dataTable id="data_contenu_update_vente" value="#{managedVente.contenus}" var="artf" rowKey="#{artf.id}" rowIndexVar="artfIdx">
                                        <p:column headerText="N°" style="width: 5%;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{artf.new_}"/>
                                            <span title="Numéro Serie : #{artf.numSerie}">#{artfIdx+1}</span>
                                        </p:column>
                                        <p:column headerText="Ref. " style="width: 12%;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <span title="Numéro Serie : #{artf.numSerie}">#{artf.article.refArt}</span>
                                            <h:graphicImage library="img" name="comment.png" width="15" height="15" rendered="#{artf.onComment}" style="float: right" title="a été commenté"/>
                                        </p:column>
                                        <p:column headerText="Article" style="color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <span title="Numéro Serie : #{artf.numSerie}">#{artf.article.designation}</span>
                                            <h:outputText title="Facture Consignée" value="C" rendered="#{artf.idReservation ne null}"
                                                          style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 1px;background: black;color: white; float: right"/>
                                        </p:column>
                                        <p:column headerText="Qté" style="width: 8%;text-align: center;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.quantite}" converter="#{managedVente.converterStock}" title="Plus #{artf.quantiteBonus} Bonus"/>
                                            <span title="#{artf.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{artf.conditionnement.unite.reference}</span>
                                        </p:column>
                                        <p:column headerText="Bonus" style="width: 8%;text-align: center;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.quantiteBonus}" converter="#{managedVente.converterStock}" title="Plus #{artf.quantiteBonus} Bonus"/>
                                        </p:column>
                                        <p:column headerText="Prix" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.prix}" converter="#{managedVente.converter}" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Rem" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.remise}" converter="DNS" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Rabais" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.quantite*artf.rabais}" converter="#{managedVente.converter}" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Taxe" style="width: 10%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.taxe}" converter="DNS" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                        <p:column headerText="Total" style="width: 12%;text-align: right;color: #{artf.etat()=='R'?'orange':(artf.etat()=='P'?'red':'')};font-style: #{artf.etat()!='E'?'italic':''}">
                                            <h:outputText value="#{artf.prixTotal}" converter="#{managedVente.converter}" title="Numéro Serie : #{artf.numSerie}"/>
                                        </p:column>
                                    </p:dataTable>                               
                                </h:panelGrid>
                            </div>    
                        </div>
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_update_vente" style="width: 99%; margin: auto; background: white">
                    <p:dataTable id="data_update_vente" value="#{managedFactureVente.documents}" var="bon" rowKey="#{bon.id}" rowIndexVar="bonIdx" selectionMode="single">
                        <p:ajax event="rowSelect" global="false" listener="#{managedVente.loadOnViewFacture}" oncomplete="collapseForm('update_vente')"
                                update=":main_update_vente:blog_form_update_vente"/>
                        <p:column width="35" headerText="N°" styleClass="statut_#{bon.statut}">
                            <h:graphicImage title="Cloturer" library="img" name="blocked.png" width="15" height="15" rendered="#{bon.cloturer}"/>  
                            <span>#{bonIdx+1}</span>
                        </p:column>
                        <p:column headerText="Reference" styleClass="statut_#{bon.statut}">
                            <span>#{bon.numDoc}</span>
                            <h:outputText value="vide" style="float: right;color: blue;font-style: italic;font-size: 0.8em" rendered="#{0>=bon.contenus.size()}"/>
                            <h:panelGroup style="float: right">
                                <h:outputText title="Facture Reglée" value="R" rendered="#{bon.statutRegle == constantes.ETAT_REGLE}"
                                              style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                <p:spacer width="2" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}"/>
                                <h:outputText title="Facture Livrée" value="L" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}"
                                              style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                <p:spacer width="2" rendered="#{bon.consigner}"/>
                                <h:outputText title="stock de la facture consigné" value="C" rendered="#{managedFactureVente.isConsigner(bon)}"
                                              style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                            </h:panelGroup>
                        </p:column>
                        <p:column headerText="Date Facture" style="text-align: center" styleClass="statut_#{bon.statut}">
                            <h:outputText value="#{bon.enteteDoc.dateEntete}" converter="DDMMYYYY"/>
                            <span> à </span>
                            <h:outputText value="#{bon.heureDoc}" converter="TIME"/>
                        </p:column>
                        <p:column headerText="Client" styleClass="statut_#{bon.statut}">
                            <span>#{bon.nom_client}</span>
                            <h:outputText value="cmd" title="Rattacher à une commande" style="color: blue;float: right;font-size: 0.7em;font-style: italic"
                                          rendered="#{bon.documentLie.id > 0}"/>
                        </p:column>
                        <p:column headerText="Point vente" styleClass="statut_#{bon.statut}">
                            <span>#{bon.enteteDoc.creneau.creneauPoint.point.libelle}</span>
                        </p:column>
                        <p:column headerText="Vendeur" styleClass="statut_#{bon.statut}">
                            <span>#{bon.enteteDoc.creneau.users.nomUsers}</span>
                        </p:column>
                        <p:column headerText="Etapes"  width="60" styleClass="statut_#{bon.statut}" style="font-size: 0.8em">
                            <h:outputText value="#{bon.libEtapes}" />
                        </p:column>
                    </p:dataTable>   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedFactureVente.init(false)}" global="false" update="data_update_vente" icon="ui-icon-circle-triangle-w" disabled="#{managedFactureVente.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedFactureVente.paginator.currentPage}/#{managedFactureVente.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedFactureVente.init(true)}" global="false" update="data_update_vente" icon="ui-icon-circle-triangle-e" disabled="#{managedFactureVente.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedFactureVente.imax}" label="Nombre max Résultat" valueChangeListener="#{managedFactureVente.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedFactureVente.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_update_vente"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </div> 
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="cacher"/>  
            <div class="zone_find">
                <h:panelGrid id="blog_search_update_fv" columns="2" style="width: 100%" cellpadding="0" cellspacing="0">
                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                        <h:panelGrid columns="7" style="float: left; font-size: 0.8em" cellpadding="0" cellspacing="0">
                            <h:outputText value="" />
                            <h:outputText value="Date" />
                            <h:outputText value="Vendeur" />
                            <h:outputText value="Client"/>
                            <h:outputText value="Statut" />
                            <h:outputText value="Reference" />
                            <span>&nbsp;</span>
                            <p:commandButton icon="ui-icon-bullet" actionListener="#{managedFactureVente.clearParams()}" title="Reinitialiser les paramètres" style="width: 20px; height: 22px" 
                                             update="blog_search_update_fv :main_update_vente:data_update_vente"/>
                            <h:panelGrid columns="2">
                                <h:selectBooleanCheckbox value="#{managedFactureVente.date_}" valueChangeListener="#{managedFactureVente._chooseDateSearch}">
                                    <p:ajax event="valueChange" oncomplete="collapseList('update_vente')"
                                            update="blog_date_search_update_vente :main_update_vente:data_update_vente"/>
                                </h:selectBooleanCheckbox>
                                <h:panelGroup id="blog_date_search_update_vente">
                                    <p:calendar value="#{managedFactureVente.dateDebut}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedFactureVente.paramDate}" size="10" style="font-size: 0.8em">
                                        <p:ajax event="dateSelect" update=":main_update_vente:data_update_vente" listener="#{managedFactureVente.addParamDate1}" oncomplete="collapseList('update_vente')"/>
                                        <p:ajax event="blur" update=":main_update_vente:data_update_vente" listener="#{managedFactureVente.addParamDate2()}" oncomplete="collapseList('update_vente')"/>
                                    </p:calendar>
                                    <p:spacer width="5px" style="background: black"/>
                                    <p:calendar value="#{managedFactureVente.dateFin}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedFactureVente.paramDate}" size="10" style="font-size: 0.8em">
                                        <p:ajax event="dateSelect" update=":main_update_vente:data_update_vente" listener="#{managedFactureVente.addParamDate1}" oncomplete="collapseList('update_vente')"/>
                                        <p:ajax event="blur" update=":main_update_vente:data_update_vente" listener="#{managedFactureVente.addParamDate2()}" oncomplete="collapseList('update_vente')"/>
                                    </p:calendar>
                                </h:panelGroup>
                            </h:panelGrid>
                            <h:inputText value="#{managedFactureVente.codeVendeur_}" style="min-width: 120px">
                                <p:ajax event="valueChange"  update=":main_update_vente:data_update_vente" listener="#{managedFactureVente._searchVendeur()}" oncomplete="collapseList('update_vente')"/>
                            </h:inputText>                            
                            <h:inputText value="#{managedFactureVente.codeClient_}" style="width: 100%">
                                <p:ajax event="valueChange" listener="#{managedFactureVente.searchByClient()}" oncomplete="collapseList('update_vente')"
                                        update=":main_update_vente:data_update_vente"/>
                            </h:inputText> 
                            <h:selectOneMenu value="#{managedFactureVente.statut}"  valueChangeListener="#{managedFactureVente._chooseStatut}" style="min-width: 120px">
                                <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                                <f:selectItem itemLabel="EDITABLE" itemValue="#{constantes.ETAT_EDITABLE}"/>
                                <f:selectItem itemLabel="EN COURS" itemValue="#{constantes.ETAT_ENCOURS}"/>
                                <f:selectItem itemLabel="ANNULE" itemValue="#{constantes.ETAT_ANNULE}"/>
                                <f:selectItem itemLabel="VALIDE" itemValue="#{constantes.ETAT_VALIDE}"/>
                                <p:ajax event="valueChange" update=":main_update_vente:data_update_vente" oncomplete="collapseList('update_vente')"/>
                            </h:selectOneMenu>                            
                            <h:inputText value="#{managedFactureVente.numSearch_}">
                                <p:ajax event="valueChange" listener="#{managedFactureVente.searchByNum()}"
                                        oncomplete="collapseList('update_vente')" update=":main_update_vente:data_update_vente"/>
                            </h:inputText>
                        </h:panelGrid>
                    </h:panelGrid>
                    <h:panelGroup style="float: right">
                        <p:commandLink onclick="dlgCleanVente.show()" global="false" style="border: 2px solid black; border-radius: 5px;padding: 3px;" 
                                       title="Nettoyage Stock" rendered="#{accesRessource.fv_clean}">
                            <h:graphicImage library="img" name="clean.png" width="15" height="18"/>  
                        </p:commandLink>
                    </h:panelGroup>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>