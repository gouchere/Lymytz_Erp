<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Cloture Commercial','modGescom', 'smenClotureCom', true,managedClotureCommercial)}
    </ui:define> 
    <ui:define name="contents">
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - 180);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('cloture_com');
                _slideShow('zone_show_header_cloture_com');
            });
            function _slideShow(node) {
                if (node === 'zone_show_facture_cloture_com') {
                    slideShowAction('zone_show_header_cloture_com', false, 450);
                    slideShowAction('zone_show_facture_cloture_com', true, 450);
                } else if (node === 'zone_show_header_cloture_com') {
                    slideShowAction('zone_show_header_cloture_com', true, 450);
                    slideShowAction('zone_show_facture_cloture_com', false, 450);
                }
            }
        </script> 
        #{managedVirement.doNothing()}
        #{managedCaisses.doNothing()}
        #{managedClotureCommercial.loadAll()}
        #{managedModeReglement.loadActifMode()}
        <h:form prependId="false">
            <p:dialog header="#{lab.LC_PCC_liste_virements}" widgetVar="dlgListVirement" width="70%" dynamic="true" closeOnEscape="true" resizable="false">
                <p:outputPanel id="form-virement_header_vente">
                    <h:panelGrid columns="6" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.L_date}"/>
                        <h:outputText value="#{lab.LC_PJV_caisse}"/>
                        <h:outputText value="#{lab.LC_PJV_caisse_cible} "/>
                        <h:outputText value="#{lab.L_montant}"/>
                        <h:outputText value="#{lab.LC_PJV_mode}"/>
                        <h:outputText value=""/>
                        <p:calendar value="#{managedClotureCommercial.virement.datePaiementPrevu}" size="8" pattern="dd-MM-yyyy"/>
                        <h:selectOneMenu value="#{managedClotureCommercial.virement.caisse.id}" valueChangeListener="#{managedClotureCommercial.chooseSource}" style="min-width: 120px">
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItems value="#{managedClotureCommercial.selectHeader.caisses}" var="iCS" itemValue="#{iCS.id}" itemLabel="#{iCS.intitule}"/>
                            <p:ajax event="valueChange" update="value-caisse_source_virement_vente"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu id="value-caisse_source_virement_vente" value="#{managedClotureCommercial.virement.otherCaisse.id}" valueChangeListener="#{managedClotureCommercial.chooseCible}" style="min-width: 120px">
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItems value="#{managedClotureCommercial.caisseCible}" var="iCC" itemValue="#{iCC.id}" itemLabel="#{iCC.intitule}"/>
                            <p:ajax event="valueChange"/>
                        </h:selectOneMenu>
                        <h:inputText value="#{managedClotureCommercial.virement.montant}"/>
                        <h:selectOneMenu value="#{managedClotureCommercial.virement.mode.id}" style="min-width: 140px">
                            <f:selectItem itemLabel="" itemValue="0" />
                            <f:selectItems value="#{managedModeReglement.modes}" var="iMdl" itemLabel="#{iMdl.designation}" itemValue="#{iMdl.id}" /> 
                            <p:ajax event="valueChange" listener="#{managedClotureCommercial.chooseModeReglement()}"/>
                        </h:selectOneMenu>
                        <p:commandButton icon="ui-icon-disk" value="#{lab.L_enregistrer}" actionListener="#{managedClotureCommercial.createVirement()}" update="data-virement_header_vente"/>
                    </h:panelGrid>
                    <p:dataTable id="data-virement_header_vente" value="#{managedClotureCommercial.selectHeader.virements}" var="mvtVir"
                                 rowKey="#{mvtVir.id}" rowIndexVar="line_M">
                        <p:column headerText="N°" width="25" style="text-align: center" styleClass="etat_#{mvtVir.statutPiece}">
                            #{mvtVir.id}
                        </p:column>
                        <p:column headerText="#{lab.L_numero}" width="180" styleClass="etat_#{mvtVir.statutPiece}">
                            #{mvtVir.numeroPiece}
                        </p:column>   
                        <p:column headerText="#{lab.L_date}" width="100" styleClass="etat_#{mvtVir.statutPiece}" style="text-align: center">
                            <h:outputText value="#{mvtVir.datePiece}" converter="DATE" />
                        </p:column>                        
                        <p:column headerText="#{lab.LC_PJV_source}" styleClass="etat_#{mvtVir.statutPiece}">
                            #{mvtVir.source.intitule}
                        </p:column>
                        <p:column headerText="#{lab.LC_PJV_cible}" styleClass="etat_#{mvtVir.statutPiece}" >
                            #{mvtVir.cible.intitule}
                        </p:column>
                        <p:column headerText="#{lab.L_montant}" width="100" styleClass="etat_#{mvtVir.statutPiece}" style="text-align: right">
                            <h:outputText value="#{mvtVir.montant + mvtVir.montantCout}" converter="DN" />
                        </p:column>
                        <p:column headerText="#{lab.LC_PJV_date_paiment}" width="100" styleClass="etat_#{mvtVir.statutPiece}" style="text-align: center">
                            <h:outputText value="#{(!mvtVir.statutPiece.equals(constantes.STATUT_DOC_PAYER))?mvtVir.datePaimentPrevu:mvtVir.datePaiement}" converter="DATE" 
                                          title="#{(!mvtVir.statutPiece.equals(constantes.STATUT_DOC_PAYER))?'Date de paiement prévu':'Date de paiement'}"/>
                        </p:column>
                        <p:column headerText="#{lab.LC_PJV_caissier}" styleClass="etat_#{mvtVir.statutPiece}">
                            #{mvtVir.caissierSource.nomUsers}
                        </p:column>   
                    </p:dataTable>
                </p:outputPanel>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main-cloture_header_vente">
            <p:dialog header="#{lab.LC_PCC_cloturer_journal_vente}" widgetVar="dlgConfirmClotureHeader" dynamic="true" closeOnEscape="true" resizable="false">
                <p:outputPanel id="form-cloture_header_vente">
                    <div align="left" style="background: #CCC;padding: 5px;font-weight: bold">
                        <p:outputLabel value="#{managedClotureCommercial.selectHeader.reference}" styleClass="statut_#{managedClotureCommercial.selectHeader.etat}"/>
                    </div>
                    <p:separator/>
                    <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.LC_PCC_total_documents} : "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.documents.size()}" converter="DNA" style="font-weight: bold"/>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_total_non_valide} : "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.totalWait + managedClotureCommercial.selectHeader.totalCours}" converter="DNA" style="font-weight: bold"/>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_total_non_regler} : "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.totalRegle}" converter="DNA" style="font-weight: bold"/>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_total_non_livrer} : "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.totalLivre}" converter="DNA" style="font-weight: bold"/>
                        </h:panelGroup>
                    </h:panelGrid>
                    <p:separator/>
                    <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.LC_PCC_ca_facture}: "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.totalFact}" converter="DNA" style="font-weight: bold"/>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_reglement_facture}: "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.avanceFact}" converter="DNA" style="font-weight: bold"/>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_ca_commande}: "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.totalCmde}" converter="DNA" style="font-weight: bold"/>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_commande_recu}: "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.avanceCmde}" converter="DNA" style="font-weight: bold"/>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                    </h:panelGrid>
                    <p:separator/>
                    <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.LC_PCC_versement_attendu} : "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.versementAttendu}" converter="DNA" style="font-weight: bold"/>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_versement_reel} : "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.versementReel}" converter="DNA" style="font-weight: bold"/>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                        <h:outputText value="#{lab.LC_PCC_versement_attente}: "/>
                        <h:panelGroup style="float: right">
                            <h:outputText value="#{managedClotureCommercial.selectHeader.versementWait}" converter="DNA" style="font-weight: bold"/>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                        <h:outputText value="#{managedClotureCommercial.selectHeader.ecartPlanifier gt 0?'Excedent':'Manquant'} : " rendered="#{managedClotureCommercial.selectHeader.ecartPlanifier ne 0}"/>
                        <h:panelGroup style="float: right" rendered="#{managedClotureCommercial.selectHeader.ecartPlanifier ne 0}">
                            <p:commandLink id="link-ecar_planifier_header_vente" global="false" actionListener="#{managedClotureCommercial.loadDataEcart()}" update=":main-cloture_com:form-ecar_planifier_header_vente">
                                <h:outputText value="#{managedClotureCommercial.abs(managedClotureCommercial.selectHeader.ecartPlanifier)}" converter="DNA" style="font-weight: bold;color: #{managedClotureCommercial.selectHeader.ecartPlanifier gt 0 ? 'green':'red'}"/>
                            </p:commandLink>
                            <span style="font-size: 0.8em"> Fcfa</span>
                        </h:panelGroup>
                    </h:panelGrid>
                    <h:panelGroup rendered="#{managedClotureCommercial.selectHeader.new_}">
                        <p:separator/>
                        <span style="font-size: 0.9em;color : red">#{managedClotureCommercial.doubleLine(managedClotureCommercial.selectHeader.libelleStatut)}</span>                   
                        <p:commandButton value="#{lab.L_cloturer}" icon="ui-icon-locked" update=":main-cloture_com:data-header_cloture_by_point" style="float: right;margin-top: -5px"
                                         actionListener="#{managedClotureCommercial.actionOnHeader(managedClotureCommercial.selectHeader, false)}" oncomplete="dlgConfirmClotureHeader.hide()"/>
                    </h:panelGroup>
                </p:outputPanel>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgForceClotureHeader" closeOnEscape="true"
                             message="#{lab.LC_PCC_text}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedClotureCommercial.actionOnHeader(managedClotureCommercial.selectHeader, true)}" oncomplete="dlgForceClotureHeader.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgForceClotureHeader.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
        *****************************************************************************
        Début du formulaire
        *****************************************************************************
        <-->
        <h:form prependId="false" id="main-cloture_com">
            <div class="part_fix" align="right" style="font-size: 0.8em;background: black;">
                <p:contextMenu for=":main-cloture_header_vente:link-ecar_planifier_header_vente">
                    <p:menuitem icon="ui-icon-refresh" value="#{lab.L_actualiser}" actionListener="#{managedClotureCommercial.actualiseEcart()}"/>
                </p:contextMenu>                    
                <p:overlayPanel for=":main-cloture_header_vente:link-ecar_planifier_header_vente" hideEffect="fade">
                    <h:panelGrid id="form-ecar_planifier_header_vente" columns="4" style="width: 100%" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.LC_PJV_caisse}"/>
                        <h:outputText value="#{lab.LC_PCC_date_ecart}"/>
                        <h:outputText value="#{lab.L_montant}"/>
                        <h:outputText value=""/>
                        <h:selectOneMenu value="#{managedClotureCommercial.ecarte.caisse.id}" style="min-width: 120px">
                            <f:selectItem itemValue="0" itemLabel="--"/>
                            <f:selectItems value="#{managedClotureCommercial.selectHeader.caisses}" var="iCais" itemValue="#{iCais.id}" itemLabel="#{iCais.intitule}"/>
                        </h:selectOneMenu>
                        <p:calendar value="#{managedClotureCommercial.ecarte.dateEcart}" pattern="dd-MM-yyyy"/>
                        <h:inputText value="#{managedClotureCommercial.ecarte.montant}" style="text-align: right"/>
                        <p:commandButton icon="ui-icon-pencil" value="#{lab.L_modifier}" actionListener="#{managedClotureCommercial.saveNew()}" update="data-ecar_planifier_header_vente" rendered="false"/>
                        <f:facet name="footer">
                            <p:dataTable id="data-ecar_planifier_header_vente" value="#{managedClotureCommercial.selectHeader.ecarts}" var="iEct" rowIndexVar="eIdx"
                                         rowKey="#{iEct.id}" selectionMode="single">
                                <p:ajax event="rowSelect" listener="#{managedClotureCommercial.loadOnViewEcart}" update=":main-cloture_com:form-ecar_planifier_header_vente @this" />                                
                                <p:ajax event="rowUnselect" listener="#{managedClotureCommercial.unLoadOnViewEcart}" update=":main-cloture_com:form-ecar_planifier_header_vente @this" />  
                                <p:column headerText="N°" style="width: 5%">
                                    <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{iEct.id eq managedClotureCommercial.ecarte.id}"/>
                                    <span>#{eIdx+1}</span>
                                </p:column>
                                <p:column headerText="#{lab.LC_PCC_date_ecart}" style="text-align: center">
                                    <h:outputText value="#{iEct.dateEcart}" converter="DATE"/>
                                </p:column>
                                <p:column headerText="#{lab.LC_PJV_caisse}">
                                    <h:outputText value="#{iEct.caisse.caisse.intitule}"/>
                                </p:column>
                                <p:column headerText="#{lab.L_montant}" style="text-align: right">
                                    <h:outputText value="#{iEct.montant}" converter="DNA"/>
                                </p:column>
                            </p:dataTable>
                        </f:facet>
                    </h:panelGrid>
                </p:overlayPanel>
                <span style="display: inline-block; clear: both" />
            </div>
            <div class="part_scroll" style="width: 99%; margin: auto; background: white ">
                <p:outputPanel id="blog-cloture_by_point" style="height: 90%;overflow-x: auto;width: 90%;overflow-y: auto">
                    <div id="zone_show_header_cloture_com" class="block_slide" style="height: 450px">
                        <span class="block_slide_title" onclick="_slideShow('zone_show_header_cloture_com')">
                            <span class="button_slide">[-]</span>
                            Journal de vente (<h:outputText id="txt-header_cloture_by_point" value="#{managedClotureCommercial.documents.size()}" style="font-weight: bold"/>)
                            <div style="float: right">
                                <h:outputText value="#{lab.LC_PCC_total_facture_non_validee} "/> (<h:outputText value="#{managedClotureCommercial.totalWait + managedClotureCommercial.totalCours}" style="font-weight: bold"/>)..
                                <h:outputText value="#{lab.LC_PCC_total_facture_non_reglee} "/> (<h:outputText value="#{managedClotureCommercial.totalRegle}" style="font-weight: bold"/>)..
                                <h:outputText value="#{lab.LC_PCC_total_facture_non_livree} "/> (<h:outputText value="#{managedClotureCommercial.totalLivre}" style="font-weight: bold"/>)
                            </div>
                        </span>
                        <div class="zone_slide">
                            <p:dataTable id="data-header_cloture_by_point" value="#{managedClotureCommercial.documents}" var="headP" rowKey="#{headP.id}" rowIndexVar="headIdx" selectionMode="single">
                                <p:ajax event="rowSelect" listener="#{managedClotureCommercial.loadOnView}" oncomplete="_slideShow('zone_show_facture_cloture_com')"
                                        update=":main-cloture_com:data-facture_cloture_by_point :main-cloture_com:txt-facture_cloture_by_point :main-cloture_com:blog-footer_facture_header" />                                
                                <p:ajax event="rowUnselect" listener="#{managedClotureCommercial.unLoadOnView}" oncomplete="_slideShow('zone_show_facture_cloture_com')"
                                        update=":main-cloture_com:data-facture_cloture_by_point :main-cloture_com:txt-facture_cloture_by_point :main-cloture_com:blog-footer_facture_header" />                                
                                <p:column width="35" styleClass="statut_#{headP.etat}">
                                    <h:graphicImage title="#{lab.L_cloturer}" library="img" name="blocked.png" width="15" height="15" rendered="#{headP.cloturer}"/>  
                                    <h:outputText value="#{headIdx+1}"/>
                                    <h:outputText value="!" rendered="#{managedClotureCommercial.errorInHeader(headP)}" title="#{headP.libelleStatut}" style="float: right; color: red;font-weight: bold"/>
                                </p:column>
                                <p:column headerText="N°" sortBy="#{headP.id}" styleClass="statut_#{headP.etat}" style="text-align: center">
                                    <span>#{headP.id}</span>
                                </p:column>
                                <p:column headerText="#{lab.L_reference}" styleClass="statut_#{headP.etat}">
                                    <span>#{headP.reference}</span>
                                </p:column>
                                <p:column headerText="#{lab.L_date}" style="text-align: center" sortBy="#{headP.dateEntete}" styleClass="statut_#{headP.etat}">
                                    <h:outputText value="#{headP.dateEntete}" converter="DATE"/>
                                </p:column>
                                <p:column headerText="#{lab.L_point_vente}" styleClass="statut_#{headP.etat}">
                                    <span>#{headP.creneau.creneauPoint.point.libelle}</span>
                                </p:column>
                                <p:column headerText="#{lab.LC_PCC_vendeur}" styleClass="statut_#{headP.etat}">
                                    <span>#{headP.creneau.users.nomUsers}</span>
                                </p:column>
                                <p:column width="20" style="text-align: center">
                                    <p:contextMenu for="btn_option-header_cloture_by_point" event="left click" style="width: 200px;font-size: 0.8em">
                                        <p:menuitem value="#{headP.cloturer?'Déverrouiller':'Cloturer'}" icon="#{headP.cloturer?'ui-icon-unlocked':'ui-icon-locked'}" actionListener="#{managedClotureCommercial.actionOnHeader(headP)}"
                                                    update=":main-cloture_com:data-header_cloture_by_point :main-cloture_com:data-facture_cloture_by_point :main-cloture_com:form-ecar_planifier_header_vente"/>
                                        <p:menuitem value="#{lab.LC_PCC_voir_detail}" icon="ui-icon-newwin" actionListener="#{managedClotureCommercial.showInfos(headP)}"
                                                    update=":main-cloture_com:data-header_cloture_by_point :main-cloture_com:data-facture_cloture_by_point :main-cloture_com:form-ecar_planifier_header_vente"/>
                                        <p:menuitem value="#{lab.LC_PCC_voir_virements}" icon="ui-icon-seek-next" actionListener="#{managedClotureCommercial.loadVirement(headP)}"/>
                                        <p:menuitem value="#{lab.LC_PCC_nettoyage_factures_vide}" icon="ui-icon-shuffle" update=":main-cloture_com:data-facture_cloture_by_point"
                                                    actionListener="#{managedClotureCommercial.cleanVente(headP, true)}"/>
                                        <p:menuitem icon="ui-icon-carat-2-e-w" value="#{lab.LC_PJV_equilibrer_statut}" actionListener="#{managedClotureCommercial.equilibreHeader(headP)}"/>
                                    </p:contextMenu>                           
                                    <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option-header_cloture_by_point" type="button"/>
                                </p:column>
                            </p:dataTable>
                        </div>  
                        <div class="zone_bottom">
                            <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                                <p:commandButton actionListener="#{managedClotureCommercial.loadData(false, false)}" global="false" update=":main-cloture_com:data-header_cloture_by_point"
                                                 icon="ui-icon-circle-triangle-w" disabled="#{managedClotureCommercial.paginator.disPrev}" style="height: 22px"/>
                                <p:outputPanel >
                                    <p:inplace label="#{managedClotureCommercial.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                        <pe:inputNumber value="#{managedClotureCommercial.paginator.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                            <p:ajax event="blur" listener="#{managedClotureCommercial.gotoPagePaginator()}" update=":main-cloture_com:data-header_cloture_by_point"/>
                                        </pe:inputNumber>
                                    </p:inplace><p:outputLabel value="/#{managedClotureCommercial.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                                </p:outputPanel>
                                <p:commandButton actionListener="#{managedClotureCommercial.loadData(true, false)}" global="false" update=":main-cloture_com:data-header_cloture_by_point"
                                                 icon="ui-icon-circle-triangle-e" disabled="#{managedClotureCommercial.paginator.disNext}" style="height: 22px"/>
                                <p:selectOneMenu value="#{managedClotureCommercial.imax}" label="Nombre max Résultat" valueChangeListener="#{managedClotureCommercial.choosePaginator}" style="float: right; font-size: 0.9em;min-width: 50px;height: 22px" >
                                    <f:selectItems value="#{managedClotureCommercial.paginations}"/>
                                    <p:ajax event="valueChange" update=":main-cloture_com:data-header_cloture_by_point :main-cloture_com:txt-header_cloture_by_point"/>
                                </p:selectOneMenu>
                            </p:outputPanel> 
                        </div>
                    </div> 
                    <div id="zone_show_facture_cloture_com" class="block_slide" style="height: 450px">
                        <span class="block_slide_title" onclick="_slideShow('zone_show_facture_cloture_com')">
                            <span class="button_slide">[-]</span>
                            #{lab.LC_PCC_factures} 
                            <p:outputPanel id="txt-facture_cloture_by_point">
                                (<h:outputText value="#{managedClotureCommercial.header.documents.size()}" style="font-weight: bold"/>)
                                <div style="float: right">
                                    <h:outputText value="#{lab.LC_PCC_total_facture_non_validee} "/> (<h:outputText value="#{managedClotureCommercial.header.totalWait + managedClotureCommercial.header.totalCours}" style="font-weight: bold"/>)..
                                    <h:outputText value="#{lab.LC_PCC_total_facture_non_reglee} "/> (<h:outputText value="#{managedClotureCommercial.header.totalRegle}" style="font-weight: bold"/>)..
                                    <h:outputText value="#{lab.LC_PCC_total_facture_non_livree} "/> (<h:outputText value="#{managedClotureCommercial.header.totalLivre}" style="font-weight: bold"/>)
                                </div>
                            </p:outputPanel>
                        </span>
                        <div class="zone_slide">
                            <p:dataTable id="data-facture_cloture_by_point" value="#{managedClotureCommercial.header.documents}" var="bonP" rowKey="#{bonP.id}" rowIndexVar="bonIdx">
                                <p:column width="35" styleClass="statut_#{bonP.statut}">
                                    <h:graphicImage title="Cloturer" library="img" name="blocked.png" width="15" height="15" rendered="#{bonP.cloturer}"/>  
                                    <h:outputText value="#{bonIdx+1}"/>
                                </p:column>
                                <p:column headerText="#{lab.L_reference}" styleClass="statut_#{bonP.statut}">
                                    <span>#{bonP.numDoc}</span>
                                </p:column>
                                <p:column headerText="#{lab.LC_PCC_heure}" style="text-align: center" sortBy="#{bonP.heureDoc}" styleClass="statut_#{bonP.statut}">
                                    <h:outputText value="#{bonP.heureDoc}" converter="TIME"/>
                                </p:column>
                                <p:column headerText="#{lab.LC_PCC_client}" styleClass="statut_#{bonP.statut}">
                                    <span>#{bonP.nomClient}</span>
                                </p:column>
                                <p:column headerText="#{lab.L_point_vente}" styleClass="statut_#{bonP.statut}">
                                    <span>#{bonP.enteteDoc.creneau.creneauPoint.point.libelle}</span>
                                </p:column>
                                <p:column headerText="#{lab.LC_PCC_vendeur}" styleClass="statut_#{bonP.statut}">
                                    <span>#{bonP.enteteDoc.creneau.users.nomUsers}</span>
                                </p:column>
                                <p:column headerText="#{lab.L_statut}" style="text-align: center">
                                    <h:outputText value="#{bonP.libelleStatut}" style="font-weight: bold"/>
                                </p:column>
                                <p:column width="20" style="text-align: center">
                                    <f:facet name="header">
                                        <p:contextMenu for="btn_option-head_facture_cloture_by_point" event="left click" style="width: 200px;font-size: 0.8em">
                                            <p:menuitem value="#{lab.LC_PCC_nettoyage_factures_vide}" icon="ui-icon-shuffle" update=":main-cloture_com:data-facture_cloture_by_point"
                                                        actionListener="#{managedClotureCommercial.cleanVente(headP, true)}"/>
                                        </p:contextMenu>                           
                                        <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option-head_facture_cloture_by_point" type="button"/>
                                    </f:facet>
                                    <p:contextMenu for="btn_option-facture_cloture_by_point" event="left click" style="font-size: 0.8em">
                                        <p:menuitem value="#{bonP.cloturer?'Déverrouiller':'Cloturer'}" icon="#{bonP.cloturer?'ui-icon-unlocked':'ui-icon-locked'}" 
                                                    actionListener="#{managedClotureCommercial.actionOnFacture(bonP)}" update=":main-cloture_com:data-facture_cloture_by_point"/>
                                        <p:menuitem icon="ui-icon-carat-2-e-w" value="#{lab.LC_PJV_equilibrer_statut}" actionListener="#{managedClotureCommercial.equilibreVente(bonP)}"/>
                                    </p:contextMenu>                           
                                    <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option-facture_cloture_by_point" type="button"/>
                                </p:column>
                            </p:dataTable>
                        </div>  
                        <div class="zone_bottom">
                            <h:panelGroup id="blog-footer_facture_header" style="font-size: 0.9em">
                                <h:outputText value="#{lab.LC_PCC_facture} " style="font-weight: bold"/>(
                                <h:outputText value="#{lab.LC_PCC_ca} : "/> <h:outputText value="#{managedClotureCommercial.header.totalFact}" converter="DNA" style="font-weight: bold"/><span style="font-size: 0.8em"> Fcfa... </span>
                                <span style="font-style: italic"><h:outputText value="#{lab.LC_PCC_reglement} : "/> <h:outputText value="#{managedClotureCommercial.header.avanceFact}" converter="DNA" style="font-weight: bold"/><span style="font-size: 0.8em"> Fcfa.</span></span>)<p:spacer width="15"/>
                                <h:outputText value="#{lab.LC_PCC_commande} " style="font-weight: bold"/>(
                                <h:outputText value="#{lab.LC_PCC_ca} : "/> <h:outputText value="#{managedClotureCommercial.header.totalCmde}" converter="DNA" style="font-weight: bold"/><span style="font-size: 0.8em"> Fcfa... </span> 
                                <span style="font-style: italic"><h:outputText value="#{lab.LC_PCC_avance} : "/> <h:outputText value="#{managedClotureCommercial.header.avanceCmde}" converter="DNA" style="font-weight: bold"/><span style="font-size: 0.8em"> Fcfa... </span></span>)
                                <h:panelGroup style="float: right">
                                    <h:outputText value="#{lab.LC_PCC_versement} " style="font-weight: bold"/>(
                                    <h:outputText value="#{lab.LC_PCC_attendu} : "/> <h:outputText value="#{managedClotureCommercial.header.versementAttendu}" converter="DNA" style="font-weight: bold"/><span style="font-size: 0.8em"> Fcfa... </span>
                                    <h:outputText value="#{lab.LC_PCC_reel} : "/> <h:outputText value="#{managedClotureCommercial.header.versementReel}" converter="DNA" style="font-weight: bold"/><span style="font-size: 0.8em"> Fcfa... </span>) 
                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                    </div> <br/>
                    <p:dataGrid value="#{managedClotureCommercial.caisses}" var="caisP" columns="#{managedClotureCommercial.caisses.size()>5?5:managedClotureCommercial.caisses.size()}">
                        <f:facet name="header">
                            Solde des caisses
                        </f:facet>
                        <p:panelGrid columns="2" style="width: 100%">
                            <f:facet name="header">
                                <h:outputText value="#{caisP.intitule}"/>
                            </f:facet>
                            <h:outputText value="#{lab.LC_PCC_solde}" style="font-weight: bold"/>
                            <h:outputText value="#{managedClotureCommercial.abs(caisP.solde)}" converter="DNA" style="color: #{caisP.solde lt 0?'red':'black'};float: right"/>
                            <h:outputText value="#{lab.LC_PCC_recette}" style="font-weight: bold"/>
                            <h:outputText value="#{caisP.versement}" converter="DNA" style="color: black;float: right"/>
                            <h:outputText value="#{lab.LC_PCC_versement}" style="font-weight: bold"/>
                            <h:outputText value="#{caisP.virement}" converter="DNA" style="color: black;float: right"/>
                            <h:outputText value="#{lab.LC_PCC_ecart}" style="font-weight: bold"/>
                            <h:outputText value="#{managedClotureCommercial.abs(caisP.ecart)}" converter="DNA" style="color: #{caisP.ecart lt 0?'red':'black'};float: right"/>
                        </p:panelGrid>
                    </p:dataGrid>
                </p:outputPanel>
                <div style="clear: both"/>
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" >                 
            <div class="zone_find">
                <div id="zone_search_cloture_com">
                    <h:panelGrid columns="2" style="width: 100%" cellpadding="0" cellspacing="0">
                        <h:panelGrid columns="5" cellpadding="0" cellspacing="0">
                            <h:outputText value="#{lab.L_dates}"/>
                            <h:outputText value="#{lab.L_point_vente}"/>
                            <h:outputText value="#{lab.LC_PCC_vendeur}"/>
                            <h:outputText value="#{lab.L_cloturer}"/>
                            <h:outputText value=""/>
                            <h:panelGroup>
                                <p:calendar value="#{managedClotureCommercial.dateDebut}" navigator="true" pattern="dd-MM-yyyy" size="10">
                                    <p:ajax event="valueChange" oncomplete="collapseList('cloture_com')"/>
                                </p:calendar>
                                <p:calendar value="#{managedClotureCommercial.dateFin}" navigator="true" pattern="dd-MM-yyyy" size="10">
                                    <p:ajax event="valueChange" oncomplete="collapseList('cloture_com')"/>
                                </p:calendar>
                            </h:panelGroup>
                            <h:selectOneMenu value="#{managedClotureCommercial.point}">
                                <f:selectItem itemLabel="--" itemValue="#{0}"/>
                                <f:selectItems value="#{managedClotureCommercial.points}" var="pt" itemLabel="#{pt.libelle}" itemValue="#{pt.id}"/>
                                <p:ajax event="valueChange" global="false" listener="#{managedClotureCommercial.addParamPoint()}" oncomplete="collapseList('cloture_com')"/>
                            </h:selectOneMenu>  
                            <h:selectOneMenu value="#{managedClotureCommercial.vendeur}">
                                <f:selectItem itemLabel="--" itemValue="#{0}"/>
                                <f:selectItems value="#{managedClotureCommercial.vendeurs}" var="vd" itemLabel="#{vd.nomUsers}" itemValue="#{vd.id}"/>
                                <p:ajax event="valueChange" global="false" listener="#{managedClotureCommercial.addParamVendeur()}" oncomplete="collapseList('cloture_com')"/>
                            </h:selectOneMenu>  
                            <h:selectOneMenu value="#{managedClotureCommercial.cloturer}">
                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                <f:selectItem itemLabel="#{lab.L_oui}" itemValue="#{true}"/>
                                <f:selectItem itemLabel="#{lab.L_non}" itemValue="#{false}"/>
                                <p:ajax event="valueChange" global="false" listener="#{managedClotureCommercial.addParamCloture()}" oncomplete="collapseList('cloture_com')"/>
                            </h:selectOneMenu>  
                            <p:commandButton value="#{lab.L_charger}" actionListener="#{managedClotureCommercial.loadData()}" oncomplete="_slideShow('zone_show_header_cloture_com')"
                                             update=":main-cloture_com:blog-cloture_by_point txt-ca_header_cloture_com" icon="ui-icon-refresh"/>
                        </h:panelGrid>
                        <h:panelGrid columns="2" cellpadding="0" cellspacing="0" style="float: right;font-size: 1.2em" rendered="false">
                            <h:outputText value="#{lab.LC_PCC_chiffre_affaire_periode} : "/>
                            <h:panelGroup>
                                <h:outputText id="txt-ca_header_cloture_com" value="#{managedClotureCommercial.cas}" converter="DN" style="font-weight: bold"/>
                                <span> Fcfa</span>
                            </h:panelGroup>
                        </h:panelGrid>
                    </h:panelGrid>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
