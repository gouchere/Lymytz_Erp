<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Paramétrage des Objectifs de vente','modGescom', 'smenparamObjectif', true,managedObjectifVente)}
    </ui:define> 
    <ui:define name="contents">
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 140);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('objectif_vente');
            });
        </script>
        #{managedAgence.addParamActifAgence(true)}
        #{managedObjectifVente.loadAllModeleObjectif(true, true)}
        #{managedCommerciaux.addParamActif(true)}
        #{managedPointVente.addParamActif(true)}   
        #{managedPeriodeObjectif.loadAllPeriodeObjectif(true)}
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDelModel" closeOnEscape="true"
                             message="#{lab.LC_POV_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedObjectifVente.deleteLineObjectif()}" oncomplete="dlgDelModel.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgDelModel.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDelPeriode" closeOnEscape="true"
                             message="#{lab.LC_POV_text2}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedPeriodeObjectif.deleteLinePeriode()}" oncomplete="dlgDelPeriode.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgDelPeriode.hide()"/>
            </p:confirmDialog>
        </h:form>
        
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDelete_" closeOnEscape="true"
                             message="#{lab.LC_POV_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedObjectifVente.deleteBean_()}" oncomplete="dlgDelete_.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgDelete_.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgCibleModel" closeOnEscape="true"
                             message="#{lab.LC_PCM_text4}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedObjectifVente.deleteLineCibleObjectif()}" oncomplete="dlgCibleModel.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgCibleModel.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false" id="form_periode_objectif">
            <p:dialog width="50%" widgetVar="dlgGesPeriode"  header="#{lab.LC_POV_gestion_periodes}"
                      footer="&copy;Lymytz 2014" modal="true">
                <h:panelGrid columns="2" cellpadding="0" cellspacing="0" styleClass="yvs_table" id="form_main_period_objectifV" 
                             style="width: 100%; background: #FFF">
                    <f:facet name="header">
                        <div align="left">
                            <p:selectBooleanCheckbox value="#{managedPeriodeObjectif.periode.periodMonth}" label="Période mensuelle"
                                                     style="float: left;margin-left: 5px;margin-top: 7.5px">
                                <p:ajax global="false" update="zone_pe_ref_obj" />
                            </p:selectBooleanCheckbox>
                            <p:spacer width="20" />
                            <span>#{lab.L_debut}</span>
                            <p:calendar size="8" pattern="dd-MM-yyyy" navigator="true" value="#{managedPeriodeObjectif.periode.debut}" />                    
                            <span>#{lab.L_fin}</span>
                            <p:calendar size="8" pattern="dd-MM-yyyy" navigator="true" value="#{managedPeriodeObjectif.periode.fin}" />                             
                            <h:inputText id="zone_pe_ref_obj" value="#{managedPeriodeObjectif.periode.reference}" disabled="#{managedPeriodeObjectif.periode.periodMonth}" style="width: 150px" title="Définir une référence"/>
                            <p:commandButton value="Enreg." icon="ui-icon-circle-check" actionListener="#{managedPeriodeObjectif.saveNew()}" style="float: right"/>
                        </div>
                    </f:facet>                        
                </h:panelGrid>
                <p:dataTable value="#{managedPeriodeObjectif.periodes}" var="ipe" rowKey="#{ipe.id}" rowIndexVar="line_pe"
                             id="table_periodes_objectifVente" selection="#{managedPeriodeObjectif.selectedPeriode}" selectionMode="single">                    
                    <p:ajax event="rowSelect" listener="#{managedPeriodeObjectif.loadOnView}" process="@this"
                            />
                    <p:column  headerText="N°" width="15"> 
                        #{line_pe+1}
                    </p:column>
                    <p:column headerText="#{lab.L_reference} " width="100">
                        <h:outputText value="#{ipe.codeRef}"/>
                    </p:column>
                    <p:column headerText="#{lab.LC_POV_periodes}" >
                        <h:outputText value="#{ipe.dateDebut}" converter="DATE"/>
                        <p:spacer style="background: black;margin-left: 5px;margin-right: 5px" width="5"/>
                        <h:outputText value="#{ipe.dateFin}" converter="DATE"/>
                    </p:column>                                                                            
                    <p:column headerText="" width="15" style="text-align: center">
                        <p:contextMenu styleClass="context_menu" for="btn_ico_opt_period_obj" event="left click">
                            <p:menuitem icon="ui-icon-arrowthickstop-1-s" value="#{lab.LC_POV_selectionner}" process="@this" update="table_periodes_objectifVente"/>
                            <p:menuitem icon="ui-icon-trash" value="#{lab.L_supprimer}" actionListener="#{managedPeriodeObjectif.selectToDelete(ipe)}" process="@this"
                                        update="table_periodes_objectifVente"/>
                        </p:contextMenu>
                        <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_ico_opt_period_obj"/>
                    </p:column>                                                                            
                </p:dataTable> 
                <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                    <p:commandButton actionListener="#{managedPeriodeObjectif.loadAllPeriodeObjectif(false,true)}" global="false" update="table_periodes_objectifVente" icon="ui-icon-circle-triangle-w" disabled="#{managedPeriodeObjectif.paginator.disPrev}"/>
                    <p:outputPanel ><p:outputLabel value="#{managedPeriodeObjectif.currentPage}/#{managedPeriodeObjectif.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedPeriodeObjectif.loadAllPeriodeObjectif(true, true)}" global="false" update="table_periodes_objectifVente" icon="ui-icon-circle-triangle-e" disabled="#{managedPeriodeObjectif.paginator.disNext}"/>
                    <p:selectOneMenu value="#{managedPeriodeObjectif.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedPeriodeObjectif.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                        <f:selectItems value="#{managedPeriodeObjectif.paginations}"/>
                        <p:ajax event="valueChange" global="false" update="table_periodes_objectifVente"/>
                    </p:selectOneMenu>
                </p:outputPanel>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="form_attrib_objectif">
            <p:dialog width="70%" widgetVar="dlgAttribObj"  header="#{lab.LC_POV_attribuer_objectifs}"
                      footer="&copy;Lymytz 2014">
                <h:panelGrid id="zone_attrib_obj" columns="6" styleClass="yvs_table" cellpadding="0" cellspacing="0" style="width: 100%">
                    <f:facet name="header">
                        <div align="left">
                            <span style="float: left;margin-left: 10px;margin-top: 5px;font-weight: normal">
                                [<span style="color: #003333;font-weight: bold">#{managedObjectifVente.selectModel.codeRef}</span>]
                                <span style="color: #003333;font-weight: bold">#{managedObjectifVente.selectModel.description}</span>
                            </span>
                            <div style="float: right">
                                <span>#{lab.LC_POV_source} </span>
                                <h:selectOneMenu value="#{managedObjectifVente.objectif.source}">
                                    <f:selectItem itemValue="C" itemLabel="#{lab.LC_POV_commercials}" />
                                    <f:selectItem itemValue="A" itemLabel="#{lab.L_agence}" />
                                    <f:selectItem itemValue="P" itemLabel="#{lab.LC_POV_point_vente}" />
                                    <p:ajax event="valueChange" update="zone_attrib_obj table_objects_objectif" listener="#{managedObjectifVente.loadDataAttribObjectif()}"/>
                                </h:selectOneMenu>
                            </div>
                        </div>
                    </f:facet>
                    <span>#{managedObjectifVente.objectif.source eq 'C'?'Commercial':(managedObjectifVente.objectif.source eq 'A'?'Agence':'Point Vente')}</span>
                    <h:panelGroup id="blog_objects_objectif">
                        <h:inputText value="#{managedObjectifVente.selectedObjectif.commercial.nom_prenom}" disabled="true" rendered="#{managedObjectifVente.objectif.source eq 'C'}"/>
                        <h:inputText value="#{managedObjectifVente.selectedObjAgence.agence.designation}" disabled="true" rendered="#{managedObjectifVente.objectif.source eq 'A'}"/>
                        <h:inputText value="#{managedObjectifVente.selectedObjPoint.pointVente.libelle}" disabled="true" rendered="#{managedObjectifVente.objectif.source eq 'P'}"/>
                    </h:panelGroup>
                    <span>#{lab.LC_POV_periode}</span>
                    <h:selectOneMenu value="#{managedObjectifVente.objectif.periode.id}" 
                                     valueChangeListener="#{managedObjectifVente.choosPeriodesObjectif}">
                        <f:selectItem itemValue="0" itemLabel="" />
                        <f:selectItems value="#{managedPeriodeObjectif.periodes}" var="pe_" itemValue="#{pe_.id}" itemLabel="#{pe_.codeRef}" />
                        <f:selectItem itemValue="0" itemLabel="-" />
                        <f:selectItem itemValue="-1" itemLabel="#{lab.L_creer}" />
                        <p:ajax event="valueChange" update="table_objects_objectif" />
                    </h:selectOneMenu>
                    <h:inputText value="#{managedObjectifVente.objectif.montantObjectif}" />
                    <p:commandButton value="#{lab.L_appliquer}" icon="ui-icon-circle-check" actionListener="#{managedObjectifVente.saveNewObjectifCom()}"/> 
                </h:panelGrid>
                <p:outputPanel id="table_objects_objectif">
                    <p:dataTable value="#{managedObjectifVente.modelObjectif.objectifsPeriodes}" var="iobjC" rowKey="#{iobjC.id}" rowIndexVar="line_com"
                                 id="table_commerciaux_objectif" selection="#{managedObjectifVente.selectedObjectif}" selectionMode="single"
                                 rendered="#{managedObjectifVente.objectif.source eq 'C'}">                    
                        <p:ajax event="rowSelect" listener="#{managedObjectifVente.selectLineObjCom}" />
                        <p:column  headerText="N°" width="15">
                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{iobjC.new_}"/>
                            #{line_com+1}
                        </p:column>
                        <p:column headerText="#{lab.L_code}" width="100">
                            <h:outputText value="#{iobjC.commercial.codeRef}"/>
                        </p:column>
                        <p:column headerText="#{lab.L_designation}" >
                            <h:outputText value="#{iobjC.commercial.nom_prenom}"/>
                        </p:column>                                                        
                        <p:column headerText="#{lab.L_agence}" style="text-align: center" width="100">
                            <h:outputText value="#{iobjC.commercial.agence.designation}"/>
                        </p:column>                            
                        <p:column headerText="#{lab.LC_POV_montant}" style="text-align: right" width="100" styleClass="#{(iobjC.valeur gt 0)?'line_actiftrue':'_'}">
                            <h:outputText value="#{iobjC.valeur}" converter="#{managedObjectifVente.converter}"/>
                        </p:column> 
                    </p:dataTable>
                    <p:dataTable value="#{managedObjectifVente.modelObjectif.objectifsPeriodesPoint}" var="iobjP" rowKey="#{iobjP.id}" rowIndexVar="line_com"
                                 id="table_points_vente_objectif" selection="#{managedObjectifVente.selectedObjPoint}" selectionMode="single"
                                 rendered="#{managedObjectifVente.objectif.source eq 'P'}">                    
                        <p:ajax event="rowSelect" listener="#{managedObjectifVente.selectLineObjPoint}" />
                        <p:column  headerText="N°" width="15">
                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{iobjP.new_}"/>
                            #{line_com+1}
                        </p:column>
                        <p:column headerText="#{lab.L_code}" width="100">
                            <h:outputText value="#{iobjP.pointVente.code}"/>
                        </p:column>
                        <p:column headerText="#{lab.L_designation}" >
                            <h:outputText value="#{iobjP.pointVente.libelle}"/>
                        </p:column>                                                        
                        <p:column headerText="#{lab.L_agence}" style="text-align: center" width="100">
                            <h:outputText value="#{iobjP.pointVente.agence.designation}"/>
                        </p:column>                            
                        <p:column headerText="#{lab.LC_POV_montant}" style="text-align: right" width="100" styleClass="#{(iobjP.valeur gt 0)?'line_actiftrue':'_'}">
                            <h:outputText value="#{iobjP.valeur}" converter="#{managedObjectifVente.converter}"/>
                        </p:column> 
                    </p:dataTable>
                    <p:dataTable value="#{managedObjectifVente.modelObjectif.objectifsPeriodesAgs}" var="iobjA" rowKey="#{iobjA.id}" rowIndexVar="line_com"
                                 id="table_agences_objectif" selection="#{managedObjectifVente.selectedObjAgence}" selectionMode="single"
                                 rendered="#{managedObjectifVente.objectif.source eq 'A'}">                    
                        <p:ajax event="rowSelect" listener="#{managedObjectifVente.selectLineObjAgs}" />
                        <p:column  headerText="N°" width="15">
                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{iobjA.new_}"/>
                            #{line_com+1}
                        </p:column>
                        <p:column headerText="#{lab.L_code}" width="100">
                            <h:outputText value="#{iobjA.agence.codeagence}"/>
                        </p:column>
                        <p:column headerText="#{lab.L_designation}" >
                            <h:outputText value="#{iobjA.agence.designation}"/>
                        </p:column>                                                        
                        <p:column headerText="#{lab.L_adresse}" style="text-align: center" width="100">
                            <h:outputText value="#{iobjA.agence.adresse}"/>
                        </p:column>                            
                        <p:column headerText="#{lab.LC_POV_montant}" style="text-align: right" width="100" styleClass="#{(iobjA.valeur gt 0)?'line_actiftrue':'_'}">
                            <h:outputText value="#{iobjA.valeur}" converter="#{managedObjectifVente.converter}"/>
                        </p:column> 
                    </p:dataTable>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block" rendered="#{managedObjectifVente.objectif.source eq 'C'}">
                        <p:commandButton icon="ui-icon-bullet" style="width: 22px; height: 22px" actionListener="#{managedCommerciaux.removeParamCode()}" update="table_commerciaux_objectif"/>
                        <p:commandButton actionListener="#{managedObjectifVente.pagineDataObjAttrib(false)}" global="false" update="table_commerciaux_objectif" icon="ui-icon-circle-triangle-w" disabled="#{managedCommerciaux.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedCommerciaux.paginator.currentPage}/#{managedCommerciaux.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedObjectifVente.pagineDataObjAttrib(true)}" global="false" update="table_commerciaux_objectif" icon="ui-icon-circle-triangle-e" disabled="#{managedCommerciaux.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedCommerciaux.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedCommerciaux.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{managedCommerciaux.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="table_commerciaux_objectif"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block" rendered="#{managedObjectifVente.objectif.source eq 'P'}">
                        <p:commandButton actionListener="#{managedObjectifVente.pagineDataObjAttrib(false)}" global="false" update="table_points_vente_objectif" icon="ui-icon-circle-triangle-w" disabled="#{managedPointVente.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedPointVente.paginator.currentPage}/#{managedPointVente.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedObjectifVente.pagineDataObjAttrib(true)}" global="false" update="table_points_vente_objectif" icon="ui-icon-circle-triangle-e" disabled="#{managedPointVente.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedPointVente.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedPointVente.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{managedPointVente.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="table_points_vente_objectif"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block" rendered="#{managedObjectifVente.objectif.source eq 'A'}">
                        <p:commandButton actionListener="#{managedObjectifVente.pagineDataObjAttrib(false)}" global="false" update="table_agences_objectif" icon="ui-icon-circle-triangle-w" disabled="#{managedAgence.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedAgence.paginator.currentPage}/#{managedAgence.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedObjectifVente.pagineDataObjAttrib(true)}" global="false" update="table_agences_objectif" icon="ui-icon-circle-triangle-e" disabled="#{managedAgence.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedAgence.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedAgence.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{managedAgence.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="table_agences_objectif"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </p:outputPanel>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.LC_POV_liste_articles}" widgetVar="dlgListArticle" modal="true" width="70%" height="450" closeOnEscape="true"> 
                <p:watermark for="txt_search_article_objectif_v" value="#{lab.LC_POV_reference_article}..." />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_article_objectif_v" value="#{Marticle.searchArticle}">
                        <p:ajax event="valueChange" global="false" listener="#{Marticle.findArticleActif(Marticle.searchArticle, false)}" update="data_articles_objectifs_vente"/>
                    </h:inputText> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{Marticle.loadAllArticle(false, false)}" global="false" update="data_articles_objectifs_vente" icon="ui-icon-circle-triangle-w" disabled="#{Marticle.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{Marticle.currentPage}/#{Marticle.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{Marticle.loadAllArticle(true, false)}" global="false" update="data_articles_objectifs_vente" icon="ui-icon-circle-triangle-e" disabled="#{Marticle.paginator.disNext}"/>
                        <p:selectOneMenu value="#{Marticle.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{Marticle.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{Marticle.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_articles_objectifs_vente"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </h:panelGrid>
                <p:dataTable id="data_articles_objectifs_vente" value="#{Marticle.listArticle}" var="art" rowKey="#{art.id}"
                             selectionMode="single" rowIndexVar="line_art" scrollable="true" scrollHeight="385">
                    <p:ajax event="rowSelect" global="false" listener="#{managedObjectifVente.selectOneLineArticle}" oncomplete="dlgListArticle.hide()"
                            update=":main_page_param_objectifs:zone_obj_cible_art"/>
                    <p:column headerText="N°" width="20" style="text-align: center">
                        <span title="#{art.designation}">#{line_art+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_reference}" width="80">
                        <span title="#{art.designation}">#{art.refArt}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_designation}" width="150">
                        <span title="#{art.designation}">#{art.designation}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_categorie}" width="80">
                        <span title="#{art.designation}">#{art.categorie}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_POV_prix_a}" width="50" style="text-align: right">
                        <h:outputText value="#{art.pua}" title="#{art.designation}" converter="DN" />
                    </p:column>
                    <p:column headerText="#{lab.LC_POV_prix_v}" width="50" style="text-align: right">
                        <h:outputText value="#{art.puv}" title="#{art.designation}" converter="DN" />
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.LC_POV_liste_villes_secteurs}" widgetVar="dlgListZone" modal="true" width="70%" height="450" closeOnEscape="true"> 
                <p:watermark for="txt_search_zone_objectif_v" value="#{lab.LC_POV_reference_zone}..." />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_zone_objectif_v" value="#{Mdico.search}">
                        <p:ajax event="valueChange" global="false" listener="#{Mdico.findZoneActif(null,Mdico.search, false)}" update="data_zone_objectifs_vente"/>
                    </h:inputText> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{Mdico.loadAllDicoActif(false, false)}" global="false" update="data_zone_objectifs_vente" icon="ui-icon-circle-triangle-w" disabled="#{Mdico.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{Mdico.paginator.currentPage}/#{Mdico.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{Mdico.loadAllDicoActif(true, false)}" global="false" update="data_zone_objectifs_vente" icon="ui-icon-circle-triangle-e" disabled="#{Mdico.paginator.disNext}"/>
                        <p:selectOneMenu value="#{Mdico.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{Mdico._choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{Mdico.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_zone_objectifs_vente"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </h:panelGrid>
                <p:dataTable id="data_zone_objectifs_vente" value="#{Mdico.dictionnaires}" var="idico" rowKey="#{idico.id}"
                             selectionMode="single" rowIndexVar="line_dico"  >
                    <p:ajax event="rowSelect" global="false" listener="#{managedObjectifVente.selectOneLineDico}" oncomplete="dlgListZone.hide()"
                            update=":main_page_param_objectifs:zone_obj_cible_zone"/>
                    <p:column headerText="N°" width="20"  style="text-align: center">
                        <span>#{line_dico+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_POV_abbreviation}" width="100">
                        <span>#{idico.abreviation}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_libelle}" >
                        <span>#{idico.libele}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_POV_titres}" width="80">
                        <span>#{idico.titre}</span>
                    </p:column>
                    <p:column headerText=" "   style="text-align: right">
                        <h:outputText value="#{idico.parent.libele}" />
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>
        <h:form prependId="false">                    
            <p:dialog header="#{lab.LC_POV_liste_clients}" widgetVar="dlgListClients" closeOnEscape="true" width="50%" height="450" modal="true" dynamic="true">   
                <p:watermark for="txt_search_client_objectifs_vente" value="#{lab.LC_POV_code_client}..." />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_client_objectifs_vente" value="#{managedClient.numSearch_}" style="float: left;text-align: center;margin-left: -10px">
                        <p:ajax event="valueChange" global="false" listener="#{managedClient.searchByNum()}" update="data_client_objectifs_vente"/>
                    </h:inputText>   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedClient.init(false)}" global="false" update="data_client_objectifs_vente" icon="ui-icon-circle-triangle-w" disabled="#{managedClient.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedClient.paginator.currentPage}/#{managedClient.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedClient.init(true)}" global="false" update="data_client_objectifs_vente" icon="ui-icon-circle-triangle-e" disabled="#{managedClient.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedClient.max}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedClient.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedClient.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_client_objectifs_vente"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </h:panelGrid>                               
                <p:dataTable id="data_client_objectifs_vente"  value="#{managedClient.clients}" var="clt_" rowKey="#{clt_.id}"
                             selectionMode="single" rowIndexVar="cltIdx" scrollable="true" scrollHeight="385">
                    <p:ajax event="rowSelect" global="false" listener="#{managedObjectifVente.selectOneLineClient}" oncomplete="dlgListClients.hide()"/>
                    <p:column headerText="N°" style="width: 10%;text-align: center">
                        <span>#{cltIdx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_code}" style="width: 20%">
                        <span>#{clt_.codeClient}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_POV_nom}">
                        <span>#{clt_.nom_prenom}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_POV_zone}">
                        <span>#{clt_.tiers.region}</span>
                    </p:column>
                </p:dataTable> 
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main_page_param_objectifs">
            <div class="part_fix">
                <p:splitButton value="#{lab.L_enregistrer}" id="save_objectif_vente" actionListener="#{managedObjectifVente.saveNew()}"  
                               update="form_main_objectif_vente" icon="ui-icon-disk">
                    <p:menuitem value="#{lab.L_nouveau}"  id="cancel_objectif_vente" actionListener="#{managedObjectifVente.resetFiche()}" 
                                process="@this" icon="ui-icon-document"/> 
                    <p:separator />
                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" onclick="dlgDelete_.show()" />   
                </p:splitButton>

                <!-->Un champ caché pour gérer la mise à zero du formulaire<-->
                <h:inputHidden value="#{managedObjectifVente.tabIds}" id="input_hide_objectif_vente" />
                <p:commandButton value="#{lab.L_supprimer}" id="delete_objectif_vente" icon="ui-icon-trash" global="false" onclick="dlgDelete_.show()" />                  
                <h:panelGroup style="margin-left: 25%">                    
                    <p:commandButton actionListener="#{managedObjectifVente.parcoursInAllResult(false)}" update="txt_parc_linear_objectif_vente table_model_objectifVente" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('objectif_vente')"/>
                    <h:inputText value="#{managedObjectifVente.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_parc_linear_objectif_vente"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedObjectifVente.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedObjectifVente.parcoursInAllResult(true)}" update="txt_parc_linear_objectif_vente table_model_objectifVente" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('objectif_vente')"/>
                </h:panelGroup>
                <div style="float: right">
                    <p:spacer width="10"/>
                    <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('objectif_vente');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link onclick="collapseList('objectif_vente');
                            return false" title="#{lab.L_mode_liste}" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>
                </div>
            </div>
            <div class="part_scroll">
                <div class="yvs_form_objectif_vente">
                    <h:panelGrid columns="1" styleClass="yvs_table" cellpadding="0" cellspacing="0" style="width: 100%"
                                 id="form_main_objectif_vente">
                        <f:facet name="header">
                            <div align="left">
                                <span>#{lab.LC_POV_indicateurs}</span>
                                <h:selectOneMenu value="#{modelObjectif.indicateur}">
                                    <f:selectItems value="#{constantes.INDICATEURS_QUANTITATIF}" />
                                </h:selectOneMenu>
                                <span>#{lab.LC_POV_titre_gen}.</span>
                                <h:inputText value="#{modelObjectif.titre}" />
                                <span>#{lab.LC_POV_code_id}.</span>
                                <h:inputText value="#{modelObjectif.codeid}" />
                                <span>#{lab.L_actif}.</span>
                                <h:selectBooleanCheckbox value="#{modelObjectif.actif}" />
                                <p:commandButton actionListener="#{managedObjectifVente.openDlgToAttribObj(managedObjectifVente.selectModel)}" icon="ui-icon-arrowthick-2-n-s" title="Attribuer cet objectif" style="width: 22px; height: 22px; float: right; margin-right: 1%"/>
                            </div>
                        </f:facet>
                        <span style="font-weight: bold">Cible d'objectif</span>
                        <h:panelGrid columns="1" styleClass="yvs_nostyle"  style="width: 100%">                           
                            <h:panelGrid columns="2" styleClass="yvs_nostyle"  style="width: 100%; font-size: 0.8em" id="zone_obj_cible_art">                                 
                                <f:facet name="header">
                                    <div align="left">
                                        <span> #{lab.LC_POV_articles}</span>
                                        <h:selectBooleanCheckbox value="#{managedObjectifVente.cible.activeCibleArticle}" >
                                            <p:ajax event="valueChange" update="txt_objectif_cible_art" />
                                        </h:selectBooleanCheckbox>
                                        <h:panelGroup id="txt_objectif_cible_art">
                                            <h:inputText value="#{managedObjectifVente.cible.article.refArt}" title="#{lab.LC_PCM_reference_article}" disabled="#{!managedObjectifVente.cible.activeCibleArticle}" style="color: #{managedObjectifVente0.cible.article.error?'red':''};"  tabindex="10">
                                                <p:ajax event="valueChange" global="false" listener="#{managedObjectifVente.searchArticle(managedObjectifVente.cible.article.refArt)}" />
                                            </h:inputText> 
                                            <span>#{managedObjectifVente.cible.article.designation}</span>
                                            <h:selectOneMenu value="#{managedObjectifVente.cible.unite.id}" disabled="#{!managedObjectifVente.cible.activeCibleArticle}">
                                                <f:selectItem itemValue="#{0}" itemLabel="--" />
                                                <f:selectItems value="#{managedObjectifVente.cible.article.conditionnements}" var="ca"
                                                               itemValue="#{ca.id}" itemLabel="#{ca.unite.reference}" />
                                                <p:ajax event="valueChange" global="false"/>
                                            </h:selectOneMenu>
                                        </h:panelGroup>
                                        <p:commandButton icon="ui-icon-circle-plus" title="#{lab.LC_POV_ajouter_cible}" style="width: 22px; height: 22px" actionListener="#{managedObjectifVente.saveCibleArticle()}" />
                                    </div>
                                </f:facet>             
                            </h:panelGrid>
                            <h:panelGrid columns="2" styleClass="yvs_nostyle"  style="width: 100%; font-size: 0.8em" id="zone_obj_cible_zone">                                 
                                <f:facet name="header">
                                    <div align="left">
                                        <span> #{lab.LC_POV_zone}</span>
                                        <h:selectBooleanCheckbox value="#{managedObjectifVente.cible.activeCibleZone}" >
                                            <p:ajax event="valueChange" update="txt_objectif_cible_zone" />
                                        </h:selectBooleanCheckbox>
                                        <h:panelGroup id="txt_objectif_cible_zone">
                                            <h:selectOneMenu value="#{managedObjectifVente.cible.zone.titre}" disabled="#{!managedObjectifVente.cible.activeCibleZone}">
                                                <f:selectItem itemValue="#{constantes.t_PAYS}" itemLabel="#{constantes.t_PAYS}" />
                                                <f:selectItem itemValue="#{constantes.t_VILLES}" itemLabel="#{constantes.t_VILLES}" />
                                                <f:selectItem itemValue="#{constantes.t_SECTEURS}" itemLabel="#{constantes.t_SECTEURS}" />
                                                <p:ajax event="valueChange" global="false"/>
                                            </h:selectOneMenu>
                                            <h:inputText  value="#{managedObjectifVente.cible.zone.abreviation}"   disabled="#{!managedObjectifVente.cible.activeCibleZone}" style="color: #{managedObjectifVente.cible.zone.error?'red':''};"  tabindex="20">
                                                <p:ajax event="valueChange" global="false" listener="#{managedObjectifVente.searchZone(managedObjectifVente.cible.zone.titre, managedObjectifVente.cible.zone.abreviation)}" update=":main_page_param_objectifs:zone_obj_cible_zone"/>
                                            </h:inputText>
                                        </h:panelGroup>
                                        <span>#{managedObjectifVente.cible.zone.libelle}</span>
                                        <p:commandButton icon="ui-icon-circle-plus" title="#{lab.LC_PCM_ajouter_cible}" style="width: 22px; height: 22px" actionListener="#{managedObjectifVente.saveCibleObjectif(constantes.SCR_DICTIONNAIRE , managedObjectifVente.cible.zone.id)}" />
                                    </div>
                                </f:facet>  
                            </h:panelGrid>
                            <h:panelGrid columns="2" styleClass="yvs_nostyle"  style="width: 100%; font-size: 0.8em" id="zone_obj_cible_client">                                 
                                <f:facet name="header">
                                    <div align="left">
                                        <span> #{lab.LC_POV_clients}</span>
                                        <h:selectBooleanCheckbox value="#{managedObjectifVente.cible.activeCibleClient}" >
                                            <p:ajax event="valueChange" update="txt_objectif_cible_client" />
                                        </h:selectBooleanCheckbox>
                                        <h:inputText id="txt_objectif_cible_client" value="#{managedObjectifVente.cible.client.codeClient}" title="#{lab.LC_PCM_reference_article}" disabled="#{!managedObjectifVente.cible.activeCibleClient}">
                                            <p:ajax event="valueChange" global="false" listener="#{managedFactureVente.searchClient()}"  />
                                        </h:inputText>
                                        <span>#{managedObjectifVente.cible.client.nom_prenom}</span>
                                        <p:commandButton icon="ui-icon-circle-plus" title="#{lab.LC_PCM_ajouter_cible}" style="width: 22px; height: 22px" actionListener="#{managedObjectifVente.saveCibleObjectif(constantes.SCR_CLIENTS , managedObjectifVente.cible.client.id)}" />
                                    </div>
                                </f:facet>  
                            </h:panelGrid>
                            <f:facet name="footer">
                                <p:outputPanel id="table_cible_objectifs">
                                    <p:dataTable value="#{modelObjectif.ciblesObjectifs}"  var="icible" selectionMode="single"
                                                 rowKey="#{icible.id}" rowIndexVar="line_id" rendered="#{modelObjectif.ciblesObjectifs.size() gt 0}">
                                        <p:column headerText="N°" width="15"  style="text-align: center">
                                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{icible.new_}"/>                               
                                            #{line_id+1}
                                        </p:column>
                                        <p:column headerText="#{lab.LC_POV_cible}">
                                            #{icible.tableExterne}
                                        </p:column>
                                        <p:column headerText="#{lab.LC_POV_intitule_cible}">
                                            #{managedObjectifVente.giveLibelleCible(icible.tableExterne, icible.idExterne)}
                                        </p:column>
                                        <p:column headerText=" " width="15"  style="text-align: center">
                                            <p:contextMenu styleClass="context_menu" for="btn_action_cible_obj" event="left click">
                                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedObjectifVente.selectToDeleteCible(icible)}" />
                                            </p:contextMenu>
                                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" type="button" id="btn_action_cible_obj"/>
                                        </p:column>
                                    </p:dataTable>
                                </p:outputPanel>
                            </f:facet>
                        </h:panelGrid>
                    </h:panelGrid>
                </div>
                <div class="yvs_list_objectif_vente">
                    <p:dataTable value="#{managedObjectifVente.modelesObjectifs}" var="vobj" selectionMode="single" style="width: 100%"
                                 rowIndexVar="line" rowKey="#{vobj.id}" id="table_model_objectifVente" selection="#{managedObjectifVente.selectModel}">
                        <p:ajax event="rowSelect" listener="#{managedObjectifVente.loadOnView}" update=":main_page_param_objectifs:input_hide_objectif_vente"
                                oncomplete="collapseForm('objectif_vente')"/>
                        <p:column headerText="N°" width="15"  style="text-align: center">
                            #{line+1}
                        </p:column>
                        <p:column headerText="#{lab.LC_POV_indicateur}">
                            #{vobj.indicateur}
                        </p:column>
                        <p:column headerText="#{lab.LC_POV_code_ref}">
                            #{vobj.codeRef}
                        </p:column>
                        <p:column headerText="#{lab.L_libelle}">
                            #{vobj.description}
                        </p:column>
                        <p:column headerText="#{lab.L_description}">
                            <ui:repeat value="#{vobj.cibles}"  var="icible_"  
                                       rendered="#{vobj.cibles.size() gt 0}" varStatus="i">                                
                                <span style="font-size: 0.8em">#{managedObjectifVente.giveLibelleCible(icible_.tableExterne, icible_.idExterne)}<span style="display: #{(i.index lt (vobj.cibles.size()-1))?'inline':'none'}; font-size: 1.1em; font-weight: bold;">;</span></span>
                            </ui:repeat>
                        </p:column>
                        <p:column headerText="#{lab.L_actif}" width="20"  style="text-align: center">
                            <h:graphicImage library="img" name="#{vobj.actif?'vu.png':'vu_non.png'}" width="15" height="15" />
                        </p:column>
                        <p:column headerText=" " width="15"  style="text-align: center">
                            <p:contextMenu styleClass="context_menu" for="btn_action_modele_obj" event="left click">
                                <p:menuitem value="#{lab.L_attribuer}" icon="ui-icon-arrowthickstop-1-n" actionListener="#{managedObjectifVente.openDlgToAttribObj(vobj)}" />
                                <p:menuitem value="#{vobj.actif?'Désactiver':'Activer'}" icon="#{vobj.actif?'ui-icon-circle-close':'ui-icon-circle-check'}"
                                            actionListener="#{managedObjectifVente.activeObjectif(vobj)}" update="table_model_objectifVente"/>
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedObjectifVente.selectToDelete(vobj)}" />
                            </p:contextMenu>
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" type="button" id="btn_action_modele_obj"/>
                        </p:column>
                    </p:dataTable>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedObjectifVente.loadAllModeleObjectif(false)}" global="false" update="table_model_objectifVente" icon="ui-icon-circle-triangle-w" disabled="#{managedObjectifVente.paginator.disPrev}"/>
                        <p:outputPanel >
                            <p:inplace label="#{managedObjectifVente.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                <pe:inputNumber value="#{managedObjectifVente.paginator.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                    <p:ajax event="valueChange" listener="#{managedObjectifVente.gotoPagePaginator()}" update="table_model_objectifVente"/>
                                </pe:inputNumber>
                            </p:inplace><p:outputLabel value="/#{managedObjectifVente.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                        </p:outputPanel>
                        <p:commandButton actionListener="#{managedObjectifVente.loadAllModeleObjectif(true)}" global="false" update="table_model_objectifVente" icon="ui-icon-circle-triangle-e" disabled="#{managedObjectifVente.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedObjectifVente.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedObjectifVente.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedObjectifVente.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="table_model_objectifVente"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div>
            </div>
        </h:form>
    </ui:define> 
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>  
            <div class="zone_find">
                <div class="yvs_form_objectif_vente display_auteur" align="right" style="font-style: italic;">
                    <p:outputPanel autoUpdate="true">
                        <span style="float: left">#{lab.L_enregistrer_le} <h:outputText value="#{managedObjectifVente.selectModel.dateSave}" converter="LD" styleClass="valeur" style="font-weight: bold"/></span> 
                        <span>#{lab.L_modifier_le} <h:outputText value="#{managedObjectifVente.selectModel.dateUpdate}" converter="LD" styleClass="valeur" style="font-weight: bold"/></span>
                        <span>#{lab.L_par} <h:outputText value="#{managedObjectifVente.selectModel.author.users.nomUsers}"  styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <h:panelGrid columns="2" style="width: 100%; font-size: 0.8em;" cellpadding="0" cellspacing="0">
                    <h:panelGrid columns="8" style="float: left; font-size: 1.0em" cellpadding="0" cellspacing="0">

                    </h:panelGrid>

                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

