<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Epargnes','modMutuelle', 'smenEpargne', true,managedEpargne)}
    </ui:define>   
    <ui:define name="contents"> 
        #{managedMutualiste.loadActif(true)}  
        #{managedEpargne.loadAll()}
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 140);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('epargne');
            });
        </script>

        <h:form>
            <p:remoteCommand name="updateBeanCaisse_" actionListener="#{managedMutuelle.updateBeanCaisse()}"/>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmCreate" closeOnEscape="true"
                             message="#{lab.LM_PM_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" onclick="dlgConfirmCreate.hide()"  oncomplete="dlgAddExercice.show()" global="false"/>
                <p:commandButton type="button" value="#{lab.L_non}" onclick="dlgConfirmCreate.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDelEpargne" closeOnEscape="true" 
                             message="#{lab.LM_PEA_text1} " 
                             header="#{lab.L_supprimer}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedEpargne.deleteEpargne()}" oncomplete="dlgDelEpargne.hide()"  />
                <p:commandButton type="button" icon="ui-icon-circle-close" value="#{lab.L_non}" onclick="dlgDelEpargne.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgCancelEpargne" closeOnEscape="true" 
                             message="#{lab.LM_PEA_text2} #{operationCompte.id}" 
                             header="#{lab.LM_PEA_annulation}">
                <p:commandButton value="#{lab.L_oui}" icon="ui-icon-circle-check" actionListener="#{managedEpargne.deleteEpargne()}" oncomplete="dlgCancelEpargne.hide()"  />
                <p:commandButton type="button" icon="ui-icon-circle-close" value="#{lab.L_non}" onclick="dlgCancelEpargne.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.LDB_PEX_creation_exercice}" widgetVar="dlgAddExercice" 
                      width="25%" modal="true" closeOnEscape="true">
                <h:panelGrid columns="1" styleClass="yvs_table" style="width: 100%">
                    <h:panelGrid columns="2" styleClass="yvs_table" style="width: 98%;margin: auto"> 
                        <span>#{lab.L_reference} </span>  
                        <h:inputText value="#{exercice.reference}"/>
                        <span>#{lab.L_date_debut} </span> 
                        <p:calendar value="#{exercice.dateDebut}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_date_fin} </span>
                        <p:calendar value="#{exercice.dateFin}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_actif} </span>
                        <h:selectBooleanCheckbox value="#{exercice.actif}"/>
                    </h:panelGrid>
                    <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedExercice.saveNew()}"
                                     oncomplete="dlgAddExercice.hide()" style="width: 100%"/> 
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form> 
        <h:form prependId="false">
            <p:dialog showHeader="false" widgetVar="dlgSetMontant" 
                      width="25%" modal="true" closeOnEscape="true" resizable="false">
                <h:panelGrid columns="3" styleClass="yvs_nostyle" style="width: 100%">
                    <span>#{lab.L_montant}</span>
                    <pe:inputNumber value="#{operationCompte.montant}" decimalPlaces="0" 
                                    style="width: 100px"/>
                    <p:commandButton value="#{lab.L_enregistrer}" icon="ui-icon-disk"
                                     actionListener="#{managedEpargne.saveNew()}"
                                     oncomplete="dlgSetMontant.hide()" /> 
                </h:panelGrid>
            </p:dialog>
        </h:form> 

        <!-->
        *****************************************************************************
        Boite de dialogue des mutualistes 
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="main_mut_epa">
            <p:dialog header="#{lab.LM_PM_liste_mutualistes}" widgetVar="dlgListMutualistes" modal="true" width="70%" 
                      height="500" closeOnEscape="true">  
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:panelGroup>
                        <h:inputText value="#{managedMutualiste.numSearch}" >
                            <p:ajax event="keyup" listener="#{managedMutualiste.addParamReference()}" update="data_mutualiste_epa :main_epargne:data_mutualiste_actuel_ep"/>
                        </h:inputText>
                    </h:panelGroup>
                    <h:panelGroup style="float: right">
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedMutualiste.paginer(false)}" update="data_mutualiste_epa :main_epargne:data_mutualiste_actuel_ep" icon="ui-icon-circle-triangle-w"  disabled="#{managedMutualiste.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedMutualiste.paginator.currentPage}/#{managedMutualiste.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedMutualiste.paginer(true)}" update="data_mutualiste_epa :main_epargne:data_mutualiste_actuel_ep" icon="ui-icon-circle-triangle-e"  disabled="#{managedMutualiste.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedMutualiste.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedMutualiste.choosePaginator}">
                                <f:selectItems value="#{managedMutualiste.paginations}" />
                                <p:ajax event="valueChange"  update="data_mutualiste_epa :main_epargne:data_mutualiste_actuel_ep" />
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </h:panelGroup>
                </h:panelGrid>
                <p:dataTable id="data_mutualiste_epa" value="#{managedMutualiste.mutualistes}" var="mutua_" rowKey="#{mutua_.id}" rowIndexVar="mutua_Idx"
                             selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedEpargne.loadOnViewMutualiste}" oncomplete="dlgListMutualistes.hide()"/>
                    <p:column headerText="N°" style="text-align: center" width="15">
                        <span>#{mutua_Idx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.LRH_PF_matricule}" width="80">
                        <span>#{mutua_.employe.matricule}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.L_nom_prenom}" width="200" >
                        <span>#{mutua_.employe.nom_prenom}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.L_compte}" width="150" rendered="false">
                        <span>#{mutua_.displayCompte()}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_agence}" width="90">
                        <span>#{mutua_.employe.agence.designation}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_actif}" width="15" style="text-align: center">
                        <h:graphicImage library="img" name="#{mutua_.actif?'vu.png':'vu_non.png'}" width="15" height="15" />
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="#{lab.LDB_PMR_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedEpargne.deleteBean()}" oncomplete="dlgConfirmDelete.hide(); afterDeleteEpargne()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_epargne">  
            <div class="part_fix">
                <p:splitButton value="#{lab.L_enregistrer}" id="save_epargne"  icon="ui-icon-disk" actionListener="#{managedEpargne.saveNew()}"
                               update=":main_epargne:blog_form_epargne">
                    <p:menuitem value="#{lab.L_nouveau}" id="cancel_epargne" icon="ui-icon-document" global="false" actionListener="#{managedEpargne.resetFiche()}" update=":main_epargne:blog_form_epargne"/>
                    <p:menuitem value="#{lab.L_supprimer}"  icon="ui-icon-trash" global="false" onclick="dlgConfirmDelete.show()"/>
                </p:splitButton>
                <p:commandButton value="#{lab.L_supprimer}" global="false" id="delete_epargne" onclick="dlgConfirmDelete.show()" />
                <h:panelGroup style="margin-left: 25%; font-size: 1em; font-weight: bold">
                    <span>#{lab.LM_PEA_action} </span>
                    <h:selectOneMenu value="#{managedEpargne.defaultAction}" valueChangeListener="#{managedEpargne.changeDefaultAction}">
                        <f:selectItem itemValue="#{constantes.MUT_NATURE_OP_EPARGNE}" itemLabel="#{constantes.MUT_NATURE_OP_EPARGNE}" />
                        <f:selectItem itemValue="#{constantes.MUT_NATURE_OP_ASSURANCE}" itemLabel="#{constantes.MUT_NATURE_OP_ASSURANCE}"/>
                        <p:ajax event="valueChange" update=":main_epargne:data_mutualiste_actuel_ep"/>
                    </h:selectOneMenu>
                    <span>#{lab.LRH_PPT_periode}</span>
                    <h:selectOneMenu id="select_periode_epargne_list" value="#{operationCompte.periode.id}" 
                                     valueChangeListener="#{managedEpargne.choixPeriode}">
                        <f:selectItem itemValue="#{0}" itemLabel="..#{lab.LRH_PPT_periode}.." itemDisabled="true"/>
                        <f:selectItems value="#{managedEpargne.giveExerciceActif(operationCompte.dateOperation).periodesMutuelles}" var="ipm" itemValue="#{ipm.id}" itemLabel="#{ipm.referencePeriode}" 
                                       itemDisabled="#{ipm.cloture}"/>
                        <p:ajax event="valueChange" update="txt_mut_period_epar data_mutualiste_actuel_ep select_periode_epargne_form"/>
                    </h:selectOneMenu>
                    <h:panelGroup >
                        <p:commandButton actionListener="#{managedEpargne.parcoursInAllResult(false)}" update="txt_parc_linear_epargne" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('epargne')"/>
                        <h:inputText value="#{managedEpargne.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_parc_linear_epargne"/>
                        <p:outputPanel autoUpdate="true">                        
                            <p:outputLabel value="/#{managedEpargne.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedEpargne.parcoursInAllResult(true)}" update="txt_parc_linear_epargne" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('epargne')"/>
                    </h:panelGroup>  
                </h:panelGroup>
                <div style="float: right">
                    <h:panelGrid columns="5" cellpadding="0" cellspacing="0" style="float: right">
                        <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('epargne');
                                return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>            
                        <p:spacer />
                        <h:link title="#{lab.LM_PEA_mode_attribuion}" onclick="collapseGrid('epargne');
                                return false">
                            <p:graphicImage library="icones" name="ico_arbre.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link> 
                        <p:spacer />
                        <h:link title="#{lab.L_mode_liste}" onclick="collapseList('epargne');
                                return false" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>   
                    </h:panelGrid>                                  
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_epargne">
                    <h:inputHidden id="input_hide_reset_epargne" value="#{managedEpargne.input_reset}"/>
                    <p:outputPanel id="blog_form_epargne" style="width: 99%; margin: auto; background: white">
                        <div style="width: 40%;float: left">
                            <h:panelGrid columns="2" styleClass="yvs_table" style="width: 100%;margin:auto" cellpadding="0" cellspacing="0">                                    
                                <f:facet name="header">
                                    <div align="left">
                                        <span>#{lab.L_caisse} </span>
                                        <h:selectOneMenu value="#{operationCompte.caisse.id}">
                                            <f:selectItems value="#{managedEpargne.currentMutuel.caisses}" var="icai" itemValue="#{icai.id}" itemLabel="#{icai.referenceCaisse}" />
                                        </h:selectOneMenu><br />
                                        #{lab.L_ref}: <p:outputPanel autoUpdate="true" style="font-size: 0.8em; text-decoration: underline">#{operationCompte.referenceOperation}</p:outputPanel>
                                    </div>
                                </f:facet>
                                <span>#{lab.LM_PM_mutualiste} </span> 
                                <h:panelGroup id="txt_mutualiste_epargne">
                                    <h:inputText value="#{managedEpargne.mutualiste.matricule}" style="color: #{managedEpargne.mutualiste.error?'red':''}">
                                        <p:ajax event="blur" global="false" listener="#{managedEpargne.searchMutualiste(false)}" update="txt_mutualiste_epargne data_mutualiste_actuel_ep chp_total_epargne"/>
                                    </h:inputText>    
                                    <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="Liste Mutualiste" global="false"
                                                     actionListener="#{managedEpargne.initMutualistes(false)}" oncomplete="dlgListMutualistes.show()"/> 
                                    <h:outputText value="#{managedEpargne.mutualiste.employe.nom_prenom}" style="margin-left: 10px;color: #333; display: block; font-size: 0.8em"/>
                                </h:panelGroup>
                                <span>#{lab.L_compte} </span> 
                                <h:selectOneMenu value="#{operationCompte.compte.id}" valueChangeListener="#{managedEpargne.chooseCompte}"
                                                 id="compte_mutualiste_epargne" style="min-width: 140px">
                                    <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                    <f:selectItems value="#{managedEpargne.mutualiste.comptes}" var="compt_" 
                                                   itemLabel="#{compt_.reference}" itemValue="#{compt_.id}" />
                                    <p:ajax event="valueChange" global="false" update="@this" />
                                </h:selectOneMenu>
                                <span>#{lab.LM_PMC_date_operation} </span>
                                <h:panelGroup>
                                    <p:calendar value="#{operationCompte.dateOperation}" navigator="true" pattern="dd-MM-yyyy" size="10">
                                        <p:ajax event="dateSelect" listener="#{managedEpargne.chooseDate}" update="select_periode_epargne_list"/>   
                                    </p:calendar>                                               
                                    <p:spacer width="1"/>
                                    <pe:timePicker value="#{operationCompte.heureOperation}" style="width: 100px"/>
                                </h:panelGroup>
                                <span>#{lab.L_montant} </span>
                                <pe:inputNumber value="#{operationCompte.montant}" decimalPlaces="0"/>
                                <span>#{lab.LM_PPG_periode} </span>
                                <h:selectOneMenu id="select_periode_epargne_form" value="#{operationCompte.periode.id}" 
                                                 valueChangeListener="#{managedEpargne.choixPeriode}" disabled="true">
                                    <f:selectItem itemValue="" itemLabel="...#{lab.LM_PPG_periode}..." itemDisabled="true"/>
                                    <f:selectItem itemValue="#{0}" itemLabel=" " />
                                    <f:selectItems value="#{managedEpargne.giveExerciceActif(operationCompte.dateOperation).periodesMutuelles}" var="ipm" itemValue="#{ipm.id}" itemLabel="#{ipm.referencePeriode}" 
                                                   itemDisabled="#{ipm.cloture}"/>
                                    <p:ajax event="valueChange" update="txt_mut_period_epar data_mutualiste_actuel_ep select_periode_epargne_list" />
                                </h:selectOneMenu>
                                <f:facet name="footer">
                                    <span>#{lab.LM_MC_commentaire} </span>
                                    <h:inputTextarea value="#{operationCompte.commentaire}" style="width: 98%" rows="5"/>                                        
                                </f:facet>
                            </h:panelGrid>
                        </div>
                        <div style="width: 58%;margin-left: 41%; text-decoration">
                            <div style="width: 100%; border: solid 2px; height: 500px; padding: 2px; border-radius: 5px;margin-top: 5px">
                                <span style="display: inline-block; background: #CCC; width: 100%">
                                    #{lab.LM_PEA_historique_epargne} 
                                    <span style="float: right">#{lab.LM_PEA_montant_total} : <h:outputText id="chp_total_epargne" value="#{managedEpargne.findSoldeMutualisteByNature(managedEpargne.mutualiste.id, constantes.MUT_TYPE_COMPTE_EPARGNE)}" converter="DN"/></span>
                                </span>
                                <div style="width: 99.5%; border: solid 1px; height: 450px; margin: auto;overflow-y: auto">
                                    <p:dataTable id="data_epargne_compte" value="#{managedEpargne.operationComptes}" var="ope" rowIndexVar="opeIdx">
                                        <p:column headerText="N°" style="text-align: center" width="10">
                                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{ope.new_}"/>
                                            <span>#{opeIdx+1}</span>
                                        </p:column>
                                        <p:column headerText="" width="10" style="text-align: center">
                                            <h:graphicImage library="img/icones" name="#{(ope.sensOperation == constantes.MUT_SENS_OP_DEPOT)?'in.png':'out.png'}" width="15" height="15"
                                                            title="#{(ope.sensOperation == constantes.MUT_SENS_OP_DEPOT)?lab.LM_PEA_depot_dans_compte:lab.LM_PEA_retrait_compte}"/>                           
                                        </p:column> 
                                        <p:column headerText="#{lab.L_date}" width="100">
                                            <h:outputText value="#{ope.dateOperation}" converter="DATE"/>
                                            <span> #{lab.L_a} </span>
                                            <h:outputText value="#{ope.heureOperation}" converter="TIME"/>
                                        </p:column>
                                        <p:column headerText="#{lab.L_reference}" width="100">
                                            <h:outputText value="#{ope.referenceOperation}" />
                                        </p:column>
                                        <p:column headerText="#{lab.L_compte}" width="100">
                                            <h:outputText value="#{ope.compte.reference}" />
                                        </p:column>
                                        <p:column headerText="#{lab.L_montant}" width="100" style="text-align: right">
                                            <h:outputText value="#{ope.montant}" converter="DN"/>
                                        </p:column>
                                        <p:column headerText="#{lab.LRH_PPT_periode}" width="50">
                                            <h:outputText value="#{ope.periode.referencePeriode}"/>
                                        </p:column>
                                    </p:dataTable>
                                </div>
                                <div>
                                    <h:selectOneMenu value="#{managedEpargne.typeCompteSearch}" valueChangeListener="#{managedEpargne.changeTypeCompte}"
                                                     style="min-width: 140px">
                                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                        <f:selectItems value="#{managedEpargne.mutualiste.comptes}" var="compt_" 
                                                       itemLabel="#{compt_.reference}" itemValue="#{compt_.id}" />
                                        <p:ajax event="valueChange" global="false" update="@this" />
                                    </h:selectOneMenu>
                                </div>
                            </div> 
                        </div>
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->                       
                <div class="yvs_list_epargne" style="width: 99%; margin: auto; background: white; height: 95%">
                    <h:inputHidden id="input_hide_epargne" value="#{managedEpargne.tabIds}"/>    
                    <p:dataTable id="data_epargne" value="#{managedEpargne.epargnes}" var="line" rowKey="#{line.id}"
                                 selectionMode="single" rowIndexVar="line_">
                        <p:ajax event="rowSelect" listener="#{managedEpargne.selectLineEpargne}" 
                                oncomplete="collapseForm('epargne')" update="data_epargne :main_epargne:input_hide_epargne"/>
                        <p:column headerText="N°" width="20" style="text-align: center">
                            <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{line.id eq operationCompte.id}"/>
                            <h:outputText value="#{line_+1}" />
                        </p:column>       
                        <p:column headerText="" width="10" style="text-align: center">
                            <h:graphicImage library="img/icones" name="#{(line.sensOperation == constantes.MUT_SENS_OP_DEPOT)?'in.png':'out.png'}" width="15" height="15"
                                            title="#{(line.sensOperation == constantes.MUT_SENS_OP_DEPOT)?'Dépôt dans le compte':'Retrait du compte'}"/>                           
                        </p:column>       
                        <p:column headerText="#{lab.LRH_PF_matricule}" width="70">
                            <h:outputText value="#{line.compte.mutualiste.employe.matricule}" />
                        </p:column>       
                        <p:column headerText="#{lab.LM_PM_mutualiste}" width="200">
                            <h:outputText value="#{line.compte.mutualiste.employe.nom_prenom}" />
                        </p:column>       
                        <p:column headerText="#{lab.LM_PMC_comptes}" width="150">
                            <h:outputText value="#{line.compte.reference}" />
                        </p:column>  
                        <p:column headerText="#{lab.LM_PEA_num_ref}" width="100">
                            <h:outputText value="#{line.referenceOperation}" />
                        </p:column>    
                        <p:column headerText="#{lab.LM_PEA_date_epargne}" width="100">
                            <h:outputText value="#{line.dateOperation}" converter="DATE"/> 
                        </p:column>    
                        <p:column headerText="#{lab.L_periode}" width="100">
                            <h:outputText value="#{line.periode.referencePeriode}"/> 
                        </p:column>    
                        <p:column style="text-align: right" headerText="Montant" width="100">
                            <h:outputText value="#{line.montant}" converter="DN"/>                                     
                        </p:column>                            
                        <p:column headerText="" style="text-align: center" width="25">
                            <p:contextMenu event="left click" for="icon_opt_del_ep_" styleClass="context_menu">
                                <p:menuitem value="#{lab.LM_PEA_voir_situation_mutualiste}" icon="ui-icon-arrowthick-1-e" actionListener="#{managedEpargne.onSelectSituationCompte(line)}" global="false" />
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedEpargne.selectLineToDel(line)}" oncomplete="collapseForm('epargne')"/>
                            </p:contextMenu>
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px"  id="icon_opt_del_ep_" />
                        </p:column> 
                        <p:column headerText="" style="text-align: center" width="25">
                            <h:selectBooleanCheckbox value="#{line.selectActif}" styleClass="chek_line_epargne" onclick="selectionLineTab(#{line_}, 'epargne')"/>
                        </p:column> 
                    </p:dataTable>                       
                    <span class="nbSelectepargne" style="font-size: .8em; font-style: italic; color: #828c95;"></span>                   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                        <p:commandButton actionListener="#{managedEpargne.paginer(false)}" update=":main_epargne:data_epargne" icon="ui-icon-circle-triangle-w"  disabled="#{managedEpargne.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedEpargne.paginator.currentPage}/#{managedEpargne.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton action="#{managedEpargne.paginer(true)}" update=":main_epargne:data_epargne" icon="ui-icon-circle-triangle-e"  disabled="#{managedEpargne.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedEpargne.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em; width: 80px" 
                                         valueChangeListener="#{managedEpargne.choosePaginator}">
                            <f:selectItems value="#{managedEpargne.paginations}" />
                            <p:ajax event="valueChange" update=":main_epargne:data_epargne" />
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div> 
                <!-->
                 *****************************************************************************
                 Vue Attrib
                 *****************************************************************************
                <-->
                <div class="yvs_grid_epargne" style="width: 99%; margin: auto; background: white">
                    <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                        <h:panelGroup style="float: left">
                            <h:inputText value="#{managedMutualiste.numSearch}" >
                                <p:ajax event="keyup" listener="#{managedMutualiste.addParamReference()}" update="data_mutualiste_actuel_ep :main_mut_epa"/>
                            </h:inputText>                            
                            <span style="padding: 5px; font-weight: bold; display: inline-block"> CAISSE : #{managedEpargne.parametreMutuelle.caisseEpargne.referenceCaisse} <span style="color: #790000; font-style: initial; display: #{(managedEpargne.parametreMutuelle.caisseEpargne.id gt 0)?'none':'inline'}; font-size: 0.8em">!!#{lab.LM_PEA_text}!!</span></span>
                        </h:panelGroup>                        
                        <h:panelGroup style="float: right">                            
                            <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                                <p:commandButton actionListener="#{managedMutualiste.paginer(false)}" update="data_mutualiste_actuel_ep :main_mut_epa" icon="ui-icon-circle-triangle-w"  disabled="#{managedMutualiste.paginator.disPrev}"/>
                                <p:outputPanel ><p:outputLabel value="#{managedMutualiste.paginator.currentPage}/#{managedMutualiste.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                                <p:commandButton action="#{managedMutualiste.paginer(true)}" update="data_mutualiste_actuel_ep :main_mut_epa" icon="ui-icon-circle-triangle-e"  disabled="#{managedMutualiste.paginator.disNext}"/>
                                <p:selectOneMenu value="#{managedMutualiste.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em; width: 50px" 
                                                 valueChangeListener="#{managedMutualiste.choosePaginator}">
                                    <f:selectItems value="#{managedMutualiste.paginations}" />
                                    <p:ajax event="valueChange"  update="data_mutualiste_actuel_ep :main_mut_epa" />
                                </p:selectOneMenu>
                            </p:outputPanel>
                        </h:panelGroup>
                    </h:panelGrid>
                    <p:dataTable id="data_mutualiste_actuel_ep" value="#{managedMutualiste.mutualistes}"
                                 var="mutuaA" rowKey="#{mutuaA.id}" rowIndexVar="mutuaAIdx" selectionMode="single">
                        <p:column headerText="N°" style="text-align: center" width="15">
                            <span>#{mutuaAIdx+1}</span>
                        </p:column>
                        <p:column headerText="#{lab.LRH_PSR_matricules}" style="font-weight: bold; text-align: center" width="100">
                            <span>#{mutuaA.employe.matricule}</span>                 
                        </p:column> 
                        <p:column headerText="#{lab.LM_PEA_mutualistes}" width="150">
                            <span>#{mutuaA.employe.nom_prenom}</span>                 
                        </p:column>                               
                        <p:column headerText="#{lab.LM_PMC_comptes}" width="80" rendered="#{managedEpargne.defaultAction ne constantes.MUT_NATURE_OP_ASSURANCE}">
                            <span>#{mutuaA.compteEpargneObligatoire.reference}</span>                 
                        </p:column>                               
                        <p:column headerText="#{lab.LM_PMC_comptes}" width="80" rendered="#{managedEpargne.defaultAction.equals(constantes.MUT_NATURE_OP_ASSURANCE)}">
                            <span>#{mutuaA.compteAAssuranceObligatoire.reference}</span>                 
                        </p:column>                               
                        <p:column headerText="#{managedEpargne.defaultAction eq constantes.MUT_NATURE_OP_EPARGNE?lab.LM_PMC_epargne_mens:lab.LM_PMC_assurance}" style="text-align: right" width="80">
                            <h:outputText value="#{mutuaA.montantEpargne}" converter="DN"  rendered="#{managedEpargne.defaultAction.equals(constantes.MUT_NATURE_OP_EPARGNE)}"/>
                            <h:outputText value="#{managedEpargne.giveResteAssurance(mutuaA.montantTotalAssurance)}" converter="DN"  rendered="#{!managedEpargne.defaultAction.equals(constantes.MUT_NATURE_OP_EPARGNE)}"/>
                            <span> Fcfa</span>
                        </p:column>                               
                        <p:column headerText="#{lab.LM_PEA_solde_assurance}" style="text-align: right" width="80" styleClass="alerte_solde_#{(mutuaA.compteAAssuranceObligatoire.soldeAlerte gt mutuaA.compteAAssuranceObligatoire.solde)}"
                                  rendered="#{managedEpargne.defaultAction.equals(constantes.MUT_NATURE_OP_ASSURANCE)}">
                            <h:outputText value="#{mutuaA.compteAAssuranceObligatoire.solde}" converter="DN" /><span> Fcfa</span>
                        </p:column>                                 
                        <p:column headerText="#{lab.LM_PEA_epargne_total}"  style="text-align: right; margin-right: 10px" width="100" rendered="#{managedEpargne.defaultAction.equals(constantes.MUT_NATURE_OP_EPARGNE)}">
                            <h:outputText value="#{mutuaA.montantTotalEpargne}" converter="DN" style="text-align: right; font-size: 1em"/><span> Fcfa</span>
                        </p:column>
                        <p:column style="text-align: center" width="50">
                            <p:commandButton icon="ui-icon-circle-check" actionListener="#{managedEpargne.directEpargne(mutuaA,mutuaA.compteEpargneObligatoire)}" update=":main_epargne:blog_form_epargne" 
                                             style="width: 90%;height: 90%" title="#{lab.LM_PEA_enregistrer_epargne_mensuelle}" rendered="#{!managedEpargne.contributionPeriodeOk(mutuaA.compteEpargneObligatoire, operationCompte.periode)}"/>
                            <h:panelGroup rendered="#{managedEpargne.contributionPeriodeOk(mutuaA.compteEpargneObligatoire, operationCompte.periode)}">
                                <p:contextMenu event="left click" for="icon_opt_del_ep" styleClass="context_menu">
                                    <p:menuitem value="#{lab.L_annuler}" icon="ui-icon-circle-close" actionListener="#{managedEpargne.calcelEpargneDirecte(mutuaA.compteEpargneObligatoire)}" />
                                </p:contextMenu>
                                <h:graphicImage library="img" name="vu.png" width="15" height="15" style="cursor: pointer" id="icon_opt_del_ep"/>
                            </h:panelGroup>                                
                        </p:column>
                    </p:dataTable> 
                    <div align="right" style="width: 100%;background: #99ccff; padding: 3px">                        
                        <h:panelGroup id="txt_mut_period_epar">
                            <span style="display: inline-block; margin: auto;font-style: italic; color: #006666; font-weight: bold; font-size: 0.8em; letter-spacing: 1px;">#{lab.LM_PEA_epargne_periode} #{operationCompte.periode.reference} :</span>
                            <h:outputText value="#{managedEpargne.findSoldeByOperationMutuellePeriode(managedEpargne.currentMutuel.id, constantes.MUT_TYPE_COMPTE_EPARGNE, operationCompte.periode.dateDebut, operationCompte.periode.dateFin, constantes.MUT_SENS_OP_DEPOT)}" converter="DN" />
                        </h:panelGroup>
                    </div>
                </div>                        
            </div>                    
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false">
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>                    
            <div class="zone_find">                                                              
                <h:panelGrid columns="4" style="font-size: 0.9em; float: left">
                    <h:outputText value="#{lab.L_date}" />
                    <h:outputText value="#{lab.LM_PM_mutualiste} " />
                    <h:outputText value="#{lab.LC_PCP_periodes} " />
                    <span>&nbsp;</span>
                    <h:panelGroup>
                        <h:selectBooleanCheckbox value="#{managedEpargne.dateSearch}">
                            <p:ajax event="valueChange" listener="#{managedEpargne.addParamDates()}" update="dates_search_epa" oncomplete="collapseList('epargne')"/>
                        </h:selectBooleanCheckbox>
                        <h:panelGroup id="dates_search_epa" style="margin-top: -2px;float: right">
                            <p:calendar value="#{managedEpargne.debutSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedEpargne.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedEpargne.addParamDates()}" oncomplete="collapseList('epargne')"/>
                            </p:calendar>
                            <p:calendar value="#{managedEpargne.finSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedEpargne.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedEpargne.addParamDates()}" oncomplete="collapseList('epargne')"/>
                            </p:calendar>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:inputText value="#{managedEpargne.mutualisteSearch}" >
                        <p:ajax event="keyup" listener="#{managedEpargne.addParamMutualiste()}" oncomplete="collapseList('epargne')"  update=":main_epargne:data_epargne"/>
                    </h:inputText>
                    <h:selectOneMenu  value="#{managedEpargne.periodeSearch}" valueChangeListener="#{managedEpargne.addParamPeriode}">
                        <f:selectItem itemValue="#{0}" itemLabel="" />
                        <f:selectItems value="#{managedEpargne.giveExerciceActif().periodesMutuelles}" var="ipm" itemValue="#{ipm.id}" itemLabel="#{ipm.referencePeriode}" 
                                       />
                        <p:ajax event="valueChange" update=":main_epargne:data_epargne"/>
                    </h:selectOneMenu>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

