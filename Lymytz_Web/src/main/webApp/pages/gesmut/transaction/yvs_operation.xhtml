<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Opérations Caisses','modMutuelle', 'smenOperation', true,managedOperationCaisse)}
    </ui:define>   
    <ui:define name="contents"> 
        #{managedOperationCaisse.loadAll()}
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 100);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('operation');
                collapseList('create_tiers_societe');
                collapseForm('create_tiers_externe');
            });
        </script>
        <h:form prependId="false" id="form_abonnement_c">
            <p:dialog header="#{lab.LM_MC_repartir_de_charge}" widgetVar="dlgAbonner" width="60%" >
                <h:panelGrid columns="2" id="form_abonnement_">
                    <span>#{lab.LM_MC_nombre_periode}</span>
                    <h:panelGroup>
                        <h:inputText value="#{managedOperationCaisse.nbPeriode}" style="width: 50px; text-align: center" disabled="#{managedOperationCaisse.allExo}"/>
                        <p:selectBooleanCheckbox value="#{managedOperationCaisse.allExo}" itemLabel="/ #{lab.LM_MC_sur_reste_exercice}" 
                                                 valueChangeListener="#{managedOperationCaisse.choixDureeAbonnement}" >
                            <p:ajax event="valueChange" update="form_abonnement_"/>
                        </p:selectBooleanCheckbox>
                    </h:panelGroup>
                    <p:selectOneRadio value="#{managedOperationCaisse.typeVal}">
                        <f:selectItem itemValue="T" itemLabel="#{lab.L_taux}" />
                        <f:selectItem itemValue="V" itemLabel="#{lab.L_montant}" />
                    </p:selectOneRadio>
                    <p:commandButton icon="ui-icon-arrowreturnthick-1-w" value="#{lab.L_charger}" actionListener="#{managedOperationCaisse.applyAbonnement()}"
                                     update="table_view_abonnement"/>                    
                </h:panelGrid>
                <p:dataTable value="#{managedOperationCaisse.abonnements}" var="iab" rowKey="#{iab.id}" selection="single"
                             rowIndexVar="line" id="table_view_abonnement">
                    <p:column headerText="N°" >#{line+1}</p:column>
                    <p:column headerText="#{lab.LDB_PC_periode}" >
                        <h:outputText value="#{managedOperationCaisse.formatMonthString.format(iab.dateOperation)}" />
                    </p:column>
                    <p:column headerText="#{lab.L_date}" >
                        <h:outputText value="#{iab.dateOperation}" converter="DATE" />
                    </p:column>
                    <p:column headerText="#{lab.L_montant}" style="text-align: right" width="100">
                        <h:outputText value="#{iab.montant}" converter="DNS"/>
                        <h:outputText value="%" rendered="#{managedOperationCaisse.typeVal.equals('T')}"/>
                    </p:column>
                    <p:column headerText="" width="12">
                        <f:facet name="header">
                            <p:contextMenu for="btn_opt_abonnement" event="left click">
                                <p:menuitem value="#{lab.L_annuler}" title="#{lab.LM_MC_annuler_abonnement}" actionListener="#{managedOperationCaisse.deleteAbonnement()}" icon="ui-icon-circle-close"/>
                            </p:contextMenu>
                            <p:commandButton icon="ui-icon-gear" id="btn_opt_abonnement" style="width: 22px; height: 22px"/>
                        </f:facet>
                    </p:column>
                </p:dataTable>
                <p:commandButton icon="ui-icon-disk" value="#{lab.L_appliquer}" actionListener="#{managedOperationCaisse.saveOperationsAbonne()}"/>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmCreate" closeOnEscape="true"
                             message="#{lab.LDB_PEX_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="Oui" onclick="dlgConfirmCreate.hide()" oncomplete="dlgAddExercice.show()" global="false"/>
                <p:commandButton type="button" value="Non" onclick="dlgConfirmCreate.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDelTiers" closeOnEscape="true"
                             message="#{lab.LM_PMC_text}" header="#{lab.LM_PMC_supprime_tiers}">
                <p:commandButton value="#{lab.L_oui}" oncomplete="dlgDelTiers.hide()" actionListener="#{managedOperationCaisse.deleteTiers()}"/>
                <p:commandButton type="button" value="#{lab.L_non}" onclick="dlgDelTiers.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgDelLine" closeOnEscape="true" style="font-size: 0.8em"
                             message="#{lab.LM_MC_text}" header="#{lab.LM_MC_supprime_operation}">
                <p:commandButton value="#{lab.L_oui}" oncomplete="dlgDelLine.hide()" actionListener="#{managedOperationCaisse.deleteBeanOperation()}"/>
                <p:commandButton type="button" value="#{lab.L_non}" onclick="dlgDelLine.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.LDB_PEX_creation_exercice}" widgetVar="dlgAddExercice" 
                      width="25%" modal="true" closeOnEscape="true">
                <h:panelGrid columns="1" styleClass="yvs_table" style="width: 100%">
                    <h:panelGrid columns="2" styleClass="yvs_table" style="width: 98%;margin: auto"> 
                        <span>#{lab.L_reference} </span>  
                        <h:inputText value="#{exercice.reference}"/>
                        <span>#{lab.L_date_debut} </span> 
                        <p:calendar value="#{exercice.dateDebut}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_date_fin} </span>
                        <p:calendar value="#{exercice.dateFin}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_actif} </span>
                        <h:selectBooleanCheckbox value="#{exercice.actif}"/>
                    </h:panelGrid>
                    <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedExercice.saveNew()}"
                                     oncomplete="dlgAddExercice.hide()" style="width: 100%"/> 
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form>  

        <!-->
        *****************************************************************************
        Boite de dialogue des tiers societe
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgTiersSociete_">
            <p:dialog id="dlgTiersSociete_" header="#{lab.LM_PMC_gestion_tiers_societes}" widgetVar="dlgTiersSociete" modal="true" width="60%" 
                      closeOnEscape="true" >  
                #{managedOperationCaisse.loadAllTiers('Societe')}
                <div class="part_fix">
                    <p:commandButton id="save_create_tiers_societe" value="#{lab.L_enregistrer}" actionListener="#{managedOperationCaisse.saveNewtiers('Societe',true)}"
                                     update="data_tiers_societe form_create_tiers_societe"/>
                    <p:commandButton id="cancel_create_tiers_societe" value="#{lab.L_nouveau}" actionListener="#{managedOperationCaisse.resetFicheTiers()}" 
                                     update="form_create_tiers_societe"/>
                    <p:commandButton title="#{lab.LM_MC_importer_societes_existante}" icon="ui-icon-arrowthick-1-s" style="width: 22px; height: 25px; float: left" 
                                     actionListener="#{managedOperationCaisse.importTiersSociete()}"/>
                    <div style="float: right">                        
                        <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('create_tiers_societe');
                                return false" >
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <p:spacer />
                        <h:link title="#{lab.L_mode_liste}" onclick="collapseList('create_tiers_societe');" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>   
                    </div>
                </div>
                <div style="clear: right"/>
                <div class="yvs_form_create_tiers_societe">
                    <h:panelGrid id="form_create_tiers_societe" columns="2" styleClass="yvs_table" 
                                 style="width: 98%;margin: auto" cellpadding="0" cellspacing="0">
                        <span>#{lab.LRH_PC_raison_sociale} </span>
                        <h:inputText value="#{managedOperationCaisse.source.raisonSociale}"/>
                        <span>#{lab.L_adresse} </span>
                        <h:inputText value="#{managedOperationCaisse.source.adresse}"/>
                        <span>#{lab.L_telephone} </span>
                        <h:inputText value="#{managedOperationCaisse.source.telephone}"/>
                        <f:facet name="footer">
                            <p:selectBooleanCheckbox label="#{lab.L_actif}" value="#{managedOperationCaisse.source.actif}" style="float: right" />
                        </f:facet>
                    </h:panelGrid>
                </div>
                <div class="yvs_list_create_tiers_societe" style="width: 100%">
                    <p:dataTable id="data_tiers_societe" value="#{managedOperationCaisse.tiers}" var="tiers0_" rowKey="#{tiers0_.id}" 
                                 rowIndexVar="tiers0_Idx" selectionMode="single">
                        <p:ajax event="rowSelect" listener="#{managedOperationCaisse.loadOnViewTiersSociete}" 
                                oncomplete="dlgTiersSociete.hide()" />
                        <p:column style="text-align: center" width="15">
                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{tiers0_.new_}"/>
                        </p:column>
                        <p:column headerText="#{lab.LM_PMC_denomination}" width="100">
                            <span>#{tiers0_.raisonSociale}</span>                 
                        </p:column>
                        <p:column headerText="#{lab.L_adresse}" width="100"> 
                            <span>#{tiers0_.adresse}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_telephone}" width="80">
                            <span>#{tiers0_.telephone}</span>
                        </p:column>
                        <p:column headerText="" width="15">
                            <p:contextMenu for="btn_opt_op_ges_scte" event="left click" styleClass="context_menu">
                                <p:menuitem value="#{lab.L_modifier}" icon="ui-icon-refresh"  actionListener="#{managedOperationCaisse.openDeleteTiers(tiers0_,false)}" oncomplete="collapseForm('create_tiers_societe')"/>
                                <p:separator />
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash"  actionListener="#{managedOperationCaisse.openDeleteTiers(tiers0_,true)}" oncomplete="collapseForm('create_tiers_societe')"/>
                            </p:contextMenu>
                            <p:commandButton icon="ui-icon-gear" type="button" style="width: 22px; height: 22px" id="btn_opt_op_ges_scte" />
                        </p:column>
                    </p:dataTable>
                </div>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>
        <!-->
        *****************************************************************************
        Boite de dialogue des employes 
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgEmployeMutuelle_0">
            <p:dialog id="dlgEmployeMutuelle_0" header="#{lab.LDB_PD_selectionner_employe}" widgetVar="dlgEmployeMutuelle" modal="true" width="50%" 
                      height="435" closeOnEscape="true">  
                #{managedOperationCaisse.loadAllEmploye()}
                <p:dataTable id="data_employe_mutuelle0" value="#{managedOperationCaisse.employes}" var="empl_" rowKey="#{empl_.id}" 
                             rowIndexVar="empl_Idx" scrollable="true" scrollHeight="400" selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedOperationCaisse.loadOnViewEmploye}" oncomplete="dlgEmployeMutuelle.hide()"/>
                    <p:column headerText="N°" style="width: 1%;text-align: center">
                        <span>#{empl_Idx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_nom}" style="width: 4%">
                        <span>#{empl_.nom}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.L_prenom}" style="width: 8%">
                        <span>#{empl_.prenom}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_agence}" style="width: 8%">
                        <span>#{empl_.agence.designation}</span>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue des mutualistes 
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgMutualiste_op">
            <p:dialog id="dlgMutualiste_op" header="#{lab.LM_MC_selectionner_mutualiste}" widgetVar="dlgMutualiste" modal="true" width="50%" 
                      height="50%" closeOnEscape="true">  
                <p:outputPanel id="dlg_blog_form_mutualiste_operation_op">
                    <p:dataTable id="data_mutualiste_op" value="#{managedMutualiste.mutualistes}" var="mutua_" rowKey="#{mutua_.id}" rowIndexVar="mutua_Idx"
                                 scrollable="true" scrollHeight="400" selectionMode="single">
                        <p:ajax event="rowSelect" global="false" listener="#{managedOperationCompte.loadOnViewMutualiste}" oncomplete="dlgMutualiste.hide()"/>
                        <p:column headerText="N°" style="width: 1%;text-align: center">
                            <span>#{mutua_Idx+1}</span>
                        </p:column>
                        <p:column headerText=" #{lab.L_nom}" style="width: 4%">
                            <span>#{mutua_.employe.nom}</span>                 
                        </p:column>
                        <p:column headerText="#{lab.L_prenom}" style="width: 7%">
                            <span>#{mutua_.employe.prenom}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_agence}" style="width: 7%">
                            <span>#{mutua_.employe.agence.designation}</span>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteOperationCaisse" closeOnEscape="true"
                             message="#{lab.LDB_PD_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedOperationCaisse.deleteBean()}" oncomplete="dlgConfirmDeleteOperationCaisse.hide(); afterDeleteOperationCaisse()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDeleteOperationCaisse.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteBean" closeOnEscape="true"
                             message="#{lab.LDB_PD_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedOperationCaisse.deleteBeanOperation()}" oncomplete="dlgConfirmDeleteBean.hide(); afterDeleteOperationCaisse()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDeleteBean.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_form_mut_opc">    
            <div class="part_fix">
                <p:splitButton value="#{lab.L_enregistrer}" id="save_operation_caisse" icon="ui-icon-disk" actionListener="#{managedOperationCaisse.saveNew()}">
                    <p:menuitem value="#{lab.L_nouveau}" id="cancel_operation_caisse" icon="ui-icon-document" global="false" actionListener="#{managedOperationCaisse.resetFiche()}" 
                                update="blog_form_operation_caisse :form_abonnement_c:table_view_abonnement"/>   
                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" onclick="dlgConfirmDeleteBean.show()"/>

                </p:splitButton>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_operation">
                    <div style="width: 35%; margin: auto; background: white;float: left">
                        <p:outputPanel id="blog_form_operation_caisse">
                            <h:panelGrid columns="2" styleClass="yvs_table" style="width: 100%" cellpadding="0" cellspacing="0">  
                                <f:facet name="header">
                                    <h:panelGrid columns="3" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0"
                                                 style="font-size: 0.89em; width: 100%">
                                        <h:outputText value="#{lab.L_montant}" />
                                        <span>&nbsp; </span>      
                                        <h:outputText value="#{operationCaisse.id}" style="float: right; background: #FFF; color: #000; border: 1px solid #045491; padding: 3px; margin-right: -9px"/>                                                                     
                                        <pe:inputNumber value="#{operationCaisse.montant}" decimalPlaces="0"/>
                                        <p:selectBooleanCheckbox itemLabel="#{lab.LM_MC_repartir_charge}" value="#{operationCaisse.abonner}" id="chb_abbonement" 
                                                                 disabled="#{!operationCaisse.sensOperation.equals(constantes.MUT_SENS_OP_RETRAIT)}"/> 
                                    </h:panelGrid>
                                </f:facet>
                                <span>#{lab.L_caisse}</span> 
                                <h:selectOneMenu value="#{operationCaisse.caisse.id}" id="compte_mutuelle_operation">
                                    <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                    <f:selectItems value="#{managedOperationCaisse.caisses}" var="cais_" 
                                                   itemLabel="#{cais_.referenceCaisse}" itemValue="#{cais_.id}" />
                                </h:selectOneMenu>
                                <span>#{lab.L_date} </span>
                                <h:panelGroup>
                                    <p:calendar value="#{operationCaisse.dateOperation}" navigator="true" pattern="dd-MM-yyyy" size="8"/>                                                    
                                    <pe:timePicker value="#{operationCaisse.heureOperation}" style="width: 100px;"/>
                                </h:panelGroup>                                                                
                                <span>#{lab.L_nature}  </span> 
                                <h:selectOneMenu value="#{operationCaisse.sensOperation}" id="nature_operation_caisse" 
                                                 valueChangeListener="#{managedOperationCaisse.chooseNatureOp}">
                                    <f:selectItem itemLabel="#{lab.L_depot}" itemValue="#{constantes.MUT_SENS_OP_DEPOT}"/>
                                    <f:selectItem itemLabel="#{lab.LM_PMC_retrait}" itemValue="#{constantes.MUT_SENS_OP_RETRAIT}"/>
                                    <p:ajax global="false" event="valueChange" update="chb_abbonement champ_participation" />
                                </h:selectOneMenu>
                                <span id="lbl_type_source_operation">#{lab.LCF_PC_source} </span> 
                                <h:panelGroup id="value_type_source_operation">
                                    <h:selectOneMenu value="#{operationCaisse.source.typeTiers}" id="type_source_operation_caisse"
                                                     valueChangeListener="#{managedOperationCaisse.chooseSource}">
                                        <f:selectItem itemLabel="--" itemValue="--" noSelectionOption="true"/>
                                        <f:selectItem itemLabel="#{lab.LDB_PT_employe}" itemValue="Employe"/>
                                        <f:selectItem itemLabel="#{lab.LDB_PC_societe}" itemValue="Societe"/>
                                        <p:ajax event="valueChange" global="false" />
                                    </h:selectOneMenu>
                                    <h:inputText id="txt_nom_source_operation_caisse" value="#{operationCaisse.source.nom}" />
                                </h:panelGroup>
                                <span>#{lab.LM_MC_participe_solde_distribuer}</span>
                                <p:selectBooleanCheckbox id="champ_participation" value="#{operationCaisse.inSoldeMutuelle}" disabled="#{operationCaisse.sensOperation eq constantes.MUT_SENS_OP_RETRAIT}"/>
                                <span>#{lab.LC_PI_ref_externe}</span>
                                <h:inputText value="#{operationCaisse.referenceExterne}" />
                            </h:panelGrid>
                            <span>#{lab.LC_PR_commentaire}</span>
                            <h:inputTextarea value="#{operationCaisse.commentaire}" style="width: 98%" rows="3"/>
                            <h:panelGrid columns="1" style="width: 100%;" rendered="#{managedOperationCaisse.paiementCredit.id gt 0 or managedOperationCaisse.mensualite.id gt 0 or managedOperationCaisse.operationCompte.id gt 0}">                                
                                <h:panelGrid columns="2" rendered="#{managedOperationCaisse.operationCompte.id gt 0}"
                                             style="width: 100%; font-size: 0.8em" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                    <f:facet name="header">#{lab.LM_MC_mouvement_compte}</f:facet>
                                    <span>#{lab.LM_MC_compte_n}</span>
                                    <h:panelGroup>
                                        <h:outputText value="#{managedOperationCaisse.operationCompte.compte.reference}" />
                                        <span> #{lab.L_de} </span>
                                        <h:outputText value="#{managedOperationCaisse.operationCompte.compte.mutualiste.employe.nom_prenom}" />                                                                                
                                    </h:panelGroup>
                                    <span style="font-weight: bold">#{managedOperationCaisse.operationCompte.nature}</span>
                                    <h:outputText value="#{managedOperationCaisse.operationCompte.commentaire}" />
                                    <span>#{lab.L_date}</span>
                                    <h:panelGroup>
                                        <h:outputText value="#{managedOperationCaisse.operationCompte.dateOperation}" converter="DATE"/>
                                        <p:spacer width="5" />
                                        <h:outputText value="#{managedOperationCaisse.operationCompte.heureOperation}" converter="TIME"/>
                                    </h:panelGroup>
                                </h:panelGrid>
                                <h:panelGrid columns="2" rendered="#{managedOperationCaisse.paiementCredit.id gt 0}"
                                             style="width: 100%; font-size: 0.8em" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                    <f:facet name="header">#{lab.LM_MC_paiement_credit}</f:facet>
                                    <span>#{lab.LM_PM_mutualiste}</span>
                                    <h:panelGroup>
                                        <h:outputText value="#{managedOperationCaisse.paiementCredit.credit.compte.mutualiste.employe.nom_prenom}" />
                                    </h:panelGroup>
                                    <span>#{lab.LM_MC_credit_n}</span>
                                    <h:outputText value="#{managedOperationCaisse.paiementCredit.credit.reference}" />
                                    <span>#{lab.L_date}</span>
                                    <h:outputText value="#{managedOperationCaisse.paiementCredit.dateReglement}" converter="DATE"/>                                        
                                </h:panelGrid>
                                <h:panelGrid columns="2" rendered="#{managedOperationCaisse.mensualite.id gt 0}"
                                             style="width: 100%; font-size: 0.8em" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                                    <f:facet name="header">Remboursement de mensuaité</f:facet>
                                    <span>Mutualiste</span>
                                    <h:panelGroup>
                                        <h:outputText value="#{managedOperationCaisse.mensualite.compte.mutualiste.employe.nom_prenom}" />
                                    </h:panelGroup>
                                    <span>#{lab.LM_MC_credit_n}</span>
                                    <h:outputText value="#{managedOperationCaisse.mensualite.credit.reference}" />
                                    <span>#{lab.L_date}</span>
                                    <h:outputText value="#{managedOperationCaisse.mensualite.dateReglement}" converter="DATE"/>                                        
                                </h:panelGrid>
                            </h:panelGrid>
                        </p:outputPanel>
                    </div>
                    <div style="width: 65%; margin: auto; background: white;float: right">
                        <h:inputHidden id="input_hide_operation_caisse" value="#{managedOperationCaisse.tabIds}"/>
                        <p:dataTable id="data_operation_caisse" value="#{managedOperationCaisse.operations}" var="opC" rowKey="#{opC.id}" 
                                     rowIndexVar="opCIdx" selectionMode="single">
                            <p:ajax event="rowSelect" global="false" listener="#{managedOperationCaisse.loadOnView}" 
                                    update="data_operation_caisse"/>
                            <p:ajax event="rowUnselect" global="false" listener="#{managedOperationCaisse.unLoadOnView}"/>                                        
                            <p:column width="30" headerText="N°" style="text-align: center" >
                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{opC.new_}"/>
                                <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{opC.id eq operationCaisse.id}"/>
                                <h:graphicImage library="img/icones" name="#{(opC.mouvement == constantes.MUT_SENS_OP_DEPOT)?'in.png':'out.png'}" width="15" height="15"
                                                style="float: right" title="#{(opC.mouvement == constantes.MUT_SENS_OP_DEPOT)?lab.LM_MC_depot_caisse:lab.LM_MC_retrait_caisse}"/>
                                <span styleClass="ligne_#{(opC.new_)?'true':'false'}">#{opCIdx+1}</span>
                            </p:column>
                            <p:column headerText="#{lab.LCF_PC_source}">
                                <span title="#{opC.note}" styleClass="ligne_#{(opC.new_)?'true':'false'}">#{opC.nameTiers}</span>
                            </p:column>
                            <p:column headerText="#{lab.L_caisse}">
                                <span title="#{opC.note}" styleClass="ligne_#{(opC.new_)?'true':'false'}">#{opC.caisse.referenceCaisse}</span>
                            </p:column>
                            <p:column headerText="#{lab.L_date}">
                                <h:outputText title="#{opC.note}" value="#{opC.dateMvt}" converter="DATE" styleClass="ligne_#{(opC.new_)?'true':'false'}"/>
                            </p:column>
                            <p:column headerText="#{lab.L_montant}" style="text-align: right">
                                <h:outputText title="#{opC.note}" styleClass="ligne_#{(opC.new_)?'true':'false'}" value="#{opC.montant}" converter="DN" style="text-align: right"/>
                            </p:column>
                            <p:column headerText="" style="text-align: right">
                                <span title="#{lab.LM_MC_operation_compte}" styleClass="ligne_#{(opC.new_)?'true':'false'}" style="padding: 2px; background: #000; color: #FFF; font-size: 0.8em; display: #{(opC.tableExterne eq constantes.MUT_TABLE_SRC_OPERATION_COMPTE)?'inline':'none'}">
                                    #{(opC.tableExterne eq constantes.MUT_TABLE_SRC_OPERATION_COMPTE)?'C':''}
                                </span>
                                <span title="#{lab.LM_MC_participe_solde_distribuer}" styleClass="ligne_#{(opC.new_)?'true':'false'}" style="padding: 2px; background: #000; color: #FFF; font-size: 0.8em; display: #{opC.inSoldeCaisse?'inline':'none'}">
                                    #{(opC.inSoldeCaisse)?'+':''}
                                </span>
                                <span title="#{lab.LM_MC_charge_abonne}" styleClass="ligne_#{opC.mouvement.equals(constantes.MUT_SENS_OP_RETRAIT)?'true':'false'}" style="padding: 2px; background: #000; color: #FFF; font-size: 0.8em; display: #{opC.inSoldeCaisse?'inline':'none'}">                                   
                                </span>
                            </p:column>
                            <p:column width="20" style="text-align: center">
                                <p:contextMenu for="btn_otp_op_caiss" event="left click">
                                    <p:menuitem value="#{lab.LM_MC_abonnement}..." actionListener="#{managedOperationCaisse.openManagedAbonnement(opC)}" icon="ui-icon-copy" 
                                                rendered="#{opC.mouvement.equals(constantes.MUT_SENS_OP_RETRAIT)}"/>
                                    <p:separator />
                                    <p:menuitem value="#{lab.L_supprimer}" actionListener="#{managedOperationCaisse.deleteBean(opC)}" icon="ui-icon-trash" />
                                </p:contextMenu>
                                <p:commandButton type="button" id="btn_otp_op_caiss" icon="ui-icon-gear" style="width: 22px; height: 22px" 
                                                 />
                            </p:column> 
                            <p:column width="25" style="text-align: center">
                                <f:facet name="header">
                                    <h:selectBooleanCheckbox styleClass="chek_all_line_operation_caisse" value="false"
                                                             onclick="selectionAllLineTab(#{managedOperationCaisse.operations.size()}, 'operation_caisse')">
                                    </h:selectBooleanCheckbox>
                                </f:facet>
                                <h:selectBooleanCheckbox  styleClass="chek_line_operation_caisse" 
                                                          onclick="selectionLineTab(#{opC.id}, 'operation_caisse')">
                                </h:selectBooleanCheckbox>
                            </p:column>
                            <f:facet name="footer">
                                <div align="right"><h:outputText value="11" style="text-align: right; font-size: 0.8em"/></div>
                            </f:facet>
                        </p:dataTable>    
                        <p:commandButton value="#{lab.L_supprimer}" global="false" id="delete_operation_caisse" actionListener="#{managedOperationCaisse.deleteBean()}" style="float: right">
                            <!--<p:confirm message="Voulez-vous vraiment supprimer?" header="supprimer les opérations" />-->
                        </p:commandButton>                            
                        <span class="nbSelectoperation_caisse" style="font-size: .8em; font-style: italic; color: #828c95;"></span>                   
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedOperationCaisse.paginer(false)}" update="data_operation_caisse" icon="ui-icon-circle-triangle-w"  disabled="#{managedOperationCaisse.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedOperationCaisse.paginator.currentPage}/#{managedOperationCaisse.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedOperationCaisse.paginer(true)}" update="data_operation_caisse" icon="ui-icon-circle-triangle-e"  disabled="#{managedOperationCaisse.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedOperationCaisse.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedOperationCaisse.choosePaginator}">
                                <f:selectItems value="#{managedOperationCaisse.paginations}" />
                                <p:ajax event="valueChange" update="data_operation_caisse" />
                            </p:selectOneMenu>
                        </p:outputPanel> 
                    </div>
                </div>                 
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false">
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>                    
            <div class="zone_find">   
                <p:dataTable value="#{managedPieceCaisse.soldesCaisse}" var="iSolde" style="font-size: 0.8em; width: 98%; margin: auto">
                    <p:columns value="#{managedOperationCaisse.caisses}" var="column" >
                        <f:facet name="header">
                            #{column.referenceCaisse}
                        </f:facet>
                        <h:outputText style="float: right; font-weight: bold" value="#{managedOperationCaisse.findSoldeCaisse(column.id)}" converter="DN"/>
                    </p:columns>
                </p:dataTable>
                <h:panelGrid columns="6" style="font-size: 0.8em; float: left; padding: 0px; margin: 0px">
                    <h:outputText value="#{lab.L_date}" />
                    <h:outputText value="#{lab.LCF_PC_source} " />  
                    <h:outputText value="#{lab.L_caisse} " />  
                    <h:outputText value="#{lab.LM_MC_mouvement} " />  
                    <h:panelGroup>
                        <h:outputText value="#{lab.L_montant} " /> 
                        <h:selectOneMenu value="#{managedOperationCaisse.operationMontant}" valueChangeListener="#{managedOperationCaisse.changeOperateur}">
                            <f:selectItem itemLabel="#{lab.LC_PLV_egale}" itemValue="=" />
                            <f:selectItem itemLabel="#{lab.LRH_PPT_superieure}" itemValue="&gt;" />
                            <f:selectItem itemLabel="#{lab.LCF_PRV_tout_inferieur}" itemValue="&lt;" />
                            <f:selectItem itemLabel="#{lab.LCF_PRV_entre}" itemValue="BETWEEN" />
                            <p:ajax event="valueChange" />
                        </h:selectOneMenu>
                    </h:panelGroup> 
                    <span>&nbsp;</span>
                    <h:panelGroup>
                        <h:selectBooleanCheckbox value="#{managedOperationCaisse.dateSearch}">
                            <p:ajax event="valueChange" listener="#{managedOperationCaisse.addParamDates()}" update="dates_search_operation"/>
                        </h:selectBooleanCheckbox>
                        <h:panelGroup id="dates_search_operation" style="margin-top: -2px;float: right">
                            <p:calendar value="#{managedOperationCaisse.debutSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedOperationCaisse.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedOperationCaisse.addParamDates()}"/>
                            </p:calendar>
                            <p:calendar value="#{managedOperationCaisse.finSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedOperationCaisse.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedOperationCaisse.addParamDates()}"/>
                            </p:calendar>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:inputText value="#{managedOperationCaisse.typeSource}" >
                        <p:ajax event="keyup" listener="#{managedOperationCaisse.addParamTypeSource(managedOperationCaisse.typeSource)}" />
                    </h:inputText>                    
                    <h:selectOneMenu value="#{managedOperationCaisse.caisseFind}" valueChangeListener="#{managedOperationCaisse.addParamCaisse}">
                        <f:selectItem itemValue="#{null}" itemLabel="#{lab.L_tout}" /> 
                        <f:selectItems value="#{managedOperationCaisse.caisses}" var="icais_" 
                                       itemLabel="#{icais_.referenceCaisse}" itemValue="#{icais_.id}" /> 
                        <p:ajax event="valueChange" listener="#{managedOperationCaisse.addParamCaisse}"/>
                    </h:selectOneMenu>
                    <h:selectOneMenu value="#{managedOperationCaisse.natureFind}" valueChangeListener="#{managedOperationCaisse.addParamNature}">
                        <f:selectItem itemValue="#{null}" itemLabel="#{lab.L_tout}" /> 
                        <f:selectItem itemValue="#{constantes.MUT_SENS_OP_DEPOT}" itemLabel="#{lab.LDB_PA_depot}" /> 
                        <f:selectItem itemValue="#{constantes.MUT_SENS_OP_RETRAIT}" itemLabel="#{lab.LM_PMC_retrait}" /> 
                        <p:ajax event="valueChange" />
                    </h:selectOneMenu>
                    <h:panelGroup>
                        <h:inputText value="#{managedOperationCaisse.montantSearch}" style="width: 80px">
                            <p:ajax event="blur" listener="#{managedOperationCaisse.addParamMontant()}" />
                        </h:inputText> 
                        <h:inputText value="#{managedOperationCaisse.montant2Search}"  style="width: 80px">
                            <p:ajax event="blur" listener="#{managedOperationCaisse.addParamMontant()}" />
                        </h:inputText> 
                    </h:panelGroup>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

