<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Avance','modMutuelle', 'smenAvance', true,managedAvanceSalaire)}
    </ui:define>   
    <ui:define name="contents"> 
        #{managedMutualiste.loadActif(true)}
        #{managedTypeAvance.loadAll()}  
        #{managedAvanceSalaire.loadAll()}
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 140);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('avance');
            });
        </script>

        <h:form>
            <p:remoteCommand name="updateBeanCaisse_" actionListener="#{managedMutuelle.updateBeanCaisse()}"/>
        </h:form>
        <h:form>
            <p:remoteCommand name="saveBeanAvance_" actionListener="#{managedAvanceSalaire.saveNew()}"/>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmCreate" closeOnEscape="true"
                             message="L'exercice correspondant au jour actuel n'existe pas. Créer?" header="Confirmation">
                <p:commandButton value="Oui" onclick="dlgConfirmCreate.hide()" oncomplete="dlgAddExercice.show()" global="false"/>
                <p:commandButton type="button" value="Non" onclick="dlgConfirmCreate.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="Création d'exercice" widgetVar="dlgAddExercice" 
                      width="25%" modal="true" closeOnEscape="true">
                <h:panelGrid columns="1" styleClass="yvs_table" style="width: 100%">
                    <h:panelGrid columns="2" styleClass="yvs_table" style="width: 98%;margin: auto"> 
                        <span>Reference </span>  
                        <h:inputText value="#{exercice.reference}"/>
                        <span>Date Debut </span> 
                        <p:calendar value="#{exercice.dateDebut}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>Date Fin </span>
                        <p:calendar value="#{exercice.dateFin}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>Actif </span>
                        <h:selectBooleanCheckbox value="#{exercice.actif}"/>
                    </h:panelGrid>
                    <p:commandButton value="Enregistrer" actionListener="#{managedExercice.saveNew()}"
                                     oncomplete="dlgAddExercice.hide(); saveBeanAvance_()" style="width: 100%"/> 
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form>  

        <!-->
        *****************************************************************************
        Boite de dialogue de reglement
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgReglement_1">
            <p:dialog id="dlgReglement_1" header="Réglement Avance" widgetVar="dlgReglement"
                      modal="true" width="20%" closeOnEscape="true">  
                <h:panelGrid columns="2" styleClass="yvs_table" style="width: 98%;margin: auto">
                    <span>Montant </span>
                    <pe:inputNumber value="#{managedAvanceSalaire.reglement.montant}"/>
                </h:panelGrid>
                <p:commandButton value="Enregistrer" actionListener="#{managedAvanceSalaire.saveNewReglement()}" 
                                 oncomplete="dlgReglement.hide()" style="width: 100%"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue motif de refus
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgMotifRefus_">
            <p:dialog id="dlgMotifRefus_" header="Motif Refus" widgetVar="dlgMotifRefus" modal="true" width="25%" closeOnEscape="true">  
                <h:inputTextarea id="blog_form_motif_refus" value="#{managedAvanceSalaire.avanceSelect.motifRefus}"
                                 style="width: 98%" rows="5" readonly="true"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="form_dlgMotifRefus1_">
            <p:dialog id="dlgMotifRefus1_" header="Motif Refus" widgetVar="dlgMotifRefus1" modal="true" width="25%" closeOnEscape="true">  
                <h:inputTextarea id="blog_form_motif_refus_" value="#{avanceSalaire.motifRefus}" readonly="true"
                                 style="width: 98%" rows="5"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue des mutualistes 
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="Mutualistes" widgetVar="dlgListMutualistes" modal="true" width="60%" height="465" closeOnEscape="true">  
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:panelGroup>
                        <h:inputText value="#{managedMutualiste.numSearch}" >
                            <p:ajax event="valueChange" listener="#{managedMutualiste.addParamReference()}"  update="data_mutualiste_ava"/>
                        </h:inputText>
                    </h:panelGroup>
                    <h:panelGroup style="float: right">
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedMutualiste.paginer(false)}" update="data_mutualiste_ava" icon="ui-icon-circle-triangle-w"  disabled="#{managedMutualiste.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedMutualiste.paginator.currentPage}/#{managedMutualiste.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedMutualiste.paginer(true)}" update="data_mutualiste_ava" icon="ui-icon-circle-triangle-e"  disabled="#{managedMutualiste.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedMutualiste.imax}" label="Nombre max Résultat" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedMutualiste.choosePaginator}">
                                <f:selectItems value="#{managedMutualiste.paginations}" />
                                <p:ajax event="valueChange"  update="data_mutualiste_ava" />
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </h:panelGroup>
                </h:panelGrid>
                <p:dataTable id="data_mutualiste_ava" value="#{managedMutualiste.mutualistes}" var="mutua_" rowKey="#{mutua_.id}" rowIndexVar="mutua_Idx"
                             selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedAvanceSalaire.loadOnViewMutualiste}" oncomplete="dlgListMutualistes.hide()"/>
                    <p:column headerText="N°" width="15">
                        <span>#{mutua_Idx+1}</span>
                    </p:column>                            
                    <p:column headerText="Matricule" >
                        <span>#{mutua_.employe.matricule}</span>                 
                    </p:column>
                    <p:column headerText="Prénom &amp; Nom" >
                        <span>#{mutua_.employe.prenom} #{mutua_.employe.nom}</span>                 
                    </p:column>
                    <p:column headerText="Agence" >
                        <span>#{mutua_.employe.agence.designation}</span>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue des conditions
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgCondition_ev">
            <p:dialog id="dlgCondition_ev" header="Conditions" widgetVar="dlgCondition"
                      modal="true" width="40%" closeOnEscape="true">  
                <p:dataTable id="data_avance_condition_ev" value="#{managedAvanceSalaire.avanceSelect.conditions}" var="cond__" rowIndexVar="condIdx__">
                    <p:column headerText="N°" style="width: 8%;text-align: center">
                        <span>#{condIdx__+1}</span>
                    </p:column>
                    <p:column headerText="Conditions">
                        <span style="font-weight: bolder">#{cond__.libelle} </span>
                        <span>(valeur requise '</span>
                        <i>
                            <h:outputText style="color: blue" value="Paramètre Incorrect" rendered="#{(cond__.valeurRequise!=null)?cond__.valeurRequise=='':true}"/>
                            <h:outputText style="color: blue" value="#{cond__.valeurRequise}" rendered="#{(cond__.code!='F')}" converter="DN"/>
                            <h:outputText style="color: blue" value="#{cond__.valeurRequise}" rendered="#{(cond__.code=='F')}" converter="NBH"/>
                            <h:outputText style="color: #666" value=" au " rendered="#{(cond__.code=='F')}"/>
                            <h:outputText style="color: blue" value="#{cond__.valeurRequise2}" rendered="#{(cond__.code=='F')}" converter="NBH"/>
                            <span>&nbsp;#{cond_.unite}</span>
                        </i>
                        <span>' valeur entrée '</span>
                        <i>
                            <h:outputText style="color: #{(!cond__.correct)?'red':'green'}; font-weight: bold" 
                                          value="#{cond__.valeurEntree}" rendered="#{(cond__.code!='F')}" converter="DNS"/>
                            <h:outputText style="color: #{(!cond__.correct)?'red':'green'}; font-weight: bold" 
                                          value="#{cond__.valeurEntree}" rendered="#{(cond__.code=='F')}" converter="NBH"/>
                            <span>&nbsp;#{cond__.unite}</span>
                        </i>
                        <span>')</span>
                    </p:column>
                    <p:column headerText="Valide" style="width: 12%;text-align: center">
                        <p:commandLink global="false" actionListener="#{managedAvanceSalaire.activeCondition(cond__)}" >
                            <h:graphicImage library="img"  name="#{(cond__.correct)?'vu.png':'no.png'}" width="15" height="15"/>
                        </p:commandLink>
                    </p:column>                            
                </p:dataTable>                        
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de type d'avance
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="form_dlgAddTypeAvance_">
            <p:dialog id="dlgAddTypeAvance_" header="Créer un type d'avance" widgetVar="dlgAddTypeAvance" 
                      modal="true" width="35%"  closeOnEscape="true"> 
                <h:panelGrid columns="2" style="width: 100%;margin: auto" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                    <span>Designation </span>
                    <h:inputText value="#{typeAvance.designation}"/>
                    <span>Nature </span>
                    <p:selectOneRadio value="#{typeAvance.natureMontant}">
                        <f:selectItem itemLabel="Fixe" itemValue="Fixe" />
                        <f:selectItem itemLabel="% Salaire" itemValue="Pourcentage" />
                    </p:selectOneRadio>
                    <span>Montant maximal </span>
                    <pe:inputNumber value="#{typeAvance.montantMaximal}" style="width: 90px"/>
                    <span>Taux </span>
                    <pe:inputNumber value="#{typeAvance.tauxMaximal}" symbol=" %" symbolPosition="suffixe" style="width: 90px"/>
                    <span>Période </span>
                    <pe:inputNumber value="#{typeAvance.periodeMaximal}" symbol=" mois" symbolPosition="suffixe" style="width: 90px"/>
                </h:panelGrid>
                <p:commandButton value="Enregistrer" style="float: right" oncomplete="dlgAddTypeAvance.hide()"
                                 actionListener="#{managedTypeAvance.saveNew()}" update=":main_avance:type_avance"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedAvanceSalaire.deleteBean()}" oncomplete="dlgConfirmDelete.hide(); afterDeleteAvanceSalaire()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_avance">  
            <div class="part_fix">
                <p:commandButton value="Enregistrer" id="save_av" actionListener="#{managedAvanceSalaire.saveNew()}"/>
                <p:commandButton value="Nouveau" id="cancel_av" global="false" actionListener="#{managedAvanceSalaire.resetFiche()}" update="blog_form_avance"/>
                <p:commandButton value="Modifier" rendered="false" id="update_av" actionListener="#{managedAvanceSalaire.updateBean()}" oncomplete="collapseForm();return false"/>
                <p:commandButton value="Supprimer" global="false" id="delete_avance" actionListener="#{managedAvanceSalaire.deleteBean()}">
                    <!--<p:confirm message="Voulez-vous vraiment supprimer?" header="supprimer les avances" />-->
                </p:commandButton>
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedAvanceSalaire.parcoursInAllResult(false)}" update="txt_parc_linear_avance" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('avance')"/>
                    <h:inputText value="#{managedAvanceSalaire.offset}" style="width: 35px; text-align: center;"  title="Aller au N°..." id="txt_parc_linear_avance"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedAvanceSalaire.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedAvanceSalaire.parcoursInAllResult(true)}" update="txt_parc_linear_avance" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('avance')"/>
                </h:panelGroup>                
                <div style="float: right">
                    <h:panelGrid columns="3" cellpadding="0" cellspacing="0">
                        <h:link title="mode création" onclick="collapseForm('avance');
                                return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="20" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>  
                        <h:link title="vue liste" onclick="collapseList('avance');
                                return false" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="20" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>  
                    </h:panelGrid>
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_avance">
                    <h:inputHidden id="input_hide_reset_avance" value="#{managedAvanceSalaire.input_reset}"/>
                    <p:outputPanel id="blog_form_avance" style="width: 99%; margin: auto; background: white">
                        <div style="width: 45%;float: left">
                            <h:panelGrid columns="2" styleClass="yvs_table" style="width: 100%;margin: auto" cellpadding="0" cellspacing="0">
                                <f:facet name="header">
                                    <h:panelGrid columns="2" styleClass="yvs_nostyle" style="float: left;font-size: large;background: black;color: white;float: left" rendered="#{avanceSalaire.id>0}">                                            
                                        <span style="font-size: initial">Reference : </span>
                                        <h:outputText id="txt_reference_avance_mut" value="#{avanceSalaire.reference}"/>
                                    </h:panelGrid>
                                </f:facet>
                                <span>Mutualiste </span> 
                                <h:panelGroup id="txt_mutualiste_avance">
                                    <h:inputText value="#{avanceSalaire.mutualiste.matricule}" style="color: #{avanceSalaire.mutualiste.error?'red':''}">
                                        <p:ajax event="blur" global="false" listener="#{managedAvanceSalaire.searchMutualiste()}" update="txt_mutualiste_avance"/>
                                    </h:inputText>    
                                    <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="Liste Client" global="false"
                                                     actionListener="#{managedAvanceSalaire.initMutualistes()}" oncomplete="dlgListMutualistes.show()"/> 
                                    <h:outputText value="#{avanceSalaire.mutualiste.employe.nom_prenom}" style="margin-left: 10px;color: #009999"/>
                                </h:panelGroup>                                               
                                <span>Type Avance </span>
                                <h:selectOneMenu value="#{avanceSalaire.type.id}" id="type_avance" style="min-width: 160px">
                                    <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                    <f:selectItems value="#{managedTypeAvance.types}" var="typA"
                                                   itemLabel="#{typA.designation}" itemValue="#{typA.id}"/>
                                    <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                    <f:selectItem itemLabel="Créer..." itemValue="-1"/>
                                    <p:ajax event="valueChange" global="false" process="@this txt_montant_ac" 
                                            listener="#{managedAvanceSalaire.chooseTypeAvance()}"/>
                                </h:selectOneMenu>
                                <span>Montant </span> 
                                <pe:inputNumber value="#{avanceSalaire.montant}" id="txt_montant_ac">
                                    <p:ajax event="valueChange" global="false" listener="#{managedAvanceSalaire.setConditionAvance()}"/>
                                </pe:inputNumber>
                                <span>Salaire restant </span> 
                                <p:inputText value="#{avanceSalaire.mutualiste.montantResteEpargne}" converter="DN" readonly="true"/>
                                <span>Date Avance </span>
                                <h:panelGroup>
                                    <p:calendar value="#{avanceSalaire.dateAvance}" pattern="dd-MM-yyyy" size="10">
                                        <p:ajax event="valueChange" global="false" listener="#{managedAvanceSalaire.setConditionAvance()}"/>                                    
                                    </p:calendar> 
                                    <p:commandLink id="txt_etat_credit_" title="Voir le motif" global="false" rendered="#{avanceSalaire.etat==constantes.ETAT_ANNULE}"
                                                   actionListener="#{managedAvanceSalaire.update('blog_form_motif_refus_')}" oncomplete="dlgMotifRefus1.show()">
                                        <p:graphicImage library="img" name="pointe.png" width="20" height="20"
                                                        style="border: 2px solid #666; border-radius: 5px;float: right;margin-bottom: 0.5%"/>
                                    </p:commandLink>  
                                </h:panelGroup>   
                                <f:facet name="footer">
                                    <span>Salaire mensuel </span>  
                                    <h:outputText value="#{avanceSalaire.mutualiste.montantSalaire}"  converter="DN" 
                                                  style="float: right;text-align: right; font-size: 1.2em; font-weight: bold; color: #006666"/>
                                </f:facet>
                            </h:panelGrid>
                        </div>                                
                        <div style="width: 55%;margin-left: 45%">
                            <p:outputPanel autoUpdate="true"> 
                                <p:outputPanel id="view_etat_avance" rendered="#{avanceSalaire.id>0}">
                                    <div style="float: right">
                                        <p:commandLink actionListener="#{managedAvanceSalaire.editerCredit()}" disabled="#{avanceSalaire.etat==constantes.ETAT_EDITABLE}">
                                            <li class="file_#{avanceSalaire.etat==constantes.ETAT_EDITABLE}" >Editable</li>
                                        </p:commandLink>
                                        <p:commandLink actionListener="#{managedAvanceSalaire.soumettreCredit()}" rendered="#{avanceSalaire.etat==constantes.ETAT_SOUMIS or avanceSalaire.etat==constantes.ETAT_EDITABLE}" disabled="#{avanceSalaire.etat==constantes.ETAT_SOUMIS}">
                                            <li class="file_#{avanceSalaire.etat==constantes.ETAT_SOUMIS}">Soumis</li>
                                        </p:commandLink>                                                
                                        <p:commandLink actionListener="#{managedAvanceSalaire.annulerCredit()}" rendered="#{(avanceSalaire.etat==constantes.ETAT_SOUMIS or avanceSalaire.etat==constantes.ETAT_ANNULE or avanceSalaire.etat==constantes.ETAT_ATTENTE)}">
                                            <li class="file_#{avanceSalaire.etat==constantes.ETAT_ANNULE or avanceSalaire.etat==constantes.ETAT_ATTENTE}">#{(avanceSalaire.etat==constantes.ETAT_ANNULE)?'Refusé':'En Attente'}</li>
                                        </p:commandLink>
                                        <p:commandLink actionListener="#{managedAvanceSalaire.accorderCredit()}" rendered="#{(avanceSalaire.etat==constantes.ETAT_VALIDE)}" disabled="#{avanceSalaire.etat==constantes.ETAT_VALIDE}">
                                            <li class="file_#{avanceSalaire.etat==constantes.ETAT_VALIDE}">Accordé</li>
                                        </p:commandLink>
                                        <p:commandLink actionListener="#{managedAvanceSalaire.updateEtatCredit(constantes.ETAT_RELANCE,'')}" rendered="#{(avanceSalaire.etat==constantes.ETAT_ANNULE)}" disabled="#{avanceSalaire.etat==constantes.ETAT_RELANCE}">
                                            <li class="file_#{avanceSalaire.etat==constantes.ETAT_RELANCE}">Relancer</li>
                                        </p:commandLink>  
                                        <p:commandLink actionListener="#{managedCredit.voirEchenacier()}" onclick="dlgReglement.show()" rendered="#{(avanceSalaire.etat==constantes.ETAT_VALIDE)}" disabled="#{avanceSalaire.etat==constantes.ETAT_REGLE}">
                                            <li class="file_#{avanceSalaire.etat==constantes.ETAT_REGLE}">Regler</li>
                                        </p:commandLink>  
                                    </div>
                                    <div style="clear: right"/>
                                </p:outputPanel>
                            </p:outputPanel>
                            <div style="width: 98.5%; border: solid 2px; height: 182px; padding: 2px; border-radius: 5px;margin-top: 5px;">
                                <span style="display: inline-block; background: #CCC; width: 100%">
                                    Credits du mois 
                                    <h:panelGroup style="float: right">
                                        <span style="font-weight: bolder">Salaire du mois </span>  
                                        <h:outputText value="#{avanceSalaire.mutualiste.montantSalaire}" converter="DN" style="font-weight: bolder"/>
                                        <span style="font-size: 0.8em"> Fcfa</span>  
                                    </h:panelGroup>
                                </span>
                                <div class="zone_slide" style="width: 99.5%; border: solid 1px; height: 150px; margin: auto;overflow-y: auto">
                                    <p:dataTable id="date_mensualite_echeancier_avance" value="#{managedAvanceSalaire.mensualites}" var="mens"
                                                 rowKey="#{mens.id}" rowIndexVar="mensIdx" selectionMode="single" style="font-size: 0.8em">
                                        <p:column headerText="N°" style="width: 8%;text-align: center" styleClass="statut_#{mens.etat}">
                                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{mens.new_}"/>
                                            <span>#{mensIdx+1}</span>
                                        </p:column>
                                        <p:column headerText="Montant" style="text-align: right" styleClass="statut_#{mens.etat}">
                                            <h:outputText value="#{mens.montant}" converter="DN"/>
                                        </p:column>
                                        <p:column headerText="Amortissement" style="text-align: right" styleClass="statut_#{mens.etat}">
                                            <h:outputText value="#{mens.amortissement}" converter="DN"/>
                                        </p:column>
                                        <p:column headerText="Interet" style="text-align: right" styleClass="statut_#{mens.etat}">
                                            <h:outputText value="#{mens.interet}" converter="DN"/>
                                        </p:column>
                                        <p:column headerText="Reste" style="text-align: right" styleClass="statut_#{mens.etat}">
                                            <h:outputText value="#{mens.montantReste}" converter="DN"/>
                                        </p:column>
                                    </p:dataTable>
                                </div>                                    
                            </div>    
                        </div>
                        <div style="clear: both"/>
                        <p:tabView id="tabview_avance">
                            <p:tab title="Conditions">
                                <p:dataTable id="data_avance_condition" value="#{avanceSalaire.conditions}" var="cond" rowIndexVar="condIdx">
                                    <p:column headerText="N°" style="width: 5%;text-align: center">
                                        <span>#{condIdx+1}</span>
                                    </p:column>
                                    <p:column headerText="Conditions">
                                        <span style="font-weight: bolder">#{cond.libelle} </span>
                                        <span>(valeur requise '</span>
                                        <i>
                                            <h:outputText style="color: blue" value="Paramètre Incorrect" rendered="#{(cond.valeurRequise!=null)?cond.valeurRequise=='':true}"/>
                                            <h:outputText style="color: blue" value="#{cond.valeurRequise}" rendered="#{(cond.code!='F')}" converter="DN"/>
                                            <h:outputText style="color: blue" value="#{cond.valeurRequise}" rendered="#{(cond.code=='F')}" converter="NBH"/>
                                            <h:outputText style="color: #666" value=" au " rendered="#{(cond.code=='F')}"/>
                                            <h:outputText style="color: blue" value="#{cond.valeurRequise2}" rendered="#{(cond.code=='F')}" converter="NBH"/>
                                            <span>&nbsp;#{cond.unite}</span>
                                        </i>
                                        <span>' valeur entrée '</span>
                                        <i>
                                            <h:outputText style="color: #{(!cond.correct)?'red':'green'}; font-weight: bold" 
                                                          value="#{cond.valeurEntree}" rendered="#{(cond.code!='F')}" converter="DNS"/>
                                            <h:outputText style="color: #{(!cond.correct)?'red':'green'}; font-weight: bold" 
                                                          value="#{cond.valeurEntree}" rendered="#{(cond.code=='F')}" converter="NBH"/>
                                            <span>&nbsp;#{cond.unite}</span>
                                        </i>
                                        <span>')</span>
                                    </p:column>
                                    <p:column headerText="OK" style="width: 5%;text-align: center">
                                        <h:graphicImage library="img"  name="#{(cond.correct)?'vu.png':'erase-128.png'}" width="15" height="15"/>
                                    </p:column>
                                </p:dataTable>  
                                <div style="clear: both"/>
                            </p:tab>
                            <p:tab title="Paiements">
                                <p:dataTable id="data_reglement_avance" value="#{managedAvanceSalaire.avanceSelect.reglements}" var="reg" rowIndexVar="regIdx">
                                    <p:column headerText="N°" style="width: 5%;text-align: center">
                                        <span>#{regIdx+1}</span>
                                    </p:column>
                                    <p:column headerText="Date Reglement">
                                        <h:outputText value="#{reg.dateReglement}" converter="DATE"/>                
                                    </p:column>
                                    <p:column headerText="Montant">
                                        <h:outputText value="#{reg.montant}" converter="DN" style="text-align: right"/>
                                    </p:column>
                                </p:dataTable>
                                <div style="clear: both"/>
                            </p:tab>
                            <p:tab title="Historiques">
                                <p:dataTable id="data_avance_mutualiste_avance" value="#{managedAvanceSalaire.avancesMut}" var="avanMut" rowKey="#{avanMut.id}" rowIndexVar="avanMutIdx">
                                    <p:column headerText="N°" style="width: 5%;text-align: center" styleClass="statut_#{avanMut.etat}">
                                        <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{avanMut.new_}"/>
                                        <span>#{avanMutIdx+1}</span>
                                    </p:column>
                                    <p:column headerText="Date Debut" styleClass="statut_#{avanMut.etat}">
                                        <h:outputText value="#{avanMut.dateAvance}" converter="DATE"/>
                                    </p:column>
                                    <p:column headerText="Montant" styleClass="statut_#{avanMut.etat}">
                                        <h:outputText value="#{avanMut.montant}" converter="DN" style="text-align: right"/>
                                    </p:column>
                                    <p:column headerText="Reste" styleClass="statut_#{avanMut.etat}">
                                        <h:outputText value="#{avanMut.montantReste}" converter="DN"/>
                                    </p:column>
                                    <f:facet name="footer">
                                        <span style="font-weight: bolder">Montant Total : </span>
                                        <h:outputText style="font-weight: bolder" value="#{avanceSalaire.mutualiste.montantTotalEpargne}" converter="DN"/>
                                    </f:facet>
                                </p:dataTable> 
                            </p:tab>
                        </p:tabView>  
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_avance" style="width: 99%; margin: auto; background: white">
                    <h:inputHidden id="input_hide_avance" value="#{managedAvanceSalaire.tabIds}"/>
                    <p:dataTable id="data_avance" value="#{managedAvanceSalaire.avances}" var="avan" rowKey="#{avan.id}" rowIndexVar="avanIdx"
                                 selectionMode="single" selection="#{managedAvanceSalaire.avanceSelect}">
                        <p:ajax event="rowSelect" global="false" listener="#{managedAvanceSalaire.loadOnView}"  oncomplete="collapseForm('avance');"/>
                        <p:column headerText="N°" width="15" styleClass="statut_#{avan.etat}">
                            <span>#{avanIdx+1}</span>
                        </p:column>
                        <p:column headerText="Matricule" width="100" styleClass="statut_#{avan.etat}">
                            <span>#{avan.mutualiste.employe.matricule}</span>
                        </p:column>
                        <p:column headerText="Mutualiste" styleClass="statut_#{avan.etat}">
                            <span>#{avan.mutualiste.employe.prenom} #{avan.mutualiste.employe.nom}</span>
                        </p:column>
                        <p:column headerText="Reference" styleClass="statut_#{avan.etat}">
                            <span>#{avan.reference}</span>
                        </p:column>
                        <p:column headerText="Type" styleClass="statut_#{avan.etat}">
                            <span>#{avan.type.designation}</span>
                        </p:column>
                        <p:column headerText="Date Debut" style="text-align: center;" width="100" styleClass="statut_#{avan.etat}">
                            <h:outputText value="#{avan.dateAvance}" converter="DATE"/>
                        </p:column>
                        <p:column headerText="Montant" style="text-align: right; font-weight: bold" width="100" styleClass="statut_#{avan.etat}">
                            <h:outputText value="#{avan.montant}" converter="DN" />
                        </p:column>
                        <p:column width="20" style="text-align: center">
                            <p:contextMenu for="option_evenement" event="left click" style="font-size: 0.8em">
                                <p:menuitem value="Contraintes" global="false" icon="ui-icon-notice" update=":form_dlgCondition_ev:data_avance_condition_ev" 
                                            oncomplete="dlgCondition.show()" actionListener="#{managedAvanceSalaire.buildForContrainte(avan)}" rendered="#{avan.etat==constantes.ETAT_SOUMIS or avan.etat==constantes.ETAT_EDITABLE}"/>  
                                <p:menuitem value="Motif Refus" global="false" icon="ui-icon-circle-close"  oncomplete="dlgMotifRefus.show()" rendered="#{avan.etat==constantes.ETAT_ANNULE}"
                                            actionListener="#{managedAvanceSalaire.update('blog_form_motif_refus')}"/>
                                <p:separator style="width: 98%;margin: auto"/>
                                <p:menuitem value="Supprimer" icon="ui-icon-trash" actionListener="#{managedAvanceSalaire.deleteBean(avan)}" update="data_avance"/>
                            </p:contextMenu>                           
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="option_evenement" type="button"/> 
                        </p:column>
                        <p:column width="25" style="text-align: center">
                            <f:facet name="header">
                                <h:selectBooleanCheckbox styleClass="chek_all_line_avance" value="false"
                                                         onclick="selectionAllLineTab(#{managedAvanceSalaire.avances.size()}, 'avance')">
                                </h:selectBooleanCheckbox>
                            </f:facet>
                            <h:selectBooleanCheckbox  value="#{avan.selectActif }" styleClass="chek_line_avance" 
                                                      onclick="selectionLineTab(#{avan.id}, 'avance')">
                            </h:selectBooleanCheckbox>
                        </p:column>
                    </p:dataTable>                              
                    <span class="nbSelectavance" style="font-size: .8em; font-style: italic; color: #828c95;"></span>                   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                        <p:commandButton actionListener="#{managedEvenement.paginer(false)}" update="data_avance" icon="ui-icon-circle-triangle-w"  disabled="#{managedEvenement.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedEvenement.paginator.currentPage}/#{managedEvenement.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton action="#{managedEvenement.paginer(true)}" update="data_avance" icon="ui-icon-circle-triangle-e"  disabled="#{managedEvenement.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedEvenement.imax}" label="Nombre max Résultat" style="float: right; font-size: 0.9em;" 
                                         valueChangeListener="#{managedEvenement.choosePaginator}">
                            <f:selectItems value="#{managedEvenement.paginations}" />
                            <p:ajax event="valueChange" update="data_avance" />
                        </p:selectOneMenu>
                    </p:outputPanel>                                                
                </div> 
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false">
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative" width="20" height="20"
                            styleClass="img_slide" title="cacher"/>                    
            <div class="zone_find">                                                              
                <h:panelGrid columns="5" style="font-size: 0.8em; float: left">
                    <h:outputText value="Date" />
                    <h:outputText value="Mutualiste " />
                    <h:outputText value="Type " />  
                    <h:outputText value="Statut " />  
                    <span>&nbsp;</span>
                    <h:panelGroup>
                        <h:selectBooleanCheckbox value="#{managedAvanceSalaire.dateSearch}">
                            <p:ajax event="valueChange" listener="#{managedAvanceSalaire.addParamDates()}" update="dates_search_ava" oncomplete="collapseList('avance')"/>
                        </h:selectBooleanCheckbox>
                        <h:panelGroup id="dates_search_ava" style="margin-top: -2px;float: right">
                            <p:calendar value="#{managedAvanceSalaire.debutSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedAvanceSalaire.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedAvanceSalaire.addParamDates()}" oncomplete="collapseList('avance')"/>
                            </p:calendar>
                            <p:calendar value="#{managedAvanceSalaire.finSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedAvanceSalaire.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedAvanceSalaire.addParamDates()}" oncomplete="collapseList('avance')"/>
                            </p:calendar>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:inputText value="#{managedAvanceSalaire.mutualisteSearch}" >
                        <p:ajax event="valueChange" listener="#{managedAvanceSalaire.addParamMutualiste()}" oncomplete="collapseList('avance')" />
                    </h:inputText>
                    <h:selectOneMenu value="#{managedAvanceSalaire.typeSearch}">
                        <f:selectItem itemValue="0" itemLabel="TOUT" /> 
                        <f:selectItem itemValue="0" itemLabel="--" /> 
                        <f:selectItems value="#{managedTypeAvance.types}" var="typ" itemValue="#{typ.id}" itemLabel="#{typ.designation}" /> 
                        <p:ajax event="valueChange" listener="#{managedAvanceSalaire.addParamType()}" oncomplete="collapseList('avance')"/>
                    </h:selectOneMenu>
                    <h:selectOneMenu value="#{managedAvanceSalaire.statutSearch}">
                        <f:selectItem itemValue="#{null}" itemLabel="TOUT" /> 
                        <f:selectItem itemValue="" itemLabel="--" /> 
                        <f:selectItem itemLabel="EDITABLE" itemValue="#{constantes.ETAT_EDITABLE}"/>
                        <f:selectItem itemLabel="TRANSMIS" itemValue="#{constantes.ETAT_SOUMIS}"/>
                        <f:selectItem itemLabel="VALIDE" itemValue="#{constantes.ETAT_VALIDE}"/>
                        <f:selectItem itemLabel="ANNULE" itemValue="#{constantes.ETAT_ANNULE}"/>
                        <f:selectItem itemLabel="RELANCE" itemValue="#{constantes.ETAT_RELANCE}"/>
                        <f:selectItem itemLabel="PAYER" itemValue="#{constantes.ETAT_REGLE}"/>
                        <p:ajax event="valueChange" listener="#{managedAvanceSalaire.addParamStatut()}" oncomplete="collapseList('avance')"/>
                    </h:selectOneMenu>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

