<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Paie','modMutuelle', 'smenPaie', true,managedPaiementSalaire)}
    </ui:define>   
    <ui:define name="contents"> 
        #{managedMutualiste.loadActif(true)}
        #{managedPaiementSalaire.loadAll()}                
        #{managedTypeCredit.loadAll()}                
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 140);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseGrid('paie');
                slideShow('zone_show_avance_paie', 200);
                slideShow('zone_show_credit_paie', 200);
            });
        </script>               
        <h:form prependId="false">
            <p:dialog header="Nouvelle session de paye" widgetVar="dlgNewPeriode" width="50%"
                      closeOnEscape="true" modal="true" footer="&copy;Lymytz 2014">
                <h:panelGrid columns="2" styleClass="yvs_table" cellpadding="0" cellspacing="0" style="width: 100%">
                    <span>Période RH</span>
                    <h:selectOneMenu value="#{managedPaiementSalaire.newPeriode.id}" 
                                     valueChangeListener="#{managedPaiementSalaire.choiPeriodeSalaireRH}">
                        <f:selectItem itemLabel="--" itemValue="0" />
                        <f:selectItems value="#{managedPaiementSalaire.listPeriodeSalaire}"
                                       var="head_" itemValue="#{head_.id}" itemLabel="#{head_.reference}" />
                        <p:ajax event="valueChange" global="false" update="zone_periode"/>
                    </h:selectOneMenu>
                    <span>Intervalle</span>
                    <h:panelGrid columns="2" id="zone_periode" styleClass="yvs_nostyle">
                        <span>Début </span>
                        <h:inputText disabled="true" value="#{managedPaiementSalaire.newPeriode.periodeRh.debutMois}" converter="DDMMYYYY"/>
                        <span>Fin </span>
                        <h:inputText disabled="true" value="#{managedPaiementSalaire.newPeriode.periodeRh.finMois}" converter="DDMMYYYY"/>
                    </h:panelGrid>
                    <span>Activer</span>
                    <h:selectBooleanCheckbox value="#{managedPaiementSalaire.newPeriode.actif}" />
                </h:panelGrid>
                <p:commandButton value="Enregistrer &amp; charger les salaires" actionListener="#{managedPaiementSalaire.createNewPeriodeSalaireMut()}" update=":form_salaire:listePeriodeRh" style="float: right"/>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmCreate" closeOnEscape="true"
                             message="L'exercice correspondant au jour actuel n'existe pas. Créer?" header="Confirmation">
                <p:commandButton value="Oui" onclick="dlgConfirmCreate.hide()" oncomplete="dlgAddExercice.show()" global="false"/>
                <p:commandButton type="button" value="Non" onclick="dlgConfirmCreate.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->Boite de dialogue de création d'un nouveau crédit en cas d'echec de paiement<-->
        <h:form prependId="false" id="form_dlgcreateCredit_">
            <p:dialog  header="Traitement du Déficit " widgetVar="dlgCreateCredit"
                       modal="true" width="65%" closeOnEscape="true" >  
                <p:outputPanel id="dlgCreateCredit_">
                    <h:panelGrid columns="2"  styleClass="yvs_table" 
                                 style="width: 98%;margin: auto" cellpadding="0" cellspacing="0">
                        <span>Montant du déficit</span>
                        <h:outputText value="#{managedPaiementSalaire.deficit}" converter="DN" styleClass="montantTotal" style="float: right; margin-right: 2px; color: brown; font-size: 1.2em"/>
                        <span>Type de crédit</span>
                        <h:selectOneMenu value="#{managedPaiementSalaire.type.id}">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedTypeCredit.types}" var="typ"
                                           itemLabel="#{typ.designation}" itemValue="#{typ.id}"/>                                    
                        </h:selectOneMenu>
                        <span>Action</span>
                        <p:selectOneRadio value="#{managedPaiementSalaire.parametreMutuelle.actionDeficit}"
                                          style="font-size: 0.8em; font-weight: bold" disabled="#{!managedPaiementSalaire.parametreMutuelle.actionDeficit.equals(constantes.MUT_ACTION_CHOIX)}">
                            <f:selectItem itemLabel="Transformer en crédit" itemValue="#{constantes.MUT_ACTION_TRANSFERE}"/>
                            <f:selectItem itemLabel="Reporter" itemValue="#{constantes.MUT_ACTION_REPORT}"/>
                            <f:selectItem itemLabel="Ne rien faire" itemValue="#{constantes.MUT_ACTION_RIEN}"/>                                
                            <p:ajax event="valueChange" listener="#{managedPaiementSalaire.traiterLedeficit()}" 
                                    update="dlgCreateCredit_ :form_salaire:blog_form_paie" />
                        </p:selectOneRadio>
                    </h:panelGrid>
                    <p:outputPanel rendered="#{managedPaiementSalaire.parametreMutuelle.actionDeficit.equals(constantes.MUT_ACTION_REPORT) and  managedMutualiste.mutualistes.size()!=0}">
                        <p:dataTable  value="#{managedPaiementSalaire.mensualites}" var="mens"
                                      rowKey="#{mens.id}" rowIndexVar="mensIdx" selection="#{managedPaiementSalaire.mensualiteSelect}" selectionMode="single">
                            <f:facet name="header">Mensualité à reporter</f:facet>
                            <p:column headerText="N°" style="width: 12%;text-align: center">
                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{mens.new_}"/>
                                <span>#{mensIdx+1}</span>
                            </p:column>                                                
                            <p:column headerText="Date" width="100" style="text-align: center">
                                <h:outputText value="#{mens.dateMensualite}" style="text-align: right" converter="DDMMYYYY"/>
                            </p:column>
                            <p:column headerText="Montant">
                                <h:outputText value="#{util.arrondi(mens.montant,2)}" converter="DN" style="text-align: right"/>
                            </p:column>
                            <p:column headerText="Reste">
                                <h:outputText value="#{util.arrondi(mens.montantReste,2)}" converter="DN" style="text-align: right"/>
                            </p:column>
                            <p:column headerText="Etat">
                                <span>#{mens.etat}</span>
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                </p:outputPanel>
                <p:commandButton actionListener="#{managedPaiementSalaire.terminatedSaveSalaire()}" 
                                 value="Enregistrer" style="float: right"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="Création d'exercice" widgetVar="dlgAddExercice" 
                      width="25%" modal="true" closeOnEscape="true">
                <h:panelGrid columns="1" styleClass="yvs_table" style="width: 100%">
                    <h:panelGrid columns="2" styleClass="yvs_table" style="width: 98%;margin: auto"> 
                        <span>Reference </span>  
                        <h:inputText value="#{exercice.reference}"/>
                        <span>Date Debut </span> 
                        <p:calendar value="#{exercice.dateDebut}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>Date Fin </span>
                        <p:calendar value="#{exercice.dateFin}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>Actif </span>
                        <h:selectBooleanCheckbox value="#{exercice.actif}"/>
                    </h:panelGrid>
                    <p:commandButton value="Enregistrer" actionListener="#{managedExercice.saveNew()}"
                                     oncomplete="dlgAddExercice.hide(); saveBeanPaie_()" style="width: 100%"/> 
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form>    
        <!-->
        *****************************************************************************
        Boite de dialogue des mutualistes 
        *****************************************************************************
        <-->  
        <h:form prependId="false" >
            <p:dialog header="Liste des Mutualistes" widgetVar="dlgListMutualistes" modal="true" width="60%" height="435" closeOnEscape="true">  
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:panelGroup>
                        <h:inputText value="#{managedMutualiste.numSearch}" >
                            <p:ajax event="keyup" listener="#{managedMutualiste.addParamReference()}" update="data_mutualiste_paie"/>
                        </h:inputText>
                    </h:panelGroup>
                    <h:panelGroup style="float: right">
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedMutualiste.paginer(false)}" update="data_mutualiste_paie" icon="ui-icon-circle-triangle-w"  disabled="#{managedMutualiste.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedMutualiste.paginator.currentPage}/#{managedMutualiste.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedMutualiste.paginer(true)}" update="data_mutualiste_paie" icon="ui-icon-circle-triangle-e"  disabled="#{managedMutualiste.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedMutualiste.imax}" label="Nombre max Résultat" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedMutualiste.choosePaginator}">
                                <f:selectItems value="#{managedMutualiste.paginations}" />
                                <p:ajax event="valueChange"  update="data_mutualiste_paie" />
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </h:panelGroup>
                </h:panelGrid>
                <p:dataTable id="data_mutualiste_paie" value="#{managedMutualiste.mutualistes}" var="mutua_" 
                             rowKey="#{mutua_.id}" rowIndexVar="mutua_Idx" selectionMode="single" style="clear: right">
                    <p:ajax event="rowSelect" global="false" listener="#{managedPaiementSalaire.loadOnViewMutualiste}" 
                            oncomplete="dlgListMutualistes.hide()" update=":form_salaire:blog_form_paie :form_salaire:data_paie_mutualiste"/>
                    <p:column headerText="N°" style="text-align: center" width="15">
                        <span>#{mutua_Idx+1}</span>
                    </p:column>
                    <p:column headerText="Mutricule" style="text-align: center">
                        <span>#{mutua_.employe.matricule}</span>
                    </p:column>
                    <p:column headerText="Prénom &amp; Nom" >
                        <span>#{mutua_.employe.prenom} #{mutua_.employe.nom}</span>                 
                    </p:column>                         
                    <p:column headerText="Agence" >
                        <span>#{mutua_.employe.agence.designation}</span>
                    </p:column>
                </p:dataTable>                        
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>



        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedPaiementSalaire.deleteBean()}" oncomplete="dlgConfirmDelete.hide(); afterDeletePaiementSalaire()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog showEffect="fade" hideEffect="explode">
                <p:commandButton value="Oui" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="Non" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="form_salaire">                        
            <div class="part_fix">
                <p:commandButton value="Enregistrer" id="save_paie" actionListener="#{managedPaiementSalaire.saveSalaireMonth(false)}" update="data_paie"/>
                <p:commandButton value="Nouveau" id="cancel_paie" global="false" actionListener="#{managedPaiementSalaire.resetFiche()}" update="blog_form_paie right_panel_paie"/>
                <p:commandButton value="Modifier" rendered="false" id="update_pa" actionListener="#{managedPaiementSalaire.updateBean()}" oncomplete="collapseForm();return false"/>
                <p:commandButton value="Supprimer" global="false" id="delete_paie" actionListener="#{managedMutuelle.deleteBean()}">
                    <!--<p:confirm message="Voulez-vous vraiment supprimer?" header="supprimer les mutuelles" />-->
                </p:commandButton>
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedPaiementSalaire.parcoursInAllResult(false)}" update="txt_parc_linear_paie" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('paie')"/>
                    <h:inputText value="#{managedPaiementSalaire.offset}" style="width: 35px; text-align: center;"  title="Aller au N°..." id="txt_parc_linear_paie"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedPaiementSalaire.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedPaiementSalaire.parcoursInAllResult(true)}" update="txt_parc_linear_paie" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('paie')"/>
                </h:panelGroup>                
                <div style="float: right">
                    <h:panelGrid columns="6" cellpadding="0" cellspacing="0">
                        <h:link title="mode création" onclick="collapseForm('paie');
                                return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <h:link title="vue liste" onclick="collapseList('paie');
                                return false" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>
                        <h:link title="Listes de périodes de salaire" onclick="collapseGrid('paie');
                                return false">
                            <p:graphicImage library="icones" name="ico_arbre.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link> 
                    </h:panelGrid>
                </div>
            </div>
            <div class="part_scroll" style="background: white">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_paie">
                    <h:inputHidden id="input_hide_reset_pa" value="#{managedPaiementSalaire.input_reset}"/>
                    <div style="width: 60%;float: left; background: whitesmoke; border-right: 2px solid #006666">
                        <div style="width: 80%;float: left">
                            <p:outputPanel id="zone_header" >                                    
                                <h:panelGroup style="float: left">
                                    <h:outputText value="Session de Paye de : " style="font-size: 1.1em; font-weight: bold"/>
                                    <h:outputText value="#{managedPaiementSalaire.selectedPeriode.periodeRh.reference}" style="background: #000; color: white"/>
                                </h:panelGroup>
                                <h:panelGroup style="float: right">                                        
                                    <h:outputText value="#{managedPaiementSalaire.selectedPeriode.periodeRh.debutMois}" style="color: #006666; font-weight: bold" converter="DDMMYYYY"/>
                                    --
                                    <h:outputText value="#{managedPaiementSalaire.selectedPeriode.periodeRh.finMois}" style="color: #006666; font-weight: bold" converter="DDMMYYYY"/>
                                </h:panelGroup>   
                                <div style="clear: both"/>
                                <h:panelGroup>                  
                                    <h:outputText value="Cette session de paye est innactive" styleClass="sess_inactif" rendered="#{!managedPaiementSalaire.selectedPeriode.actif}" />
                                    <h:outputText value="Cette session de paye est clôturé" styleClass="sess_inactif" rendered="#{(!managedPaiementSalaire.selectedPeriode.actif)?managedPaiementSalaire.selectedPeriode.cloture:false}" />                                    
                                </h:panelGroup>   
                            </p:outputPanel>                                 
                            <br style="clear: both"/>
                            <br />
                            <h:panelGroup >
                                <span style="float: left">Matricule  Employé</span>
                                <h:inputText id="txt_matricule" value="#{managedPaiementSalaire.matricule}" >
                                    <p:ajax event="blur" listener="#{managedPaiementSalaire.findMutualisteByMatricule()}" 
                                            update=":form_salaire:blog_form_paie :form_salaire:data_paie_mutualiste right_panel_paie" />
                                </h:inputText>
                            </h:panelGroup>                            
                        </div>
                        <div style="width: 19%;margin-left: 81%">
                            <div style="float: right">
                                <p:graphicImage library="lymytz/documents/docEmps/perso/photo" style="max-height: 100px"
                                                name="#{(managedPaiementSalaire.paiementSalaire.mutualiste.employe.photos==null)?'user1.png':managedPaiementSalaire.paiementSalaire.mutualiste.employe.photos}" id="photos_mut_"/>
                            </div>
                        </div>
                        <p:outputPanel id="blog_form_paie" style="width: 100%; margin: auto; background: white; clear: both">
                            <p:outputPanel style="width: 100%">                                        
                                <div style="width: 100%;">                                           
                                    <h:panelGrid columns="2" styleClass="yvs_table" cellpadding="0" cellspacing="0" style="width: 100%">                                                 
                                        <span>Mutualiste </span> 
                                        <h:panelGroup id="txt_mutualiste_avance_pa">
                                            <h:inputText value="#{managedPaiementSalaire.paiementSalaire.mutualiste.matricule}" style="color: #{managedPaiementSalaire.paiementSalaire.mutualiste.error?'red':''}">
                                                <p:ajax event="blur" global="false" listener="#{managedPaiementSalaire.searchMutualiste()}" update="txt_mutualiste_avance_pa"/>
                                            </h:inputText>    
                                            <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="Liste Client" global="false"
                                                             actionListener="#{managedPaiementSalaire.initMutualistes()}" oncomplete="dlgListMutualistes.show()"/> 
                                            <h:outputText value="#{managedPaiementSalaire.paiementSalaire.mutualiste.employe.nom_prenom}" style="margin-left: 10px;color: #009999"/>                                                    
                                        </h:panelGroup>
                                        <span>Date de paiement</span>
                                        <h:panelGroup>
                                            <p:inplace label="'modifier la date '" styleClass="label_" style="font-size: 0.8em" id="inplace_date_paie">
                                                <p:calendar value="#{managedPaiementSalaire.paiementSalaire.datePaiement}" size="8" pattern="dd-MM-yyyy" >
                                                    <p:ajax event="dateSelect" update="date_paie inplace_date_paie" process="@this" />
                                                </p:calendar>
                                            </p:inplace>
                                            <h:outputText value="#{managedPaiementSalaire.paiementSalaire.datePaiement}" style="float: right" id="date_paie" styleClass="label_" converter="DDMMYYYY" />
                                        </h:panelGroup>
                                        <span>Salaire du mois</span>  
                                        <h:panelGroup style="font-weight: bold; font-size: 1.2em; float: right">
                                            <h:outputText id="txt_salaire_mutualiste" value="#{managedPaiementSalaire.paiementSalaire.montantAPayer}" 
                                                          converter="DN"  /> Fcfa </h:panelGroup>                                                 
                                    </h:panelGrid>
                                    <h:panelGrid columns="4" style="width: 100%">
                                        <span class="label_">Retenue Epargne du mois</span>
                                        <h:panelGroup>                                                    
                                            <h:outputText id="txt_epargne_mutualiste" value="#{managedPaiementSalaire.paiementSalaire.mutualiste.montantEpargne}" 
                                                          converter="DN" style="font-weight: bold; font-size: 1.2em"/> Fcfa 
                                        </h:panelGroup>
                                        <span class="label_">Solde du compte salaire</span>
                                        <h:panelGroup>                                                    
                                            <h:outputText  value="#{managedPaiementSalaire.paiementSalaire.soldeCompteSalaire}" 
                                                           converter="DN" style="font-weight: bold; font-size: 1.2em"/> Fcfa 
                                        </h:panelGroup>
                                    </h:panelGrid>
                                </div>
                                <br />
                                <div style="clear: left"/>
                                <div style="width: 100%; font-size: 1.3em; font-style: italic; color: #009999" >
                                    Montant net à payer : <span style="float: right; color: #1f252a"> &nbsp;Fcfa</span>                                            
                                    <h:outputText id="txt_montant_salaire_" value="#{managedPaiementSalaire.paiementSalaire.montantPaye}" converter="DN" styleClass="span_montant_salaire_"
                                                  style="float: right; font-weight: bold; color: #{(managedPaiementSalaire.paiementSalaire.montantPaye>0)?'inherit':'red'}"/>                                                                                         
                                    <h:inputText value="#{managedPaiementSalaire.paiementSalaire.montantPaye}" id="txt_montant_S_AP" 
                                                 style="display: none;width: 130px; float: right" >
                                        <p:ajax event="blur" update="@this txt_montant_salaire_ img_up_salaire_" global="false"/>
                                    </h:inputText>
                                    <h:graphicImage id="img_up_salaire_" library="icones" name="update.png" width="20" height="20" style="float: right; cursor: pointer" 
                                                    styleClass="span_montant_salaire_" title="modifier la valeur" onclick="displayChampSalaire()"/>
                                </div>
                                <br />
                                <span>Commentaire </span>  
                                <h:inputTextarea value="#{managedPaiementSalaire.paiementSalaire.commentaire}" style="width: 99%" rows="3"/>

                            </p:outputPanel>
                            <p:outputPanel style="width: 100%">
                                <div id="zone_show_avance_paie" style="width: 99%; border: solid 2px; height: 200px; padding: 2px; border-radius: 5px;margin-top: 5px">
                                    <span style="display: inline-block; background: #CCC; width: 100%;cursor: pointer" onclick="slideShow('zone_show_avance_paie', 200)">
                                        <span class="button_slide">[-]</span>
                                        Avances du mois 
                                        <div style="float: right">Total:<div style="float: right"><h:outputText value="#{managedPaiementSalaire.paiementSalaire.soeAcompte}" converter="DNS" styleClass="montantTotal"/> Fcfa</div></div>
                                    </span>
                                    <div class="zone_slide" style="width: 99.5%; border: solid 1px; height: 150px; margin: auto;overflow-y: auto">
                                        <p:dataTable id="data_avance_mutualiste" value="#{managedPaiementSalaire.avances}" var="avan" rowKey="#{avan.id}" rowIndexVar="avanIdx">
                                            <p:column headerText="N°" style="width: 12%;text-align: center">
                                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{avan.new_}"/>
                                                <span>#{avanIdx+1}</span>
                                            </p:column>
                                            <p:column headerText="Date" width="100" style="text-align: center">
                                                <h:outputText value="#{avan.dateAvance}" style="text-align: right" converter="DDMMYYYY"/>
                                            </p:column>
                                            <p:column headerText="Montant">
                                                <h:outputText value="#{util.arrondi(avan.montant,2)}" converter="DN" style="text-align: right"/>
                                            </p:column>                                                
                                            <p:column headerText="Reste">
                                                <h:outputText value="#{util.arrondi(avan.montantReste,2)}" converter="DN" style="text-align: right"/>
                                            </p:column>
                                            <p:column headerText="Etat">
                                                <span>#{avan.etat}</span>
                                            </p:column>
                                        </p:dataTable>
                                    </div>  
                                    <div class="zone_bottom">

                                    </div>
                                </div>
                            </p:outputPanel>
                            <p:outputPanel style="width: 100%; clear: right">
                                <div id="zone_show_credit_paie" style="width: 99%; border: solid 2px; height: 200px; padding: 2px; border-radius: 5px;margin-top: 5px">
                                    <span style="display: inline-block; background: #CCC; width: 100%;cursor: pointer" onclick="slideShow('zone_show_credit_paie', 200)">
                                        <span class="button_slide">[-]</span>
                                        Credits du mois
                                        <div style="float: right">Total:<div style="float: right"><h:outputText value="#{managedPaiementSalaire.paiementSalaire.soeCredit}" converter="DNS" styleClass="montantTotal"/> Fcfa</div></div>
                                    </span>
                                    <div class="zone_slide" style="width: 99.5%; border: solid 1px; height: 150px; margin: auto;overflow-y: auto">
                                        <p:dataTable id="date_mensualite_echeancier_pa" value="#{managedPaiementSalaire.mensualites}" var="mens"
                                                     rowKey="#{mens.id}" rowIndexVar="mensIdx" selection="#{managedPaiementSalaire.mensualiteSelect}" selectionMode="single">
                                            <p:column headerText="N°" style="width: 12%;text-align: center">
                                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{mens.new_}"/>
                                                <span>#{mensIdx+1}</span>
                                            </p:column>                                                
                                            <p:column headerText="Date" width="100" style="text-align: center">
                                                <h:outputText value="#{mens.dateMensualite}" style="text-align: right" converter="DDMMYYYY"/>
                                            </p:column>
                                            <p:column headerText="Montant">
                                                <h:outputText value="#{util.arrondi(mens.montant,2)}" converter="DN" style="text-align: right"/>
                                            </p:column>
                                            <p:column headerText="Reste">
                                                <h:outputText value="#{util.arrondi(mens.montantReste,2)}" converter="DN" style="text-align: right"/>
                                            </p:column>
                                            <p:column headerText="Etat">
                                                <span>#{mens.etat}</span>
                                            </p:column>
                                        </p:dataTable>
                                    </div>  
                                    <div class="zone_bottom">

                                    </div>
                                </div>
                            </p:outputPanel>
                        </p:outputPanel>     
                    </div>
                    <div style="width: 39.5%;margin-left: 60.5%">
                        <!-->Positionner la photos<-->
                        <p:outputPanel id="right_panel_paie">
                            <div style=";width: 99%; border: solid 2px; height: 410px; padding: 2px; border-radius: 5px;margin-top: 5px">
                                <span style="display: inline-block; background: #CCC; width: 100%">
                                    Historique des paiements de l'année
                                    <div style="float: right"><p:graphicImage library="img" style="margin-left: 50px" name="paye.png" rendered="#{managedPaiementSalaire.paiementSalaire.payer}"/></div>
                                </span>
                                <div class="zone_slide" style="width: 99.5%; border: solid 1px; height: 360px; margin: auto;overflow-y: auto">
                                    <p:dataTable id="data_paie_mutualiste" value="#{managedPaiementSalaire.historiquePaiement}" 
                                                 var="paieM" rowIndexVar="paieMIdx" style="color: #045491">
                                        <p:column headerText="N°" width="15" style="text-align: center; color: #045491">
                                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{paieM.new_}"/>
                                            <span>#{paieMIdx+1}</span>
                                        </p:column>
                                        <p:column headerText="Date Paiement" style="text-align: center; color: #045491">
                                            <h:outputText value="#{paieM.datePaiement}" converter="DATE"/>
                                        </p:column>
                                        <p:column headerText="Montant" width="100" style="text-align: right; color: #045491">
                                            <h:outputText value="#{paieM.montantPaye}" converter="DN" /> <span style="font-size: medium">Fcfa</span>
                                        </p:column>
                                    </p:dataTable>
                                </div>  
                                <div class="zone_bottom">

                                </div>
                            </div>
                            <div style="float: left">

                            </div>
                        </p:outputPanel>
                    </div>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_paie" style="width: 99%; margin: auto; background: white">
                    <p:outputPanel id="data_paie">
                        <h:inputHidden id="input_hide_paie" value="#{managedPaiementSalaire.tabIds}"/>                          
                        <p:contextMenu for="data_paie" rendered="false"> 
                            <p:menuitem global="false" icon="ui-icon-circle-arrow-e" value="Payer" onclick="dlgPaieS.show()"/>
                        </p:contextMenu>
                        <p:dataTable  value="#{managedPaiementSalaire.salaires}" var="paie" rowKey="#{paie.id}" rowIndexVar="paieIdx"
                                      selectionMode="single" >                                
                            <p:ajax event="rowSelect" global="false" update=":form_salaire:zone_header  "
                                    listener="#{managedPaiementSalaire.loadOnView}"  oncomplete="collapseForm('paie');"/>
                            <p:column headerText="N°" width="30" style="font-size: 0.8em">
                                <span>#{paieIdx+1}</span>
                            </p:column>
                            <p:column headerText="Matricule" width="90">
                                <span>#{paie.mutualiste.employe.matricule}</span>
                            </p:column> 
                            <p:column headerText="Mutualiste" width="200">
                                <span>#{paie.mutualiste.employe.prenom} #{paie.mutualiste.employe.nom}</span>
                            </p:column>                                
                            <p:column headerText="Salaire" style="font-weight: bold">
                                <h:outputText value="#{paie.montantAPayer}" converter="DN" style="text-align: right; width: 100%"/>
                            </p:column>
                            <p:column headerText="Crédits" style="color: red; font-weight: bold">
                                <h:outputText value="#{paie.soeCredit}" converter="DN" style="text-align: right"/>
                            </p:column>
                            <p:column headerText="Acomptes" style="color: firebrick; font-weight: bold">
                                <h:outputText value="#{paie.soeAcompte}" converter="DN" style="text-align: right"/>
                            </p:column>
                            <p:column headerText="Epargne" style="color: orangered; font-weight: bold">
                                <h:outputText value="#{paie.epargneDuMois}" converter="DN" style="text-align: right"/>
                            </p:column>
                            <p:column headerText="Net Perçu" style="font-weight: bold">
                                <h:outputText value="#{paie.montantPaye}" converter="DN" style="text-align: right; color: #{(paie.montantAPayer>0)?'#0066cc':'red'}"/>
                            </p:column>
                            <p:column headerText="Payé" style="width: 7%;text-align: center">
                                <h:graphicImage library="img"  name="#{(paie.payer)?'vu.png':'vu_non.png'}" width="15" height="15"/>
                            </p:column>
                            <p:column headerText="Date Paiement" style="font-size: 0.8em">
                                <h:outputText value="#{(paie.id>0)?paie.datePaiement:null}" converter="DDMMYYYY"/>
                            </p:column>
                            <p:column width="20" style="text-align: center">
                                <p:commandLink global="false" actionListener="#{managedPaiementSalaire.deleteBean(paie)}">
                                    <!--<p:confirm message="Voulez-vous vraiment supprimer" header="supprimer ce paiement"/>-->
                                    <h:graphicImage library="img" name="del.png" width="20" height="20" title="Supprimer"/>      
                                </p:commandLink>
                            </p:column> 
                            <p:column width="25" style="text-align: center">
                                <f:facet name="header">
                                    <h:selectBooleanCheckbox styleClass="chek_all_line_paie" value="false"
                                                             onclick="selectionAllLineTab(#{managedPaiementSalaire.salaires.size()}, 'paie')">
                                    </h:selectBooleanCheckbox>
                                </f:facet>
                                <h:selectBooleanCheckbox  value="#{paie.selectActif }" styleClass="chek_line_paie" rendered="#{(paie.id>0)}"
                                                          onclick="selectionLineTab(#{paie.id}, 'paie')">
                                </h:selectBooleanCheckbox>
                            </p:column>
                        </p:dataTable>                                  
                        <span class="nbSelectevenement" style="font-size: .8em; font-style: italic; color: #828c95;"></span>                   
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedPaiementSalaire.paginer(false)}" update="data_paie" icon="ui-icon-circle-triangle-w"  disabled="#{managedPaiementSalaire.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedPaiementSalaire.paginator.currentPage}/#{managedPaiementSalaire.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedPaiementSalaire.paginer(true)}" update="data_paie" icon="ui-icon-circle-triangle-e"  disabled="#{managedPaiementSalaire.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedPaiementSalaire.imax}" label="Nombre max Résultat" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedPaiementSalaire.choosePaginator}">
                                <f:selectItems value="#{managedPaiementSalaire.paginations}" />
                                <p:ajax event="valueChange" update="data_paie" />
                            </p:selectOneMenu>
                        </p:outputPanel>                        
                        <div align="left" style="font-size: 0.8em; font-style: italic; font-weight: bold; float: left">
                            <span style="color: #006666">Afficher tous les employés</span>
                            <p:selectBooleanCheckbox value="false" valueChangeListener="#{managedPaiementSalaire.toogleAllMutualiste}">
                                <p:ajax event="valueChange" update="data_paie" />
                            </p:selectBooleanCheckbox>
                        </div>
                        <div style="clear: both"/>
                        <div style="font-size: 0.8em; font-style: italic; font-weight: bold; float: right">
                            Salaire de la session de <span style="color: #006666">
                                <h:outputText value="#{managedPaiementSalaire.selectedPeriode.periodeRh.reference}" style="background: #000; color: white"/></span>
                        </div>
                    </p:outputPanel>
                </div> 
                <!-->Vue des périodes de salaire à payer<-->
                <div class="yvs_grid_paie">
                    <h:inputHidden id="input_hide_periode_paie" value="#{managedPaiementSalaire.tabIds}"/>
                    <p:commandButton onclick="dlgNewPeriode.show()" type="button" icon="ui-icon-document" title="Créer une nouvelle session de paye" style="width: 22px; height: 30px"/>
                    <p:dataTable value="#{managedPaiementSalaire.periodesSalaires}" var="period_" rowKey="#{period_.id}"
                                 selectionMode="single" id="listePeriodeRh" style="clear: right" rowIndexVar="line_s">
                        <p:ajax event="rowSelect"  listener="#{managedPaiementSalaire.selectOneSessionSalaire}"
                                update=":form_salaire:zone_header :form_salaire:data_paie" oncomplete="collapseForm('paie')" />
                        <p:column headerText="N° " width="18">
                            #{line_s+1}
                        </p:column>
                        <p:column headerText="Référence ">
                            #{period_.periodeRh.reference}
                        </p:column>
                        <p:column headerText="Debut ">
                            <h:outputText value="#{period_.periodeRh.debutMois}" converter="DDMMYYYY" />
                        </p:column>
                        <p:column headerText="Fin ">
                            <h:outputText value="#{period_.periodeRh.finMois}" converter="DDMMYYYY" />
                        </p:column>
                        <p:column headerText="Etat ">
                            <h:outputText value="#{(period_.actif)?'En cours':'Inactif'}"  rendered="#{(!period_.cloture)}" style="color: #006666"/>
                            <h:outputText value="Clôturé" rendered="#{period_.cloture}" />
                        </p:column>
                        <p:column width="18">
                            <p:commandButton icon="ui-icon-circle-check" title="Activer la session" update="listePeriodeRh" style="width: 22px; height: 22px"
                                             actionListener="#{managedPaiementSalaire.activerNewSession(period_)}" rendered="#{!period_.actif and !period_.cloture}">
                                <!--<p:confirm message="Cette action vas désactiver la session en cours. voulez-vous continuer? " header="Activer/Désactiver session" />-->
                            </p:commandButton>
                        </p:column>
                        <p:column width="18">
                            <p:commandButton icon="ui-icon-arrowthickstop-1-s" title="Tirer les salaire de cette session" update="listePeriodeRh" style="width: 22px; height: 22px"
                                             actionListener="#{managedPaiementSalaire.recupererSalaireSession(period_)}" />
                        </p:column >
                    </p:dataTable>
                </div>
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false">
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative" width="20" height="20"
                            styleClass="img_slide" title="cacher"/>                    
            <div class="zone_find">                                                              
                <h:panelGrid columns="4" style="font-size: 1.0em; float: left">
                    <h:outputText value="Date" />
                    <h:outputText value="Mutualiste " />
                    <h:outputText value="Type " />  
                    <span>&nbsp;</span>
                    <h:panelGroup>
                        <h:selectBooleanCheckbox value="#{managedPaiementSalaire.dateSearch}">
                            <p:ajax event="valueChange" listener="#{managedPaiementSalaire.addParamDates()}" update="dates_search_paie" oncomplete="collapseList('evenement')"/>
                        </h:selectBooleanCheckbox>
                        <h:panelGroup id="dates_search_paie" style="margin-top: -2px;float: right">
                            <p:calendar value="#{managedPaiementSalaire.debutSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedPaiementSalaire.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedPaiementSalaire.addParamDates()}" oncomplete="collapseList('evenement')"/>
                            </p:calendar>
                            <p:calendar value="#{managedPaiementSalaire.finSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedPaiementSalaire.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedPaiementSalaire.addParamDates()}" oncomplete="collapseList('evenement')"/>
                            </p:calendar>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:inputText value="#{managedPaiementSalaire.mutualisteSearch}" >
                        <p:ajax event="keyup" listener="#{managedPaiementSalaire.addParamMutualiste()}" oncomplete="collapseList('evenement')" />
                    </h:inputText>
                    <h:selectOneMenu value="#{managedPaiementSalaire.typeSearch}">
                        <f:selectItem itemValue="0" itemLabel="TOUT" /> 
                        <f:selectItem itemValue="0" itemLabel="--" /> 
                        <f:selectItems value="#{managedPaiementSalaire.periodesSalaires}" var="typ" itemValue="#{typ.id}" itemLabel="#{typ.periodeRh.reference}" /> 
                        <p:ajax event="valueChange" listener="#{managedPaiementSalaire.addParamType()}" oncomplete="collapseList('evenement')"/>
                    </h:selectOneMenu>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

