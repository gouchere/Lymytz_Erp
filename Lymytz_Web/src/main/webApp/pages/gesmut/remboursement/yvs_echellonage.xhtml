<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Echéancier','modMutuelle', 'smenEcheancier', true,managedEchellonage)}
    </ui:define>   
    <ui:define name="contents"> 
        #{managedCredit.load(false)}
        #{managedMutualiste.doNothing()}
        #{managedEchellonage.loadAll()}
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 140);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('echeancier');
                collapseForm('caisse_mutuelle');
            });
        </script>

        <h:form>
            <p:remoteCommand name="updateBeanCaisse_" actionListener="#{managedMutuelle.updateBeanCaisse()}"/>
        </h:form>
        <h:form>
            <p:remoteCommand name="saveBeanEchellonage_" actionListener="#{managedEchellonage.saveNew()}"/>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgChooseCaisse" header="#{lab.LC_PEV_selectionner_caisse}" closeOnEscape="true" width="30%">
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                    <span>#{lab.L_caisse} </span>
                    <h:panelGroup>
                        <h:selectOneMenu value="#{managedEchellonage.reglement.caisse.id}" style="min-width:140px">
                            <f:selectItem itemLabel="--" itemValue="0"/>
                            <f:selectItems value="#{managedEchellonage.caisses}" var="cais" 
                                           itemLabel="#{cais.referenceCaisse}" itemValue="#{cais.id}"/>
                            <p:ajax event="valueChange" global="false" listener="#{managedEchellonage.chooseCaisse()}"/>
                        </h:selectOneMenu>  
                        <p:commandButton value="#{lab.L_valider}" style="float: right" actionListener="#{managedEchellonage.saveNewReglementMensualite()}" 
                                         oncomplete="dlgChooseCaisse.hide()"/>
                    </h:panelGroup>
                </h:panelGrid>                
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:dialog id="blog_reechellonage_" header="#{lab.LM_PC_reecheloner_echeancier}" widgetVar="dlgReechellonage" modal="true" width="35%" closeOnEscape="true">  
                <h:panelGrid id="form_reechellonage_" columns="2" styleClass="yvs_table" style="width: 98%;margin: auto">
                    <f:facet name="header">
                        <div align="center">
                            <span>#{lab.L_montant} </span>
                            <h:outputText value="#{managedEchellonage.echellonage.montantReste}" converter="DNS" style="font-weight: bold"/>
                        </div>
                    </f:facet>
                    <span>#{lab.LC_PRPF_date_effet} </span>
                    <p:calendar value="#{managedEchellonage.echellonage.dateEchellonage}" navigator="true" pattern="dd-MM-yyyy"/>
                    <span>#{lab.LM_PC_ecart_mensualite} </span>
                    <pe:inputNumber value="#{managedEchellonage.echellonage.ecartMensualite}" symbol=" mois" symbolPosition="suffixe"/>
                    <span>#{lab.L_taux} </span>
                    <pe:inputNumber value="#{managedEchellonage.echellonage.taux}" symbol=" %" symbolPosition="suffixe"/>
                    <span>#{lab.LP_PPG_duree} </span>
                    <pe:inputNumber value="#{managedEchellonage.echellonage.dureeEcheance}"/>
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                    <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedEchellonage.reechellonerEcheance()}" style="float: right"/>
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *****************************************************************************
        Boite de dialogue de avancement
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.LM_PC_suspendre_echeances}" widgetVar="dlgAvancement" modal="true" width="80%" closeOnEscape="true">  
                <h:panelGroup>
                    <p:commandButton value="#{lab.LM_PC_revenir}" icon="ui-icon-arrowrefresh-1-w" actionListener="#{managedEchellonage.cancelEvaluerReport()}"
                                     style="float: left" update="date_mensualite_echeancier1_"/>
                    <h:panelGrid id="blog_form_reechellonage_" columns="6" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0" style="float: left">
                        <span>#{lab.LM_PTC_report} </span>              
                        <h:selectOneMenu value="#{managedCredit.report.typeReport}">
                            <f:selectItem itemValue="#{constantes.MUT_TYPE_REPORT_PARTIEL}" itemLabel="Partiel"/>
                            <f:selectItem itemValue="#{constantes.MUT_TYPE_REPORT_TOTAL}" itemLabel="Total"/>
                            <p:ajax event="valueChange" global="false" update="lb_duree_echeance_report_ txt_duree_echeance_report_"/>
                        </h:selectOneMenu>
                        <span>#{lab.LM_PC_partir_echeances} </span>
                        <p:calendar value="#{managedCredit.report.dateEcheance}"  size="8" pattern="dd-MM-yyyy"/>
                        <h:panelGroup id="lb_duree_echeance_report_">
                            <h:outputText value="#{lab.LM_PC_nombre_echeances}" rendered="#{managedCredit.report.typeReport == constantes.MUT_TYPE_REPORT_PARTIEL}"/>
                            <h:outputText value="#{lab.LM_PC_duree_suspension}" rendered="#{managedCredit.report.typeReport != constantes.MUT_TYPE_REPORT_PARTIEL}"/>    
                        </h:panelGroup>
                        <h:panelGroup id="txt_duree_echeance_report_">
                            <h:inputText value="#{managedCredit.report.nombreEcheance}" style="width: 80px" rendered="#{managedCredit.report.typeReport == constantes.MUT_TYPE_REPORT_PARTIEL}"/>
                            <h:panelGroup rendered="#{managedCredit.report.typeReport != constantes.MUT_TYPE_REPORT_PARTIEL}">
                                <h:inputText value="#{managedCredit.report.dureeSuspension}" style="width: 80px"/>
                                <span> #{lab.L_mois}</span>
                            </h:panelGroup>
                        </h:panelGroup>
                    </h:panelGrid>
                    <p:commandButton value="#{lab.LM_PC_avaluer}" icon="ui-icon-calculator" actionListener="#{managedEchellonage.reportEcheances()}"
                                     style="float: right" update="date_mensualite_echeancier1_"/>
                </h:panelGroup>
                <p:dataTable id="date_mensualite_echeancier1_" value="#{managedCredit.report.mensualites}" var="mens_r"
                             rowKey="#{mens_r.id}" rowIndexVar="mens_Idx0" >
                    <p:column headerText="N°" style="text-align: center; font-size: 0.9em" width="15" styleClass="marquer_#{mens_r.marquer}">
                        <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{mens_r.new_}"/>
                        <span>#{mens_Idx0+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.LC_PRS_date_echeance}" style="text-align: center" width="80" styleClass="marquer_#{mens_r.marquer}">
                        <h:outputText value="#{mens_r.dateMensualite}" converter="DDMMYYYY"/>
                    </p:column>
                    <p:column headerText="#{lab.LM_PMC_mensualite}" style="width: 17.5%;text-align: right" styleClass="marquer_#{mens_r.marquer}">
                        <h:outputText value="#{mens_r.montant}" converter="DNS"/>
                    </p:column>
                    <p:column headerText="#{lab.LM_PC_amortissement}" style="width: 17.5%;text-align: right" styleClass="marquer_#{mens_r.marquer}">
                        <h:outputText value="#{mens_r.amortissement}" converter="DNS"/>
                    </p:column>
                    <p:column headerText="#{lab.LM_PPG_interet}" style="width: 17.5%;text-align: right" styleClass="marquer_#{mens_r.marquer}">
                        <h:outputText value="#{mens_r.interet}" converter="DNS"/>
                    </p:column>
                    <p:column headerText="#{lab.LM_PC_penalite}" style="width: 15%;text-align: right" styleClass="marquer_#{mens_r.marquer}">
                        <h:outputText value="#{mens_r.montantPenalite}" converter="DNS"/>
                    </p:column>                                
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                    <p:commandButton value="#{lab.L_appliquer}" icon="ui-icon-circle-check" actionListener="#{managedEchellonage.appliquerReport()}"
                                     style="float: right;margin-top: -5px" update="date_mensualite_echeancier1_" oncomplete="dlgAvancement.hide()"/>
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmCreate" closeOnEscape="true"
                             message="#{lab.LM_PE_fiance_a}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" onclick="dlgConfirmCreate.hide()" oncomplete="dlgAddExercice.show()" global="false"/>
                <p:commandButton type="button" value="#{lab.L_non}" onclick="dlgConfirmCreate.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.LDB_PEX_creation_exercice}" widgetVar="dlgAddExercice" 
                      width="25%" modal="true" closeOnEscape="true">
                <h:panelGrid columns="1" styleClass="yvs_table" style="width: 100%">
                    <h:panelGrid columns="2" styleClass="yvs_table" style="width: 98%;margin: auto"> 
                        <span>#{lab.L_reference} </span>  
                        <h:inputText value="#{exercice.reference}"/>
                        <span>#{lab.L_date_debut} </span> 
                        <p:calendar value="#{exercice.dateDebut}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_date_fin} </span>
                        <p:calendar value="#{exercice.dateFin}" navigator="true" pattern="dd-MM-yyyy"/>
                        <span>#{lab.L_actif} </span>
                        <h:selectBooleanCheckbox value="#{exercice.actif}"/>
                    </h:panelGrid>
                    <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedExercice.saveNew()}"
                                     oncomplete="dlgAddExercice.hide(); saveBeanEchellonage_()" style="width: 100%"/> 
                </h:panelGrid>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form>     
        <!-->
        *****************************************************************************
        Boite de dialogue des mutualistes 
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.LM_PE_selectionner_mutualiste_concerne}" widgetVar="dlgListMutualistes" modal="true" width="50%" height="435" closeOnEscape="true"> 
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:panelGroup>
                        <h:inputText value="#{managedMutualiste.numSearch}" >
                            <p:ajax event="valueChange" listener="#{managedMutualiste.addParamReference()}" update="data_mutualiste_echel" oncomplete="collapseList('mutualiste')" />
                        </h:inputText>
                    </h:panelGroup>
                    <h:panelGroup style="float: right">
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                            <p:commandButton actionListener="#{managedMutualiste.paginer(false)}" update="data_mutualiste_echel" icon="ui-icon-circle-triangle-w"  disabled="#{managedMutualiste.paginator.disPrev}"/>
                            <p:outputPanel ><p:outputLabel value="#{managedMutualiste.paginator.currentPage}/#{managedMutualiste.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                            <p:commandButton action="#{managedMutualiste.paginer(true)}" update="data_mutualiste_echel" icon="ui-icon-circle-triangle-e"  disabled="#{managedMutualiste.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedMutualiste.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em;" 
                                             valueChangeListener="#{managedMutualiste.choosePaginator}">
                                <f:selectItems value="#{managedMutualiste.paginations}" />
                                <p:ajax event="valueChange"  update="data_mutualiste_echel" />
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </h:panelGroup>
                </h:panelGrid>
                <p:dataTable id="data_mutualiste_echel" value="#{managedMutualiste.mutualistes}" var="mutua_" rowKey="#{mutua_.id}" rowIndexVar="mutua_Idx"
                             scrollable="true" scrollHeight="400" selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedEchellonage.loadOnViewMutualiste}" oncomplete="dlgListMutualistes.hide()"/>
                    <p:column headerText="N°" style="width: 1%;text-align: center">
                        <span>#{mutua_Idx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_nom}" style="width: 4%">
                        <span>#{mutua_.employe.nom}</span>                 
                    </p:column>
                    <p:column headerText="#{lab.L_prenom}" style="width: 8%">
                        <span>#{mutua_.employe.prenom}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_agence}" style="width: 8%">
                        <span>#{mutua_.employe.agence.designation}</span>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    &copy; Lymytz 2014
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="#{lab.LRH_PRS_text}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedEchellonage.deleteBean()}" oncomplete="dlgConfirmDelete.hide(); afterDeleteEchellonage()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_echeance">    
            <div class="part_fix">
                <p:splitButton value="#{lab.L_enregistrer}" id="save_echeancier" actionListener="#{managedEchellonage.saveNew()}" icon="ui-icon-disk">
                    <p:menuitem value="#{lab.L_nouveau}" icon="ui-icon-document" id="cancel_echeancier" global="false" actionListener="#{managedEchellonage.resetFiche()}" update="blog_form_echellonage"/>
                    <p:menuitem value="#{lab.L_modifier}" rendered="false" id="update_echeancier" actionListener="#{managedEchellonage.updateBean()}" oncomplete="collapseForm();return false"/>
                    <p:separator/>
                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" onclick="dlgConfirmDelete.show()" />
                </p:splitButton>
                <p:commandButton  value="#{lab.L_supprimer}" id="delete_echeancier" icon="ui-icon-trash" global="false" onclick="dlgConfirmDelete.show()" />
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedEchellonage.parcoursInAllResult(false)}" update="txt_parc_linear_credit" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('credit')"
                                     />
                    <h:inputText value="#{managedEchellonage.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_parc_linear_credit"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedEchellonage.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedEchellonage.parcoursInAllResult(true)}" update="txt_parc_linear_credit" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('credit')"
                                     />
                </h:panelGroup>
                <div style="float: right">
                    <h:panelGrid columns="5" cellpadding="0" cellspacing="0">
                        <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('echeancier');
                                return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <p:spacer />
                        <h:link title="#{lab.L_mode_liste}" onclick="collapseList('echeancier');
                                return false" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <p:spacer />
                        <h:link title="#{lab.LM_PE_vue_calendrier}" onclick="collapseGrid('echeancier');
                                return false" >
                            <p:graphicImage library="icones" name="ico_calendar.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>  
                    </h:panelGrid>
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_echeancier">
                    <h:inputHidden id="input_hide_reset_echeancier" value="#{managedEchellonage.input_reset}"/>
                    <p:outputPanel id="blog_form_echellonage" style="width: 99%; margin: auto; background: white">
                        <div style="float: left;width: 40%">
                            <div id="zone_show_credits_mut" style="width: 99.5%; border: solid 2px; height: 97%; padding: 2px; border-radius: 5px">
                                <span style="display: inline-block; background: #CCC; width: 100%">
                                    #{lab.LM_PE_credit_mutualiste} 
                                </span>
                                <div class="zone_slide" style="width: 99.5%; border: solid 1px; height: 95%; margin: auto;overflow-y: auto">
                                    <h:panelGrid id="form_compte_mutualiste" columns="2" styleClass="yvs_table" style="width: 100%" cellpadding="0" cellspacing="0" >
                                        <span>#{lab.LM_PE_mutualiste} </span>                                         
                                        <h:panelGroup id="txt_mutualiste_echellonage">                                             
                                            <h:inputText value="#{managedEchellonage.mutualiste.matricule}" style="color: #{managedEchellonage.mutualiste.error?'red':''}">
                                                <p:ajax event="blur" global="false" listener="#{managedEchellonage.searchMutualiste()}" update="txt_mutualiste_echellonage"/>
                                            </h:inputText>    
                                            <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px" title="#{lab.LC_PPL_liste_client}" global="false"
                                                             actionListener="#{managedEchellonage.initMutualistes()}" oncomplete="dlgListMutualistes.show()"/> 
                                            <h:outputText value="#{managedEchellonage.mutualiste.employe.nom_prenom}" style="margin-left: 10px;color: #009999"/>
                                        </h:panelGroup>
                                        <span>#{lab.L_compte} </span> 
                                        <h:selectOneMenu value="#{managedEchellonage.echellonage.credit.compte.id}" id="compte_mutualiste_echellonage" style="min-width: 170px">
                                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                            <f:selectItems value="#{managedEchellonage.mutualiste.comptes}" var="compt_" 
                                                           itemLabel="#{compt_.reference}" itemValue="#{compt_.id}" />
                                            <p:ajax event="valueChange" global="false" listener="#{managedEchellonage.chooseCompte()}"/>
                                        </h:selectOneMenu>
                                        <f:facet name="footer">
                                            <div style="color: #333; font-size: 0.8em; padding-top: 5px">Historique crédit</div>
                                            <p:dataTable id="data_credit_compte" value="#{managedEchellonage.credits}" var="credC" scrollable="true" 
                                                         rowKey="#{credC.id}" rowIndexVar="credCIdx" selectionMode="single" scrollHeight="500">
                                                <p:ajax event="rowSelect" global="false" listener="#{managedEchellonage.loadOnViewCredit}"/>
                                                <p:column headerText="Reference" styleClass="statut_#{credC.etat}">
                                                    <h:outputText value="#{credC.reference}"/>
                                                </p:column>
                                                <p:column headerText="#{lab.LM_PE_date_credit}" style="text-align: center;width: 35%" styleClass="statut_#{credC.etat}">
                                                    <h:outputText value="#{credC.dateCredit}" converter="DATE"/>
                                                </p:column>
                                                <p:column headerText="#{lab.L_montant}" style="text-align: right;width: 22%" styleClass="statut_#{credC.etat}">
                                                    <h:outputText value="#{credC.montant}" converter="DN"/>
                                                </p:column>
                                            </p:dataTable>
                                        </f:facet>
                                    </h:panelGrid>    
                                </div>
                            </div>
                        </div>
                        <div style="width: 59%;margin-left: 40.5%">
                            <div id="zone_show_echeancier_mut" style="width: 99.5%; border: solid 2px; height: 97%; padding: 2px; border-radius: 5px">
                                <span style="display: inline-block; background: #CCC; width: 100%">
                                    #{lab.LM_PE_echeancier} 
                                </span>
                                <div class="zone_slide" style="width: 99.5%; border: solid 1px; height: 95%; margin: auto;overflow-y: auto">
                                    <h:panelGrid columns="1" styleClass="yvs_table" style="width: 100%; font-size: 0.8em" cellpadding="0" cellspacing="0">
                                        <f:facet name="header">
                                            <span>#{lab.LM_PE_infos_credit} </span>
                                            <h:panelGrid columns="4"  cellpadding="0" cellspacing="0" id="txt_reference_credit"  style="width: 100%">
                                                <span>#{lab.L_reference} </span>
                                                <h:inputText value="#{managedEchellonage.echellonage.credit.reference}" readonly="true" style="width: 95%"/>
                                                <span>#{lab.L_montant}</span>
                                                <h:inputText value="#{managedEchellonage.echellonage.credit.montant}" readonly="true" converter="DN" style="width: 95%"/>
                                                <span>#{lab.LM_PE_date_echellonage} </span> 
                                                <p:calendar value="#{managedEchellonage.echellonage.dateEchellonage}" navigator="true" pattern="dd-MM-yyyy" size="10"/>
                                                <span>#{lab.LP_PPG_duree} <span style="font-size: 0.8em">(En mois)</span> </span>  
                                                <pe:inputNumber value="#{managedEchellonage.echellonage.dureeEcheance}" symbol=" mois" symbolPosition="suffixe" style="width: 140px"/>
                                                <span>#{lab.LM_PC_ecart_mensualite} </span>  
                                                <h:inputText value="#{managedEchellonage.echellonage.ecartMensualite}" style="width: 90px"/>
                                                <span>#{lab.L_taux} </span>  
                                                <h:inputText value="#{managedEchellonage.echellonage.taux}" style="width: 90px"/>
                                                <span>#{lab.LM_PE_charge_totale} </span>  
                                                <h:inputText value="#{managedEchellonage.echellonage.montant}"  converter="DN" style="text-align: right" disabled="true"/>
                                                <span>#{lab.LRH_PM_reste_payer} </span>  
                                                <h:inputText value="#{managedEchellonage.echellonage.montantReste}" converter="DN" style="text-align: right" disabled="true"/>
                                            </h:panelGrid>
                                        </f:facet>                                        
                                        <h:panelGrid columns="2" cellpadding="0" cellspacing="0">   
                                            <f:facet name="header">
                                                <h:panelGrid columns="7" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0" id="zone_edit_mode_paiement_mes_credit">
                                                    <h:selectOneRadio value="#{managedCredit.reglement.modePaiement}" styleClass="yvs_noStyle" style="margin-left: 10px; font-size: 0.8em"
                                                                      valueChangeListener="#{managedCredit.loadCaisseByTypeOp}"  layout="PageDirection">
                                                        <f:selectItem itemValue="#{constantes.MUT_MODE_PAIEMENT_ESPECE}" itemLabel="#{constantes.MUT_MODE_PAIEMENT_ESPECE}" />
                                                        <f:selectItem itemValue="#{constantes.MUT_MODE_PAIEMENT_COMPTE}" itemLabel="#{constantes.MUT_MODE_PAIEMENT_COMPTE}" />
                                                        <p:ajax event="valueChange" update="zone_edit_mode_paiement_mes_credit" global="false"/>
                                                    </h:selectOneRadio>
                                                    <span >#{!(managedCredit.reglement.modePaiement eq constantes.MUT_MODE_PAIEMENT_COMPTE)?lab.L_caisse:''}</span>
                                                    <h:selectOneMenu rendered="#{!(managedCredit.reglement.modePaiement eq constantes.MUT_MODE_PAIEMENT_COMPTE)}" 
                                                                     value="#{managedCredit.reglement.caisse.id}" style="width:140px">
                                                        <f:selectItem itemLabel="--" itemValue="0"/>
                                                        <f:selectItems value="#{managedCredit.caisses}" var="cais" 
                                                                       itemLabel="#{cais.referenceCaisse}" itemValue="#{cais.id}"/>
                                                        <p:ajax event="valueChange" global="false" listener="#{managedCredit.chooseCaisse(false)}"/>
                                                    </h:selectOneMenu>   
                                                    <span>#{!(managedCredit.reglement.modePaiement eq constantes.MUT_MODE_PAIEMENT_ESPECE)?lab.L_compte:''}</span>
                                                    <h:selectOneMenu rendered="#{!(managedCredit.reglement.modePaiement eq constantes.MUT_MODE_PAIEMENT_ESPECE)}" 
                                                                     value="#{managedCredit.reglement.compte.id}" style="width:140px" >
                                                        <f:selectItem itemLabel="--" itemValue="0"/>
                                                        <f:selectItems value="#{managedCredit.mutualiste.comptes}" var="icmpt" 
                                                                       itemLabel="#{icmpt.reference}" itemValue="#{icmpt.id}" itemDisabled="#{(icmpt.typeCompte.nature eq constantes.MUT_TYPE_COMPTE_EPARGNE and !managedCredit.parametreMutuelle.acceptRetraitEpargne)}"/>
                                                        <p:ajax event="valueChange" global="false" update="txt_reg_solde_compte"/>
                                                    </h:selectOneMenu>
                                                    <span>#{lab.LM_PM_solde}: </span>
                                                    <h:outputText style="font-weight: bold" id="txt_reg_solde_compte" value="#{managedCredit.findSoldeCompte(managedCredit.reglement.compte.id)}" converter="DN" />
                                                </h:panelGrid>
                                            </f:facet>
                                            <span>#{lab.LM_PC_regler_le}</span>
                                            <h:panelGroup>
                                                <p:calendar value="#{managedCredit.reglement.dateReglement}" pattern="dd-MM-yyyy" size="10"/>
                                                <h:outputText value="#{managedCredit.reglement.id}" style="float: right; padding: 3px; border: 1px solid #333" />
                                            </h:panelGroup>
                                            <span>#{lab.L_montant}</span>
                                            <pe:inputNumber value="#{managedCredit.reglement.montant}"/>
                                            <span>#{lab.LM_PC_regler_par}</span>
                                            <h:inputText value="#{managedCredit.reglement.reglerPar}" style="width: 98%"/>
                                            <f:facet name="footer">
                                                <p:commandButton value="#{lab.L_nouveau}" actionListener="#{managedCredit.resetFicheReglement()}"  />
                                                <p:commandButton value="#{lab.L_enregistrer}" actionListener="#{managedCredit.saveNewReglementMensualite()}"  
                                                                 style="float: right"   disabled="#{managedCredit.credit.etatValidation != constantes.ETAT_VALIDE}"/>
                                            </f:facet>
                                        </h:panelGrid>                                         
                                        <f:facet name="footer">
                                            <p:outputPanel  id="data_mensualites_echellonage">
                                                <p:commandButton value="#{lab.LM_PE_echelonner}" style="float: right" actionListener="#{managedEchellonage.calculMensualite()}"
                                                                 update="data_mensualites_echellonage" disabled="#{!managedEchellonage.onGenererMensualite()}"/>
                                                <p:dataTable value="#{managedEchellonage.echellonage.mensualites}" var="mens" rowIndexVar="line_m"
                                                             scrollable="true" scrollHeight="390" style="clear: both">
                                                    <p:column headerText="N°" styleClass="statut_#{mens.etat}" style="text-align: center" width="10">
                                                        <span>#{line_m+1}</span>
                                                    </p:column>
                                                    <p:column headerText="#{lab.LM_PE_date_mensualite}" styleClass="statut_#{mens.etat}" style="text-align: center">
                                                        <h:outputText value="#{mens.dateMensualite}" converter="DATE"/>
                                                    </p:column>
                                                    <p:column headerText="#{lab.L_montant}" styleClass="statut_#{mens.etat}" style="text-align: right">
                                                        <h:outputText value="#{mens.montantReel}" converter="DN"/>
                                                    </p:column>
                                                    <p:column headerText="#{lab.LM_PC_amortissement}" styleClass="statut_#{mens.etat}" style="text-align: right">
                                                        <h:outputText value="#{mens.amortissement}" converter="DN"/>
                                                    </p:column>
                                                    <p:column headerText="#{lab.LM_PC_interet}" styleClass="statut_#{mens.etat}" style="text-align: right">
                                                        <h:outputText value="#{mens.interet}" converter="DN"/>
                                                        <h:graphicImage library="img" name="vu.png" width="15" height="15" rendered="#{managedEchellonage.echellonage.creditRetainsInteret}" 
                                                                        title="#{lab.LM_PE_interet_deja_rembourse}"/>
                                                    </p:column>
                                                    <p:column headerText="#{lab.LCF_PCF_reste}" styleClass="statut_#{mens.etat}" style="text-align: right">
                                                        <h:outputText value="#{mens.montantReste}" converter="DN"/>
                                                    </p:column>
                                                    <p:column style="text-align: center;width: 5%">
                                                        <p:contextMenu for="option_mensualite_echeance" event="left click" style="font-size: 0.8em" styleClass="context_menu">
                                                            <p:menuitem value="#{lab.LM_PC_regler}" global="false" icon="ui-icon-circle-check" actionListener="#{managedEchellonage.saveNewReglementMensualite(mens)}"
                                                                        rendered="#{mens.montantReste gt 0 and mens.etat!=constantes.ETAT_SUSPENDU and mens.id gt 0}" oncomplete="dlgChooseCaisse.show()"/>
                                                            <p:menuitem value="#{lab.LRH_PRS_reporter}" global="false" icon="ui-icon-circle-arrow-n" actionListener="#{managedEchellonage.openViewReport(mens)}" rendered="#{mens.etat==constantes.ETAT_ATTENTE}"/>
                                                            <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedEchellonage.deleteBeanMensualite(mens)}" update=":main_echeance:data_mensualites_echellonage" rendered="#{mens.etat==constantes.ETAT_ATTENTE}"/>
                                                        </p:contextMenu>                           
                                                        <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="option_mensualite_echeance" type="button" disabled="#{mens.id le 0}"/> 
                                                    </p:column>
                                                </p:dataTable>
                                            </p:outputPanel>
                                        </f:facet>
                                    </h:panelGrid>
                                </div>
                            </div>
                        </div>        
                    </p:outputPanel>
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_echeancier" style="width: 99%; margin: auto; background: white">
                    <h:inputHidden id="input_hide_echeancier" value="#{managedEchellonage.tabIds}"/>
                    <p:dataTable id="data_echellonage" value="#{managedEchellonage.echellonages}" var="echel" rowKey="#{echel.id}" rowIndexVar="echelIdx"
                                 selectionMode="single">
                        <p:ajax event="rowSelect" global="false" listener="#{managedEchellonage.loadOnView}"  update=":main_echeance:input_hide_echeancier"
                                oncomplete="collapseForm('echeancier');return false"/>
                        <p:column width="20" headerText="N°" styleClass="statut_#{echel.etat}">
                            <span>#{echelIdx+1}</span>
                        </p:column>
                        <p:column width="40" headerText="Id" style="text-align: center" styleClass="statut_#{echel.etat}">
                            <span>#{echel.id}</span>
                        </p:column>
                        <p:column headerText="#{lab.LM_PM_credit}" styleClass="statut_#{echel.etat}">
                            <span>#{echel.credit.reference}</span>
                            <p:spacer width="10px" style="float: right;margin-top: 2px" styleClass="#{echel.credit.etat}" title="STATUT : #{managedEchellonage.giveNameStatut(echel.credit.etat)}"/>
                        </p:column>
                        <p:column headerText="#{lab.LDB_PD_matricule}" styleClass="statut_#{echel.etat}">
                            <span>#{echel.credit.compte.mutualiste.employe.matricule}</span>
                        </p:column>
                        <p:column headerText="#{lab.LM_PM_mutualiste}" styleClass="statut_#{echel.etat}">
                            <span>#{echel.credit.compte.proprietaire}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_compte}" styleClass="statut_#{echel.etat}">
                            <h:outputText value="#{echel.credit.compte.reference}"/>
                        </p:column>
                        <p:column headerText="#{lab.LP_PPG_duree}" style="text-align: center" styleClass="statut_#{echel.etat}">
                            <span>#{echel.dureeEcheance}</span>
                        </p:column>
                        <p:column headerText="#{lab.LM_PE_date_planing}" style="text-align: center" styleClass="statut_#{echel.etat}">
                            <h:outputText value="#{echel.dateEchellonage}" converter="DDMMYYYY"/>
                        </p:column>
                        <p:column headerText="#{lab.LM_PC_mens_svt}" style="text-align: center" styleClass="statut_#{echel.etat}">
                            <h:outputText value="#{managedEchellonage.giveNextmensualite(echel)}" converter="DDMMYYYY" title="#{lab.LM_PE_prochaine_mensualite}"/>
                        </p:column>
                        <p:column headerText="#{lab.L_montant}" style="text-align: right" styleClass="statut_#{echel.etat}">
                            <h:outputText value="#{echel.montant}" converter="DN" style="text-align: right"/>
                        </p:column>
                        <p:column headerText="#{lab.LM_PPG_interet}" style="text-align: right" styleClass="statut_#{echel.etat}">
                            <h:outputText value="#{echel.montantInteret}" converter="DN" style="text-align: right"/>
                        </p:column>
                        <p:column headerText="#{lab.LCF_PC_reste}" style="text-align: right" styleClass="statut_#{echel.etat}">
                            <h:outputText value="#{echel.montantReste}" converter="DN" style="text-align: right"/>
                        </p:column>
                        <p:column headerText="#{lab.L_taux}" style="text-align: center" styleClass="statut_#{echel.etat}">
                            <span>#{echel.taux}%</span>
                        </p:column>
                        <p:column width="20" style="text-align: center">
                            <p:contextMenu for="option_echellonage" event="left click" style="font-size: 0.8em" styleClass="context_menu">
                                <p:menuitem value="#{lab.LM_PC_reechelonner}" icon="ui-icon-circle-arrow-n" actionListener="#{managedEchellonage.onReecheancement(echel)}" rendered="#{echel.actif}"/>
                                <p:menuitem value="#{lab.L_suspendre}" icon="ui-icon-circle-close" actionListener="#{managedEchellonage.suspendreEcheance(echel)}" update="data_echellonage" rendered="#{echel.actif}"/>
                                <p:menuitem value="#{lab.L_activer}" icon="ui-icon-circle-check" actionListener="#{managedEchellonage.activeEcheance(echel)}" update="data_echellonage" rendered="#{managedEchellonage.onActiveEcheance(echel)}"/>
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedEchellonage.deleteBean(echel)}" update="data_echellonage"/>
                                <p:separator style="width: 98%;margin: auto"/>
                                <p:menuitem value="#{lab.L_telecharger}" icon="ui-icon-print" global="false" actionListener="#{managedCredit.print(echel)}" ajax="false"/>
                            </p:contextMenu>                           
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="option_echellonage" type="button"/> 
                        </p:column> 
                        <p:column width="25" style="text-align: center">
                            <f:facet name="header">
                                <h:selectBooleanCheckbox styleClass="chek_all_line_echeancier" value="false"
                                                         onclick="selectionAllLineTab(#{managedEchellonage.echellonages.size()}, 'echeancier')">
                                </h:selectBooleanCheckbox>
                            </f:facet>
                            <h:selectBooleanCheckbox  value="#{echel.selectActif }" styleClass="chek_line_echeancier" 
                                                      onclick="selectionLineTab(#{echelIdx}, 'echeancier')">
                            </h:selectBooleanCheckbox>
                        </p:column>
                    </p:dataTable>                                 
                    <span class="nbSelectecheancier" style="font-size: .8em; font-style: italic; color: #828c95;"></span>                   
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block" >
                        <p:commandButton actionListener="#{managedEchellonage.paginer(false)}" update="data_echellonage" icon="ui-icon-circle-triangle-w"  disabled="#{managedEchellonage.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedEchellonage.paginator.currentPage}/#{managedEchellonage.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton action="#{managedEchellonage.paginer(true)}" update="data_echellonage" icon="ui-icon-circle-triangle-e"  disabled="#{managedEchellonage.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedEchellonage.imax}" label="#{lab.L_nombre_max_resultat}" style="float: right; font-size: 0.9em;" 
                                         valueChangeListener="#{managedEchellonage.choosePaginator}">
                            <f:selectItems value="#{managedEchellonage.paginations}" />
                            <p:ajax event="valueChange" update="data_echellonage" />
                        </p:selectOneMenu>
                    </p:outputPanel>                                                   
                </div> 
                <!-->
                 *****************************************************************************
                 Vue Calendrier
                 *****************************************************************************
                <-->
                <div class="yvs_grid_echeancier" style="width: 99%; margin: auto">
                    <p:outputPanel  id="cal_echellonage">
                        <p:schedule id="schedule_ec" value="#{managedEchellonage.eventModel}" widgetVar="myschedule" timeFormat="" 
                                    locale="fr"  aspectRatio="2.8" timeZone="GMT+1" resizable="true" />
                    </p:outputPanel>
                </div>
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false">
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>                    
            <div class="zone_find">                                                              
                <h:panelGrid columns="6" style="font-size: 0.8em; float: left">
                    <h:outputText value="&nbsp;" />
                    <h:outputText value="#{lab.L_date}" />
                    <h:outputText value="#{lab.LC_PTBC_credit} " />
                    <h:outputText value="#{lab.LM_PM_mutualiste} " />
                    <h:panelGroup>
                        <h:outputText value="#{lab.L_statut} " />
                        <h:selectOneMenu value="#{managedEchellonage.operateurStatut}" valueChangeListener="#{managedEchellonage.changeOperateurStatut}">
                            <f:selectItem itemValue="=" itemLabel="#{lab.L_egale}" />
                            <f:selectItem itemValue="!=" itemLabel="#{lab.L_different}" />
                            <p:ajax event="valueChange" />
                        </h:selectOneMenu>
                    </h:panelGroup>
                    <span>&nbsp;</span>
                    <p:commandButton icon="ui-icon-bullet" title="#{lab.LM_PC_reset_param}" actionListener="#{managedEchellonage.clearParams()}" oncomplete="collapseList('credit')"
                                     style="width: 22px; height: 22px; border-radius: 15px"/>
                    <h:panelGroup>
                        <h:selectBooleanCheckbox value="#{managedEchellonage.dateSearch}">
                            <p:ajax event="valueChange" listener="#{managedEchellonage.addParamDates()}" update="dates_search_echel" oncomplete="collapseList('echeancier')"/>
                        </h:selectBooleanCheckbox>
                        <h:panelGroup id="dates_search_echel" style="margin-top: -2px;float: right">
                            <p:calendar value="#{managedEchellonage.debutSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedEchellonage.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedEchellonage.addParamDates()}" oncomplete="collapseList('echeancier')"/>
                            </p:calendar>
                            <p:calendar value="#{managedEchellonage.finSearch}" navigator="true" pattern="dd-MM-yyyy" size="10" disabled="#{!managedEchellonage.dateSearch}">
                                <p:ajax event="dateSelect" listener="#{managedEchellonage.addParamDates()}" oncomplete="collapseList('echeancier')"/>
                            </p:calendar>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:inputText value="#{managedEchellonage.creditSearch}" >
                        <p:ajax event="valueChange" listener="#{managedEchellonage.addParamCredit()}" oncomplete="collapseList('echeancier')" />
                    </h:inputText>
                    <h:inputText value="#{managedEchellonage.mutualisteSearch}" >
                        <p:ajax event="valueChange" listener="#{managedEchellonage.addParamMutualiste()}" oncomplete="collapseList('echeancier')" />
                    </h:inputText>
                    <h:selectOneMenu value="#{managedEchellonage.statutSearch}">
                        <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                        <f:selectItem itemLabel="--" itemValue=""/>
                        <f:selectItem itemLabel="#{lab.L_en_cours}" itemValue="#{constantes.ETAT_ENCOURS}"/>
                        <f:selectItem itemLabel="#{lab.L_termine}" itemValue="#{constantes.ETAT_TERMINE}"/>
                        <f:selectItem itemLabel="#{lab.LM_PE_transfere}" itemValue="#{constantes.ETAT_SOUMIS}"/>
                        <f:selectItem itemLabel="#{lab.L_annule}" itemValue="#{constantes.ETAT_ANNULE}"/>
                        <p:ajax event="valueChange" listener="#{managedEchellonage.addParamStatus()}" oncomplete="collapseList('echeancier')" />
                    </h:selectOneMenu>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

