<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Models Exportation &amp; Importation','modParam', 'smenEtatExport', true)}
    </ui:define>  
    <ui:define name="contents"> 
        #{managedExportImport.loadAll()}
        <script type="text/javascript">
            $(function() {
                collapseForm('etat_export');
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
            });
        </script>
        <h:form>
            <p:remoteCommand name="updateBeanCaisse_" actionListener="#{managedExportImport.updateBean()}"/>
        </h:form>

        <h:form prependId="false" enctype="multipart/form-data">
            <p:dialog widgetVar="dlgUploadFile" width="300" height="100" closeOnEscape="true" dynamic="true" resizable="false">
                <p:fileUpload sizeLimit="1000000" mode="advanced" dragDropSupport="true" auto="true" allowTypes="/(\.|\/)(csv|txt)$/" 
                              fileUploadListener="#{managedExportImport.handleFile}"
                              uploadLabel="#{lab.L_envoyer}" label="#{lab.L_parcourir}"
                              oncomplete="dlgUploadFile.hide()"> 
                </p:fileUpload>
            </p:dialog>
            <p:dialog header="Visualiser les données à importer" width="80%" closeOnEscape="true" widgetVar="dlgImportData" resizable="true">
                <p:outputPanel id="blog_import_data">
                    <p:dataTable value="#{managedExportImport.resultImport.lignes}" var="ligne" rowIndexVar="iRow" paginator="true" rows="20" paginatorAlwaysVisible="false">
                        <p:columnGroup type="header" rendered="#{!managedExportImport.resultImport.titles.isEmpty()}">
                            <p:row>
                                <c:forEach items="#{managedExportImport.resultImport.titles}" var="head" varStatus="iHead">
                                    <p:column headerText="#{managedExportImport.sanitize(head)}" style="width: 15%"/>
                                </c:forEach>
                            </p:row>
                        </p:columnGroup>  
                        <p:columns value="#{ligne}" var="col" columnIndexVar="iCol" style="width: 15%">
                            <h:outputText value="#{managedExportImport.sanitize(col)}"/>  
                        </p:columns> 
                    </p:dataTable>
                </p:outputPanel>
                <f:facet name="footer">
                    <p:commandButton value="#{lab.L_importer}" actionListener="#{managedExportImport.onImporte()}" oncomplete="dlgImportData.hide()" style="float: right;margin-top: -3px" />                    
                </f:facet>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.LMP_PMEI_erreur_compilation}" width="40%" closeOnEscape="true" widgetVar="dlgErreurExport">
                <h:inputTextarea id="txt_msg_erreur_compilation_export" value="#{managedExportImport.msg_erreur}" rows="20" style="width: 100%"/>
            </p:dialog>
            <p:dialog header="Visualiser la requete" width="40%" closeOnEscape="true" widgetVar="dlgQueryExport">
                <h:inputTextarea id="txt_msg_query_compilation_export" value="#{managedExportImport.msg_query}" rows="20" style="width: 100%"/>
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:dialog header="Entrer les valeurs des conditions" width="40%" closeOnEscape="true" widgetVar="dlgExportData">
                <p:outputPanel id="blog_export_data">
                    <p:dataTable value="#{managedExportImport.selectExportEtat.colonnes}" var="colon" rowKey="#{colon.id}" 
                                 rowIndexVar="idx" editable="true" editMode="cell">
                        <p:column headerText="Colonne">
                            <span>#{colon.tableName}.#{colon.colonne}</span>
                        </p:column>
                        <p:column headerText="Operateur" style="text-align:center">
                            <span>#{colon.conditionOperator}</span>
                        </p:column>
                        <p:column headerText="Valeur" style="text-align: center;cursor: pointer">
                            <p:cellEditor rendered="#{colon.conditionExpression.startsWith(':')}">
                                <f:facet name="output">
                                    <h:outputText value="#{colon.conditionValue}"/>
                                    <h:panelGroup rendered="#{colon.conditionOperator eq 'BETWEEN'}">
                                        <p:spacer style="background: black;width: 10px;height: 5px;margin: 2px"/>
                                        <h:outputText value="#{colon.conditionValueOther}"/>
                                    </h:panelGroup>
                                </f:facet>
                                <f:facet name="input">
                                    <h:inputText value="#{colon.conditionValue}" style="width: #{colon.conditionOperator eq 'BETWEEN'?'100px':'200px'}" title="Separer par un ; pour une liste"/>
                                    <h:panelGroup rendered="#{colon.conditionOperator eq 'BETWEEN'}">
                                        <p:spacer style="background: black;width: 10px;height: 5px;margin: 2px"/>
                                        <h:inputText value="#{colon.conditionValueOther}" style="width: 100px" title="Separer par un ; pour une liste"/>
                                    </h:panelGroup>
                                </f:facet>
                            </p:cellEditor>
                            <h:panelGroup rendered="#{!colon.conditionExpression.startsWith(':')}">
                                <h:outputText value="#{colon.conditionExpression}"/>
                                <h:panelGroup rendered="#{colon.conditionOperator eq 'BETWEEN'}">
                                    <p:spacer style="background: black;width: 10px;height: 5px;margin: 2px"/>
                                    <h:outputText value="#{colon.conditionExpressionOther}"/>
                                </h:panelGroup>
                            </h:panelGroup>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
                <f:facet name="footer">
                    <p:commandButton value="#{lab.L_exporter}" actionListener="#{managedExportImport.onExporter()}" ajax="false" style="float: right;margin-top: -3px" />                    
                </f:facet>
            </p:dialog>
        </h:form>

        <h:form prependId="false" id="main_colonne_etat_export">
            <p:dialog header="Détails de la colonne" width="30%" closeOnEscape="true" widgetVar="dlgDetailsColonne">
                <h:panelGrid id="form_colonne_etat_export" columns="2" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                    <f:facet name="header">
                        <p>#{managedExportImport.colonne.tableName}<b>.</b>#{managedExportImport.colonne.colonne}</p>
                    </f:facet> 
                    <span>Libelle</span>
                    <h:inputText value="#{managedExportImport.colonne.libelle}" style="width: 100%">
                        <p:ajax event="valueChange" global="false"/>
                    </h:inputText>
                    <span>#{lab.LMP_PMEI_order_by}</span>
                    <h:panelGroup>
                        <h:selectOneMenu id="order_by_colonne_export" value="#{managedExportImport.colonne.orderBy}">
                            <f:selectItem itemLabel="" itemValue="#{null}"/>
                            <f:selectItem itemLabel="DESC" itemValue="D"/>
                            <f:selectItem itemLabel="ASC" itemValue="A"/>
                            <p:ajax event="valueChange" global="false"/>
                        </h:selectOneMenu>
                        <h:panelGroup style="float: right">
                            <h:selectBooleanCheckbox value="#{managedExportImport.colonne.key}">
                                <p:ajax event="valueChange"/>
                            </h:selectBooleanCheckbox>
                            <span>Définir comme clé</span>
                        </h:panelGroup>
                    </h:panelGroup>
                    <span>Valeur par defaut </span>
                    <h:inputText value="#{managedExportImport.colonne.defautValeur}" style="width: 100%">
                        <p:ajax event="valueChange" global="false"/>
                    </h:inputText>
                    <f:facet name="footer">
                        <div align="left">
                            <h:panelGrid id="form_contrainte_colonne_etat_export" columns="1" styleClass="yvs_nostyle" style="width: 100%" cellpadding="0" cellspacing="0">
                                <h:panelGroup>
                                    <h:selectBooleanCheckbox value="#{managedExportImport.colonne.condition}">
                                        <p:ajax event="valueChange" update="form_contrainte_colonne_etat_export"/>
                                    </h:selectBooleanCheckbox>
                                    <span>Condition</span>
                                </h:panelGroup>
                                <h:panelGrid columns="2" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0" rendered="#{managedExportImport.colonne.condition}">
                                    <h:outputText value="Operateur"/>
                                    <h:outputText value="Valeur(s) ou expression(s)"/>
                                    <h:selectOneMenu value="#{managedExportImport.colonne.conditionOperator}">
                                        <f:selectItem itemLabel="=" itemValue="="/>
                                        <f:selectItem itemLabel="!=" itemValue="!="/>
                                        <f:selectItem itemLabel="&gt;" itemValue="&gt;"/>
                                        <f:selectItem itemLabel="&lt;" itemValue="&lt;"/>
                                        <f:selectItem itemLabel="IN" itemValue="IN"/>
                                        <f:selectItem itemLabel="NOT IN" itemValue="NOT IN"/>
                                        <f:selectItem itemLabel="LIKE" itemValue="LIKE"/>
                                        <f:selectItem itemLabel="NOT LIKE" itemValue="NOT LIKE"/>
                                        <f:selectItem itemLabel="BETWEEN" itemValue="BETWEEN"/>
                                        <p:ajax event="valueChange" global="false" update="form_condition_colonne_etat_export"/>
                                    </h:selectOneMenu>
                                    <h:panelGroup id="form_condition_colonne_etat_export">
                                        <h:inputText value="#{managedExportImport.colonne.conditionExpression}" title="Prefixer de : pour un parametre dynamique" style="width: 180px">
                                            <p:ajax event="valueChange" global="false"/>
                                        </h:inputText>
                                        <h:panelGroup rendered="#{managedExportImport.colonne.conditionOperator eq 'BETWEEN'}">
                                            <p:spacer style="background: black;width: 10px;height: 5px;margin: 2px"/>
                                            <h:inputText value="#{managedExportImport.colonne.conditionExpressionOther}" title="Prefixer de : pour un parametre dynamique" style="width: 180px">
                                                <p:ajax event="valueChange" global="false"/>
                                            </h:inputText>
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </h:panelGrid>
                                <p:separator/>
                                <h:panelGroup>
                                    <h:selectBooleanCheckbox value="#{managedExportImport.colonne.contrainte}" disabled="#{managedExportImport.colonne.realContrainte}">
                                        <p:ajax event="valueChange" listener="#{managedExportImport.chooseContrainte()}" update="form_contrainte_colonne_etat_export"/>
                                    </h:selectBooleanCheckbox>
                                    <span>Contrainte</span>
                                </h:panelGroup>
                                <h:selectOneMenu value="#{managedExportImport.colonne.tableNameLiee}" style="width: 100%" rendered="#{managedExportImport.colonne.contrainte}">
                                    <f:selectItem itemLabel="--" itemValue="#{null}"/>
                                    <f:selectItems value="#{managedExportImport.tablesContraint}" var="tabC" itemLabel="#{tabC}" itemValue="#{tabC}"/>
                                    <p:ajax event="valueChange" listener="#{managedExportImport.chooseTableContraint()}" update="select_colonne_liee_colonne"/>
                                </h:selectOneMenu>
                                <h:panelGrid columns="3" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0" rendered="#{managedExportImport.colonne.contrainte}">
                                    <h:outputText value="#{lab.LMP_PMEI_colonne_liee}"/>
                                    <h:outputText value="Jointure"/>
                                    <h:outputText value="Sens"/>
                                    <h:selectOneMenu id="select_colonne_liee_colonne" value="#{managedExportImport.colonne.colonneLiee}" style="width: 180px">
                                        <f:selectItem itemLabel="--" itemValue="#{null}"/>
                                        <f:selectItems value="#{managedExportImport.colonnesContraint}" var="colC" itemLabel="#{colC}" itemValue="#{colC}"/>
                                        <p:ajax event="valueChange" global="false"/>
                                    </h:selectOneMenu>
                                    <h:selectOneMenu value="#{managedExportImport.colonne.jointure}">
                                        <f:selectItem itemLabel="LEFT JOIN" itemValue="LEFT JOIN"/>
                                        <f:selectItem itemLabel="RIGHT JOIN" itemValue="RIGHT JOIN"/>
                                        <f:selectItem itemLabel="INNER JOIN" itemValue="INNER JOIN"/>
                                        <p:ajax event="valueChange" global="false"/>
                                    </h:selectOneMenu>
                                    <h:selectOneMenu value="#{managedExportImport.colonne.sensContrainte}">
                                        <f:selectItem itemLabel="NORMAL" itemValue="N"/>
                                        <f:selectItem itemLabel="INVERSE" itemValue="I"/>
                                        <p:ajax event="valueChange" global="false"/>
                                    </h:selectOneMenu>
                                </h:panelGrid>
                            </h:panelGrid>
                        </div>
                    </f:facet>
                </h:panelGrid>
                <f:facet name="footer">
                    <p:commandButton icon="ui-icon-disk" title="#{lab.L_enregistrer}" value="#{lab.L_enregistrer}" style="float: right;margin-bottom: 5px"
                                     actionListener="#{managedExportImport.saveNewColonne()}" update=":main_etat_export:data_colonne_etat_export"/>              
                </f:facet>
            </p:dialog>
        </h:form>

        <!-->
       *****************************************************************************
       Début du formulaire
       *****************************************************************************
       <-->
        <h:form prependId="false" id="main_etat_export">   
            <div class="part_fix">                
                <p:splitButton icon="ui-icon-disk" value="#{lab.L_enregistrer}" id="save_etat_export" actionListener="#{managedExportImport.saveNew()}" update="data_etat_export blog_etat_export" >
                    <p:menuitem icon="ui-icon-document" value="#{lab.L_nouveau}" id="cancel_etat_export" actionListener="#{managedExportImport.resetFiche()}" update="blog_etat_export" oncomplete="collapseForm('etat_export')" />
                    <p:separator />
                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" onclick="dlgConfirmDelete.show()" global="false"/>
                </p:splitButton>
                <p:outputPanel autoUpdate="true">               
                    <p:splitButton icon="ui-icon-extlink" value="#{lab.LRH_PB_compiler}" id="compiler_etat_export" actionListener="#{managedExportImport.compilerModel()}" rendered="#{exportEtat.id gt 0}">
                        <p:menuitem value="Voir la requete" icon="ui-icon-extlink" actionListener="#{managedExportImport.onViewModel()}" oncomplete="dlgQueryExport.show()"/>
                        <p:separator/>
                        <p:menuitem value="#{lab.L_exporter}" icon="ui-icon-extlink" actionListener="#{managedExportImport.onOpenToExport(managedExportImport.currentExportEtat)}" oncomplete="dlgExportData.show()"/>
                        <p:menuitem value="#{lab.L_importer}" icon="ui-icon-extlink" actionListener="#{managedExportImport.setSelectExportEtat(managedExportImport.currentExportEtat)}"
                                    disabled="#{exportEtat.typeFormule eq 'F'}" oncomplete="dlgUploadFile.show()"/>
                    </p:splitButton>
                </p:outputPanel>
                <div style="float: right">
                    <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('etat_export');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link title="#{lab._mode_liste}" onclick="collapseList('etat_export');
                            return false" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>   
                </div>
            </div>
            <div class="part_scroll">
                <!-->
                 *****************************************************************************
                 Vue Formulaire
                 *****************************************************************************
                <-->
                <div class="yvs_form_etat_export" style="width: 99%; height: 99%; margin: auto; background: white">
                    <h:panelGroup id="blog_etat_export">
                        <h:panelGrid columns="1" style="width: 100%; background: #CCCCCC">
                            <h:panelGrid columns="6">
                                <h:outputText value="#{lab.LDB_PA_modele}" />
                                <h:outputText value="#{lab.L_reference}" />
                                <h:outputText value="#{lab.LMP_PMEI_file_name}" />
                                <h:outputText value="#{lab.LMP_PMEI_format}" />
                                <h:outputText value="#{lab.LMP_PMEI_separateur}" />
                                <h:outputText value="Mode d'extraction" />
                                <h:panelGroup>
                                    <h:selectOneMenu value="#{exportEtat.code}" style="min-width: 140px">
                                        <f:selectItem itemLabel="--" itemValue="#{null}"/>
                                        <f:selectItems value="#{constantes.TYPE_ETAT_EXPORT}" var="typ" itemLabel="#{typ.value}" itemValue="#{typ.label}"/>
                                        <p:ajax event="valueChange" listener="#{managedExportImport.chooseType()}" update="btnListReference"/>
                                    </h:selectOneMenu>
                                    <p:commandLink id="btnListReference" global="false" update="data_reference_export" style="margin-right: 10px;margin-left: 15px">
                                        <h:outputText value="#{managedExportImport.references.size()}" converter="DNA" styleClass="num" style="color: greenyellow; padding: 5px; top: 0.5" />
                                    </p:commandLink>
                                    <p:overlayPanel for="btnListReference" hideEffect="fade" style="width: 20%">
                                        <p:dataTable id="data_reference_export" value="#{managedExportImport.references}" var="reference" rowKey="#{reference}" 
                                                     rowIndexVar="Idx" selectionMode="single">
                                            <p:ajax event="rowSelect" listener="#{managedExportImport.loadOnReference}"/>
                                            <p:column headerText="N°" width="15">
                                                <span>#{Idx+1}</span>
                                            </p:column>
                                            <p:column headerText="#{lab.L_reference}">
                                                <span>#{reference}</span>
                                            </p:column>
                                        </p:dataTable>
                                    </p:overlayPanel>
                                </h:panelGroup>  
                                <h:inputText value="#{exportEtat.reference}">
                                    <p:ajax event="valueChange"/>                            
                                </h:inputText>
                                <h:inputText value="#{exportEtat.fileName}" style="width: 250px">
                                    <p:ajax event="valueChange"/>                            
                                </h:inputText>
                                <h:selectOneMenu value="#{exportEtat.format}" style="width: 100px">
                                    <f:selectItems value="#{constantes.FILES_EXTENSION_EXPORT}" var="ext" itemLabel="#{ext.value}" itemValue="#{ext.label}"/>
                                    <p:ajax event="valueChange" global="false" update="select_separateur_etat_export"/>     
                                </h:selectOneMenu>
                                <h:selectOneMenu id="select_separateur_etat_export" value="#{exportEtat.separateur}" style="width: 100px" disabled="#{exportEtat.format eq constantes.FILE_CSV}">
                                    <f:selectItem itemLabel=";" itemValue=";"/>
                                    <f:selectItem itemLabel="," itemValue=","/>
                                    <p:ajax event="valueChange" global="false"/>   
                                </h:selectOneMenu>
                                <h:selectOneMenu value="#{exportEtat.typeFormule}" style="width: 140px">
                                    <f:selectItem itemLabel="Selon un model" itemValue="S"/>
                                    <f:selectItem itemLabel="Requete Libre" itemValue="F"/>
                                    <p:ajax event="valueChange" global="false" update="blog_colonne_etat_export"/>
                                </h:selectOneMenu>
                            </h:panelGrid>
                        </h:panelGrid>
                        <p:outputPanel id="blog_colonne_etat_export">
                            <h:panelGroup rendered="#{exportEtat.typeFormule == 'S'}" style="width: 100%;height: 100%">
                                <h:panelGrid columns="1" style="width: 29%;height: auto;float: left;padding: 5px" cellpadding="0" cellspacing="0">
                                    <span>#{lab.LMP_PMEI_table}</span>
                                    <h:selectOneMenu value="#{managedExportImport.colonne.tableName}" style="width: 100%" disabled="#{exportEtat.id lt 1}">
                                        <f:selectItem itemLabel="--" itemValue="#{null}"/>
                                        <f:selectItems value="#{managedExportImport.tables}" var="tab" itemLabel="#{tab}" itemValue="#{tab}"/>
                                        <p:ajax event="valueChange" listener="#{managedExportImport.chooseTable()}" update="data_colonne_table"/>
                                    </h:selectOneMenu>
                                    <p:dataTable id="data_colonne_table" value="#{managedExportImport.colonnes}" var="column" rowKey="#{column}" rowIndexVar="Idx"
                                                 scrollable="true" scrollHeight="650">
                                        <p:column headerText="#{lab.LMP_PMEI_colonne}" style="#{managedExportImport.isExist(managedExportImport.colonne.tableName, column)?'opacity:0.5':''}">
                                            <span>#{column}</span>
                                        </p:column>                            
                                        <p:column headerText="" style="text-align: center;width: 25px">   
                                            <f:facet name="header">
                                                <p:commandButton icon="ui-icon-arrowthick-1-e" style="width: 22px; height: 22px" disabled="#{managedExportImport.colonnes.isEmpty()}"
                                                                 actionListener="#{managedExportImport.addColumns(managedExportImport.colonne.tableName, managedExportImport.colonnes)}"/>
                                            </f:facet>                  
                                            <p:commandButton icon="ui-icon-arrowthick-1-e" style="width: 22px; height: 22px"
                                                             actionListener="#{managedExportImport.addColumn(managedExportImport.colonne.tableName, column)}"
                                                             disabled="#{managedExportImport.isExist(managedExportImport.colonne.tableName, column)}"/>
                                        </p:column>
                                    </p:dataTable>  
                                </h:panelGrid>
                                <h:panelGroup style="width: 70%;float: right;padding: 5px">                                    
                                    <h:panelGroup>
                                        <h:panelGrid style="float: left;font-size: 0.6em" columns="4">
                                            <h:outputText value="#{lab.L_reference}" />
                                            <h:outputText value="#{lab.LMP_PMEI_integrer}" />
                                            <h:outputText value="#{lab.LMP_PMF_visible}" />
                                            <h:outputText value="#{lab.LMP_PMEI_contrainte}" />
                                            <h:inputText value="#{managedExportImport.tableSearch}" disabled="#{exportEtat.id lt 1}">
                                                <p:ajax event="valueChange" listener="#{managedExportImport.addParamTable()}" update="data_colonne_etat_export"/>
                                            </h:inputText>
                                            <h:selectOneMenu value="#{managedExportImport.integrerSearch}" disabled="#{exportEtat.id lt 1}">
                                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                                <f:selectItem itemLabel="#{lab.L_oui.toUpperCase()}" itemValue="#{true}"/>
                                                <f:selectItem itemLabel="#{lab.L_non.toUpperCase()}" itemValue="#{false}"/>
                                                <p:ajax event="valueChange" listener="#{managedExportImport.addParamIntegrer()}" update="data_colonne_etat_export"/>
                                            </h:selectOneMenu>
                                            <h:selectOneMenu value="#{managedExportImport.visibleSearch}" disabled="#{exportEtat.id lt 1}">
                                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                                <f:selectItem itemLabel="#{lab.L_oui.toUpperCase()}" itemValue="#{true}"/>
                                                <f:selectItem itemLabel="#{lab.L_non.toUpperCase()}" itemValue="#{false}"/>
                                                <p:ajax event="valueChange" listener="#{managedExportImport.addParamVisible()}" update="data_colonne_etat_export"/>
                                            </h:selectOneMenu>
                                            <h:selectOneMenu value="#{managedExportImport.contrainteSearch}" disabled="#{exportEtat.id lt 1}">
                                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                                <f:selectItem itemLabel="#{lab.L_oui.toUpperCase()}" itemValue="#{true}"/>
                                                <f:selectItem itemLabel="#{lab.L_non.toUpperCase()}" itemValue="#{false}"/>
                                                <p:ajax event="valueChange"     listener="#{managedExportImport.addParamContrainte()}" update="data_colonne_etat_export"/>
                                            </h:selectOneMenu>
                                        </h:panelGrid>
                                        <p:outputPanel autoUpdate="true" style="float: right;margin-top: 15px" layout="block">
                                            <p:commandButton actionListener="#{managedExportImport.paginerColonne(false)}" global="false" update="data_colonne_etat_export" icon="ui-icon-circle-triangle-w" disabled="#{managedExportImport.p_colonnes.disPrev}"/>
                                            <p:outputPanel ><p:outputLabel value="#{managedExportImport.p_colonnes.currentPage}/#{managedExportImport.p_colonnes.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                                            <p:commandButton actionListener="#{managedExportImport.paginerColonne(true)}" global="false" update="data_colonne_etat_export" icon="ui-icon-circle-triangle-e" disabled="#{managedExportImport.p_colonnes.disNext}"/>
                                            <p:selectOneMenu value="#{managedExportImport.p_colonnes.rows}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedExportImport.choosePaginatorColonne}"
                                                             disabled="#{exportEtat.id lt 1}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                                                <f:selectItems value="#{managedExportImport.paginations}"/>
                                                <p:ajax event="valueChange" global="false" update="data_colonne_etat_export"/>
                                            </p:selectOneMenu>
                                        </p:outputPanel>  
                                        <div style="clear: both"></div>
                                    </h:panelGroup>
                                    <p:dataTable id="data_colonne_etat_export" value="#{exportEtat.colonnes}" var="colon" rowKey="#{colon.id}" rowIndexVar="Idx"
                                                 scrollable="true" scrollHeight="650">
                                        <p:column headerText="" style="text-align: center;width: 25px">
                                            <p:commandButton icon="ui-icon-pencil" style="width: 22px; height: 22px"  actionListener="#{managedExportImport.onRowEdit(colon)}"
                                                             update=":main_colonne_etat_export:form_colonne_etat_export" oncomplete="dlgDetailsColonne.show()"/>
                                        </p:column>  
                                        <p:column headerText="N°" style="text-align: center;width: 20px">
                                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{colon.new_}"/>
                                            <span>#{Idx+1}</span>
                                        </p:column>  
                                        <p:column headerText="Libelle" style="#{colon.visible?'':'text-decoration: line-through'};#{colon.integrer?'':'color : red'}">
                                            <span>#{colon.libelle}</span>
                                            <h:panelGroup style="float: right">
                                                <h:outputText value="K" title="Est un identifiant (clé)" rendered="#{colon.key}" style="border: 1px solid blue;padding: 2px"/>
                                                <h:outputText value="R" title="Est une relation" rendered="#{colon.contrainte}" style="border: 1px solid green;padding: 2px;margin-left: 2px"/>
                                                <h:outputText value="C" title="Est une condition" rendered="#{colon.condition}" style="border: 1px solid orange;padding: 2px;margin-left: 2px"/>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="#{lab.LMP_PMEI_colonne}" style="#{colon.visible?'':'text-decoration: line-through'};#{colon.integrer?'':'color : red'}">
                                            <span>#{colon.tableName}.#{colon.colonne}</span>
                                        </p:column>
                                        <p:column headerText="" style="text-align: center;width: 50px">
                                            <p:commandButton icon="ui-icon-arrowthick-1-n" style="width: 22px; height: 22px" actionListener="#{managedExportImport.onUpOrderColonne(colon)}"
                                                             rendered="#{colon.integrer}" disabled="#{!managedExportImport.isUpOrderColonne(colon)}" update="data_colonne_etat_export"/>
                                            <p:commandButton icon="ui-icon-arrowthick-1-s" style="width: 22px; height: 22px" actionListener="#{managedExportImport.onDownOrderColonne(colon)}"
                                                             rendered="#{colon.integrer}" disabled="#{!managedExportImport.isDownOrderColonne(colon)}" update="data_colonne_etat_export"/>
                                        </p:column>                            
                                        <p:column headerText="" style="text-align: center;width: 25px">                            
                                            <p:contextMenu for="btn_option_colonne_etat_export" event="left click" style="font-size: 0.8em; width: 200px">
                                                <p:menuitem value="#{colon.integrer?'Ne pas i':'I'}ntégrer au résultat" icon="#{colon.integrer?'ui-icon-minus':'ui-icon-plus'}"
                                                            actionListener="#{managedExportImport.changeIntegreColonne(colon)}" update="data_colonne_etat_export"/>
                                                <p:menuitem value="Rendre #{colon.visible?'invisible':'visible'}" icon="#{colon.visible?'ui-icon-cancel':'ui-icon-radio-on'}"
                                                            actionListener="#{managedExportImport.changeVisibleColonne(colon)}" update="data_colonne_etat_export"
                                                            rendered="#{colon.integrer}"/>
                                                <p:separator />
                                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" actionListener="#{managedExportImport.deleteBeanColonne(colon)}"
                                                            update="data_colonne_etat_export"/>
                                            </p:contextMenu>                           
                                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_colonne_etat_export" type="button"/>
                                        </p:column>
                                    </p:dataTable> 
                                </h:panelGroup>
                            </h:panelGroup>
                            <p:outputPanel rendered="#{exportEtat.typeFormule != 'S'}">
                                <h:inputTextarea value="#{exportEtat.formule}" style="width: 100%" rows="20"/>
                                <span style="float: right;font-size: 0.8em">* #{lab.LMP_PMEI_text}</span>
                            </p:outputPanel>
                        </p:outputPanel>  
                    </h:panelGroup>                      
                </div>
                <!-->
                 *****************************************************************************
                 Vue Liste
                 *****************************************************************************
                <-->
                <div class="yvs_list_etat_export" style="width: 99%; margin: auto; background: white">
                    <p:dataTable id="data_etat_export" value="#{managedExportImport.etats}" var="etat" rowKey="#{etat.id}" 
                                 rowIndexVar="etatIdx" selectionMode="single">
                        <p:ajax event="rowSelect" listener="#{managedExportImport.loadOnView}" process="@this" partialSubmit="true"
                                oncomplete="collapseForm('etat_export')" update=":main_etat_export:blog_etat_export"/>
                        <p:column headerText="N°" width="15">
                            <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{etat.new_}"/>
                            <span>#{etatIdx+1}</span>
                        </p:column>
                        <p:column headerText="Model" style="width: 12%;">
                            <span>#{etat.code}</span>
                        </p:column>
                        <p:column headerText="#{lab.L_code}" style="width: 12%;">
                            <span>#{etat.reference}</span>
                        </p:column>
                        <p:column headerText="#{lab.LMP_PMEI_file_name}">
                            <span>#{etat.fileName}.#{etat.format.toLowerCase()}</span>
                        </p:column> 
                        <p:column headerText="#{lab.LMP_PMEI_col_integrees}" style="width: 12%;text-align: center">
                            <h:outputText value="#{managedExportImport.nombreIntegrer(etat)}" converter="DN" styleClass="num" style="color: greenyellow; padding: 5px; top: 0.5" />
                        </p:column>
                        <p:column headerText="#{lab.LMP_PMEI_col_visibles}" style="width: 12%;text-align: center">
                            <h:outputText value="#{managedExportImport.nombreVisible(etat)}" converter="DN" styleClass="num" style="color: greenyellow; padding: 5px; top: 0.5" />
                        </p:column>
                        <p:column headerText="#{lab.LMP_PMEI_col_conraintes}" style="width: 12%;text-align: center">
                            <h:outputText value="#{managedExportImport.nombreContrainte(etat)}" converter="DN" styleClass="num" style="color: greenyellow; padding: 5px; top: 0.5" />
                        </p:column>
                        <p:column headerText="" width="15" style="text-align: center;">                            
                            <p:contextMenu for="btn_option_etat_export" event="left click" style="font-size: 0.8em">
                                <p:menuitem value="#{lab.L_exporter}" icon="ui-icon-extlink" actionListener="#{managedExportImport.onOpenToExport(etat)}" oncomplete="dlgExportData.show()"/>
                                <p:menuitem value="#{lab.L_importer}" icon="ui-icon-extlink" actionListener="#{managedExportImport.setSelectExportEtat(etat)}"
                                            disabled="#{etat.typeFormule eq 'F'}" oncomplete="dlgUploadFile.show()"/>
                                <p:separator/>
                                <p:menuitem value="Sauvegarder" icon="ui-icon-extlink" actionListener="#{managedExportImport.setSelectExportEtat(etat)}" oncomplete="dlgBackupExport.show()"/>
                                <p:menuitem value="Restaurer" icon="ui-icon-extlink" actionListener="#{managedExportImport.setSelectExportEtat(etat)}" oncomplete="dlgRestoreExport.show()"/>
                                <p:menuitem value="#{lab.LMP_PMEI_dupliquer}" icon="ui-icon-copy" actionListener="#{managedExportImport.duplicateModel(etat)}"
                                            update="data_etat_export"/>
                                <p:separator/>
                                <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedExportImport.deleteBean(etat)}"
                                            update="data_etat_export"/>
                            </p:contextMenu>                           
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_etat_export" type="button"/>
                        </p:column>
                    </p:dataTable> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedExportImport.paginer(false)}" global="false" update="data_etat_export" icon="ui-icon-circle-triangle-w" disabled="#{managedExportImport.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedExportImport.paginator.currentPage}/#{managedExportImport.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedExportImport.paginer(true)}" global="false" update="data_etat_export" icon="ui-icon-circle-triangle-e" disabled="#{managedExportImport.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedExportImport.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedExportImport.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedExportImport.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_etat_export"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div> 
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form style="background: #CCC" id="main_search_export">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="#{lab.L_cacher}"/>  
            <div class="zone_find">
                <h:panelGrid columns="2" style="width: 100%; font-size: 1.0em" cellpadding="0" cellspacing="0">
                    <h:panelGrid columns="1" style="float: left; font-size: 1.0em" cellpadding="0" cellspacing="0">
                        <h:outputText value="#{lab.L_reference}" />
                        <h:inputText value="#{managedExportImport.numSearch}">
                            <p:ajax event="valueChange" listener="#{managedExportImport.addParamReference()}"/>
                        </h:inputText>
                    </h:panelGrid>
                    <h:panelGroup style="float: right">

                    </h:panelGroup>
                </h:panelGrid>
            </div>
        </h:form>
    </ui:define>
</ui:composition>