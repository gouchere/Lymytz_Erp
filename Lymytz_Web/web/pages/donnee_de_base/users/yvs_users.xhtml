<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:c="http://java.sun.com/jsp/jstl/core">    
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Gestion des utilisateurs','modDonneBase', 'smenUser', true,managedUser)}
    </ui:define>         
    <ui:define name="contents">
        #{acces.doNothing()}
        #{managedNiveauAcces.doNothing()}
        #{managedAgence.doNothing()}
        #{managedSociete.loadByGroupe()}
        #{managedUser.initView()}
        #{managedUser.addParamActif(true)}
        #{managedCategoriePerso.loadAll()}
        <h:outputScript library="js/donne_de_base" name="param_db.js" />
        <script type="text/javascript">
            $(function() {
//                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 135);
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('user');
            });
        </script> 
        <h:form prependId="false" enctype="multipart/form-data">
            <p:dialog widgetVar="dlgUploadImg" width="300" height="100" closeOnEscape="true"
                      dynamic="true" resizable="false">
                <p:fileUpload sizeLimit="100000"  id="image_user_00"  mode="advanced" dragDropSupport="true" 
                              allowTypes="/(\.|\/)(gif|jpe?g|png)$/" fileUploadListener="#{managedUser.handleFileUpload}"
                              uploadLabel="#{lab.L_envoyer}" label="#{lab.L_parcourir}" auto="true"
                              oncomplete="dlgUploadImg.hide()"> 
                </p:fileUpload>
            </p:dialog>
        </h:form>
        <!-->
        *************************************BeanCaisse****************************************
        Boite de dialogue des livreurs
        *****************************************************************************
        <-->  
        <h:form prependId="false">
            <p:dialog header="#{lab.LDB_PU_liste_livreurs}" widgetVar="dlgListUsers" modal="true" width="50%"  closeOnEscape="true"> 
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:panelGroup>
                        <h:inputText value="#{managedUser.numSearch}" style="margin-left: -10px">
                            <p:ajax event="keyup" global="false" update="data_users_acces" listener="#{managedUser.searchUsersActif(false)}"/>
                        </h:inputText>
                    </h:panelGroup>                    
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedUser.loadAll(false,false)}" global="false" update="data_users_acces" icon="ui-icon-circle-triangle-w" disabled="#{managedUser.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedUser.paginator.currentPage}/#{managedUser.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedUser.loadAll(true,false)}" global="false" update="data_users_acces" icon="ui-icon-circle-triangle-e" disabled="#{managedUser.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedUser.imax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{managedUser.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{managedUser.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_users_acces"/>
                        </p:selectOneMenu>
                    </p:outputPanel>  
                </h:panelGrid>
                <p:dataTable id="data_users_acces" value="#{managedUser.listUser}" var="art" rowKey="#{art.id}"
                             selectionMode="single" paginator="true" rows="20" paginatorAlwaysVisible="false" >
                    <p:ajax event="rowSelect" global="false" listener="#{managedUser.loadOnViewUsers}" oncomplete="dlgListUsers.hide()"/>
                    <p:column filterBy="#{art.codeUsers}" style="width: 2%">
                        <span>#{art.codeUsers}</span>
                    </p:column>
                    <p:column headerText="#{lab.LDB_PU_noms}" style="width: 6%">
                        <span>#{art.nomUsers}</span>
                    </p:column>
                    <p:column headerText="#{lab.LDB_PU_groupe}" style="width: 4%">
                        <span>#{art.categorie.libelle}</span>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *************************************BeanCaisse****************************************
        Boite de dialogue des naviagtions
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="main_code_acces">
            <p:dialog header="Description accès" widgetVar="dlgUpdateAcces" modal="true" width="25%" closeOnEscape="true"> 
                <h:inputText value="#{managedUser.codeAcces}" style="background: #99ccff;width: 99%"/>
                <h:inputTextarea value="#{managedUser.descriptionAcces}" style="width: 99%" rows="3"/>
                <p:dataTable value="#{managedUser.selectAcces.code.elements}" var="elt" rows="10" paginatorAlwaysVisible="false" paginator="true"
                             rendered="#{managedUser.selectAcces.code.id gt 0}">
                    <p:column headerText="#{lab.LDB_PU_element}">
                        <span>#{elt}</span>
                    </p:column>
                </p:dataTable>
                <p:commandButton value="#{lab.L_enregistrer}" style="width: 99%" actionListener="#{managedUser.saveNewAcces()}"
                                 oncomplete="dlgUpdateAcces.hide()"/>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <!-->
        *************************************BeanCaisse****************************************
        Boite de dialogue des naviagtions
        *****************************************************************************
        <-->  
        <h:form prependId="false" id="main_navigation_users">
            <p:dialog header="#{lab.LDB_PU_historiques}" widgetVar="dlgNavigation" modal="true" width="40%" height="400" closeOnEscape="true"> 
                <p:dataTable id="data_navigation_users" value="#{managedUser.userSelect.connection.pages}" var="pag" rowKey="#{pag.id}" 
                             rowIndexVar="_idx" style="height: 385px;overflow-y: auto">
                    <p:column headerText="N°" width="20">
                        <span>#{_idx+1}</span>
                    </p:column>
                    <p:column headerText="#{lab.LDB_PU_pages}" width="130">
                        <span>#{pag.titrePage}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_date}" width="90">
                        <h:outputText value="#{pag.dateOuverture}" converter="DATET"/>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form>

        <h:form prependId="false" id="main_fusionn_user">
            <p:dialog widgetVar="dlgConfirmFusion" header="#{lab.L_fusionner}" dynamic="true" resizable="false" closeOnEscape="true" modal="true">
                <h:panelGrid id="blog_fusionner_user" columns="1" styleClass="yvs_nostyle" style="width: 100%" cellpadding="0" cellspacing="0">
                    <span>#{lab.LDB_PU_text1} </span>
                    <h:outputText style="font-weight: bold;margin-left: 10px" value="#{managedUser.fusionneTo}"/>
                    <span>#{lab.LDB_PU_text2}</span>
                    <c:forEach items="#{managedUser.fusionnesBy}" var="fus">
                        <span style="margin-left: 10px"> - <span style="font-weight: bold">#{fus}</span></span>
                    </c:forEach>
                    <span>#{lab.LDB_PU_text3}</span>
                </h:panelGrid>
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedUser.fusionner(false)}" style="float: right" 
                                 oncomplete="dlgConfirmFusion.hide()"  update=":body_user_00:tab_user_00"/> 
            </p:dialog>
        </h:form> 
        <h:form prependId="false">                     
            <p:confirmDialog message="#{lab.LDB_PU_text4}" widgetVar="dlgConfirmReinitialised"
                             header="#{lab.L_confirmation}" severity="alert" hideEffect="explode" closeOnEscape="true">
                <p:commandButton value="#{lab.L_oui}" oncomplete="dlgConfirmReinitialised.hide()" actionListener="#{managedUser.reInitialedPassword()}" />
                <p:commandButton value="#{lab.L_non}" type="button" onclick="dlgConfirmReinitialised.hide()" />
            </p:confirmDialog>     
        </h:form>
        <h:form prependId="false" style="overflow: auto;" id="form">                     
            <p:confirmDialog message="#{lab.LDB_PU_text5}" widgetVar="dlgConfirmActive"
                             header="#{lab.L_confirmation}" severity="alert" hideEffect="explode" closeOnEscape="true">
                <p:commandButton value="#{lab.L_oui}" oncomplete="dlgConfirmActive.hide()" actionListener="#{managedUser.changeEtat()}" />
                <p:commandButton value="#{lab.L_non}" type="button" onclick="dlgConfirmActive.hide()" />
            </p:confirmDialog>   
        </h:form>
        <h:form prependId="false" style="overflow: auto;"> 
            <p:confirmDialog message="#{lab.LDB_PU_text6}" widgetVar="dlgConfirmDelete"
                             header="#{lab.L_confirmation}" severity="alert" hideEffect="explode" closeOnEscape="true">
                <p:commandButton value="#{lab.L_oui}" oncomplete="dlgConfirmDelete.hide()" actionListener="#{managedUser.deleteBean()}" />
                <p:commandButton value="#{lab.L_non}" type="button" onclick="dlgConfirmDelete.hide()" />
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false" style="overflow: auto;"> 
            <p:confirmDialog message="#{lab.LDB_PU_text7}" widgetVar="dlgConfirmDeconnect"
                             header="#{lab.L_confirmation}" severity="alert" hideEffect="explode" closeOnEscape="true">
                <p:commandButton value="#{lab.L_oui}" oncomplete="dlgConfirmDeconnect.hide()" actionListener="#{managedUser.deconnectUsers()}" />
                <p:commandButton value="#{lab.L_non}" type="button" onclick="dlgConfirmDeconnect.hide()" />
            </p:confirmDialog>                                                                        
        </h:form>   
        <h:form prependId="false" style="overflow: auto;"> 
            <p:confirmDialog message="#{lab.LDB_PU_text6}" widgetVar="dlgConfirmDeleteAcces"
                             header="#{lab.L_confirmation}" severity="alert" hideEffect="explode" closeOnEscape="true">
                <p:commandButton value="#{lab.L_oui}" oncomplete="dlgConfirmDeleteAcces.hide()" actionListener="#{managedUser.deleteCodeAcces()}" />
                <p:commandButton value="#{lab.L_non}" type="button" onclick="dlgConfirmDeleteAcces.hide()" />
            </p:confirmDialog>                                                                        
        </h:form>   
        <h:form prependId="false" id="body_user_00">
            <div class="part_fix">
                <div style="float: left;">                       
                    <p:splitButton id="save_user" value="#{lab.L_enregistrer}" actionListener="#{managedUser.saveNew()}" update="tab_user_00" 
                                   icon="ui-icon-disk">
                        <p:menuitem id="cancel_user" value="#{lab.L_nouveau}" actionListener="#{managedUser.resetFiche()}"  update="form_user_01" process="@this"
                                    icon="ui-icon-document"/>
                        <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" onclick="dlgConfirmDelete.show()" global="false" id="user_delete" />            

                    </p:splitButton>  

                    <p:splitButton  value="#{lab.L_supprimer}" icon="ui-icon-trash" onclick="dlgConfirmDelete.show()" global="false" id="delete_user">
                        <p:menuitem value="#{lab.L_fusionner}" icon="ui-icon-refresh" actionListener="#{managedUser.fusionner(true)}" global="false"
                                    oncomplete="dlgConfirmFusion.show()" update=":main_fusionn_user:blog_fusionner_user"/>
                    </p:splitButton>

                </div>     
                <h:panelGroup style="margin-left: 25%">
                    <p:commandButton actionListener="#{managedUser.parcoursInAllResult(false)}" update="txt_parc_linear_user" global="false"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('user')"/>
                    <h:inputText value="#{managedUser.offset}" style="width: 35px; text-align: center;"  title="#{lab.L_aller_au}" id="txt_parc_linear_user"/>
                    <p:outputPanel autoUpdate="true">                        
                        <p:outputLabel value="/#{managedUser.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                    <p:commandButton actionListener="#{managedUser.parcoursInAllResult(true)}" update="txt_parc_linear_user" global="false" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('user')"/>
                </h:panelGroup>                     
                <div style="float: right">
                    <h:link title="#{lab.L_mode_creation}" onclick="collapseForm('user');
                            return false">
                        <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>               
                    <p:spacer />
                    <h:link onclick="collapseList('user');
                            return false" title="#{lab.L_mode_liste}" >
                        <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                    </h:link>
                    <p:spacer />                       
                </div>
            </div>
            <div class="part_scroll">
                <div class="yvs_form_user">
                    <p:outputPanel id="form_user_01">
                        <div style="float: left; background: white; width: 13%;border: 2px solid #006666; border-radius: 10px">
                            <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_nostyle" >                                        
                                <f:facet name="header">
                                    <p:commandLink title="#{lab.LDB_PU_modifier}" onclick="dlgUploadImg.show()">
                                        <p:graphicImage library="lymytz/documents/docUsers"  width="99%"     
                                                        name="#{(users.photo==null or users.photo=='')?'default.png':users.photo}" alt="#{lab.LDB_PU_photo_user}" 
                                                        id="image_user_01" style="border-radius: 10px"/>
                                    </p:commandLink> 
                                </f:facet>             
                            </h:panelGrid>
                        </div>
                        <div style="width: 85%; margin-left: 13.5%">
                            <ui:include src="users/form.xhtml"/>
                        </div>
                        <div style="clear: left; height: 5px; width: 100%">

                        </div>
                        <p:tabView id="tabview_users" >
                            <p:tab rendered="#{users.afficheSolde}" >
                                <f:facet name="title">
                                    Solde <h:outputText value="#{users.solde}" style="color: #{users.solde gt 0 ? 'green':(users.solde lt 0 ? '#D20005' : 'black')}" converter="DN"/>
                                </f:facet>
                                <div style="float: left;width: 20%">
                                    <p:dataTable value="#{users.soldes}" var="exo" rowKey="#{exo.id}" rowIndexVar="exoIdx"
                                                 paginator="true" rows="10" paginatorAlwaysVisible="false">
                                        <p:column width="30" headerText="N°" style="text-align: center">
                                            <span>#{exoIdx+1}</span>
                                        </p:column>
                                        <p:column width="35" headerText="#{lab.LDB_PU_annee}" style="text-align: center">
                                            <span>#{exo.reference}</span>
                                        </p:column>
                                        <p:column headerText="#{lab.LDB_PU_solde}" style="text-align: right">
                                            <h:outputText value="#{exo.valeur}" converter="DNS"/>
                                        </p:column>
                                    </p:dataTable>   
                                </div>
                                <div style="margin-left: 21%;width: 79%">
                                    <p:dataTable value="#{users.factures}" var="bon" rowKey="#{bon.id}" rowIndexVar="bonIdx"
                                                 paginator="true" rows="10" paginatorAlwaysVisible="false">
                                        <p:column width="10" headerText="N°" styleClass="statut_#{bon.statut}" style="text-align: center">
                                            <h:graphicImage title="#{lab.LDB_PU_cloturer}" library="img" name="blocked.png" width="15" height="15" rendered="#{bon.cloturer}"/>  
                                            <span>#{bonIdx+1}</span>
                                        </p:column>
                                        <p:column headerText="#{lab.LDB_PU_reference}" styleClass="statut_#{bon.statut}">
                                            <span>#{bon.numDoc}</span>
                                            <h:panelGroup style="float: right">
                                                <p:spacer width="2" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}"/>
                                                <h:outputText title="#{lab.LDB_PU_facture_livree}" value="L" rendered="#{bon.statutLivre == constantes.ETAT_LIVRE}"
                                                              style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                                <p:spacer width="2" rendered="#{bon.consigner}"/>
                                                <h:outputText title="#{lab.LDB_PU_stock_facture_consigne}" value="C" rendered="#{managedFactureVente.isConsigner(bon)}"
                                                              style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: black;color: white"/>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="#{lab.LDB_PU_date_facture}" style="text-align: center" styleClass="statut_#{bon.statut}">
                                            <h:outputText value="#{bon.enteteDoc.dateEntete}" converter="DDMMYYYY"/>
                                            <span> à </span>
                                            <h:outputText value="#{bon.heureDoc}" converter="TIME"/>
                                        </p:column>
                                        <p:column headerText="#{lab.LDB_PU_point_vente}" styleClass="statut_#{bon.statut}">
                                            <span>#{bon.enteteDoc.creneau.creneauPoint.point.libelle}</span>
                                        </p:column>
                                        <p:column headerText="#{lab.LDB_PU_vendeur}" styleClass="statut_#{bon.statut}">
                                            <span>#{bon.enteteDoc.creneau.users.nomUsers}</span>
                                        </p:column>
                                        <p:column headerText="#{lab.LDB_PU_net_a_payer}"  width="60" styleClass="statut_#{bon.statut}" style="text-align: right">
                                            <h:outputText value="#{managedFactureVente.netAPayer(bon)}" converter="DNS"/>
                                        </p:column>
                                    </p:dataTable> 
                                </div>
                                <div style="clear: both"/>
                            </p:tab>
                            <p:tab title="#{lab.LDB_PU_alertes}" >
                                <p:dataTable value="#{managedUser.documents}" var="idocM" style="width: 100%" rowKey="#{idocM.id}" id="data_alert_users" rowIndexVar="line">
                                    <p:column headerText="N°" width="40" style="text-align: center">  
                                        #{line+1}
                                    </p:column>
                                    <p:column headerText="#{lab.LDB_PU_documents}" >  
                                        #{idocM.documentType.titreDoc}
                                    </p:column>
                                    <p:column headerText="#{lab.LDB_PU_description}" >  
                                        #{idocM.documentType.description}                                      
                                    </p:column>
                                    <p:column headerText="" width="40" style="text-align: center">
                                        <f:facet name="header">
                                            <p:contextMenu for="btn_option_header_warning_users" event="left click" styleClass="context_menu" style="width: 200px">                                         
                                                <p:menuitem value="#{lab.LDB_PU_activer_tout}" icon="ui-icon-circle-check" actionListener="#{managedUser.activeAlertUserDocAll(true)}" update="data_alert_users"/>    
                                                <p:menuitem value="#{lab.LDB_PU_desactiver_tout}" icon="ui-icon-circle-close" actionListener="#{managedUser.activeAlertUserDocAll(false)}" update="data_alert_users"/>    
                                            </p:contextMenu>
                                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_header_warning_users" type="button"/>
                                        </f:facet>
                                        <p:commandLink actionListener="#{managedUser.activeAlertUserDoc(idocM)}" update="data_alert_users">
                                            <p:graphicImage library="img" name="#{!idocM.actif?'switch_off.png':'switch_on.png'}" width="40"  />
                                        </p:commandLink>
                                    </p:column>
                                </p:dataTable>
                            </p:tab>
                            <p:tab rendered="#{users.accesMultiAgence}" title="Accès aux agences" >
                                <p:dataTable value="#{managedUser.agences}" var="iAg" style="width: 100%" rowKey="#{iAg.id}" id="data_agence_users" rowIndexVar="line">
                                    <p:column headerText="N°" width="40" style="text-align: center">  
                                        #{line+1}
                                    </p:column>
                                    <p:column headerText="Code" >  
                                        #{iAg.agence.codeagence}
                                    </p:column>
                                    <p:column headerText="Designation" >  
                                        #{iAg.agence.designation}                                      
                                    </p:column>
                                    <p:column headerText="Action" width="40" style="text-align: center">
                                        <p:commandLink actionListener="#{managedUser.autoriseActionAgence(iAg)}" update="data_agence_users" disabled="#{!iAg.actif}">
                                            <p:graphicImage library="img" name="#{!iAg.canAction?'switch_off.png':'switch_on.png'}" width="40"  />
                                        </p:commandLink>
                                    </p:column>
                                    <p:column headerText="" width="40" style="text-align: center">
                                        <p:commandLink actionListener="#{managedUser.autoriseAccesAgence(iAg)}" update="data_agence_users">
                                            <p:graphicImage library="img" name="#{!iAg.actif?'switch_off.png':'switch_on.png'}" width="40"  />
                                        </p:commandLink>
                                    </p:column>
                                </p:dataTable>
                            </p:tab>
                            <p:tab title="Accès par code" >
                                <p:commandButton icon="ui-icon-circle-arrow-s" title="#{lab.LDB_PU_charger_droits_utilisateur}" update="data_code_acces"
                                                 actionListener="#{managedUser.loadAcces()}" value="Charger"/>
                                <p:dataTable id="data_code_acces" value="#{managedUser.listAcces}" var="acc" rowKey="#{acc.id}" rowIndexVar="yAcc">
                                    <p:ajax event="rowToggle" listener="#{managedUser.displayUsersAcces(acc)}" global="false"/> 
                                    <p:column width="30" >
                                        <p:rowToggler/>
                                    </p:column>     
                                    <p:column headerText="N°" width="20">
                                        <span>#{yAcc+1}</span>
                                    </p:column>
                                    <p:column headerText="#{lab.LDB_PU_code}" width="200" styleClass="#{(acc.id gt 0)?'line_actiftrue':'_'}">
                                        <span>#{acc.code.code}</span>
                                    </p:column>                                                                                     
                                    <p:column headerText="#{lab.LDB_PU_description}">
                                        <span>#{acc.code.description}</span>
                                    </p:column>                                                                                     
                                    <p:column  width="20" style="text-align: center">
                                        <p:commandButton icon="#{acc.id gt 0? 'ui-icon-minusthick':'ui-icon-plusthick'}" title="#{acc.id gt 0? 'Retirer':'Accorder'} accès"
                                                         style="width: 20px;height: 20px" actionListener="#{managedUser.updateAcces(acc)}" update="data_code_acces"/>
                                    </p:column>     
                                    <p:column width="20" style="text-align: center">
                                        <p:contextMenu for="btn_option_code_acces" event="left click" style="font-size: 0.8em">
                                            <p:menuitem value="Modifier" icon="ui-icon-star" global="false" actionListener="#{managedUser.setSelectAcces(acc)}"
                                                        oncomplete="dlgUpdateAcces.show()" update=":main_code_acces"/>
                                            <p:menuitem value="Supprimer l'accès" icon="ui-icon-gear" actionListener="#{managedUser.setSelectAcces(acc)}"
                                                        oncomplete="dlgConfirmDeleteAcces.show()" update=":main_code_acces"/>
                                        </p:contextMenu>                           
                                        <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_code_acces" type="button"/>
                                    </p:column> 
                                    <p:rowExpansion>
                                        <p:dataTable id="dt_row_ex_#{acc.id}" value="#{acc.utilisateurs}" var="usr" rowKey="#{usr.id}" rowIndexVar="line_user">
                                            <p:column  headerText="N°" style="width:16px">
                                                #{line_user+1}
                                            </p:column>                                    
                                            <p:column headerText="#{lab.LDB_PU_civilite}" width="50">
                                                <h:outputText value="#{usr.civilite}"/>
                                            </p:column>
                                            <p:column headerText="#{lab.LDB_PU_code}">
                                                <h:outputText value="#{usr.codeUsers}"/>
                                                <h:panelGroup style="float:right">
                                                    <h:outputText value="E" title="#{lab.LDB_PU_utilisateur_employer}" styleClass="indice_statut" style="margin-right: 2px" rendered="#{usr.employe != null}"/>
                                                    <h:outputText value="C" title="#{lab.LDB_PU_utilisateur_commercial}" styleClass="indice_statut" style="margin-right: 2px" rendered="#{usr.commercial != null}"/>
                                                </h:panelGroup>
                                            </p:column>
                                            <p:column headerText="#{lab.LDB_PU_nom}">
                                                <h:outputText value="#{usr.nomUsers}"/>
                                            </p:column>
                                            <p:column headerText="#{lab.LDB_PU_groupe}"  width="150">
                                                <h:outputText value="#{usr.categorie.libelle}"/>
                                            </p:column>
                                            <p:column headerText="#{lab.LDB_PU_agence}" width="150">
                                                <h:outputText value="#{usr.agence.designation}"/>
                                            </p:column>
                                            <p:column width="100" headerText="#{lab.LDB_PU_planifier}" style="text-align: center">
                                                <h:graphicImage library="img" name="#{(usr.connectOnlinePlanning)?'vu.png':'vu_non.png'}" width="15" height="15"/>
                                            </p:column>
                                            <p:column width="50" headerText="#{lab.L_actif}" style="text-align: center">
                                                <h:graphicImage library="img" name="#{(usr.actif)?'vu.png':'vu_non.png'}" width="15" height="15"/>
                                            </p:column>
                                        </p:dataTable>
                                    </p:rowExpansion>
                                </p:dataTable>
                                <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                                    <p:commandButton actionListener="#{managedUser.loadAcces(false,false)}" global="false" icon="ui-icon-circle-triangle-w" disabled="#{managedUser.p_acces.disPrev}"/>
                                    <p:outputLabel value="#{managedUser.p_acces.currentPage}/#{managedUser.p_acces.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                                    <p:commandButton actionListener="#{managedUser.loadAcces(true,false)}" global="false" icon="ui-icon-circle-triangle-e" disabled="#{managedUser.p_acces.disNext}"/>
                                    <p:selectOneMenu value="#{managedUser.p_acces.rows}" label="Nombre max Résultat" valueChangeListener="#{managedUser.choosePaginatorAcces}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                                        <f:selectItems value="#{managedUser.paginations}"/>
                                        <p:ajax event="valueChange" global="false" update="data_code_acces"/>
                                    </p:selectOneMenu>
                                </p:outputPanel>  
                            </p:tab>
                        </p:tabView>
                    </p:outputPanel>
                </div>
                <div class="yvs_list_user"> 
                    <h:inputHidden id="input_hide_user" value="#{managedUser.tabIds}"/>
                    <p:outputPanel id="form_user_00">
                        <p:dataTable value="#{managedUser.listUser}" var="usr" rowKey="#{usr.id}" rowIndexVar="line_user"
                                     rendered="#{managedUser.vueListe}" id="tab_user_00" selectionMode="single">
                            <p:ajax event="rowSelect" listener="#{managedUser.loadOnView}" update=":body_user_00:form_user_01"
                                    process="@this" />
                            <p:column  headerText="N°" style="width:16px">
                                #{line_user+1}
                            </p:column>                                    
                            <p:column headerText="#{lab.LDB_PU_civilite}" width="30">
                                <h:outputText value="#{usr.civilite}"/>
                            </p:column>
                            <p:column headerText="#{lab.LDB_PU_code}">
                                <h:outputText value="#{usr.codeUsers}"/>
                                <h:panelGroup style="float:right">
                                    <h:outputText value="E" title="#{lab.LDB_PU_utilisateur_employer}" styleClass="indice_statut" style="margin-right: 2px" rendered="#{usr.employe != null}"/>
                                    <h:outputText value="C" title="#{lab.LDB_PU_utilisateur_commercial}" styleClass="indice_statut" style="margin-right: 2px" rendered="#{usr.commercial != null}"/>
                                </h:panelGroup>
                            </p:column>
                            <p:column headerText="#{lab.LDB_PU_nom}">
                                <h:outputText value="#{usr.nomUsers}"/>
                            </p:column>
                            <p:column headerText="#{lab.LDB_PU_groupe}"  width="100">
                                <h:outputText value="#{usr.categorie.libelle}"/>
                            </p:column>
                            <p:column headerText="#{lab.LDB_PU_agence}" width="100">
                                <h:outputText value="#{usr.agence.designation}"/>
                            </p:column>
                            <p:column width="100" headerText="#{lab.LDB_PU_planifier}" style="text-align: center">
                                <h:graphicImage library="img" name="#{(usr.connectOnlinePlanning)?'vu.png':'vu_non.png'}" width="15" height="15"/>
                            </p:column>
                            <p:column width="100" headerText="#{lab.LDB_PU_acces_mutiple}" style="text-align: center">
                                <p:commandLink actionListener="#{managedUser.changeAcces(usr, false)}">
                                    <h:graphicImage library="img" name="#{(usr.accesMultiAgence)?'vu.png':'vu_non.png'}" width="15" height="15"/>
                                </p:commandLink>
                            </p:column>
                            <p:column width="50" headerText="#{lab.L_actif}" style="text-align: center">
                                <h:graphicImage library="img" name="#{(usr.actif)?'vu.png':'vu_non.png'}" width="15" height="15"/>
                            </p:column>
                            <p:column width="20" style="text-align: center">
                                <h:graphicImage library="img" name="#{(usr.connected)?'connecte.png':'deconnecte.png'}" width="15" height="15"/>
                            </p:column>
                            <p:column width="20" style="text-align: center">
                                <p:contextMenu for="btn_option_users" event="left click" styleClass="context_menu" style="width: 200px">
                                    <p:menuitem value="#{usr.actif?'Désactiver':'Activer'}" icon="#{usr.actif?'ui-icon-circle-close':'ui-icon-circle-check'}" global="false" 
                                                actionListener="#{managedUser.setUserSelect(usr)}" oncomplete="dlgConfirmActive.show()"/>                                            
                                    <p:menuitem value="#{lab.LDB_PU_historique}" icon="ui-icon-calendar" global="false" actionListener="#{managedUser.setUserSelect(usr)}" oncomplete="dlgNavigation.show()" 
                                                rendered="#{usr.connected}" update=":main_navigation_users:data_navigation_users"/>                                            
                                    <p:menuitem value="#{lab.LDB_PU_reinitialiser_password}" icon="ui-icon-refresh" global="false" actionListener="#{managedUser.setUserSelect(usr)}" oncomplete="dlgConfirmReinitialised.show()"/>    
                                    <p:menuitem value="#{lab.LDB_PU_deconnecter}" icon="ui-icon-eject" global="false" actionListener="#{managedUser.setUserSelect(usr)}" oncomplete="dlgConfirmDeconnect.show()" rendered="#{usr.connected}"/>    
                                    <p:separator />
                                    <p:menuitem value="#{lab.LDB_PU_fixer_comme_systeme}" icon="ui-icon-newwin" actionListener="#{managedUser.applyUserSysteme(usr)}" title="#{lab.LDB_PU_fixer_utilisateur_comme_systeme}"
                                                update=":main_navigation_users:data_navigation_users"/>
                                    <p:menuitem value="Gerer les droits d'accès" icon="ui-icon-unlocked" actionListener="#{managedUser.onManagedDroitAcces(usr)}"
                                                update=":main_navigation_users:data_navigation_users"/>
                                    <p:separator />
                                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedUser.setUserSelect(usr)}" oncomplete="dlgConfirmDelete.show()"/> 
                                </p:contextMenu>
                                <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_users" type="button"/>
                            </p:column> 
                            <p:column width="25" style="text-align: center">
                                <f:facet name="header">
                                    <h:selectBooleanCheckbox styleClass="chek_all_line_user" value="false"
                                                             onclick="selectionAllLineTab(#{managedUser.listUser.size()}, 'user')">
                                    </h:selectBooleanCheckbox>
                                </f:facet>
                                <h:selectBooleanCheckbox  value="#{usr.selectActif}" styleClass="chek_line_user" 
                                                          onclick="selectionLineTab(#{line_user}, 'user')">
                                </h:selectBooleanCheckbox>
                            </p:column>
                        </p:dataTable>
                        <span class="nbSelectuser" style="font-size: .8em; font-style: italic; color: #828c95;"></span>
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                            <p:commandButton actionListener="#{managedUser.loadAll(false,false)}" global="false" update="tab_user_00" icon="ui-icon-circle-triangle-w" disabled="#{managedUser.paginator.disPrev}"/>
                            <p:outputPanel >
                                <p:inplace label="#{managedUser.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                    <pe:inputNumber value="#{managedUser.paginator.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                        <p:ajax event="blur" listener="#{managedUser.gotoPagePaginator()}" update="tab_user_00"/>
                                    </pe:inputNumber>
                                </p:inplace><p:outputLabel value="/#{managedUser.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                            </p:outputPanel>
                            <p:commandButton actionListener="#{managedUser.loadAll(true,false)}" global="false" update="tab_user_00" icon="ui-icon-circle-triangle-e" disabled="#{managedUser.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedUser.imax}" label="Nombre max Résultat" valueChangeListener="#{managedUser.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                                <f:selectItems value="#{managedUser.paginations}"/>
                                <p:ajax event="valueChange" global="false" update="tab_user_00"/>
                            </p:selectOneMenu>
                        </p:outputPanel>  
                    </p:outputPanel>
                </div>
            </div>
        </h:form>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="#{lab.LDB_PU_cacher}"/>  
            <div class="zone_find"> 
                <div class="display_auteur" align="right" style="font-style: italic;">
                    <p:outputPanel autoUpdate="true">
                        <span style="float: left">Enregistré Le <h:outputText value="#{managedUser.userSelect.dateSave}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span> 
                        <span>Modifier Le <h:outputText value="#{managedUser.userSelect.dateUpdate}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span>
                        <span>Par <h:outputText value="#{managedUser.userSelect.author.users.nomUsers}" styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <div id="zone_search_user">
                    <h:panelGrid columns="2" style="width: 100%; " cellpadding="0" cellspacing="0">
                        <h:panelGrid columns="9" style="float: left; font-size: 0.8em" cellpadding="0" cellspacing="0">                            
                            <h:outputText value="#{lab.LDB_PU_societe}" />
                            <h:outputText value="#{lab.LDB_PU_agence}" />
                            <h:outputText value="#{lab.LDB_PU_niveau_acces}" />
                            <h:outputText value="#{lab.LDB_PU_connecter}" />
                            <h:outputText value="#{lab.L_actif}" />
                            <h:outputText value="#{lab.LDB_PU_planifier}" />
                            <h:outputText value="#{lab.LDB_PU_groupe}" />
                            <h:outputText value="#{lab.LDB_PU_code}" />
                            <span>&nbsp;</span>
                            <h:selectOneMenu value="#{managedUser.societeSearch}" style="min-width: 140px">
                                <f:selectItems value="#{managedSociete.listSociete}" var="scte" itemLabel="#{scte.codeAbreviation}" itemValue="#{scte.id}"/>
                                <p:ajax event="valueChange" listener="#{managedUser.addParamSociete()}" update="chp_search_by_agence chp_search_by_niveau_acces"/>
                            </h:selectOneMenu>
                            <h:selectOneMenu value="#{managedUser.agenceSearch}" style="min-width: 140px" id="chp_search_by_agence">
                                <f:selectItem itemLabel="--" itemValue="0"/>
                                <f:selectItems value="#{managedAgence.listAgence}" var="age" itemLabel="#{age.designation}" itemValue="#{age.id}"/>
                                <p:ajax event="valueChange" listener="#{managedUser.addParamAgence()}"/>
                            </h:selectOneMenu>
                            <h:selectOneMenu value="#{managedUser.niveauSearch}" style="min-width: 140px" id="chp_search_by_niveau_acces">
                                <f:selectItem itemLabel="--" itemValue="0"/>
                                <f:selectItems value="#{managedUser.listNiveaux}" var="niv" itemLabel="#{niv.designation}" itemValue="#{niv.id}"/>
                                <p:ajax event="valueChange" listener="#{managedUser.addParamNiveau()}"/>
                            </h:selectOneMenu>
                            <h:selectOneMenu value="#{managedUser.connectSearch}" style="min-width: 140px">
                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                <f:selectItem itemLabel="#{lab.L_oui}" itemValue="#{true}"/>
                                <f:selectItem itemLabel="#{lab.L_non}" itemValue="#{false}"/>
                                <p:ajax event="valueChange" listener="#{managedUser.addParamConnected()}"/>
                            </h:selectOneMenu>
                            <h:selectOneMenu value="#{managedUser.actifSearch}" style="min-width: 140px">
                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                <f:selectItem itemLabel="#{lab.L_oui}" itemValue="#{true}"/>
                                <f:selectItem itemLabel="#{lab.L_non}" itemValue="#{false}"/>
                                <p:ajax event="valueChange" listener="#{managedUser.addParamActif()}"/>
                            </h:selectOneMenu>
                            <h:selectOneMenu value="#{managedUser.planifierSearch}" style="min-width: 140px">
                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                <f:selectItem itemLabel="#{lab.L_oui}" itemValue="#{true}"/>
                                <f:selectItem itemLabel="#{lab.L_non}" itemValue="#{false}"/>
                                <p:ajax event="valueChange" listener="#{managedUser.addParamPlanifier()}"/>
                            </h:selectOneMenu>
                            <h:selectOneMenu value="#{managedUser.groupeSearch}">
                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="0" noSelectionOption="true"/>
                                <f:selectItems value="#{managedCategoriePerso.categories}" var="catS" itemLabel="#{catS.libelle}" itemValue="#{catS.id}" />     
                                <p:ajax event="valueChange" listener="#{managedUser.addParamGroupe()}"/>             
                            </h:selectOneMenu> 
                            <h:inputText value="#{managedUser.numSearch}">
                                <p:ajax event="valueChange" listener="#{managedUser.addParamUsers()}"/>
                            </h:inputText>
                        </h:panelGrid>   
                    </h:panelGrid>                    
                </div>
                <div id="zone_find_user">
                    <h:panelGrid columns="2" style="width: 100%; font-size: 0.8em" cellpadding="0" cellspacing="0">
                        <h:panelGrid columns="1" style="float: left; font-size: 1.0em" cellpadding="0" cellspacing="0">                            
                            <h:outputText value="#{lab.LDB_PU_code}" />
                            <h:inputText value="#{managedUser.accesSearch}">
                                <p:ajax event="valueChange" listener="#{managedUser.addParamAcces()}" oncomplete="collapseGrid('user')"/>
                            </h:inputText>
                        </h:panelGrid>  
                        <h:panelGroup style="float: right">
                            <p:commandButton icon="ui-icon-circle-plus" title="#{lab.LDB_PU_ajouter_code_acces}" style="width: 20px;height: 20px;margin-left: 20px"
                                             oncomplete="dlgUpdateAcces.show()" actionListener="#{managedUser.setSelectAcces(null)}" update=":main_code_acces"/>
                        </h:panelGroup>
                    </h:panelGrid>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
