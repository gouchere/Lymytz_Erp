<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui" 
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Suivie Opérations','modProduction', 'smenOfSuiviOp', true)}
    </ui:define>                                    
    <ui:define name="contents">          
        #{Marticle.doNothing()}        
        #{managedOrdresF.setTypePage(constantes.PROD_TYPE_PAGE_SUIVI)}
        #{managedConditionnement.doNothing()}
        #{managedTransfertStock.doNothing(null)}
        #{managedDepot.loadAllDepotActif(true)}
        #{managedLotReception.loadAllLots()}
        #{managedPosteCharge.loadAll()}
        #{managedEquipeProduction.loadAllEquipeProduction()}       
        #{managedTypeCreneau.loadAllTrancheProduction()}                                                                                                                 
        #{managedSiteProduction.loadAll()}          
        #{managedOrdresF.loadInitProd('SUIVI')}  
        <script type="text/javascript">
            $(function() {
//                alert($('body').height()+" "+$('.part_scroll').height()+" "+$('#top').height()+" "+$('.zone_find').height())
                $('body').find('.part_scroll').height($('body').height() - $('body').find('#top').height() - $('body').find('.zone_find').height() - $('body').find('.part_fix').height() - $('body').find('#bottom').height() - 30);
                collapseForm('of');
                collapseForm('conditionnement');
            });
        </script> 
        <h:form prependId="false">
            <p:dialog widgetVar="dlgVerifyAppro" modal="true" showHeader="false" footer="&copy;Lymytz 2015"
                      resizable="false" dynamic="true">
                <span>Vous devez valider tous vos Approvisionnement avant de continuer !</span>                    
                <div align="center">
                    <p:commandLink value="Aller aux approvisionnement? "  actionListener="#{managedOrdresF._onloadDIstantDocStock()}" ajax="false"/>
                </div>
                <br />
                <p:commandButton type="button" value="Ok" onclick="dlgVerifyAppro.hide()" style="float: left; margin-left: 40%"/>
            </p:dialog>
        </h:form>
        <h:form prependId="false" >
            <p:dialog header="Composants" widgetVar="dlgComposantNom" height="250" width="40%">
                <p:dataTable value="#{managedOrdresF.program.nomenclature.composants}" var="comp_n" rowKey="#{comp_n.id}" rowIndexVar="idx"
                             selectionMode="single"  id="data_composant_nom_of" style="font-size: 0.9em"
                             editable="true" editMode="cell">
                    <p:ajax event="cellEdit" listener="#{managedOrdresF.changeQuantiteMp}"  />
                    <p:column headerText="N°" width="15">
                        <span>#{idx+1}</span>
                    </p:column>
                    <p:column width="100" headerText="Référence">
                        <span >#{comp_n.article.refArt}</span>
                    </p:column>
                    <p:column headerText="Désignation">
                        <span >#{comp_n.article.designation}</span>
                    </p:column>                    
                    <p:column headerText="quantite" width="80" style="text-align: right">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{comp_n.quantite}" converter="DNS"/>
                            </f:facet>
                            <f:facet name="input">
                                <h:inputText  value="#{comp_n.quantite}" style="width:70%"/>
                            </f:facet>
                        </p:cellEditor>                       
                    </p:column>
                </p:dataTable>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeclare" closeOnEscape="true"
                             message="Cette déclaration entrainera un flux au delà de la quantité prévue. Voulez-vous continuer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.saveDeclaration(true)}" oncomplete="dlgConfirmDeclare.hide()"
                                 icon="ui-icon-circle-check"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeclare.hide()"  icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false" id="form_search_statuts">
            <p:dialog header="#{lab.LP_PSO_statut_of}" widgetVar="dlgStatut" footer="&copy;Lymytz 2014" width="15%">                
                <p:selectBooleanCheckbox itemLabel="Grouper les productions ?" value="#{managedOrdresF.groupProd}">
                    <p:ajax event="valueChange" oncomplete="collapseList('of')" listener="#{managedOrdresF.loadAllOf(true, managedOrdresF.initForm)}"/>
                </p:selectBooleanCheckbox>
                <h:selectOneMenu value="#{managedOrdresF.egaliteStatutOf}" 
                                 style="min-width: 200px;">
                    <f:selectItem itemLabel="#{lab.LP_PSO_inclus}" itemValue="IN"/>
                    <f:selectItem itemLabel="#{lab.LP_PSO_exclus}" itemValue="NOT IN" />
                </h:selectOneMenu> 
                <p:selectManyMenu value="#{managedOrdresF.statutsOf}" showCheckbox="true" 
                                  id="select_statuts_of" style="min-width: 200px;">
                    <f:selectItems value="#{managedOrdresF.allStatutsOf}" var="istat" itemValue="#{istat}" itemLabel="#{managedOrdresF.giveNameStatut(istat)}" />
                </p:selectManyMenu>
                <p:commandButton value="#{lab.L_appliquer}" icon="ui-icon-arrowthickstop-1-s" style="width: 100%" actionListener="#{managedOrdresF.searchByStatutOF()}"/>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="#{lab.L_liste_article}" widgetVar="dlgListArticle" modal="true" width="70%" closeOnEscape="true" height="450"> 
                <p:watermark for="txt_search_article_gammes_of" value="#{lab.L_reference_article}..." />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_article_gammes_of" value="#{Marticle.article.refArt}" style="text-align: center">
                        <p:ajax event="valueChange" listener="#{Marticle.searchArticleActif(managedOrdresF.isComposant?'A':'P',Marticle.article.refArt,false)}" update="data_article_gammes_of" />
                    </h:inputText> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{Marticle.loadActifArticle(false, false)}" global="false"
                                         update="data_article_gammes_of" icon="ui-icon-circle-triangle-w" disabled="#{Marticle.pa.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{Marticle.pa.currentPage}/#{Marticle.pa.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{Marticle.loadActifArticle(true, false)}" global="false" 
                                         update="data_article_gammes_of" icon="ui-icon-circle-triangle-e" disabled="#{Marticle.pa.disNext}"/>
                        <p:selectOneMenu value="#{Marticle.nbMax}" label="#{lab.L_nombre_max_resultat}" valueChangeListener="#{Marticle._choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{Marticle.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_article_gammes_of"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </h:panelGrid>
                <p:dataTable value="#{Marticle.articlesResult}" var="art" rowKey="#{art.id}" rowIndexVar="artIdx"
                             selectionMode="single" scrollable="true" scrollHeight="385" id="data_article_gammes_of" style="font-size: 0.9em">
                    <p:ajax event="rowSelect" global="false" listener="#{managedOrdresF.loadOnViewArticleProgram}" oncomplete="dlgListArticle.hide()"/>
                    <p:column headerText="N°" width="15">
                        <span title="#{art.designation}">#{artIdx+1}</span>
                    </p:column>
                    <p:column width="70">
                        <span title="#{art.designation}">#{art.refArt}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_designation}" width="150">
                        <span title="#{art.designation}">#{art.designation}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_categorie}" width="80">
                        <span title="#{art.designation}">#{art.categorie}</span>
                    </p:column>
                    <p:column headerText="#{lab.L_prix_a}" width="80" style="text-align: right">
                        <h:outputText value="#{art.pua}" title="#{art.designation}" converter="DN" />
                    </p:column>
                    <p:column headerText="#{lab.L_prix_v}" width="80" style="text-align: right">
                        <h:outputText value="#{art.puv}" title="#{art.designation}" converter="DN" />
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form> 
        <h:form prependId="false" id="form_session">
            <p:dialog header="#{lab.LP_POF_infos_sessions}" widgetVar="dlgInfoSession_" 
                      width="80%" minHeight="450" 
                      footer="&copy;Lymytz 2014"
                      closeOnEscape="true">
                <ui:include src="yvs_sessions_prod.xhtml" />
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main_form_declaration">
            <p:dialog header="#{lab.LP_POF_declaration_production}" widgetVar="dlgDeclaration" width="60%" height="400" footer="&copy;Lymytz 2014"
                      closeOnEscape="true" >
                <ui:include src="yvs_declaration_prod.xhtml" />                
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <!--pour eviter des erreurs sur la vue-->
            <p:dialog header="#{lab.LP_POF_suivi_flux_operation}" widgetVar="dlgEditFlux" width="93%" height="650" footer="&copy;Lymytz 2014"
                      closeOnEscape="true" >                
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmFinOp" closeOnEscape="true"
                             message="#{lab.LP_PSO_text}" header="Confirmation">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedOrdresF.finishOperation(true)}" oncomplete="dlgConfirmFinOp.hide()"
                                 icon="ui-icon-circle-check" update=":formulaire_mainOrdreF:zone_diplay_op"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmFinOp.hide()" icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmFinAllOp" closeOnEscape="true"
                             message="#{lab.LP_PSO_text1}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedOrdresF.finishOperation(true)}" oncomplete="dlgConfirmFinAllOp.hide()"
                                 icon="ui-icon-circle-check" update=":formulaire_mainOrdreF:zone_diplay_op"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmFinAllOp.hide()" icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmSuspendOf" closeOnEscape="true"
                             message="#{lab.LP_PSO_text2} " header="#{lab.L_confirmation}" >
                <div align="center">(#{lab.LP_PSO_text6})</div>
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedOrdresF.suspendOf()}" oncomplete="dlgConfirmSuspendOf.hide()"
                                 icon="ui-icon-circle-check"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmSuspendOf.hide()" icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>   
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelSuivi" closeOnEscape="true"
                             message="#{lab.LP_PSO_text3}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedOrdresF.deleteSuiviOperation()}" oncomplete="dlgConfirmDelSuivi.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelSuivi.hide()"/>
            </p:confirmDialog>
        </h:form>   
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="confirmDelSF" closeOnEscape="true"
                             message="#{lab.LP_PSO_text4} " header="#{lab.L_confirmation}">
                <p:selectBooleanCheckbox itemLabel="#{lab.LP_POF_supprimer_cycle}" value="#{managedOrdresF.delCycle}"/>
                <p:commandButton icon="ui-icon-circle-check" value="#{lab.L_oui}" actionListener="#{managedOrdresF.deleteOneLineFlux(managedOrdresF.delCycle)}" oncomplete="confirmDelSF.hide()"/>
                <p:commandButton icon="ui-icon-circle-close" type="button"  value="#{lab.L_non}" onclick="confirmDelSF.hide()"/>
            </p:confirmDialog>
        </h:form> 
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="#{lab.LP_PSO_text5}" header="#{lab.L_confirmation}">
                <p:commandButton value="#{lab.L_oui}" actionListener="#{managedOrdresF.deleteBean()}" update=":formulaire_mainOrdreF:tableOF"
                                 oncomplete="dlgConfirmDelete.hide()"/>
                <p:commandButton type="button"  value="#{lab.L_non}" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false" id="main-programmation_of" >
            <p:dialog header="#{lab.LP_POF_programmation}" widgetVar="dlgProgramOrdre" width="60%" style="max-height: 80%" minHeight="450"
                      position="top" >
                <p:focus id="defaut-article_program_of" for="txt-article_program_of_2"/>
                <p:focus id="fcs_quantite_program_of" for="txt-quantite_program_of_2"/>
                <p:focus id="fcs_btn_add_program_of" for="btn_add_program_of"/>
                <h:panelGrid id="form-programmation_of" columns="2" style="width: 100%" cellpadding="0" cellspacing="0">
                    <f:facet name="header">
                        <div align="left">
                            <span>#{lab.LP_PSO_date_lancement} : </span>
                            <p:calendar value="#{managedOrdresF.dateLancement}" pattern="dd-MM-yyyy" size="8">
                                <p:ajax event="dateSelect" global="false"/>
                            </p:calendar>
                            <p:commandButton icon="ui-icon-document" value="Nouveau" actionListener="#{managedOrdresF.resetFicheProgram()}"
                                             update="data-programmation_of select-site_programmation"/>
                            <div style="font-size: 0.9em; float: right;font-weight: normal;background: #000;color: #FFF;padding: 5px">
                                <p:selectBooleanCheckbox value="#{managedOrdresF.program.suiviOperations}"  itemLabel="#{lab.LP_PSO_suivi_operation_requis}">
                                    <p:ajax event="valueChange" global="false"/>
                                </p:selectBooleanCheckbox>
                                <p:spacer width="10"/>
                                <p:selectBooleanCheckbox value="#{managedOrdresF.program.generateOfSousProduit}"  itemLabel="#{lab.LP_PSO_generer_of_produit_inter}">
                                    <p:ajax event="valueChange" global="false"/>
                                </p:selectBooleanCheckbox>
                            </div>
                            <p:separator />
                        </div>
                    </f:facet>
                    <h:panelGrid columns="5" cellpadding="0" cellspacing="5" id="form-programmation_of_f">
                        <h:outputText value="#{lab.L_article}"/>
                        <h:outputText value="#{lab.LP_PSO_nomenclature}"/>
                        <h:outputText value="#{lab.LP_PSO_gamme}"/>
                        <h:outputText value="#{lab.L_quantite}"/>  
                        <p:commandLink value="Déterminez à partir d'un autre composant" actionListener="#{managedOrdresF.loadComposantsNomenclature()}" />                                             
                        <h:inputText id="txt-article_program_of_2" value="#{managedOrdresF.program.articles.refArt}" style="color: #{pr.articles.error?'red':''}">
                            <p:ajax event="valueChange" listener="#{managedOrdresF.searchArticleProgram()}" update="form-programmation_of fcs_quantite_program_of"/>
                        </h:inputText>
                        <h:selectOneMenu value="#{managedOrdresF.program.nomenclature.id}" style="min-width: 140px">  
                            <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                            <f:selectItems value="#{managedOrdresF.program.articles.nomenclatures}" var="itemNom" itemValue="#{itemNom.id}" itemLabel="#{itemNom.reference}" />   
                            <p:ajax event="valueChange" listener="#{managedOrdresF.chooseNomenclature()}"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedOrdresF.program.gamme.id}" style="min-width: 140px" disabled="#{!managedOrdresF.program.suiviOperations}">  
                            <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                            <f:selectItems value="#{managedOrdresF.program.articles.gammes}" var="itemGam" itemValue="#{itemGam.id}" itemLabel="#{itemGam.codeRef}" />
                            <p:ajax event="valueChange" listener="#{managedOrdresF.chooseGamme()}"/>
                        </h:selectOneMenu>  
                        <h:inputText id="txt-quantite_program_of_2" value="#{managedOrdresF.program.quantitePrevu}" style="width: 100px;text-align: center">
                            <p:ajax event="valueChange" global="false"/>
                        </h:inputText>  
                        <p:commandButton icon="ui-icon-plus" actionListener="#{managedOrdresF.addProgram()}" value="#{lab.L_ajouter}"
                                         update="data-programmation_of form-programmation_of_f defaut-article_program_of" 
                                         id="btn_add_program_of" title="#{lab.LP_PSO_ajouter_programme}" />
                    </h:panelGrid>                    
                </h:panelGrid>
                <p:dataTable id="data-programmation_of" value="#{managedOrdresF.programs}" var="pr" rows="10" paginatorAlwaysVisible="false"
                             selection="single" rowKey="#{pr.id}"  paginator="true" rowsPerPageTemplate="5,10,15,20,25,50,100"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records">
                    <p:column style="width:16px">
                        <p:rowToggler/>
                        <h:graphicImage library="img" name="vu.png" width="17" height="15" title="Element enregistré" rendered="#{pr.id gt 0}" style="float:right;margin-top: -15px"/>
                    </p:column>
                    <p:column width="250" headerText="#{lab.L_article}">
                        <h:outputText value="[#{pr.articles.refArt}]" style="font-weight: bold"/>
                        <h:outputText value=" #{pr.articles.designation}" title="#{lab.LP_PSO_nomenclature} #{pr.nomenclature.reference}; #{lab.LP_PSO_gamme} : #{pr.gamme.reference}"/> 
                    </p:column>
                    <p:column  headerText="#{lab.L_quantite}" width="90" style="text-align: center">
                        <h:outputText value="#{pr.quantitePrevu}" converter="#{managedOrdresF.converterProd(pr.articles.categorie)}"/>
                    </p:column>                                                                                                 
                    <p:column width="90" headerText="#{lab.LP_POF_lancement}" style="text-align: center">
                        <h:outputText value="#{pr.dateDebutLancement}" converter="DDMMYYYY" />
                    </p:column>
                    <p:column style="width: 10px;text-align: center">
                        <p:commandButton icon="ui-icon-gear" type="button" id="btn-opt-prog-of" 
                                         style="width: 22px; height: 22px" title="#{lab.LP_POF_retirer_programme}"/>
                        <p:contextMenu for="btn-opt-prog-of" event="left click" >
                            <p:menuitem icon="ui-icon-refresh" value="#{lab.L_modifier}" actionListener="#{managedOrdresF.loadToUpdateProgram(pr)}"/>
                            <p:menuitem icon="ui-icon-arrowthickstop-1-e" value="#{lab.LP_PSO_voir_composition}" actionListener="#{managedOrdresF.displayComposantOf(pr)}"/>
                            <p:separator />
                            <p:menuitem icon="ui-icon-trash" value="#{lab.L_supprimer}" actionListener="#{managedOrdresF.removeProgram(pr)}" update="data-programmation_of"/>
                        </p:contextMenu>
                    </p:column>
                    <p:rowExpansion >
                        <p:dataTable value="#{pr.listComposantOf}" var="prc" rendered="#{pr.listComposantOf.size() gt 0}">
                            <p:column width="250" headerText="#{lab.LP_POF_composant}">
                                <h:outputText value="[#{prc.article.refArt}]" style="font-weight: bold"/>
                                <h:outputText value=" #{prc.article.designation}"  /> 
                            </p:column>
                            <p:column  headerText="#{lab.L_quantite}" width="90" style="text-align: center">
                                <h:outputText value="#{prc.quantitePrevu}"/>
                            </p:column>                                                                                                 
                            <p:column width="90" headerText="#{lab.L_type}"  >
                                <h:outputText value="#{prc.type}" />
                            </p:column>
                            <p:column style="width: 10px;text-align: center">
                                <p:commandButton icon="ui-icon-gear" type="button" id="btn-opt-prog-of_" 
                                                 style="width: 22px; height: 22px" title="#{lab.LP_POF_retirer_programme}"/>
                                <p:contextMenu for="btn-opt-prog-of_" event="left click" >
                                    <p:menuitem icon="ui-icon-arrowthickstop-1-e" value="#{lab.LP_PSO_voir_composition}" />                                
                                </p:contextMenu>
                            </p:column>
                        </p:dataTable>
                    </p:rowExpansion>
                </p:dataTable>
                <f:facet name="footer">
                    <div align="left">
                        <span>#{lab.LP_PSO_site_production} : </span> 
                        <h:selectOneMenu value="#{managedOrdresF.program.site.id}" style="min-width: 160px" id="select-site_programmation">
                            <f:selectItem itemValue="0" itemLabel="--" />
                            <f:selectItems value="#{managedSiteProduction.sites}" var="p_site" itemValue="#{p_site.id}" itemLabel="#{p_site.designation}" />                                    
                        </h:selectOneMenu>
                        <p:commandButton icon="ui-icon-check" value="Enregistrer" actionListener="#{managedOrdresF.terminerProgram(false)}"
                                         style="margin-top: -10px!important;margin-left: 5px"  update="data-programmation_of select-site_programmation"/>
                        <p:splitButton icon="ui-icon-print" value="#{lab.L_telecharger} Tout" actionListener="#{managedOrdresF.printProgram(null)}" global="false" ajax="false" title="Télécharger toutes" style="float: right">
                            <p:menuitem icon="ui-icon-print" value="#{lab.L_telecharger} PSF" global="false" actionListener="#{managedOrdresF.printProgram(constantes.CAT_PSF)}" ajax="false" title="Télécharger pour les PSF"/>
                            <p:menuitem icon="ui-icon-print" value="#{lab.L_telecharger} PF" global="false" actionListener="#{managedOrdresF.printProgram(constantes.CAT_PF)}" ajax="false" title="Télécharger pour les PF"/>
                        </p:splitButton>
                    </div>
                </f:facet>
            </p:dialog>
        </h:form>
        <div style="width: 100%; overflow-y: hidden">
            <h:form prependId="false" id="formulaire_mainOrdreF" style="width: 100%; overflow-y: hidden"> 
                <div class="part_fix">
                    <div style="font-size: 0.9em;float: left;width: 30%; ">  
                        <p:commandButton value="Préparer une production" type="button" icon="ui-icon-extlink" onclick="dlgProgramOrdre.show()"
                                         update=":main-programmation_of:defaut-article_program_of"/>                                            
                    </div >  
                    <div style="margin-left: 31%">
                        <p:outputPanel autoUpdate="true" id="of_statut_zone"> 
                            <p:outputPanel styleClass="yvs_form_of" style="float: left;margin-top: 10px" rendered="#{ordreFabrication.id gt 0}">
                                <p:commandLink value="#{lab.LP_PSO_declarer}-" title="#{lab.LP_POF_enregistrer_nouvelle_declaration}" styleClass="button-stateOF #{(ordreFabrication.statutDeclaration eq constantes.ETAT_TERMINE)?'button-stateOF_actif':''}"
                                               actionListener="#{managedOrdresF.loadDeclaration()}" disabled="#{(ordreFabrication.statutDeclaration eq constantes.ETAT_TERMINE)}" 
                                               rendered="#{(ordreFabrication.id gt 0) and accesRessource.prod_acces_raccourcis}"                                                        
                                               oncomplete="dlgDeclaration.show()" update=":main_form_declaration:blog_declaration"/>
                            </p:outputPanel>

                            <p:contextMenu for="panel_state" >
                                <p:menuitem value="#{lab.LP_PSO_mettre_en_attente}" icon="ui-icon-arrowreturnthick-1-w" actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_ATTENTE)}"
                                            rendered="#{ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ENCOUR}"
                                            update="panel_state tableOF"/>
                                <p:menuitem value="#{lab.LP_PSO_mettre_en_cours}"  icon="ui-icon-arrowreturnthick-1-w" actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_ENCOUR)}"
                                            rendered="#{(ordreFabrication.statusOrdre ne constantes.STATUT_DOC_ATTENTE) and (ordreFabrication.statusOrdre ne constantes.STATUT_DOC_ENCOUR)}"
                                            update="panel_state tableOF" />
                            </p:contextMenu>
                            <p:outputPanel id="panel_state" styleClass="yvs_form_of" style="float: right;margin-top: 10px" > 
                                <p:commandLink value="#{lab.L_en_attente}" styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_ATTENTE)?'button-stateOF_actif':''}" 
                                               disabled="#{((ordreFabrication.statusOrdre != constantes.STATUT_DOC_SUSPENDU) 
                                                           and (ordreFabrication.statusOrdre != constantes.STATUT_PROD_LANCE)
                                                           and (ordreFabrication.statusOrdre != constantes.STATUT_DOC_ENCOUR))}"
                                               rendered="#{(ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ATTENTE)}"
                                               actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_ATTENTE)}"
                                               process="@this" update="panel_state tableOF" />
                                <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_PROD_LANCE)?'LANCER':'LANC&Eacute;'}" styleClass="button-stateOF #{((ordreFabrication.statusOrdre eq constantes.STATUT_PROD_LANCE))?'button-stateOF_actif':''}" 
                                               rendered="#{!(ordreFabrication.statusOrdre != constantes.STATUT_DOC_ATTENTE)}" 
                                               actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_PROD_LANCE)}"
                                               process="@this" update="panel_state tableOF" title="#{lab.LP_PSO_pret_pour_lancement}"/>
                                <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_SUSPENDU)?'SUSPENDRE':'SUSPENDU'}" styleClass="button-stateOF #{((ordreFabrication.statusOrdre==constantes.STATUT_DOC_SUSPENDU) or ordreFabrication.suspendu)?'button-stateOF_actif':''}" 
                                               disabled="#{((ordreFabrication.statusOrdre == constantes.STATUT_DOC_TERMINE) or (ordreFabrication.statusOrdre == constantes.STATUT_DOC_CLOTURE))}" 
                                               rendered="#{(ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ENCOUR)}"
                                               actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_SUSPENDU)}"
                                               process="@this" update="panel_state tableOF" />
                                <p:commandLink value="#{lab.L_en_cours}" styleClass="button-stateOF #{((ordreFabrication.statusOrdre==constantes.STATUT_DOC_ENCOUR) or(ordreFabrication.statusOrdre eq constantes.STATUT_DOC_TERMINE))?'button-stateOF_actif':''}" 
                                               disabled="#{ordreFabrication.suiviOperations or ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ATTENTE}" title="En cours de fabrication"  actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_ENCOUR)}"
                                               rendered="#{(ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ENCOUR) or (ordreFabrication.statusOrdre eq constantes.STATUT_PROD_LANCE)}"
                                               process="@this" update="panel_state tableOF"/>
                                <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_TERMINE)?'TERMINER':'TERMIN&Eacute;'}" styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_TERMINE)?'button-stateOF_actif':''}" 
                                               disabled="#{!(ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ENCOUR)}" 
                                               actionListener="#{managedOrdresF.finishOrdre()}"
                                               rendered="#{(ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ENCOUR) or (ordreFabrication.statusOrdre eq constantes.STATUT_DOC_TERMINE)}"
                                               process="@this" update="panel_state tableOF :formulaire_mainOrdreF:zone_operations" />
                                <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_CLOTURE)?'CL&Ocirc;TURER':'CL&Ocirc;TUR&Eacute;'}"  styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_CLOTURE)?'button-stateOF_actif':''}" 
                                               rendered="#{!(ordreFabrication.statusOrdre != constantes.STATUT_DOC_TERMINE)}" 
                                               actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_CLOTURE)}" 
                                               process="@this" update="panel_state tableOF" />                                        
                            </p:outputPanel>
                        </p:outputPanel>
                    </div>
                </div> 
                <div class="part_scroll" style="background: white">
                    <div  class="main_relais background_bleu_ciel display_none padding_6">
                        <span class="main">
                            <h:graphicImage library="icones" name="menu-icon-vector.png" width="15" height="15"
                                            onclick="slideLaterale()"/>
                        </span>    
                        <span style="display: inline-block; height: 10px ; border: 1px solid #333; margin-left: 5%; opacity: 0.5"/>
                        <h:panelGroup style="margin-left: 1%" styleClass="size-08" rendered="#{managedOrdresF.selectedOf.id gt 0}"
                                      id="zone_head_art_of">
                            <b>[#{managedOrdresF.selectedOf.article.refArt}]</b>
                            <b>#{managedOrdresF.selectedOf.article.designation}</b>
                            <span>&nbsp;&nbsp;</span>
                            <h:outputText value="#{managedOrdresF.selectedOf.quantite}" style="text-decoration: underline" 
                                          converter="#{managedOrdresF.cproduction}"/>
                        </h:panelGroup>
                        <h:panelGroup style="margin-left: 1%" styleClass="size-08" rendered="#{managedOrdresF.selectedOf.id le 0}">
                            <b><i>#{lab.LP_PSO_aucune_selection_trouve}</i></b>
                        </h:panelGroup>
                        <span class="right" style="margin-top: -5px">
                            <p:commandButton actionListener="#{managedOrdresF.parcoursInAllResult(false)}" 
                                             update="tableOF :formulaire_mainOrdreF:formOF txt_parc_linear_ordre_fabrication zone_head_art_of"  
                                             icon="ui-icon-circle-triangle-w" />
                            <h:outputText id="txt_parc_linear_ordre_fabrication" value="#{managedOrdresF.offset}" />
                            / #{managedOrdresF.paginator.nbResult}                            
                            <p:commandButton actionListener="#{managedOrdresF.parcoursInAllResult(true)}" 
                                             update="tableOF :formulaire_mainOrdreF:formOF zone_head_art_of txt_parc_linear_ordre_fabrication" 
                                             icon="ui-icon-circle-triangle-e" />                          
                        </span>
                    </div>
                    <div class="zone_of_left zone_of_show">                        
                        <div class="background_bleu_ciel">
                            #{lab.LP_PSO_ordre_en_cours} <p:outputPanel autoUpdate="true"> (#{managedOrdresF.paginator.nbResult})</p:outputPanel>
                            <span class="right main">
                                <p:watermark value="#{lab.L_article}..." for="txt_find_art" />
                                <h:inputText value="#{managedOrdresF.article_}" class="background_trasparent" id="txt_find_art">
                                    <p:ajax event="valueChange" listener="#{managedOrdresF.addParamArticle()}" oncomplete="collapseList('of')"/>                            
                                </h:inputText>
                                <h:graphicImage library="icones" name="menu-icon-vector.png" width="15" height="15"
                                                onclick="slideLaterale()"/>
                            </span>
                        </div>
                        <p:dataTable value="#{managedOrdresF.listeOrdreF}" var="itemOF" rowIndexVar="line"  
                                     rowKey="#{itemOF.id}" selectionMode="single"  id="tableOF" style="width: 100%; overflow-x: auto;font-size: 0.8em ">
                            <p:ajax event="rowSelect" listener="#{managedOrdresF.loadOnViewToUpdate}" update=":formulaire_mainOrdreF:formOF"/>
                            <p:ajax event="rowToggle" global="false" />
                            <p:column width="20" headerText="N°">
                                <p:rowToggler  rendered="#{itemOF.composants.size() gt 0}" />
                                #{line+1}
                            </p:column>
                            <p:column  headerText="N°">
                                <span>#{itemOF.codeRef}</span>
                            </p:column>
                            <p:column headerText=" " width="20" styleClass="statut_#{itemOF.statutOrdre} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}">                                
                                <h:graphicImage library="img" name="pointe.png" width="15" height="13" rendered="#{itemOF.id eq ordreFabrication.id}"/>
                                <h:outputText value="#{itemOF.article.refArt}" style="font-weight: bold" rendered="#{itemOF.article.categorie eq constantes.CAT_PSF}"/>
                            </p:column>
                            <p:column width="100" headerText="#{lab.L_reference}" styleClass="statut_#{itemOF.statutOrdre} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}">
                                <h:outputText value="#{itemOF.article.refArt}" style="font-weight: bold" />
                            </p:column>
                            <p:column width="250" headerText="#{lab.L_article}" styleClass="statut_#{itemOF.statutOrdre} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}">
                                <h:outputText value=" #{itemOF.article.designation}" title="#{itemOF.codeRef}"/> 
                            </p:column>
                            <p:column  headerText="#{lab.L_quantite}" width="90" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}">
                                <f:facet name="header"><span title="#{lab.LP_PSO_quantite_a_produire}">Quantité</span></f:facet>
                                <h:outputText value="#{itemOF.quantite}" converter="#{managedOrdresF.converterProd(itemOF.article.categorie)}" />
                            </p:column>                                                                             
                            <p:column  headerText="#{lab.L_unite}" width="60" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}">
                                <h:outputText value="#{itemOF.nomenclature.uniteMesure.unite.reference}" title="#{itemOF.nomenclature.uniteMesure.unite.libelle}" />
                            </p:column>                                                                             
                            <p:column width="100" headerText="#{lab.L_date}" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}">
                                <h:outputText value="#{itemOF.dateDebut}" converter="DDMMYYYY" />
                            </p:column>
                            <p:column width="80" headerText="#{lab.LP_PSO_site}" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}">
                                <h:outputText value="#{itemOF.siteProduction.reference}" title="#{itemOF.siteProduction.designation} line_psf_#{itemOF.article.categorie eq constantes.CAT_PSF}"/>
                            </p:column>
                            <p:column width="10" headerText="" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre}">
                                <p:contextMenu for="btn_opt_of" event="left click">
                                    <p:menuitem value="#{lab.LP_PSO_composition}" icon="ui-icon-transfer-e-w" actionListener="#{managedOrdresF.displayComposition(itemOF)}"/>
                                    <p:separator />
                                    <p:menuitem value="#{lab.LP_PSO_mettre_en_attente}" icon="ui-icon-arrowreturnthick-1-w" actionListener="#{managedOrdresF.changeStateOfW(itemOF, constantes.ETAT_ATTENTE)}"
                                                rendered="#{itemOF.statutOrdre eq constantes.STATUT_DOC_ENCOUR}"/>
                                    <p:menuitem value="#{lab.LP_PSO_mettre_en_cours}"  icon="ui-icon-arrowreturnthick-1-w" actionListener="#{managedOrdresF.changeStateOfW(itemOF, constantes.ETAT_ENCOURS)}"
                                                rendered="#{(itemOF.statutOrdre ne constantes.STATUT_DOC_ATTENTE) and (itemOF.statutOrdre ne constantes.STATUT_DOC_ENCOUR)}"/>
                                    <p:menuitem value="#{lab.LP_PSO_annuler_dec}" title="#{lab.LP_PSO_annuler_declaration_produits}"  icon="ui-icon-circle-cancel"
                                                rendered="#{(itemOF.statutDeclaration eq constantes.ETAT_TERMINE)}" actionListener="#{managedOrdresF.changestatutDec(itemOF)}"/>
                                    <p:separator  />
                                    <p:menuitem value="#{lab.L_supprimer}" icon="ui-icon-trash" global="false" actionListener="#{managedOrdresF.setSelectedOf(itemOF)}" oncomplete="dlgConfirmDelete.show()"/>
                                </p:contextMenu>
                                <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_opt_of" type="button"/>
                            </p:column>
                            <p:rowExpansion >
                                <p:dataTable value="#{itemOF.composants}" var="itemcomp"
                                             rowKey="#{itemcomp.id}" id="tableOF_comp"  >                                                                      
                                    <p:column width="100" headerText="#{lab.L_reference}"  >
                                        <h:outputText value="#{itemcomp.article.refArt}" style="font-weight: bold"/>
                                    </p:column>
                                    <p:column width="250" headerText="#{lab.L_article}" >
                                        <h:outputText value=" #{itemcomp.article.designation}" /> 
                                    </p:column>
                                    <p:column  headerText="#{lab.L_quantite}" width="90" style="text-align: center" >
                                        <h:outputText value="#{itemcomp.quantitePrevu}" converter="#{managedOrdresF.cproduction}" />
                                    </p:column> 
                                </p:dataTable> 
                            </p:rowExpansion>
                        </p:dataTable> 
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                            <p:commandButton actionListener="#{managedOrdresF.avance(false)}" update="tableOF" icon="ui-icon-circle-triangle-w" disabled="#{managedOrdresF.paginator.disPrev}"/>
                            <p:outputPanel >
                                <p:inplace label="#{managedOrdresF.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                    <pe:inputNumber value="#{managedOrdresF.paginator.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                        <p:ajax event="valueChange" listener="#{managedOrdresF.gotoPagePaginator()}" update="tableOF"/>
                                    </pe:inputNumber>
                                </p:inplace><p:outputLabel value="/#{managedOrdresF.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                            </p:outputPanel>
                            <p:commandButton actionListener="#{managedOrdresF.avance(true)}" update="tableOF" icon="ui-icon-circle-triangle-e" disabled="#{managedOrdresF.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedOrdresF.imax}" label="#{lab.L_nombre_max_resultat}" 
                                             valueChangeListener="#{managedOrdresF.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                                <f:selectItems value="#{managedOrdresF.paginations}"/>
                                <p:ajax event="valueChange" update="tableOF"/>
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </div>
                    <div class="zone_of_rigth zone_form_of_show">                        
                        <div class="block_slide_entoure">                            
                            <span class="block_slide_title">
                                <h:panelGroup>
                                    <p:commandLink title="#{lab.LP_PSO_modifier_session}" onclick="dlgInfoSession_.show()">
                                        <p:graphicImage library="icones" name="pencil.jpg" width="17" height="17" />
                                    </p:commandLink>
                                    <h:outputText value="#{lab.LP_POF_infos_session}" />
                                    <p:contextMenu for="btn_download" event="left click">
                                        <p:menuitem value="#{lab.LP_PSO_declaration}" title="#{lab.LP_PSO_telecharger_fiche_declaration}" icon="ui-icon-circle-arrow-s" 
                                                    actionListener="#{managedOrdresF.downloadProdDeclare()}" ajax="false"/>
                                    </p:contextMenu>
                                    <p:commandButton icon="ui-icon-gear" styleClass="button_gear_small right" id="btn_download" type="button"/>
                                </h:panelGroup>
                            </span>
                            <h:panelGrid id="panel-opt-session-prod" styleClass="yvs_nostyle size-08" columns="5" cellpadding="0" cellspacing="0"
                                         >
                                <h:outputText value="#{lab.LP_PSO_equipe}" />
                                <h:outputText value="#{lab.LP_PSO_producteur}" />
                                <h:outputText value="#{lab.LP_PSO_depots}" />
                                <h:outputText value="#{lab.L_date}" />
                                <h:outputText value="#{lab.L_tranche}" />
                                <h:outputText value="#{managedOrdresF.currentSession.equipe.nom}" style="font-weight: bold; color: darkblue; font-size: 0.9em"/>
                                <h:outputText value="#{managedOrdresF.currentSession.producteur.nomUsers}" style="font-weight: bold; color: darkblue; font-size: 0.9em"/>
                                <h:outputText value="#{managedOrdresF.currentSession.depot.designation}" style="font-weight: bold; color: darkblue; font-size: 0.9em"/>
                                <h:outputText value="#{managedOrdresF.currentSession.dateSession}" converter="DATE" style="font-weight: bold; color: darkblue; font-size: 0.9em"/>
                                <h:outputText value="  #{managedOrdresF.currentSession.tranche.titre}" style="font-weight: bold; color: darkblue;font-size: 0.9em"/>
                            </h:panelGrid>
                        </div>
                        <p:outputPanel id="formOF">
                            <p:outputPanel layout="block" style="border-bottom: 1px #003399 solid; width: 100%; padding-bottom: 18px" id="zone_gear_operation">
                                <h:panelGroup>
                                    <p:commandButton icon="ui-icon-triangle-1-w" style="width: 22px; height: 22px" 
                                                     actionListener="#{managedOrdresF.findAndSelectNextOperation(managedOrdresF.selectedOp,false)}"
                                                     update="zone_gear_operation header_detail_edit_flux"/>
                                    <h:outputText value="#{managedOrdresF.selectedOp.numero}/#{ordreFabrication.listOperationsOf.size()*10}" style="font-size: 0.8em"/>
                                    <p:commandButton icon="ui-icon-triangle-1-e" style="width: 22px; height: 22px" actionListener="#{managedOrdresF.findAndSelectNextOperation(managedOrdresF.selectedOp,true)}"
                                                     update="zone_gear_operation header_detail_edit_flux"/>
                                </h:panelGroup>
                                <h:panelGrid columns="1" styleClass="size-09 right">                                                                        
                                    <h:panelGroup id="header_detail_edit_flux">
                                        #{lab.LP_PSO_operation} : 
                                        <h:outputText value="#{managedOrdresF.selectedOp.codeRef}" style="font-weight: bold"  /> 
                                    </h:panelGroup>                                    
                                    <p:selectBooleanCheckbox itemLabel="#{lab.LP_PSO_appliquer_suivant}"  value="#{managedOrdresF.loadNext}" >
                                        <p:ajax global="false" />
                                    </p:selectBooleanCheckbox>
                                </h:panelGrid>
                                <p:outputPanel rendered="#{managedOrdresF.mesCycles.size() gt 1}"  layout="block">
                                    <div style="font-size: 0.8em; background: #90bff5; margin-top: 20px">
                                        <div >
                                            <span style="margin-top: 0px; display: inline-block; cursor: pointer">
                                                <h:graphicImage class="ico_slide_down" library="img" name="pointe_.png" width="18" height="18" onclick="slideOnClick(true, 'display_cycle_')" />
                                                <h:graphicImage class="ico_slide_up" library="img" name="pointe_h.png" width="18" height="18" onclick="slideOnClick(false, 'display_cycle_')" style="display: none"/>
                                            </span>
                                        </div>
                                        <div class="display_cycle_" style="height: 25px; display: none">
                                            <p:outputPanel  id="control_cycle_op" layout="block">
                                                <span style="display: inline-block;margin-right: 1%">Cycles opération :</span>
                                                <p:commandButton icon="ui-icon-triangle-1-w" style="width: 22px; height: 22px" actionListener="#{managedOrdresF.navigueInCycle(false)}"
                                                                 update="control_cycle_op form_detail_edit_flux table_suivi_edit_flux" disabled="#{managedOrdresF.navPrevCycle}"/>
                                                <h:outputText value="0/#{managedOrdresF.mesCycles.size()*10}" style="font-size: 0.8em"/>                    
                                                <p:commandButton icon="ui-icon-triangle-1-e listeSuiviFlux" style="width: 22px; height: 22px" actionListener="#{managedOrdresF.navigueInCycle(true)}"
                                                                 update="control_cycle_op form_detail_edit_flux table_suivi_edit_flux" disabled="#{managedOrdresF.navNextCycle}"/>
                                                <span>#{lab.L_ref} :</span>
                                                <h:outputText value="#{managedOrdresF.selectedCycle.referenceOp}" style="font-size: 0.8em; font-weight: bold"/>    
                                                <span>#{lab.L_par} :</span>
                                                <h:outputText value="#{managedOrdresF.selectedCycle.sessionOf.sessionProd.producteur.nomUsers}" style="font-size: 0.8em; font-weight: bold"/>    
                                            </p:outputPanel>
                                        </div>
                                    </div>
                                </p:outputPanel>
                            </p:outputPanel>
                            <h:panelGrid id="form_detail_edit_flux" columns="2" style="float: right;width: 100%">
                                <h:panelGrid columns="6" styleClass="yvs_nostyle" style="float: left; font-size: 0.8em" id="panel_detail_ppte_cycle_op">
                                    <h:outputText value="Id OF" />
                                    <h:outputText value="Id" />
                                    <h:outputText title="#{lab.LP_POF_cycles_operatoire}" value="Cycle N°" />
                                    <h:outputText value="#{lab.L_debut}" />
                                    <h:outputText value="#{lab.L_fin}" />
                                    <h:outputText value="&nbsp;" />
                                    <h:outputText value="#{managedOrdresF.ordre.id}" styleClass="style_identifiant"/>
                                    <h:outputText value="#{managedOrdresF.suiviOperation.id}" />
                                    <h:outputText value="#{managedOrdresF.suiviOperation.reference}" style="font-weight: bold; color: #000066"/>
                                    <pe:timePicker value="#{managedOrdresF.suiviOperation.heureDebut}" style="width: 70px"/>
                                    <pe:timePicker value="#{managedOrdresF.suiviOperation.heureFin}" style="width: 70px"/>
                                    <p:commandLink rendered="#{managedOrdresF.suiviOperation.id gt 0}" onclick="dlgConfirmDelSuivi.show()" type="button">
                                        <h:graphicImage library="icones" name="alert.png"  title="#{lab.LP_POF_supprimer_cycle}"/>
                                    </p:commandLink>
                                </h:panelGrid>
                                <h:panelGrid style="float: right" columns="2">                                    
                                    <h:outputText value="#{lab.LP_PSO_qte_declare}" title="#{lab.LP_POF_quantite_declarer}" rendered="#{ordreFabrication.quantiteDeclare gt 0}"/>
                                    <p:inputText value="#{ordreFabrication.quantiteDeclare}" rendered="#{ordreFabrication.quantiteDeclare gt 0}" style="width: 100px; text-align: center; background: #b4e391" readonly="true"/>
                                    <span>Quantité à produire </span>
                                    <h:inputText value="#{managedOrdresF.qteAProduire}" style="width: 100px; text-align: center">
                                        <p:ajax event="blur" listener="#{managedOrdresF.calculBesoinProduit()}" update="table_suivi_edit_flux"/>
                                    </h:inputText>
                                </h:panelGrid>
                            </h:panelGrid>
                            <div style="max-height: 70%;">
                                <p:dataTable value="#{managedOrdresF.selectedFlux.listeSuiviFlux}" var="item_es" selectionMode="single" 
                                             rowIndexVar="line_s_" rowKey="#{item_es.id}" id="table_suivi_edit_flux" editMode="cell" 
                                             editable="true" style="font-size: 0.8em">
                                    <p:ajax event="cellEdit" global="false" process="@this"  listener="#{managedOrdresF.listenChangeQuantite}" />                                
                                    <p:column headerText="#{lab.L_reference}" width="80"  >                                    
                                        <span style="color: #{((item_es.composant.composant.stock lt item_es.quantite) and (item_es.composant.sens eq 'S'))?'red':'inherit'}"
                                              title="#{(item_es.composant.composant.stock lt item_es.quantite)?'Stock article insuffisant':''}">
                                            <b >#{item_es.composant.composant.article.refArt}</b>
                                        </span>
                                    </p:column>
                                    <p:column headerText="#{lab.LP_PN_composant}" >
                                        <span style="color: #{((item_es.composant.composant.stock lt item_es.quantite) and (item_es.composant.sens eq 'S')) ?'red':'inherit'}"
                                              title="#{(item_es.composant.composant.stock lt item_es.quantite)?'Stock article insuffisant':''}">
                                            #{item_es.composant.composant.article.designation}
                                        </span>
                                        <h:panelGroup style="float: right">
                                            <p:graphicImage library="icones" name="#{(item_es.composant.sens eq 'E')?'in.png':'out.png'}" width="12" height="12" style="margin-right: 10px"/>
                                            <h:outputText value="#{item_es.composant.composant.unite.unite.reference}" styleClass="style_unite" title="#{item_es.composant.composant.unite.unite.libelle}"/>
                                        </h:panelGroup>
                                    </p:column>
                                    <p:column headerText="#{lab.LC_PMS_stocks}" style="text-align: right" width="80">
                                        <h:panelGroup rendered="#{item_es.composant.composant.article.suiviEnStock}">
                                            <h:outputText value="#{managedOrdresF.giveStockMp(item_es.composant.composant)}" converter="#{managedOrdresF.cproduction}"/>       
                                        </h:panelGroup>
                                    </p:column>
                                    <p:column headerText="#{lab.LP_POF_qte_cycle}" style="text-align: right" rendered="#{managedOrdresF.suiviOperation.id gt 0}">
                                        <h:outputText value="#{managedOrdresF.giveQteCycleOp(item_es.composant,managedOrdresF.suiviOperation.id)}" converter="#{managedOrdresF.cproduction}"/>       
                                    </p:column>
                                    <p:column headerText="#{lab.LP_POF_en_cours}" width="80"  style="text-align: right">
                                        <h:outputText value="#{managedOrdresF.giveQteFluxEncours(item_es.composant)}" converter="#{managedOrdresF.cproduction}"/> 
                                    </p:column>    
                                    <p:column headerText="#{lab.LP_PSO_prevu}" width="80"  style="text-align: right">
                                        <h:outputText value="#{item_es.composant.quantite}" converter="#{managedOrdresF.cproduction}" style="font-weight: bold"/>
                                    </p:column>    
                                    <p:column headerText="#{lab.LP_PSO_ecart}" width="100"  style="text-align: right">
                                        <h:outputText value="#{item_es.composant.quantite-managedOrdresF.giveQteFluxEncours(item_es.composant)}" 
                                                      converter="#{managedOrdresF.cproduction}" />
                                    </p:column>   
                                    <p:column headerText="" style="text-align: right" width="90">
                                        <f:facet name="header">
                                            <span>#{lab.L_quantite}</span>
                                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px; float: right" title="#{lab.LP_POF_option_remplissage}" type="button" id="btn_opt_qte_flux"
                                                             rendered="#{accesRessource.prod_acces_raccourcis}"/>
                                            <p:contextMenu for="btn_opt_qte_flux" event="left click" style="font-size: 0.8em; width: 220px">
                                                <p:menuitem icon="ui-icon-arrowthickstop-1-s" value="#{lab.LP_PSO_appliquer_reste}" actionListener="#{managedOrdresF.applyResteQte(false)}"/>
                                                <p:menuitem icon="ui-icon-arrowthickstop-1-s" value="#{lab.LP_PSO_appliquer_enregistrer_reste}" actionListener="#{managedOrdresF.applyResteQte(true)}"/>
                                            </p:contextMenu>
                                        </f:facet>
                                        <p:cellEditor >
                                            <f:facet name="output" >
                                                <h:outputText value="#{item_es.quantite}" converter="#{managedOrdresF.cproduction}" id="cell_qte1"/>
                                            </f:facet>
                                            <f:facet name="input">
                                                <h:inputText value="#{item_es.quantite}" style="width: 80px" id="cell_qte2" />
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="" width="15"  style="text-align: right">
                                        <p:commandButton icon="ui-icon-circle-minus" style="float: right; width: 22px; height: 22px" title="#{lab.LP_POF_retirer_composant_operation}"
                                                         actionListener="#{managedOrdresF.deleteUseComposant(item_es)}"/>                        
                                        <f:facet name="header">
                                            <p:commandButton icon="ui-icon-circle-plus" style="float: right; width: 22px; height: 22px" title="#{lab.LP_POF_ajouter_composant_operation}"
                                                             onclick="dlgComposantOFView.show()" />
                                        </f:facet>
                                    </p:column> 
                                </p:dataTable>
                            </div>
                            <p:outputPanel autoUpdate="true">
                                <p:outputPanel rendered="#{managedOrdresF.paramProduction.declareWhenFinishOf and managedOrdresF.isLastOperation(managedOrdresF.selectedOp)}">
                                    <div style="padding-top: 5px;padding-bottom: 5px;margin-top: 5px; margin-bottom: 5px; background: #ccc">                                                                                       
                                        <p:selectBooleanCheckbox itemLabel="Transférer la production" value="#{managedOrdresF.transfertOf}" valueChangeListener="#{managedOrdresF.initTransfert}" >
                                            <p:ajax event="valueChange" process="@this tr_decl_prod"/>
                                        </p:selectBooleanCheckbox>
                                        <h:panelGrid columns="2" cellspacing="10">
                                            <h:panelGrid columns="1" cellspacing="10">                                            
                                                <h:outputText value="Quantité à déclarer "/>
                                                <h:inputText value="#{managedOrdresF.qteADeclarer}" style="width: 100px; text-align: center"/>
                                            </h:panelGrid>
                                            <h:panelGrid columns="1"> 
                                                <h:panelGrid id="tr_decl_prod" columns="2" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0"  style="font-size: 0.9em" rendered="#{managedOrdresF.transfertOf}">
                                                    <h:outputText value="#{lab.L_depot}" style="font-weight: normal; font-size: 0.9em"/> 
                                                    <h:outputText value="#{lab.L_tranche}" style="font-weight: normal; font-size: 0.9em"/> 
                                                    <h:selectOneMenu value="#{managedOrdresF.depotDest.id}" style="min-width: 150px" id="chp_depot_tr_decl_prod_"
                                                                     valueChangeListener="#{managedOrdresF.chooseDepotCible}">
                                                        <f:selectItem itemLabel="--" itemValue="0"/>
                                                        <f:selectItems value="#{managedOrdresF.depotsCible}" var="dep_" itemLabel="#{dep_.designation}" itemValue="#{dep_.id}" />                                 
                                                        <p:ajax event="valueChange" update="chp_tranche_tr_decl_prod_"/>
                                                    </h:selectOneMenu>
                                                    <h:selectOneMenu value="#{managedOrdresF.trancheHoraire.id}" style="min-width: 150px" id="chp_tranche_tr_decl_prod_">
                                                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                                        <f:selectItems value="#{managedOrdresF.tranchesCible}" var="tran_" itemLabel="#{tran_.titre}" itemValue="#{tran_.id}" />                                   
                                                        <p:ajax event="valueChange" global="false" process="@this"/>
                                                    </h:selectOneMenu>
                                                </h:panelGrid>
                                            </h:panelGrid>
                                        </h:panelGrid>
                                    </div>
                                </p:outputPanel>
                                <h:panelGroup>
                                    <p:commandButton rendered="#{managedOrdresF.suiviOperation.id gt 0}" value="#{lab.LP_POF_appliquer_nouveau}" 
                                                     title="#{lab.LP_POF_appliquer_flux_nouveau_cycle_operation}"
                                                     actionListener="#{managedOrdresF.saveFluxStock(true)}"  
                                                     update="table_suivi_edit_flux" icon="ui-icon-arrowthickstop-1-s"/>                
                                    <p:commandButton value="#{(managedOrdresF.suiviOperation.id gt 0)?'Modifier':'Appliquer'}" 
                                                     actionListener="#{managedOrdresF.saveFluxStock(false)}" 
                                                     update="formOF" icon="ui-icon-arrowthickstop-1-s"/>   
                                </h:panelGroup>             
                            </p:outputPanel>
                        </p:outputPanel>                        
                    </div>                          
                </div>
                <p:outputPanel id="tablePhase_"/>
                <p:outputPanel id="txt_article_gammes_of"/>
                <p:outputPanel id="input_qte"/>
                <p:outputPanel id="of_depot"/>
                <p:outputPanel id="zone_diplay_op"/>
                <p:outputPanel id="zone_operations"/>
            </h:form>
        </div>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <div class="zone_find">
                <div class="yvs_form_of display_auteur" align="right"  style="font-style: italic;">
                    <p:outputPanel autoUpdate="true">
                        <span style="float: left">#{lab.L_enregistrer_le} 
                            <h:outputText value="#{managedOrdresF.selectedOf.dateSave}" styleClass="valeur" converter="DTL" style="font-weight: bold"/>
                        </span> 
                        <span>#{lab.L_modifier_le} <h:outputText value="#{managedOrdresF.selectedOf.dateUpdate}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span>
                        <span>#{lab.L_par} <h:outputText value="#{managedOrdresF.selectedOf.author.users.nomUsers}"  styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <div id="zone_search_of">
                    <h:panelGrid id="blog_search_fv" columns="2" style="width: 100%;" cellpadding="0" cellspacing="0">
                        <h:panelGrid columns="7" style="float: left; font-size: 0.8em" cellpadding="0" cellspacing="0">
                            <h:outputText value="" />
                            <h:panelGroup>
                                <h:selectBooleanCheckbox value="#{managedOrdresF.date_}" valueChangeListener="#{managedOrdresF._chooseDateSearch}" style="float: left;margin-left: 5px">
                                    <p:ajax event="valueChange" oncomplete="collapseList('of')" update="blog_date_search_entete_facture_vente"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="#{lab.L_date}" />
                            </h:panelGroup>
                            <h:outputText value="#{lab.LP_PSO_site}" />
                            <h:outputText value="#{lab.L_article}" />
                            <h:panelGroup>                                
                                <h:outputText value="#{lab.LP_PSO_s_decl}" title="#{lab.LP_POF_statut_decl}" style="float:left;margin-top: 2px"/>
                                <h:selectOneMenu value="#{managedOrdresF.egaliteStatutDec}" style="float:right;margin-right: 5px;">
                                    <f:selectItem itemLabel="#{lab.L_egale}" itemValue="="/>
                                    <f:selectItem itemLabel="#{lab.L_different}" itemValue="!="/>
                                    <p:ajax event="valueChange" listener="#{managedOrdresF.searchByStatutDec()}" oncomplete="collapseList('of')"/>
                                </h:selectOneMenu>  
                            </h:panelGroup>
                            <span title="#{lab.LP_POF_numero_production}">#{lab.LP_POF_numero_p}</span>
                            <h:outputText value="" />
                            <p:commandButton icon="ui-icon-bullet" actionListener="#{managedOrdresF.clearParams()}" title="#{lab.L_reset_param}" style="width: 20px; height: 22px" 
                                             update="blog_search_fv"/>
                            <h:panelGroup id="blog_date_search_entete_facture_vente">
                                <p:calendar value="#{managedOrdresF.dateDebut}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedOrdresF.date_}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect"  listener="#{managedOrdresF.addParamDate1}" oncomplete="collapseList('of')"/>
                                    <p:ajax event="valueChange"  listener="#{managedOrdresF.addParamDate2()}" oncomplete="collapseList('of')"/>
                                </p:calendar>
                                <p:spacer width="5px" style="background: black"/>
                                <p:calendar value="#{managedOrdresF.dateFin}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedOrdresF.date_}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect" listener="#{managedOrdresF.addParamDate1}" oncomplete="collapseList('of')"/>
                                    <p:ajax event="valueChange" listener="#{managedOrdresF.addParamDate2()}" oncomplete="collapseList('of')"/>
                                </p:calendar>
                            </h:panelGroup>
                            <h:selectOneMenu value="#{managedOrdresF.siteSearch}" style="min-width: 160px">
                                <f:selectItem itemValue="0" itemLabel="" />
                                <f:selectItems value="#{managedSiteProduction.sites}" var="isS" itemValue="#{isS.id}" itemLabel="#{isS.designation}" />    
                                <p:ajax event="valueChange" listener="#{managedOrdresF.addParamSite()}" oncomplete="collapseList('of')"/>                                
                            </h:selectOneMenu>
                            <h:inputText value="#{managedOrdresF.article_}" style="min-width: 120px">
                                <p:ajax event="valueChange" listener="#{managedOrdresF.addParamArticle()}" oncomplete="collapseList('of')"/>
                            </h:inputText>                           
                            <h:selectOneMenu value="#{managedOrdresF.statutDec}"  valueChangeListener="#{managedOrdresF.addParamStatuDeclaration}" style="min-width: 120px">
                                <f:selectItem itemLabel="#{lab.L_tout}" itemValue="#{null}"/>
                                <f:selectItem itemLabel="#{lab.L_en_attente}" itemValue="#{constantes.ETAT_ATTENTE}"/>
                                <f:selectItem itemLabel="#{lab.L_en_cours}" itemValue="#{constantes.ETAT_ENCOURS}"/>
                                <f:selectItem itemLabel="#{lab.L_termine}" itemValue="#{constantes.ETAT_TERMINE}"/>
                                <p:ajax event="valueChange" oncomplete="collapseList('of')"/>
                            </h:selectOneMenu>
                            <h:inputText value="#{managedOrdresF.numSearch_}" style="min-width: 120px">
                                <p:ajax event="valueChange" listener="#{managedOrdresF.addParamNumRef()}" oncomplete="collapseList('of')"/>
                            </h:inputText> 
                            <p:commandLink value="#{lab.L_avancees}" type="button" global="false" onclick="dlgStatut.show()"/>
                        </h:panelGrid>
                    </h:panelGrid>
                </div>          
            </div>
        </h:form>
    </ui:define>
</ui:composition>

