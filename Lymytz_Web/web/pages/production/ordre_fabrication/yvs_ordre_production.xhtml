Maintena<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../../../WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui" 
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="breadcumb">
        #{navigations.naviguationApps('Ordres de fabrication','modProduction', 'smenOfSuivi', true)}
    </ui:define>                                    
    <ui:define name="contents">          
        #{managedTransfertStock.doNothing(null)}
        #{managedDepot.loadAllDepotActif(true)}
        #{managedDepot.loadAllDepot()}
        #{managedLotReception.loadAllLots()}
        #{managedPosteCharge.loadAll()}
        #{managedConditionnement.doNothing()}
        #{managedEquipeProduction.loadAllEquipeProduction()}       
        #{managedTypeCreneau.loadAllTrancheProduction()}                                                                                                                 
        #{managedSiteProduction.loadAll()}              
        #{managedOrdresF.loadAll('OF')}  
        #{managedFactureAchat.doNothing(null)}  
        <script type="text/javascript">
            $(function() {
                $('body').find('.part_scroll').height($('body').height() - $('body').find('.part_fix').height() - $('body').find('.zone_find').height() - 135);
                collapseForm('of');
                collapseForm('conditionnement');
            });
        </script>
        <h:form prependId="false">
            <p:confirmDialog header="Supprimer!" message="Souhaitez-vous réellement supprimer l'utilisation de ce composant?" widgetVar="dlgConfirmDelFlux">
                <p:commandButton icon="ui-icon-circle-plus" value="Oui" />
                <p:commandButton icon="ui-icon-circle-close" value="Non" />
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog widgetVar="dlgVerifyAppro" modal="true" showHeader="false" footer="&copy;Lymytz 2015"
                      resizable="false" dynamic="true">
                <span>Vous devez valider tous vos Approvisionnement avant de continuer !</span>                    
                <div align="center">
                    <p:commandLink value="Aller aux approvisionnement? "  actionListener="#{managedOrdresF._onloadDIstantDocStock()}" ajax="false"/>
                </div>
                <br />
                <p:commandButton type="button" value="Ok" onclick="dlgVerifyAppro.hide()" style="float: left; margin-left: 40%"/>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="form_table_composantOF">
            <p:dialog header="Composants nomenclature" width="50%" footer="&copy;Lymytz 2014"
                      widgetVar="dlgComposantOFView">   
                <p:dataTable id="table_composantOF_view" value="#{ordreFabrication.listComposantOf}" var="itemComposant" rowIndexVar="lineC"
                             selectionMode="single" rowKey="#{itemComposant.id}" selection="#{managedOrdresF.selectedComposant}"
                             editMode="cell" editable="true">
                    <p:ajax event="rowSelect"  update=":form_table_composantOF:detail_comp_op"/>
                    <p:column  width="300" headerText="Composant" >                                        
                        <h:outputText value="[#{itemComposant.article.refArt}]"  title="#{itemComposant.commentaire}" style="font-weight: bold"/>
                        <h:outputText value=" #{itemComposant.article.designation}"  title="#{itemComposant.commentaire}"/>                                        
                    </p:column>
                    <p:column width="15" headerText="Unités" style="text-align: center">
                        <h:outputText styleClass="style_unite" value="#{itemComposant.unite.unite.reference}" title="#{itemComposant.unite.unite.libelle}" />
                    </p:column>
                    <p:column width="100" headerText="Quantité Prévue" style="text-align: right">
                        <h:outputText value="#{itemComposant.quantitePrevu}" style="color: #{((itemComposant.stock lt itemComposant.quantitePrevu) and (itemComposant.type eq constantes.PROD_OP_TYPE_COMPOSANT_NORMAL))?'red':'blue'}" converter="DNS"/>                                                                                                     
                    </p:column> 
                    <p:column headerText="Coefficient"  width="80" style="text-align: right" >     
                        <p:cellEditor >
                            <f:facet name="output">
                                <h:outputText value="#{itemComposant.coefficient}" converter="DNS" title="Quantité déjà utilisé"/>           
                            </f:facet>
                            <f:facet name="input">
                                <h:inputText value="#{itemComposant.coefficient}" disabled="#{ordreFabrication.suiviStockByOperation}"/>
                            </f:facet>
                        </p:cellEditor>                                                                             
                    </p:column>   
                    <p:column headerText="Coût U." width="100" style="text-align: right">                                                             
                        <h:outputText value="#{itemComposant.coutComposant}" converter="DNS"/>    
                    </p:column>      
                    <p:column  width="100" headerText="Lot" >
                        <h:outputText value="#{itemComposant.lotSortie.numero}"  />                                           
                    </p:column>                                            
                </p:dataTable>
                <h:panelGrid columns="4" id="detail_comp_op">
                    <h:outputText value="#{managedOrdresF.selectedComposant.article.designation}" style="font-weight: bold"/>
                    <h:inputText value="#{managedOrdresF.margeNew}" style="width: 50px; text-align: center" />
                    <p:selectOneButton style="font-size: 0.8em" value="#{managedOrdresF.sensConso}">
                        <f:selectItem itemLabel="Normal" itemValue="S" />
                        <f:selectItem itemLabel="Sous produit" itemValue="E" />
                    </p:selectOneButton>
                    <p:commandButton value="Appliquer" icon="ui-icon-check" actionListener="#{managedOrdresF.addUseComposantInOperation()}"/>
                </h:panelGrid>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main-programmation_of" >
            <p:dialog header="Programmation" widgetVar="dlgProgramOrdre" width="70%" style="max-height: 70%">
                <p:focus id="defaut-article_program_of" for="txt-article_program_of"/>
                <h:panelGrid id="form-programmation_of" columns="2" style="width: 100%" cellpadding="0" cellspacing="0">
                    <f:facet name="header">
                        <div align="left">
                            <span>Date de lancement : </span>
                            <p:calendar value="#{managedOrdresF.dateLancement}" pattern="dd-MM-yyyy" size="10">
                                <p:ajax event="dateSelect" global="false"/>
                            </p:calendar>
                            <div style="font-size: 0.9em; float: right;font-weight: normal;background: #000;color: #FFF;padding: 5px">
                                <p:selectBooleanCheckbox value="#{managedOrdresF.program.suiviOperations}"  itemLabel="Suivi des opérations requis"/>
                                <p:spacer width="10"/>
                                <p:selectBooleanCheckbox value="#{managedOrdresF.program.generateOfSousProduit}"  itemLabel="Générer OF produits Inter."/>
                            </div>
                        </div>
                    </f:facet>
                    <h:panelGrid columns="6" cellpadding="0" cellspacing="0">
                        <h:outputText value="Article"/>
                        <h:outputText value="Nomenclature"/>
                        <h:outputText value="Gamme"/>
                        <h:outputText value="Quantite"/>
                        <h:outputText value="Dépôt Mp"/>
                        <h:outputText value="Dépôt Pf"/>
                        <h:inputText id="txt-article_program_of" value="#{managedOrdresF.program.articles.refArt}" style="color: #{pr.articles.error?'red':''}">
                            <p:ajax event="valueChange" listener="#{managedOrdresF.searchArticle(managedOrdresF.program)}" update="form-programmation_of"/>
                        </h:inputText>
                        <h:selectOneMenu value="#{managedOrdresF.program.nomenclature.id}" style="min-width: 140px">  
                            <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                            <f:selectItems value="#{managedOrdresF.program.articles.nomenclatures}" var="itemNom" itemValue="#{itemNom.id}" itemLabel="#{itemNom.reference}" />   
                            <p:ajax event="valueChange" listener="#{managedOrdresF.chooseNomenclature()}"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedOrdresF.program.gamme.id}" style="min-width: 140px" disabled="#{!managedOrdresF.program.suiviOperations}">  
                            <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                            <f:selectItems value="#{managedOrdresF.program.articles.gammes}" var="itemGam" itemValue="#{itemGam.id}" itemLabel="#{itemGam.codeRef}" />
                            <p:ajax event="valueChange" listener="#{managedOrdresF.chooseGamme()}"/>
                        </h:selectOneMenu>  
                        <h:inputText value="#{managedOrdresF.program.quantitePrevu}" style="width: 100px;text-align: center">
                            <p:ajax event="valueChange" global="false"/>
                        </h:inputText>
                        <h:inputText value="#{managedOrdresF.program.depotMp.code}" style="color: #{managedOrdresF.program.depotMp.error?'red':''}">
                            <p:ajax event="valueChange" listener="#{managedOrdresF.saisirDepotProgram(managedOrdresF.program.depotMp)}" update="@this"/>
                        </h:inputText>
                        <h:inputText value="#{managedOrdresF.program.depotPf.code}" style="color: #{managedOrdresF.program.depotPf.error?'red':''}">
                            <p:ajax event="valueChange" listener="#{managedOrdresF.saisirDepotProgram(managedOrdresF.program.depotPf)}" update="@this"/>
                        </h:inputText>
                    </h:panelGrid>
                    <p:commandButton icon="ui-icon-plus" actionListener="#{managedOrdresF.addProgram()}" style="width: 22px; height: 22px ; float: right;margin-top: 5px"
                                     update="data-programmation_of form-programmation_of defaut-article_program_of" title="Ajouter un programme"/>
                </h:panelGrid>
                <p:dataTable id="data-programmation_of" value="#{managedOrdresF.programs}" var="pr" rows="10" paginatorAlwaysVisible="false">
                    <p:column width="250" headerText="Article">
                        <h:outputText value="[#{pr.articles.refArt}]" style="font-weight: bold"/>
                        <h:outputText value=" #{pr.articles.designation}" /> 
                    </p:column>
                    <p:column  headerText="Quantité" width="90" style="text-align: center">
                        <h:outputText value="#{pr.quantitePrevu}"/>
                    </p:column>
                    <p:column width="120" headerText="Nomenclature" style="text-align: center">                                                             
                        <h:outputText value="#{pr.nomenclature.reference}"/>
                    </p:column>
                    <p:column width="150" headerText="Gamme" style="text-align: center">
                        <h:outputText value="#{pr.gamme.reference}" />
                    </p:column>                                                                                
                    <p:column width="150" headerText="Dépôt" style="text-align: center">
                        <h:outputText value="#{pr.depotMp.code}" />
                    </p:column>                                                                                
                    <p:column width="90" headerText="Lancement" style="text-align: center">
                        <h:outputText value="#{pr.dateDebutLancement}" converter="DDMMYYYY" />
                    </p:column>
                    <p:column style="width: 10px;text-align: center">
                        <p:commandButton icon="ui-icon-trash" actionListener="#{managedOrdresF.removeProgram(pr)}" update="data-programmation_of"
                                         style="width: 22px; height: 22px" title="Retirer un programme"/>
                    </p:column>
                </p:dataTable>
                <f:facet name="footer">
                    <div align="left">
                        <span>Site de production : </span> 
                        <h:selectOneMenu value="#{managedOrdresF.program.site.id}" style="min-width: 160px" id="select-site_programmation">
                            <f:selectItem itemValue="0" itemLabel="--" />
                            <f:selectItems value="#{managedSiteProduction.sites}" var="p_site" itemValue="#{p_site.id}" itemLabel="#{p_site.designation}" />                                    
                        </h:selectOneMenu>
                        <p:commandButton icon="ui-icon-check" value="Terminer" actionListener="#{managedOrdresF.terminerProgram()}"
                                         style="margin-top: -5px!important;margin-left: 5px" update="data-programmation_of select-site_programmation"/>
                    </div>
                </f:facet>
            </p:dialog>
        </h:form>
        <h:form prependId="false" >
            <p:dialog header="Indicateurs" widgetVar="dlgAllIndc" width="50%" height="80%">
                <p:dataTable value="#{managedOrdresF.selectedFlux.indicateursSuivis}" var="ind_" id="table_indicateur_xx" rowKey="#{ind_.id}"
                             selectionMode="single">
                    <p:column headerText="Id">
                        #{ind_.id}
                    </p:column>
                    <p:column headerText="Articles">
                        #{ind_.composant.composant.article.designation}
                    </p:column>
                    <p:column headerText="Qté">
                        #{ind_.quantiteBorne}
                    </p:column>
                    <p:column width="20">
                        <p:commandButton icon="ui-icon-circle-close" actionListener="#{managedOrdresF.deleteOrdreFabrication(ind_)}"/>
                    </p:column>
                </p:dataTable>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="form_display_resumeflux">
            <p:dialog header="Résumé des flux de composants" widgetVar="dlgResumeFlux" width="85%" height="80%" closeOnEscape="true">
                <p:outputPanel id="table_resume_flux_equipe" layout="block" style="width: 100%; height: 100%; overflow: auto">
                    <ui:repeat value="#{managedOrdresF.listeEquipe}" var="iEq">
                        <div class="head_niveau1">#{iEq.reference}</div>
                        <table class="table_niveau" cellpadding="0" cellspacing="0">
                            <tr >
                                <th rowspan="2" width="100">Date</th>
                                <th rowspan="2" width="120">Tranche</th>
                                <ui:repeat value="#{ordreFabrication.listComposantOf}" var="hiart">
                                    <th colspan="2">#{hiart.article.designation}</th>
                                </ui:repeat>
                            </tr>
                            <tr >
                                <ui:repeat value="#{ordreFabrication.listComposantOf}" var="hiart">
                                    <th title="Quantité Consommée">Conso.</th>
                                    <th title="Quantité produite">Produ.</th>
                                </ui:repeat>
                            </tr>
                            <ui:repeat value="#{managedOrdresF.listeDate}" var="iDate">
                                <h:panelGroup rendered="#{managedOrdresF.giveValueLine(iEq, iDate[0], iDate[1]) gt 0}">
                                    <tr >
                                        <td bgcolor="#aafab3"><h:outputText value="#{iDate[0]}" converter="DATE" /></td>
                                        <td bgcolor="#aafab3"><h:outputText value="#{iDate[1].titre}"  /></td>
                                        <ui:repeat value="#{ordreFabrication.listComposantOf}" var="iart">
                                            <td class="consomation">
                                                <h:outputText value="#{managedOrdresF.giveValueFlux(iEq, iDate[0], iDate[1], iart,true)}" converter="#{managedOrdresF.cproduction}" />
                                            </td>
                                            <td class="production">
                                                <h:outputText value="#{managedOrdresF.giveValueFlux(iEq, iDate[0], iDate[1], iart,false)}" converter="#{managedOrdresF.cproduction}" />
                                            </td>
                                        </ui:repeat>
                                    </tr>
                                </h:panelGroup>
                            </ui:repeat>
                        </table>
                    </ui:repeat>
                </p:outputPanel>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgNotAllDeclare" closeOnEscape="true"
                             message="La déclaration de production de cet Ordre n'est pas atteint. Voulez-vous continuer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.changeStateOf(constantes.ETAT_CLOTURE,true)}" oncomplete="dlgNotAllDeclare.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgNotAllDeclare.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmChangeDepot" closeOnEscape="true"
                             message="Vous êtes sur le point de changer le dêpot de consommation. Voulez-vous continuer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.confirmChangeDepotConso()}" oncomplete="dlgConfirmChangeDepot.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmChangeDepot.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeclare" closeOnEscape="true"
                             message="Cette déclaration entrainera un flux au delà de la quantité prévue. Voulez-vous continuer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.saveDeclaration(true)}" oncomplete="dlgConfirmDeclare.hide()"
                                 icon="ui-icon-circle-check"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeclare.hide()"  icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmFinOp" closeOnEscape="true"
                             message="Les flux de composant ne sont pas conformes. Voulez-vous continuer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.finishOperation(false)}" oncomplete="dlgConfirmFinOp.hide()"
                                 icon="ui-icon-circle-check" update=":formulaire_mainOrdreF:zone_diplay_op"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmFinOp.hide()" icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmFinAllOp" closeOnEscape="true"
                             message="Votre ordre de fabrication semble terminé. Voulez-vous marquer la fin des opérations en cours?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.finishOperation(false)}" oncomplete="dlgConfirmFinAllOp.hide()"
                                 icon="ui-icon-circle-check" update=":formulaire_mainOrdreF:zone_diplay_op"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmFinAllOp.hide()" icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteDec" closeOnEscape="true"
                             message="Confirmez-vous la suppression de cette déclaration de production?" header="Confirmation">               
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.deleteDeclaration()}" oncomplete="dlgConfirmDeleteDec.hide()"
                                 icon="ui-icon-circle-check" update=":formulaire_mainOrdreF:tablePhase_:data_declaration"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeleteDec.hide()" icon="ui-icon-circle-close"/>
            </p:confirmDialog>
        </h:form>
        <!-->
       *****************************************************************************
       Boite de dialogue des declarations
       *****************************************************************************
       <--> 
        <h:form prependId="false">
            <p:dialog header="Status" widgetVar="dlgMoreStatuts" modal="true" closeOnEscape="true">                 
                <p:selectManyMenu value="#{managedOrdresF.statutsOf}" showCheckbox="true" style="min-width: 120px;size: 20px">
                    <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                    <f:selectItem itemLabel="LANCE" itemValue="#{constantes.ETAT_PROD_LANCE}"/>
                    <f:selectItem itemLabel="ENCOURS" itemValue="#{constantes.ETAT_ENCOURS}"/>                   
                    <p:separator />
                    <f:selectItem itemLabel="TERMINER" itemValue="#{constantes.ETAT_SOUMIS}"/>
                    <f:selectItem itemLabel="CLOTURE" itemValue="#{constantes.ETAT_CLOTURE}"/>
                    <p:separator />
                    <f:selectItem itemLabel="SUSPENDU" itemValue="#{constantes.ETAT_SUSPENDU}"/> 
                    <f:selectItem itemLabel="ANNULER" itemValue="#{constantes.ETAT_ANNULE}"/> 
                    <p:ajax event="valueChange"   listener="#{managedOrdresF.searchByStatutOF()}"/>
                </p:selectManyMenu>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main_declaration">
            <p:dialog header="Conditionnement" widgetVar="dlgConditionnement" width="80%" modal="true" footer="&copy;Lymytz 2014" closeOnEscape="true">
                <div class="dlg_part_fix">
                    <p:commandButton value="Enregistrer" id="save_conditionnement" actionListener="#{managedConditionnement.saveNew()}" update="form_conditionnement data_fiche_conditionnement"
                                     icon="ui-icon-disk"/>
                    <p:commandButton value="Nouveau" id="cancel_conditionnement" actionListener="#{managedOrdresF.resetConditionner()}" update="form_conditionnement" oncomplete="collapseForm('conditionnement')"
                                     icon="ui-icon-document"/>
                    <div style="float: right">     
                        <h:link title="Vue Formulaire" onclick="collapseForm('conditionnement');
                                return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <p:spacer />
                        <h:link title="Vue Liste" onclick="collapseList('conditionnement');
                                return false" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>   
                    </div>
                    <div style="clear: right"/>
                </div>
                <div class="dlg_part_scroll">
                    <div class="yvs_form_conditionnement" style="width: 99%; margin: auto; background: white">
                        <h:panelGrid id="form_conditionnement" columns="2" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">     
                            <f:facet name="header">
                                <h:panelGrid id="form_entete_conditionnement" columns="2" styleClass="yvs_nostyle" style="width: 100%;margin-bottom: -5px;" cellpadding="0" cellspacing="0">
                                    <h:panelGrid columns="2" styleClass="yvs_nostyle" style="float: left">   
                                        <span>Dépot </span>
                                        <h:selectOneMenu value="#{managedConditionnement.fiche.depot.id}" style="min-width: 200px">
                                            <f:selectItem itemLabel="--" itemValue="0"/>
                                            <f:selectItems value="#{managedDepot.depots_all}" var="dep" itemLabel="#{dep.designation}" itemValue="#{dep.id}" />                                 
                                            <p:ajax event="valueChange" global="false" listener="#{managedConditionnement.chooseDepotConditionnement()}"/>
                                        </h:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGroup style="padding: 7px;float: right; position: relative; margin-top: -5px" rendered="#{managedConditionnement.fiche.id gt 0}">
                                        <p:outputPanel id="grp_btn_etat_conditionnement" styleClass="yvs_form_of" autoUpdate="true">                                    
                                            <p:commandLink value="#{(managedConditionnement.fiche.statut==constantes.STATUT_DOC_ANNULE)?'Editable':'En Edition'}"
                                                           styleClass="#{(managedConditionnement.fiche.statut == constantes.STATUT_DOC_EDITABLE)?'statut_valide':'etat_formation_true'}" 
                                                           disabled="#{!(managedConditionnement.fiche.statut == constantes.STATUT_DOC_ANNULE
                                                                       or managedConditionnement.fiche.statut == constantes.STATUT_DOC_RENVOYE)}"
                                                           actionListener="#{managedConditionnement.annuler(false, false)}" style="font-size: 0.8em; color: #FFF"
                                                           process="@this" global="false"/>
                                            <p:commandLink value="#{(managedConditionnement.fiche.statut==constantes.STATUT_DOC_VALIDE)?'Validé':'Valider'}"
                                                           styleClass="#{(managedConditionnement.fiche.statut==constantes.STATUT_DOC_VALIDE)?'statut_valide':'etat_formation_true'}" 
                                                           disabled="#{!(managedConditionnement.fiche.statut == constantes.STATUT_DOC_EDITABLE)}" 
                                                           actionListener="#{managedConditionnement.valider()}" style="font-size: 0.8em; color: #FFF"
                                                           process="@this" global="false"/>
                                        </p:outputPanel>                                                
                                    </h:panelGroup>                                     
                                </h:panelGrid>
                            </f:facet>
                            <span style="font-size: initial">Article : </span>
                            <h:panelGroup>
                                <h:inputText value="#{managedConditionnement.fiche.article.refArt}" style="color: #{managedConditionnement.fiche.article.error?'red':''}" tabindex="10" readonly="true">
                                    <p:ajax event="blur" global="false" listener="#{managedConditionnement.searchArticle(true)}" update="form_conditionnement"/>
                                </h:inputText>    
                                <span style="font-weight: bold;color: #000">#{managedConditionnement.fiche.article.designation}</span>                                
                                <h:panelGroup id="desc_article_fiche_conditionnement" style="float: right;margin-top: 5px">
                                    <h:outputText value="#{managedConditionnement.fiche.article.stock}" converter="DNS" style="font-weight: bold;color: #000"/>
                                    <h:outputText value=" #{managedConditionnement.fiche.conditionnement.unite.reference}"/>
                                    <span> en stock </span>
                                </h:panelGroup>
                            </h:panelGroup>
                            <span>Nomenclature </span>  
                            <h:selectOneMenu value="#{managedConditionnement.fiche.nomenclature.id}" disabled="#{(managedConditionnement.fiche.statut != constantes.STATUT_DOC_EDITABLE)}"
                                             style="min-width: 200px">
                                <f:selectItem itemLabel="--" itemValue="0"/>
                                <f:selectItems value="#{managedConditionnement.nomenclatures}" var="nome" 
                                               itemLabel="#{nome.reference}" itemValue="#{nome.id}" />                                 
                                <p:ajax event="valueChange" listener="#{managedConditionnement.chooseNomenclature()}" update="data_reconditionnement desc_article_fiche_conditionnement"/>
                            </h:selectOneMenu> 
                            <span>Date Fiche </span>
                            <p:calendar value="#{managedConditionnement.fiche.dateConditionnement}" size="10" pattern="dd-MM-yyyy"/>
                            <span>Quantitée </span>  
                            <h:panelGroup>
                                <h:inputText value="#{managedConditionnement.fiche.quantite}">
                                    <p:ajax event="blur" listener="#{managedConditionnement.blurQuantiteFiche()}" update="data_reconditionnement"/>
                                </h:inputText>    
                                <h:outputText value="#{managedConditionnement.fiche.conditionnement.unite.reference}"/>
                            </h:panelGroup> 
                            <f:facet name="footer">
                                <p:dataTable id="data_reconditionnement" value="#{managedConditionnement.fiche.contenus}" var="y" rowKey="#{y.id}" 
                                             rowIndexVar="yIdx" style="font-size: 0.9em">
                                    <p:column headerText="N°" style="width: 5%">
                                        <span>#{yIdx+1}</span>
                                        <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{y.new_}"/>
                                    </p:column>
                                    <p:column headerText="Reference">
                                        <span>#{y.article.refArt}</span>
                                    </p:column>
                                    <p:column headerText="Article">
                                        <span>#{y.article.designation}</span>
                                    </p:column>
                                    <p:column headerText="Quantité" style="text-align: right;width: 10%">
                                        <h:outputText value="#{y.quantite}" converter="DNS"/>
                                        <span title="#{y.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399"> #{y.conditionnement.unite.reference}</span>
                                    </p:column>
                                    <p:column headerText="Stock." style="text-align: center;width: 5%">
                                        <h:graphicImage library="icones" name="#{(y.consommable)?'out.png':'in.png'}" width="15" height="15" title="#{(y.consommable)?'Consommable':'Produit final'}"/>
                                    </p:column>
                                    <p:column style="width: 5%;text-align: center">
                                        <p:contextMenu for="btn_option_reconditionnement" event="left click" style="font-size: 0.8em; text-align: center"
                                                       styleClass="context_menu">
                                            <p:menuitem value="Supprimer" icon="ui-icon-trash" global="false" actionListener="#{managedConditionnement.deleteBeanContenu(y)}"
                                                        update="data_reconditionnement"/>
                                        </p:contextMenu>                           
                                        <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px" id="btn_option_reconditionnement" type="button"/>
                                    </p:column> 
                                </p:dataTable>
                            </f:facet>
                        </h:panelGrid>
                    </div>
                    <div class="yvs_list_conditionnement" style="width: 99%; margin: auto; background: white">
                        <p:dataTable id="data_fiche_conditionnement" value="#{managedConditionnement.fiches}" var="mouv" 
                                     rowKey="#{mouv.id}" rowIndexVar="mouvIdx" selectionMode="single">
                            <p:ajax event="rowSelect" listener="#{managedConditionnement.loadOnView}" update=":main_declaration:form_conditionnement" 
                                    oncomplete="collapseForm('conditionnement')" />
                            <p:column headerText="N°" width="15" styleClass="statut_#{mouv.statut}">
                                <h:graphicImage library="img" name="redo.png" width="15" height="15" rendered="#{mouv.new_}"/>
                                <span>#{mouvIdx+1}</span>
                            </p:column>
                            <p:column headerText="Article " styleClass="statut_#{mouv.statut}">
                                <h:outputText value="#{mouv.nomenclature.article.designation}"/>
                            </p:column>
                            <p:column headerText="Nomenclature " styleClass="statut_#{mouv.statut}">
                                <h:outputText value="#{mouv.nomenclature.reference}"/>
                            </p:column>
                            <p:column headerText="Date " style="width: 12%;text-align: center" styleClass="statut_#{mouv.statut}">
                                <h:outputText value="#{mouv.dateConditionnement}" converter="DDMMYYYY"/>
                            </p:column>
                            <p:column headerText="Depot" style="width: 20%;" styleClass="statut_#{mouv.statut}">
                                <span>#{mouv.depot.designation}</span>
                            </p:column>
                            <p:column headerText="Quantite " style="text-align: right;width: 10%" styleClass="statut_#{mouv.statut}">
                                <h:outputText value="#{mouv.quantite}" converter="DN"/>
                                <span title="#{mouv.nomenclature.uniteMesure.unite.libelle}" style="font-size: 0.6em;color: #003399"> #{mouv.nomenclature.uniteMesure.unite.reference}</span>
                            </p:column>
                            <p:column headerText="" width="15" styleClass="statut_#{mouv.statut}" style="text-align: center">
                                <p:contextMenu for="btn_option_conditionnement" event="left click" style="font-size: 0.9em"
                                               styleClass="context_menu">
                                    <p:menuitem value="Supprimer" icon="ui-icon-trash" global="false" actionListener="#{managedConditionnement.openTodeleteBean(mouv)}"
                                                update="data_fiche_conditionnement" oncomplete="dlgConfirmDeleteConditionnement.show()"/>
                                </p:contextMenu>
                                <p:commandButton icon="ui-icon-gear" id="btn_option_conditionnement" style="width: 20px; height: 20px" type="button"/>
                            </p:column>
                        </p:dataTable> 
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                            <p:commandButton actionListener="#{managedConditionnement.paginer(false)}" global="false" update="data_fiche_conditionnement" icon="ui-icon-circle-triangle-w" disabled="#{managedConditionnement.paginator.disPrev}"/>
                            <p:outputPanel >
                                <p:inplace label="#{managedConditionnement.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                    <pe:inputNumber value="#{managedConditionnement.paginator.gotoPage}" style="width: 30px;text-align: center" decimalPlaces="0">
                                        <p:ajax event="blur" listener="#{managedConditionnement.gotoPagePaginator()}" update="data_fiche_conditionnement"/>
                                    </pe:inputNumber>
                                </p:inplace><p:outputLabel value="/#{managedConditionnement.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                            </p:outputPanel>
                            <p:commandButton actionListener="#{managedConditionnement.paginer(true)}" global="false" update="data_fiche_conditionnement" icon="ui-icon-circle-triangle-e" disabled="#{managedConditionnement.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedConditionnement.imax}" label="Nombre max Résultat" valueChangeListener="#{managedConditionnement.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                                <f:selectItems value="#{managedConditionnement.paginations}"/>
                                <p:ajax event="valueChange" global="false" update="data_fiche_conditionnement"/>
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </div>
                </div>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="main_form_transfert_prod">
            <p:dialog header="Transfert la production" widgetVar="dlgTransfert" width="50%" modal="true" footer="&copy;Lymytz 2014"
                      closeOnEscape="true" >
                <h:panelGrid columns="2" style="float: right" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:outputText value="Dépôt"/> 
                    <h:selectOneMenu value="#{managedOrdresF.depotDest.id}" style="min-width: 200px" id="chp_depot_tr_decl_prod_1"
                                     valueChangeListener="#{managedOrdresF.chooseDepotCible}">
                        <f:selectItem itemLabel="--" itemValue="0"/>
                        <f:selectItems value="#{managedOrdresF.depotsCible}" var="dep_" itemLabel="#{dep_.designation}" itemValue="#{dep_.id}" />                                 
                        <p:ajax event="valueChange" />
                    </h:selectOneMenu>
                    <h:outputText value="Tranche"/> 
                    <h:selectOneMenu value="#{managedOrdresF.trancheHoraire.id}" style="min-width: 200px" id="chp_tranche_tr_decl_prod_1">
                        <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                        <f:selectItems value="#{managedOrdresF.tranchesCible}" var="tran_" itemLabel="#{tran_.titre}" itemValue="#{tran_.id}" />                                   
                        <p:ajax event="valueChange" global="false" process="@this"/>
                    </h:selectOneMenu>
                </h:panelGrid>
            </p:dialog>
        </h:form>

        <h:form prependId="false" id="main_form_declaration">
            <p:dialog header="Déclaration de prodution" widgetVar="dlgDeclaration" width="50%" modal="true" footer="&copy;Lymytz 2014"
                      closeOnEscape="true" >
                <f:facet name="header">
                    <h:panelGroup id="header_declaration">
                        <span style="font-size: 0.8em">Déclaration de l'ordre de fabrication N°.:<span style="font-size: 0.8em; color: #aaa">#{managedOrdresF.selectedOf.numeroIdentification}</span></span>
                    </h:panelGroup>
                </f:facet>
                <p:outputPanel id="blog_declaration">
                    <h:panelGrid id="form_declaration" columns="2" style="float: left" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">                        
                        <h:outputText value="Dépôt"/> 
                        <h:panelGroup>
                            <h:selectOneMenu value="#{managedOrdresF.declaration.depot.id}" style="min-width: 200px">
                                <f:selectItem itemLabel="--" itemValue="0"/>
                                <f:selectItems value="#{managedDepot.depots}" var="dep" itemLabel="#{dep.designation}" itemValue="#{dep.id}" />                                    
                                <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseDepotDeclaration()}"/>
                            </h:selectOneMenu>
                            <span>Transférer l'of vers</span>
                            <h:selectBooleanCheckbox title="Déclarer et transférer" value="#{managedOrdresF.transfertOf}" valueChangeListener="#{managedOrdresF.initTransfert}" >
                                <p:ajax event="valueChange" process="@this"/>
                            </h:selectBooleanCheckbox>
                        </h:panelGroup>
                        <h:outputText value="Equipe"/> 
                        <h:selectOneMenu value="#{managedOrdresF.declaration.equipe.id}" style="min-width: 200px">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedEquipeProduction.equipes}" var="eqp" itemLabel="#{eqp.nom}" itemValue="#{eqp.id}" />                                 
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseEquipe()}"/>
                        </h:selectOneMenu>
                        <h:outputText value="Tranche"/> 
                        <h:selectOneMenu value="#{managedOrdresF.declaration.tranche.id}" style="min-width: 200px">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedTypeCreneau.tranches}" var="tran" itemLabel="#{tran.titre}" itemValue="#{tran.id}" />                                   
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseTranche()}"/>
                        </h:selectOneMenu>
                        <h:outputText value="Date"/> 
                        <p:calendar value="#{managedOrdresF.declaration.dateDeclaration}" pattern="dd-MM-yyyy" size="10" style="text-align: center"/>
                        <h:outputText value="Quantité"/> 
                        <h:panelGroup>
                            <h:inputText value="#{managedOrdresF.declaration.quantite}" style="width: 100px"/>
                            <h:outputText styleClass="input_dis" value="#{(managedOrdresF.declaration.conditionnement.id gt 0)?managedOrdresF.declaration.conditionnement.unite.reference:'Aucune unité'}" 
                                          style="color: #{(managedOrdresF.declaration.conditionnement.id gt 0)?'blue':'red'}; font-size: #{(managedOrdresF.declaration.conditionnement.id gt 0)?'1em':'0.8em'}"/>                                  
                        </h:panelGroup>                         
                        <span>&nbsp;</span>
                        <p:selectBooleanCheckbox value="#{managedOrdresF.declaration.terminer}" itemLabel="Marquer la déclaration complète de l'OF"  />
                    </h:panelGrid>
                    <h:panelGrid columns="2" style="float: right" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                        <h:outputText value="Dépôt"/> 
                        <h:selectOneMenu value="#{managedOrdresF.depotDest.id}" style="min-width: 200px" id="chp_depot_tr_decl_prod"
                                         valueChangeListener="#{managedOrdresF.chooseDepotCible}">
                            <f:selectItem itemLabel="--" itemValue="0"/>
                            <f:selectItems value="#{managedOrdresF.depotsCible}" var="dep_" itemLabel="#{dep_.designation}" itemValue="#{dep_.id}" />                                 
                            <p:ajax event="valueChange" />
                        </h:selectOneMenu>
                        <h:outputText value="Tranche"/> 
                        <h:selectOneMenu value="#{managedOrdresF.trancheHoraire.id}" style="min-width: 200px" id="chp_tranche_tr_decl_prod">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedOrdresF.tranchesCible}" var="tran_" itemLabel="#{tran_.titre}" itemValue="#{tran_.id}" />                                   
                            <p:ajax event="valueChange" global="false" process="@this"/>
                        </h:selectOneMenu>
                    </h:panelGrid>
                    <div style="clear: both" />
                    <p:commandButton icon="ui-icon-disk" value="Enregistrer"  style="float: right" actionListener="#{managedOrdresF.saveDeclaration(false)}" 
                                     update="blog_declaration :formulaire_mainOrdreF:tablePhase_ :formulaire_mainOrdreF:zone_state_declare_prod :formulaire_mainOrdreF:tableOF
                                     :formulaire_mainOrdreF:txt_article_gammes_of :formulaire_mainOrdreF:input_qte"/>                
                </p:outputPanel>
            </p:dialog>
        </h:form>
        <!-->
       *****************************************************************************
       Boite de dialogue des articles
       *****************************************************************************
       <--> 
        <h:form prependId="false" id="main_of_sous_produit">
            <p:dialog header="Information de l'OF pour '#{managedOrdresF.sous.articles.designation}'" widgetVar="dlgGenererOF" width="500" modal="true" footer="&copy;Lymytz 2014" >
                <h:panelGrid columns="1" style="width: 100%" styleClass="yvs_noStyle" cellpadding="0" cellspacing="0" id="blog_of_sous_produit">
                    <span>Nomenclature</span> 
                    <h:selectOneMenu value="#{managedOrdresF.sous.nomenclature.id}" style="width: 100%">  
                        <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                        <f:selectItems value="#{managedOrdresF.sous.articles.nomenclatures}" var="isNom" itemValue="#{isNom.id}" itemLabel="#{isNom.reference}" />   
                    </h:selectOneMenu>
                    <span>Gamme</span>
                    <h:selectOneMenu value="#{managedOrdresF.sous.gamme.id}" style="width: 100%">  
                        <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                        <f:selectItems value="#{managedOrdresF.sous.articles.gammes}" var="isGam" itemValue="#{isGam.id}" itemLabel="#{isGam.codeRef}" />
                    </h:selectOneMenu>  
                    <f:facet name="footer">
                        <p:commandButton value="Enregistrer" actionListener="#{managedOrdresF.saveOFSousProduit()}" oncomplete="dlgGenererOF.hide()" style="float: right"/>
                    </f:facet>
                </h:panelGrid>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="Liste des postes de charges" widgetVar="dlgPostC" width="70%" modal="true" footer="&copy;Lymytz 2014" closeOnEscape="true">
                <div class="yvs_list_poste_charge">
                    <p:dataTable id="data_poste_charge_of" value="#{managedPosteCharge.postes}" var="postC" 
                                 rowIndexVar="postCLIne" rowKey="#{postC.id}" selectionMode="single" >
                        <p:ajax event="rowSelect" listener="#{managedOrdresF.addOrReplacePoste}" 
                                oncomplete="dlgPostC.hide()" />
                        <p:column headerText="N°" style="width: 5%">
                            <span>#{postCLIne+1}</span>
                        </p:column>
                        <p:column headerText="Reference">
                            <span>#{postC.reference}</span>        
                            <h:panelGroup style="float: right">
                                <h:outputText title="Valeur directe" value="D" rendered="#{postC.typeValeur == constantes.DIRECT}"
                                              style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: #0099ff;color: white"/>
                                <h:outputText title="Valeur calculée" value="C" rendered="#{postC.typeValeur != constantes.DIRECT}"
                                              style="font-weight: bold;border: 2px solid #666; border-radius: 5px;padding: 2px;background: #0099ff;color: white"/>
                            </h:panelGroup>         
                        </p:column>
                        <p:column headerText="Designation">
                            <span>#{postC.designation}</span>
                        </p:column>
                        <p:column headerText="Type" style="text-align: center;width: 15%">
                            <span>#{postC.typeName}</span>
                        </p:column>
                        <p:column headerText="Site Production" style="width: 15%">
                            <span>#{postC.siteProduction.designation}</span>
                        </p:column>
                        <p:column headerText="Capacite" style="text-align: right;width: 10%">
                            <h:outputText value="#{postC.capaciteH}" converter="DNS"/>
                            <span>h/mois</span>
                        </p:column>
                        <p:column headerText="Rendement" style="text-align: right;width: 8%">
                            <h:outputText value="#{postC.tauxRendement}" converter="DNS"/>
                            <span>%</span>
                        </p:column>
                    </p:dataTable>   
                    <span class="nbSelectposte_charge" style="font-size: .8em; font-style: italic; color: #828c95;"></span>
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedPosteCharge.init(false)}" global="false" update="data_poste_charge_of" icon="ui-icon-circle-triangle-w" disabled="#{managedPosteCharge.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedPosteCharge.paginator.currentPage}/#{managedPosteCharge.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedPosteCharge.init(true)}" global="false" update="data_poste_charge_of" icon="ui-icon-circle-triangle-e" disabled="#{managedPosteCharge.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedPosteCharge.nbMax}" label="Nombre max Résultat" valueChangeListener="#{managedPosteCharge.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                            <f:selectItems value="#{managedPosteCharge.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_poste_charge_of"/>
                        </p:selectOneMenu>
                    </p:outputPanel> 
                </div>
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="Liste des dépôts" widgetVar="dlgDepot" width="80%" footer="&copy;Lymytz 2014" modal="true" closeOnEscape="true">
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_depot" value="#{managedDepot.codeSearch}" style="text-align: center">
                        <p:ajax event="valueChange" global="false" listener="#{managedDepot.addParamCode(managedDepot.codeSearch)}" update="data_of_depot" />
                    </h:inputText> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{managedDepot.loadAllDepot(true, true)}" global="false"
                                         update="data_of_depot" icon="ui-icon-circle-triangle-w" disabled="#{managedDepot.paginator.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{managedDepot.paginator.currentPage}/#{managedDepot.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedDepot.loadAllDepot(true, false)}" global="false" 
                                         update="data_of_depot" icon="ui-icon-circle-triangle-e" disabled="#{managedDepot.paginator.disNext}"/>
                        <p:selectOneMenu value="#{managedDepot.nbMax}" label="Nombre max Résultat" valueChangeListener="#{managedDepot.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{managedDepot.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_of_depot"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </h:panelGrid>
                <p:dataTable id="data_of_depot" value="#{managedDepot.depots}" var="dep" rowKey="#{dep.id}" rowIndexVar="depIdx"
                             selectionMode="single">
                    <p:ajax event="rowSelect" global="false" listener="#{managedOrdresF.selectLineDepot}" 
                            oncomplete="dlgDepot.hide()"/>
                    <p:column headerText="N°" style="width: 5%;text-align: center">
                        <span>#{depIdx+1}</span>
                    </p:column>
                    <p:column headerText="Code" style="width: 12%">
                        <span>#{dep.code}</span>
                    </p:column>
                    <p:column headerText="Abreviation" style="width: 12%">
                        <span>#{dep.abbreviation}</span>
                    </p:column>
                    <p:column headerText="Désignation">
                        <span>#{dep.designation}</span>
                    </p:column>
                    <p:column headerText="Responsable">
                        <span>#{dep.responsable.nom_prenom}</span>
                    </p:column>
                    <p:column headerText="Opérations" style="text-align: center">
                        <h:panelGroup>
                            <h:graphicImage library="img" name="#{(dep.opProduction)?'P_on.png':'P_off.png'}" width="16" height="16" title="Production"/>
                            <p:spacer width="5"/>
                            <h:graphicImage library="img" name="#{(dep.opAchat)?'A_on.png':'A_off.png'}" width="16" height="16" title="Achat"/>
                            <p:spacer width="5"/>
                            <h:graphicImage library="img" name="#{(dep.opVente)?'V_on.png':'V_off.png'}" width="16" height="16" title="Vente"/>
                            <p:spacer width="5"/>
                            <h:graphicImage library="img" name="#{(dep.opTransit)?'T_on.png':'T_off.png'}" width="16" height="16" title="Transit"/>
                            <p:spacer width="5"/>
                            <h:graphicImage library="img" name="#{(dep.opRetour)?'R_on.png':'R_off.png'}" width="16" height="16" title="Retour"/>
                            <p:spacer width="5"/>
                            <h:graphicImage library="img" name="#{(dep.opTechnique)?'E_on.png':'E_off.png'}" width="16" height="16" title="Téchnique"/>
                            <p:spacer width="5"/>
                            <h:graphicImage library="img" name="#{(dep.opReserv)?'S_on.png':'S_off.png'}" width="16" height="16" title="Reservation Sortie"/>
                        </h:panelGroup>
                    </p:column>                                                                                       
                    <p:column  width="20" style="text-align: center">
                        <h:graphicImage library="img" name="#{(dep.actif)?'vu.png':'erase-128.png'}" title="#{(dep.actif)?'Actif':'dépôt innactif'}" width="10" height="10"/>
                    </p:column>
                </p:dataTable> 
            </p:dialog>
        </h:form>
        <h:form prependId="false">
            <p:dialog header="Liste des articles" widgetVar="dlgListArticle" modal="true" width="70%" closeOnEscape="true" height="450"> 
                <p:watermark for="txt_search_article_gammes_of" value="Reference article..." />
                <h:panelGrid columns="2" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                    <h:inputText id="txt_search_article_gammes_of" value="#{Marticle.article.refArt}" style="text-align: center">
                        <p:ajax event="valueChange" listener="#{Marticle.searchArticleActif(managedOrdresF.isComposant?'A':'P',Marticle.article.refArt,false)}" update="data_article_gammes_of" />
                    </h:inputText> 
                    <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                        <p:commandButton actionListener="#{Marticle.loadActifArticle(false, false)}" global="false"
                                         update="data_article_gammes_of" icon="ui-icon-circle-triangle-w" disabled="#{Marticle.pa.disPrev}"/>
                        <p:outputPanel ><p:outputLabel value="#{Marticle.pa.currentPage}/#{Marticle.pa.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{Marticle.loadActifArticle(true, false)}" global="false" 
                                         update="data_article_gammes_of" icon="ui-icon-circle-triangle-e" disabled="#{Marticle.pa.disNext}"/>
                        <p:selectOneMenu value="#{Marticle.nbMax}" label="Nombre max Résultat" valueChangeListener="#{Marticle._choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px">
                            <f:selectItems value="#{Marticle.paginations}"/>
                            <p:ajax event="valueChange" global="false" update="data_article_gammes_of"/>
                        </p:selectOneMenu>
                    </p:outputPanel>
                </h:panelGrid>
                <p:dataTable value="#{Marticle.articlesResult}" var="art" rowKey="#{art.id}" rowIndexVar="artIdx"
                             selectionMode="single" scrollable="true" scrollHeight="385" id="data_article_gammes_of" style="font-size: 0.9em">
                    <p:ajax event="rowSelect" global="false" listener="#{managedOrdresF.loadOnViewArticle}" oncomplete="dlgListArticle.hide()"/>
                    <p:column headerText="N°" width="15">
                        <span title="#{art.designation}">#{artIdx+1}</span>
                    </p:column>
                    <p:column width="70">
                        <span title="#{art.designation}">#{art.refArt}</span>
                    </p:column>
                    <p:column headerText="Designation" width="150">
                        <span title="#{art.designation}">#{art.designation}</span>
                    </p:column>
                    <p:column headerText="Categorie" width="80">
                        <span title="#{art.designation}">#{art.categorie}</span>
                    </p:column>
                    <p:column headerText="Prix A." width="80" style="text-align: right">
                        <h:outputText value="#{art.pua}" title="#{art.designation}" converter="DN" />
                    </p:column>
                    <p:column headerText="Prix V" width="80" style="text-align: right">
                        <h:outputText value="#{art.puv}" title="#{art.designation}" converter="DN" />
                    </p:column>
                </p:dataTable>
                <f:facet name="footer" class="yvs-dialog-footer">
                    #{lab.L_copy}
                </f:facet> 
            </p:dialog>
        </h:form> 
        <h:form prependId="false" id="formulaire_update_edit_flux">
            <p:dialog modal="true" width="60%" widgetVar="dlgEditFlux" footer="&copy;Lymytz 2014" closeOnEscape="true" >
                <f:facet name="header">
                    Suivi des flux de l'opération : 
                    <h:panelGroup id="header_detail_edit_flux">
                        <h:outputText value="#{managedOrdresF.selectedOp.codeRef}" style="color: #aaa; font-size: 0.8em"  /> 
                    </h:panelGroup>
                </f:facet>
                <p:outputPanel layout="block" style="border-bottom: 1px #003399 solid; width: 100%" id="zone_gear_operation">
                    <p:commandButton icon="ui-icon-triangle-1-w" style="width: 22px; height: 22px" actionListener="#{managedOrdresF.findAndSelectNextOperation(managedOrdresF.selectedOp,false)}"
                                     update="zone_gear_operation header_detail_edit_flux"/>
                    <h:outputText value="#{managedOrdresF.selectedOp.numero}/#{ordreFabrication.listOperationsOf.size()*10}" style="font-size: 0.8em"/>
                    <p:commandButton icon="ui-icon-triangle-1-e" style="width: 22px; height: 22px" actionListener="#{managedOrdresF.findAndSelectNextOperation(managedOrdresF.selectedOp,true)}"
                                     update="zone_gear_operation header_detail_edit_flux"/>
                    <p:selectBooleanCheckbox itemLabel="Appliquer &amp; suivant"  value="#{managedOrdresF.loadNext}" style="font-size: 0.8em; float: right" >
                        <p:ajax global="false"  />
                    </p:selectBooleanCheckbox>
                </p:outputPanel>
                <p:outputPanel id="form_detail_edit_flux">
                    <h:panelGrid columns="3" styleClass="yvs_nostyle" style="float: left">
                        <h:outputText value="Equipe" />
                        <h:outputText value="Tranche" />
                        <h:outputText value="Date" />
                        <h:selectOneMenu value="#{managedOrdresF.suiviFlux.equipe.id}" style="min-width: 200px">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedEquipeProduction.equipes}" var="eqp" itemLabel="#{eqp.nom}" itemValue="#{eqp.id}" />                                 
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseEquipe()}"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedOrdresF.suiviFlux.tranche.id}" style="min-width: 200px">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedTypeCreneau.tranches}" var="tran" itemLabel="#{tran.titre}" itemValue="#{tran.id}" />                                   
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseTranche()}"/>
                        </h:selectOneMenu>
                        <p:calendar value="#{managedOrdresF.suiviFlux.date}" pattern="dd-MM-yyyy" size="8"/>                        
                    </h:panelGrid>
                    <h:panelGrid style="float: right; width: 100px" columns="1">
                        <span>PF à Déclarer </span>
                        <pe:inputNumber value="#{managedOrdresF.qteADeclare}"  decimalPlaces="2" maxValue="999999999999999" style="width: 100px; text-align: center">
                            <p:ajax event="blur" listener="#{managedOrdresF.calculBesoinProduit()}" update="table_suivi_edit_flux"/>
                        </pe:inputNumber>
                    </h:panelGrid>
                </p:outputPanel>
                <p:dataTable value="#{managedOrdresF.selectedFlux.listeSuiviFlux}" var="item_es" selectionMode="single" rowIndexVar="line_s_" rowKey="#{item_es.id}"
                             id="table_suivi_edit_flux" editMode="cell" editable="true">
                    <p:ajax event="cellEdit" global="false" process="@this"  listener="#{managedOrdresF.listenChangeQuantite}" />
                    <p:column headerText="N°" width="15" style="text-align: center">
                        #{line_s_+1}
                    </p:column>
                    <p:column headerText="Composants" width="120"  >
                        <span style="font-weight: bold">[#{item_es.composant.composant.article.refArt}]</span>
                        #{item_es.composant.composant.article.designation}
                    </p:column>
                    <p:column headerText="Unité" width="25" style="text-align: right">
                        <p:graphicImage library="icones" name="#{(item_es.composant.sens eq 'E')?'in.png':'out.png'}" width="12" height="12" style="float: left"/>
                        <h:outputText value="#{item_es.composant.composant.unite.unite.reference}" styleClass="style_unite" title="#{item_es.composant.composant.unite.unite.libelle}"/>
                    </p:column>
                    <p:column headerText="Stocks" style="text-align: right">
                        <h:panelGroup rendered="#{item_es.composant.composant.article.suiviEnStock}">
                            <h:outputText value="#{managedOrdresF.giveStockMp(item_es.composant.composant)}" converter="#{managedOrdresF.cproduction}"/>       
                        </h:panelGroup>
                    </p:column>
                    <p:column headerText="En cours" width="100"  style="text-align: right">
                        <h:outputText value="#{item_es.composant.quantiteFlux}" converter="#{managedOrdresF.cproduction}" />/
                        <h:outputText value="#{item_es.composant.quantite}" converter="#{managedOrdresF.cproduction}" style="font-weight: bold"/>
                    </p:column>    
                    <p:column headerText="Reste" width="100"  style="text-align: right">
                        <h:outputText value="#{item_es.composant.quantiteResteFlux}" converter="#{managedOrdresF.cproduction}" />
                    </p:column>    
                    <p:column headerText="Perte" width="100"  style="text-align: right">
                        <p:cellEditor >
                            <f:facet name="output" >
                                <h:outputText value="#{item_es.quantitePerdue}" converter="#{managedOrdresF.cproduction}" id="cell_qte12"/>
                            </f:facet>
                            <f:facet name="input">
                                <h:inputText value="#{item_es.quantitePerdue}" style="width: 80px" id="cell_qte22" disabled="#{item_es.composant.sens eq constantes.STOCK_SENS_SORTIE}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>    
                    <p:column headerText="" style="text-align: right" width="90">
                        <f:facet name="header">
                            <span>Quantité</span>
                            <p:commandButton icon="ui-icon-gear" style="width: 22px; height: 22px; float: right" title="Options de remplissage" type="button" id="btn_opt_qte_flux"/>
                            <p:contextMenu for="btn_opt_qte_flux" event="left click" style="font-size: 0.8em; width: 220px">
                                <p:menuitem icon="ui-icon-arrowthickstop-1-s" value="Appliquer les restes" actionListener="#{managedOrdresF.applyResteQte(false)}"/>
                                <p:menuitem icon="ui-icon-arrowthickstop-1-s" value="Appliquer &amp; Enregistrer le reste" actionListener="#{managedOrdresF.applyResteQte(true)}"/>
                            </p:contextMenu>
                        </f:facet>
                        <p:cellEditor >
                            <f:facet name="output" >
                                <h:outputText value="#{item_es.quantite}" converter="#{managedOrdresF.cproduction}" id="cell_qte1"/>
                            </f:facet>
                            <f:facet name="input">
                                <h:inputText value="#{item_es.quantite}" style="width: 80px" id="cell_qte2" />
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column headerText="" width="15"  style="text-align: right">
                        <p:commandButton icon="ui-icon-circle-minus" style="float: right; width: 22px; height: 22px" title="retirer ce composant de l'opération"
                                         actionListener="#{managedOrdresF.deleteUseComposant(item_es)}"/>                        
                        <f:facet name="header">
                            <p:commandButton icon="ui-icon-circle-plus" style="float: right; width: 22px; height: 22px" title="Ajouter un composant à l'opération"
                                             onclick="dlgComposantOFView.show()" update=":form_table_composantOF:table_composantOF_view"/>
                        </f:facet>
                    </p:column> 
                </p:dataTable>
                <p:commandButton value="Appliquer" actionListener="#{managedOrdresF.saveFluxStock()}" update=":formulaire_mainOrdreF:zone_diplay_op table_suivi_edit_flux"/>                
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="formulaire_update_flux">
            <p:dialog header=" " width="70%" widgetVar="dlgSuiviFlux" footer="&copy;Lymytz 2014" closeOnEscape="true">
                <f:facet name="header">
                    Suivi des flux de l'opération :
                    <h:panelGroup id="header_detail_flux">
                        <h:outputText value="#{managedOrdresF.selectedFlux.operation.codeRef}" style="color: #aaa; font-size: 0.8em"  /> /
                        <h:outputText value="#{managedOrdresF.selectedFlux.composant.article.designation}" style="color: #aaa; font-size: 0.8em" />
                    </h:panelGroup>
                </f:facet>
                <p:outputPanel id="form_detail_flux">
                    <div>Enregistrer un nouveau flux de stock de  <h:outputText value="#{managedOrdresF.selectedFlux.composant.article.designation}" style="color: #aaa; font-size: 0.8em"/></div>
                    <h:panelGrid columns="5" styleClass="yvs_nostyle" >
                        <h:outputText value="Equipe" />
                        <h:outputText value="Tranche" />
                        <h:outputText value="Date" />
                        <h:outputText value="Quantité" />
                        <span>&nbsp;</span>
                        <h:selectOneMenu value="#{managedOrdresF.suiviFlux.equipe.id}" style="min-width: 200px">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedEquipeProduction.equipes}" var="eqp" itemLabel="#{eqp.nom}" itemValue="#{eqp.id}" />                                 
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseEquipe()}"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedOrdresF.suiviFlux.tranche.id}" style="min-width: 200px">
                            <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                            <f:selectItems value="#{managedTypeCreneau.tranches}" var="tran" itemLabel="#{tran.titre}" itemValue="#{tran.id}" />                                   
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseTranche()}"/>
                        </h:selectOneMenu>
                        <p:calendar value="#{managedOrdresF.suiviFlux.date}" pattern="dd-MM-yyyy" size="8"/>
                        <h:panelGroup>
                            <h:inputText value="#{managedOrdresF.suiviFlux.quantite}" style="width: 70px" />/ 
                            <h:outputText value="#{managedOrdresF.selectedFlux.quantiteResteFlux}" converter="#{managedOrdresF.cproduction}" style="width: 100px" />
                        </h:panelGroup>
                        <p:commandButton icon="ui-icon-circle-plus" value="Enregistrer" actionListener="#{managedOrdresF.saveNewSuiviFluxComposant(false)}"
                                         update="table_suivi_flux"/>
                    </h:panelGrid>
                </p:outputPanel>
                <p:dataTable value="#{managedOrdresF.selectedFlux.listeSuiviFlux}" var="item_s" selectionMode="single" rowIndexVar="line_s_" rowKey="#{item_s.id}"
                             id="table_suivi_flux">
                    <p:column headerText="N°" width="15" style="text-align: center">
                        #{line_s_+1}
                    </p:column>
                    <p:column headerText="Quantité">
                        <h:outputText value="#{item_s.quantite}" converter="#{managedOrdresF.cproduction}" />
                    </p:column>
                    <p:column headerText="Equipes">
                        #{item_s.equipe.nom}
                    </p:column>
                    <p:column headerText="Dates">
                        <h:outputText value="#{item_s.dateFlux}" converter="DATE" />
                    </p:column>
                    <p:column headerText="Tranche">
                        <h:outputText value="#{item_s.tranche.heureDebut}" converter="TIME" /> - 
                        <h:outputText value="#{item_s.tranche.heureFin}" converter="TIME" />
                    </p:column>
                    <p:column headerText="" style="text-align: center" width="15">
                        <p:contextMenu for="opt_suivi_flux_composant" event="left click">
                            <p:menuitem value="Supprimer" icon="ui-icon-trash" actionListener="#{managedOrdresF.deleteSuiviFlux(item_s)}" update="table_suivi_flux"/>
                        </p:contextMenu>
                        <p:commandButton  style="width: 22px; height: 22px" type="button" icon="ui-icon-gear" id="opt_suivi_flux_composant"/>
                    </p:column>  
                </p:dataTable>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="formulaire_propriete_phase">
            <p:dialog closeOnEscape="true" width="80%" position="center" showEffect="fade" hideEffect="scale" widgetVar="dlgProprieteOp">
                <f:facet name="header">
                    Propriétés de l'opération .:
                    <h:outputText value="#{managedOrdresF.operation.reference}" style="color: #aaa; font-size: 0.8em" id="headPPt"/>
                </f:facet>
                <p:outputPanel id="formPptePhase">
                    <p:outputPanel layout="block"  rendered="#{managedOrdresF.operation.id gt 0}" style="width: 100%">
                        <h:panelGroup style="float: left">
                            <p:commandButton title="Opération précédente" update="headPPt formPptePhase" actionListener="#{managedOrdresF.navigueInListOperation(false)}" global="false"  icon="ui-icon-circle-triangle-w" />                            
                            <p:commandButton title="Opération suivante" update="headPPt formPptePhase" actionListener="#{managedOrdresF.navigueInListOperation(true)}" global="false"  icon="ui-icon-circle-triangle-e" />                            
                        </h:panelGroup>
                        <h:panelGroup id="zone_state_op" style="float: right;font-size: 0.9em">
                            <p:commandLink value="En attente" title="Pause" styleClass="#{(managedOrdresF.operation.statutOp==constantes.STATUT_DOC_ATTENTE)?'statut_valide':'etat_formation_true'}"                                    
                                           process="@this"  actionListener="#{managedOrdresF.changeStatutOp(constantes.STATUT_DOC_ATTENTE)}"
                                           update=":formulaire_mainOrdreF:tablePhase_:table_phase :formulaire_mainOrdreF:tablePhase_:table_composantOF btn_apply_operation table_op_use_mp"/>
                            <p:commandLink value="En cours" styleClass="#{(managedOrdresF.operation.statutOp==constantes.STATUT_DOC_ENCOUR)?'statut_valide':'etat_formation_true'}"                                    
                                           process="@this"  actionListener="#{managedOrdresF.changeStatutOp(constantes.STATUT_DOC_ENCOUR)}"
                                           update=":formulaire_mainOrdreF:tablePhase_:table_phase :formulaire_mainOrdreF:tablePhase_:table_composantOF btn_apply_operation table_op_use_mp"/>
                            <p:commandLink value="Terminé" styleClass="#{(managedOrdresF.operation.statutOp==constantes.STATUT_DOC_TERMINE)?'statut_valide':'etat_formation_true'}" 
                                           process="@this"  actionListener="#{managedOrdresF.finishOperation()}" disabled="#{managedOrdresF.operation.statutOp.equals(constantes.STATUT_DOC_ATTENTE)}"
                                           update=":formulaire_mainOrdreF:tablePhase_:table_phase :formulaire_mainOrdreF:tablePhase_:table_composantOF btn_apply_operation table_op_use_mp"/>
                        </h:panelGroup>
                    </p:outputPanel>
                    <h:panelGrid columns="1" styleClass="yvs_nostyle" style="width: 100%" cellpadding="0" cellspacing="0">  
                        <h:panelGrid columns="4" style="width: 100%" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                            <f:facet name="header">
                                <div align="left" style="padding: 5px">
                                    <span> 
                                        <span style="font-weight: normal">Op. N° : </span>
                                        <h:outputText value="#{managedOrdresF.operation.numero}" style="font-weight: bold" rendered="#{managedOrdresF.operation.id gt 0}"/>
                                        <h:inputText value="#{managedOrdresF.operation.numero}" style="font-weight: bold;width: 70px" rendered="#{managedOrdresF.operation.id lt 1}"/>
                                    </span> 
                                    <span>
                                        <span style="font-weight: normal; margin-left: 5%">Reference : </span>
                                        <h:outputText value="#{managedOrdresF.operation.reference}" style="font-weight: bold" rendered="#{managedOrdresF.operation.id gt 0}"/>
                                        <h:inputText value="#{managedOrdresF.operation.reference}" style="font-weight: bold" rendered="#{managedOrdresF.operation.id lt 1}"/>
                                    </span> 
                                    <h:outputText style="float: right" styleClass="style_identifiant" value="#{managedOrdresF.operation.id}" />
                                </div>
                            </f:facet>
                            <span>Machine</span>
                            <h:panelGroup id="op_poste_machine">
                                <h:outputText title="#{managedOrdresF.operation.machine.designation}" value="#{managedOrdresF.operation.machine.reference}" style="width: 80%; padding: 8px; background: #444; color: #FFF; margin-right: 8px"/>
                                <p:inplace label="#{managedOrdresF.operation.nbMachine}" style="font-weight: bold">
                                    <h:inputText value="#{managedOrdresF.operation.nbMachine}" disabled="#{managedOrdresF.operation.machine.id le 0 or managedOrdresF.operation.machine==null}"
                                                 style="width: 50px"/>
                                </p:inplace>
                                <p:contextMenu for="btn_opt_replace_pc_ma" event="left click">
                                    <p:menuitem value="Remplacer le poste" icon="ui-icon-arrow-4-diag" rendered="#{managedOrdresF.operation.machine.id gt 0}"
                                                actionListener="#{managedOrdresF.openDlgPoste('MA')}"/>
                                    <p:separator />
                                    <p:menuitem value="Supprimer le poste" icon="ui-icon-trash" rendered="#{managedOrdresF.operation.machine.id gt 0}"
                                                actionListener="#{managedOrdresF.operation.setMachine(null)}" update="op_poste_machine"/>
                                    <p:menuitem value="Ajouter un poste" icon="ui-icon-circle-plus" rendered="#{managedOrdresF.operation.machine.id le 0 or managedOrdresF.operation.machine==null}"
                                                actionListener="#{managedOrdresF.openDlgPoste('MA')}"/>
                                </p:contextMenu>
                                <p:commandButton id="btn_opt_replace_pc_ma" icon="ui-icon-gear" title="Remplacer le poste" style="width: 22px; height: 22px; margin-left: 2%"/>
                            </h:panelGroup>
                            <span>Main d'oeuvre</span>
                            <h:panelGroup  id="op_poste_mo" >
                                <h:outputText title="#{managedOrdresF.operation.mainOeuvre.designation}" value="#{managedOrdresF.operation.mainOeuvre.reference}" style="width: 80%; padding: 8px; background: #444; color: #FFF; margin-right: 8px"  />
                                <p:inplace label="#{managedOrdresF.operation.nbMainOeuvre}" style="font-weight: bold">
                                    <h:inputText value="#{managedOrdresF.operation.nbMainOeuvre}" disabled="#{managedOrdresF.operation.mainOeuvre.id le 0 or managedOrdresF.operation.mainOeuvre==null}"
                                                 style="width: 50px"/>
                                </p:inplace>
                                <p:contextMenu for="btn_opt_replace_pc_mo" event="left click">
                                    <p:menuitem value="Remplacer le poste" icon="ui-icon-arrow-4-diag" rendered="#{(managedOrdresF.operation.mainOeuvre.id gt 0)}"
                                                actionListener="#{managedOrdresF.openDlgPoste('MO')}"/>
                                    <p:separator />
                                    <p:menuitem value="Supprimer le poste" icon="ui-icon-trash" rendered="#{(managedOrdresF.operation.mainOeuvre.id gt 0)}"
                                                actionListener="#{managedOrdresF.operation.setMachine(null)}" update="op_poste_mo"/>
                                    <p:menuitem value="Ajouter un poste" icon="ui-icon-circle-plus" rendered="#{managedOrdresF.operation.mainOeuvre.id le 0 or managedOrdresF.operation.mainOeuvre==null}"
                                                actionListener="#{managedOrdresF.openDlgPoste('MO')}"/>
                                </p:contextMenu>
                                <p:commandButton id="btn_opt_replace_pc_mo" icon="ui-icon-gear" title="Remplacer la main d'oeuvre" style="width: 22px; height: 22px; margin-left: 2%"/>
                            </h:panelGroup>
                            <span>Date Lancement Op.</span>
                            <h:panelGroup>
                                <p:calendar value="#{managedOrdresF.operation.dateDebut}" navigator="true" pattern="dd-MM-yyyy" size="8" />
                                <pe:timePicker value="#{managedOrdresF.operation.heureDebut}" style="width: 80px"/>                        
                            </h:panelGroup>
                            <span>Date Fin</span>
                            <h:panelGroup>
                                <p:calendar value="#{managedOrdresF.operation.dateFin}" navigator="true" pattern="dd-MM-yyyy" size="8" />
                                <pe:timePicker value="#{managedOrdresF.operation.heureFin}" style="width: 80px"/>                        
                            </h:panelGroup>
                            <span title="temps d'Réglage">Temps Réglage</span>
                            <h:panelGroup>
                                <pe:inputNumber value="#{managedOrdresF.operation.tempsReglage}" style="width: 100px"/>
                                <span style="font-size: 0.8em; font-weight: bold">(#{ordreFabrication.gamme.uniteTemps.reference})</span>
                            </h:panelGroup>
                            <span title="temps opératoire">Temps opératoire</span>
                            <h:panelGroup >
                                <pe:inputNumber value="#{managedOrdresF.operation.tempsOperation}" style="width: 100px"/>                                                      
                                <span style="font-size: 0.8em; font-weight: bold"> (#{ordreFabrication.gamme.uniteTemps.reference})</span>
                            </h:panelGroup>                        
                        </h:panelGrid>
                        <h:inputTextarea value="#{managedOrdresF.operation.commentaire}" title="commentaire" style="width: 100%"  rows="1"/>                                                        
                    </h:panelGrid>                    
                    <p:dataTable value="#{managedOrdresF.operation.composants}" var="iconso" id="table_op_use_mp"
                                 rowIndexVar="line_cop" editMode="cell" editable="true" selectionMode="single" rowKey="#{iconso.id}">
                        <p:column headerText="Id" width="50" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{iconso.id eq managedOrdresF.selectedFlux.id}"/>                                
                            <span style="font-weight: bold">#{iconso.id}</span>
                        </p:column>
                        <p:column headerText="Composant" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <span style="font-weight: bold">[#{iconso.composant.article.refArt}]</span>
                            <span > #{iconso.composant.article.designation}</span>
                        </p:column>
                        <p:column headerText="Unités" width="15" style="text-align: center" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <h:outputText styleClass="style_unite" value="#{iconso.composant.unite.unite.reference}" title="#{iconso.composant.unite.unite.libelle}"/>                      
                        </p:column>
                        <p:column width="100" headerText="Stock " style="text-align: right" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <h:panelGroup rendered="#{iconso.composant.article.suiviEnStock}">
                                <h:outputText value="#{managedOrdresF.giveStockMp(iconso.composant)}" converter="#{managedOrdresF.cproduction}"/>       
                            </h:panelGroup>
                            <h:outputText value="Non suivi" style="color: red;font-size: 0.8em; font-style: italic" rendered="#{!iconso.composant.article.suiviEnStock}"/>                                                                  
                        </p:column>
                        <p:column headerText="Qte perdue" style="text-align: right" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{iconso.quantitePerdue}" converter="#{managedOrdresF.cproduction}" title="#{iconso.tauxComposant} %"/>
                                </f:facet>
                                <f:facet name="input">
                                    <h:inputText value="#{iconso.quantitePerdue}" style="width:70%" disabled="#{!ordreFabrication.suiviStockByOperation or iconso.id gt 0}"/>
                                </f:facet>
                            </p:cellEditor>                        
                        </p:column>
                        <p:column headerText="Flux Réel" style="text-align: right" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <h:outputText value="#{iconso.quantiteFlux}" converter="#{managedOrdresF.cproduction}" title="#{iconso.tauxComposant} %"/>                            
                        </p:column>
                        <p:column headerText="Quantité" style="text-align: right" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{iconso.quantite}" converter="#{managedOrdresF.cproduction}" title="#{iconso.tauxComposant} %"/>
                                </f:facet>
                                <f:facet name="input">
                                    <h:inputText value="#{iconso.quantite}" style="width:70%" disabled="#{!ordreFabrication.suiviStockByOperation or iconso.id gt 0}"/>
                                </f:facet>
                            </p:cellEditor>                        
                        </p:column>
                        <p:column headerText="Sens" style="text-align: center" width="15" styleClass="#{(iconso.id gt 0 or iconso.inListByDefault)?'':'line_disable'}">
                            <h:graphicImage title="#{(iconso.sens eq constantes.STOCK_SENS_ENTREE)?'Consommation de stock':'Production de stock'}" library="icones" rendered="#{iconso.inListByDefault or iconso.id gt 0}" name="#{(iconso.sens eq constantes.STOCK_SENS_ENTREE)?'in.png':'out.png'}" width="15" height="15"/>
                        </p:column>
                        <p:column headerText="" style="text-align: center" width="15">
                            <p:commandButton  style="width: 22px; height: 22px" type="button" icon="ui-icon-gear"
                                              id="opt_flux_composant"/>
                            <p:contextMenu for="opt_flux_composant" event="left click" style="width: 300px">
                                <p:menuitem value="Voir les flux de #{(iconso.sens eq constantes.STOCK_SENS_SORTIE)? 'consommations':'productions'}" rendered="#{iconso.inListByDefault}" icon="ui-icon-folder-open" actionListener="#{managedOrdresF.loadDetailFluxCOmposant(iconso)}"  title="Modifier le détails des flux"  
                                            oncomplete="dlgSuiviFlux.show()" update="table_op_use_mp "/>
                                <p:menuitem value="Gestion des indicateurs" rendered="#{iconso.inListByDefault}" icon="ui-icon-star" actionListener="#{managedOrdresF.loadAllIndicateurs(iconso)}"  title="Modifier le détails des flux"  
                                            update="table_op_use_mp"/>
                                <p:separator />
                                <p:menuitem value="#{iconso.inListByDefault?'Enlever':'Ajouter'}" icon="#{iconso.inListByDefault?'ui-icon-circle-minus':'ui-icon-circle-plus'}" actionListener="#{managedOrdresF.addOrRemoveFromOp(iconso)}"  title="#{iconso.inListByDefault?'Annuler l\'utilisation à cette étape':'Activer l\'utilisation à cette étape'}"  />                                
                            </p:contextMenu>
                        </p:column>                    
                    </p:dataTable>                
                    <p:commandButton value="Appliquer" update=":formulaire_mainOrdreF:tablePhase_ :formulaire_mainOrdreF:tablePhase_:table_phase table_op_use_mp" id="btn_apply_operation" 
                                     disabled="#{ordreFabrication.id le 0 or managedOrdresF.operation.statutOp==constantes.STATUT_DOC_TERMINE}" icon="ui-icon-refresh" 
                                     actionListener="#{managedOrdresF.applyPropertyPhase(false)}" style="float: right"/>
                </p:outputPanel>
                <f:facet name="footer">
                    &copy; lymytz 2014
                </f:facet>
            </p:dialog>
        </h:form>
        <h:form prependId="false" id="formulaire_propriete_composant">
            <p:dialog id="headPPtC" closeOnEscape="true" width="70%" position="center" showEffect="fade" hideEffect="scale" widgetVar="dlgProprieteComposant">
                <f:facet name="header">
                    Propriétés du composant 
                    <h:outputText id="headPPtCc" value="#{managedOrdresF.composant.composant.designation}" style="text-decoration: underline; font-style: italic; color: #009999"/>
                </f:facet>
                <h:panelGrid id="formPpteComposant" columns="1" style="width: 100%; font-size: 0.9em" styleClass="yvs_table" cellpadding="0" cellspacing="0">
                    <f:facet name="header">
                        <div align="left">
                            <h:inputText value="#{managedOrdresF.composant.id}" style="font-weight: bold; width: 80px; text-align: center; background: #CCC" disabled="true"/> 
                            <h:panelGroup rendered="#{managedOrdresF.composant.id lt 1}">
                                <h:inputText id="txt_article_composant" value="#{managedOrdresF.composant.composant.refArt}" style="color: #{managedOrdresF.composant.composant.error?'red':''}">
                                    <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.searchArticle(managedOrdresF.composant.composant.refArt, true)}" update="txt_article_composant headPPtCc"/>
                                </h:inputText>  
                                <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px;background: white;margin-top: 5px" title="Liste Articles" global="false"
                                                 actionListener="#{managedOrdresF.initArticles(true)}" oncomplete="dlgListArticle.show()"/>
                            </h:panelGroup>
                            <h:panelGroup style="float: right" id="txt_depot_composant">
                                <span>Dépôt de consommation </span>
                                <h:selectOneMenu value="#{managedOrdresF.composant.depotConso.id}" style="min-width: 200px">
                                    <f:selectItem itemLabel="--" itemValue="0" noSelectionOption="true"/>
                                    <f:selectItems value="#{managedDepot.depots}" var="dep" itemLabel="#{dep.designation}" itemValue="#{dep.id}" />                                 
                                    <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseDepotConso()}"/>
                                </h:selectOneMenu>
                            </h:panelGroup>   
                        </div>
                    </f:facet>
                    <h:panelGrid columns="5" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">
                        <span>Unité </span>
                        <h:selectOneMenu id="txt_unite_composant" value="#{managedOrdresF.composant.unite.id}" style="min-width: 180px">
                            <f:selectItem itemLabel="--" itemValue="-1" />
                            <f:selectItems value="#{managedOrdresF.composant.composant.conditionnements}"
                                           var="icon_c" itemLabel="[#{icon_c.unite.reference}] #{icon_c.unite.libelle}"  itemValue="#{icon_c.id}" />
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseUniteComposant()}"/>
                        </h:selectOneMenu>
                        <span>Référence du lot </span>
                        <h:selectOneMenu value="#{managedOrdresF.composant.lotSortie.id}" style="min-width: 180px" >
                            <f:selectItem itemLabel="--" itemValue="-1" />
                            <f:selectItems value="#{managedLotReception.lots}"
                                           var="icon_l" itemLabel="#{icon_l.numero}"  itemValue="#{icon_l.id}" />
                            <p:ajax event="valueChange" global="false" listener="#{managedOrdresF.chooseLotComposant()}"/>
                        </h:selectOneMenu>
                        <p:selectOneRadio value="#{managedOrdresF.composant.nature}">
                            <f:selectItem itemValue="#{constantes.PROD_OP_TYPE_COMPOSANT_NORMAL}" itemLabel="COMPOSANT NORMAL" />
                            <f:selectItem itemValue="#{constantes.PROD_OP_TYPE_COMPOSANT_SOUS_PRODUIT}" itemLabel="SOUS PRODUITS" />
                        </p:selectOneRadio>
                    </h:panelGrid>   
                    <h:panelGrid columns="6" style="width: 100%" styleClass="yvs_nostyle" cellpadding="0" cellspacing="0">   
                        <h:outputText value="Quantité Prévu"/>
                        <h:inputText value="#{managedOrdresF.composant.quantitePrevu}" readonly="#{managedOrdresF.composant.id gt 0}" style="background: #828c95; width: 100px"/>
                        <h:outputText value="Quantité Utilisé"/>
                        <pe:inputNumber value="#{managedOrdresF.composant.quantiteValide}" maxValue="9999999.99999" style="width: 100px" decimalPlaces="2"/> 
                        <h:outputText value="Mode d'arrondi"/>
                        <h:selectOneMenu value="#{managedOrdresF.composant.modeArrondi}">
                            <f:selectItem itemValue="S" itemLabel="Valeur supérieur" />
                            <f:selectItem itemValue="I" itemLabel="Valeur inférieur"/>
                            <f:selectItem itemValue="E" itemLabel="Valeur exacte"/>
                            <f:selectItem itemValue="N" itemLabel="Pas d'arrondi"/>
                        </h:selectOneMenu>
                    </h:panelGrid>     
                    <f:facet name="footer">
                        <h:inputTextarea value="#{managedOrdresF.composant.commentaire}" title="commentaire" style="width: 100%" />                             
                    </f:facet>
                </h:panelGrid>                                                               
                <div align="left" style="margin-top: 5px">
                    <span style="font-size: 0.8em;font-weight: bold">Points de consomation</span>
                    <p:dataTable value="#{managedOrdresF.composant.composantsUsed}" var="cop" rowKey="#{cop.id}" editable="true" editMode="cell">
                        <p:column headerText="Num Opération" styleClass="statut_#{cop.operation.statutOp}">
                            #{cop.operation.numero}
                        </p:column>
                        <p:column headerText="Code Opération" styleClass="statut_#{cop.operation.statutOp}">
                            #{cop.operation.codeRef}
                        </p:column>
                        <p:column headerText="Quantité" style="text-align: right" styleClass="statut_#{cop.operation.statutOp}">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{cop.quantite}" title="#{cop.tauxComposant} %" converter="DNS"/>
                                    <h:outputText styleClass="style_unite" value="#{cop.composant.unite.unite.reference}" />
                                </f:facet>
                                <f:facet name="input">
                                    <h:inputText  value="#{cop.quantite}" style="width:70%" disabled="#{cop.operation.statutOp==constantes.ETAT_TERMINE}"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                    </p:dataTable>
                </div>
                <h:panelGroup style="font-weight: bold">
                    <span>Stock : </span>
                    <h:outputText value="#{managedOrdresF.giveStockMp(managedOrdresF.selectedComposant)}" converter="DNS"/>       
                    <h:outputText styleClass="style_unite" value="#{managedOrdresF.composant.unite.unite.reference}"  /> 
                </h:panelGroup>
                <p:commandButton value="Appliquer" style="float: right" oncomplete="dlgProprieteComposant.hide()"
                                 actionListener="#{managedOrdresF.applyPropertyComposant()}"/>
                <f:facet name="footer">
                    &copy; lymytz
                </f:facet>
            </p:dialog>
        </h:form>

        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmFinish" closeOnEscape="true"
                             message="Etes vous sur de vouloir terminer cette transformation?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedConditionnement.terminer()}" oncomplete="dlgConfirmFinish.hide();collapseForm('conditionnement')"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmFinish.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmEditer" closeOnEscape="true"
                             message="Cette transformation est validée... Etes vous sur de vouloir l'annuler?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedConditionnement.annuler(false, true)}" oncomplete="dlgConfirmEditer.hide();collapseForm('conditionnement')"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmEditer.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmAnnuler" closeOnEscape="true"
                             message="Cette transformation est validée... Souhaitez vous vraiment l'annuler?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedConditionnement.annuler(true, true)}" oncomplete="dlgConfirmAnnuler.hide();collapseForm('conditionnement')"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmAnnuler.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog widgetVar="dlgConfirmDeleteConditionnement" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation" width="40%">
                <p:commandButton value="Oui" actionListener="#{managedConditionnement.deleteBean()}" 
                                 oncomplete="dlgConfirmDeleteConditionnement.hide()" update=":main_declaration:data_fiche_conditionnement"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeleteConditionnement.hide()"/>
            </p:confirmDialog>
        </h:form>
        <h:form prependId="false">
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDelete" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.deleteBean()}" update=":formulaire_mainOrdreF:tableOF"
                                 oncomplete="dlgConfirmDelete.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDelete.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteOperation" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.deleteBeanOperation()}" update=":formulaire_mainOrdreF:tablePhase_:table_phase"
                                 oncomplete="dlgConfirmDeleteOperation.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeleteOperation.hide()"/>
            </p:confirmDialog>
            <p:confirmDialog hideEffect="explode" widgetVar="dlgConfirmDeleteComposant" closeOnEscape="true"
                             message="Êtes-vous sûr de vouloir supprimer?" header="Confirmation">
                <p:commandButton value="Oui" actionListener="#{managedOrdresF.deleteBeanComposant()}" update=":formulaire_mainOrdreF:tablePhase_:table_composantOF"
                                 oncomplete="dlgConfirmDeleteComposant.hide()"/>
                <p:commandButton type="button"  value="Non" onclick="dlgConfirmDeleteComposant.hide()"/>
            </p:confirmDialog>
        </h:form>
        <div style="width: 100%; overflow-y: hidden">
            <h:form prependId="false" id="formulaire_mainOrdreF" style="width: 100%; overflow-y: hidden"> 
                <div class="part_fix">      
                    <p:commandButton value="Enregistrer" id="save_of" actionListener="#{managedOrdresF.saveNew()}" icon="ui-icon-disk"
                                     update="tableOF panel_state of_depot tablePhase_:table_composantOF of_statut_zone tablePhase_:table_phase zone_diplay_op"/>
                    <p:commandButton value="Nouveau"  id="cancel_of" update="panel_state formOF tablePhase_ of_depot zone_diplay_op"
                                     actionListener="#{managedOrdresF.resetFiche()}" icon="ui-icon-document"/>                                                       
                    <!-->Un champ caché pour gérer la mise à zero du formulaire<-->
                    <h:inputHidden value="#{managedOrdresF.chaineSelectOf}" id="input_hide_of" />
                    <p:splitButton type="button" value="Options" style="font-size: 0.8em" id="page_prod_splitbutton">
                        <p:menuitem value="Programmation" icon="ui-icon-note" actionListener="#{managedOrdresF.resetProgram()}"
                                    oncomplete="dlgProgramOrdre.show()" update=":main-programmation_of:form-programmation_of"/>
                        <p:menuitem value="#{managedOrdresF.displayAll?'Affichage réduit':'Tout afficher'}" icon="#{managedOrdresF.displayAll?'ui-icon-copy':'ui-icon-newwin'}" actionListener="#{managedOrdresF.setDisplayAll(!managedOrdresF.displayAll)}"
                                    update=":formulaire_mainOrdreF:formOF page_prod_splitbutton"/>
                    </p:splitButton>
                    <p:commandButton value="Supprimer" id="delete_of" actionListener="#{Marticle.deleteBean()}" type="button"/>                                             
                    <div style="float: right">                        
                        <h:link title="mode création" onclick="collapseForm('of');
                                return false">
                            <p:graphicImage library="icones" name="newDoc.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>               
                        <p:spacer />
                        <h:link onclick="collapseList('of');
                                return false" title="vue liste" >
                            <p:graphicImage library="icones" name="ico_formulaire.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>          
                        <p:spacer />        
                        <h:link title="mode consultation" onclick="collapseGrid('of');
                                return false">
                            <p:graphicImage library="icones" name="ico_arbre.png" width="18" height="25" style="border: 2px solid #666; border-radius: 5px;"/>
                        </h:link>                             
                    </div>
                    <h:panelGroup style="float: right; margin-right: 45%">
                        <p:commandButton actionListener="#{managedOrdresF.parcoursInAllResult(false)}" 
                                         update="formOF txt_parc_linear_ordre_fabrication tablePhase_ tableOF zone_diplay_op"  icon="ui-icon-circle-triangle-w" oncomplete="collapseForm('of')"/>
                        <h:inputText value="#{managedOrdresF.offset}" style="width: 35px; text-align: center;"  title="Aller au N°..." id="txt_parc_linear_ordre_fabrication"/>
                        <p:outputPanel autoUpdate="true">                        
                            <p:outputLabel value="/#{managedOrdresF.paginator.nbResult}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" /></p:outputPanel>
                        <p:commandButton actionListener="#{managedOrdresF.parcoursInAllResult(true)}" 
                                         update="formOF txt_parc_linear_ordre_fabrication tablePhase_ tableOF zone_diplay_op" icon="ui-icon-circle-triangle-e" oncomplete="collapseForm('of')"/>
                    </h:panelGroup>
                </div> 
                <div class="part_scroll" style="background: white">
                    <div style="width: 100%;" class="yvs_form_of">
                        <h:panelGrid id="formOF" columns="1" style="width: 100%" cellpadding="0" cellspacing="0">
                            <f:facet name="header">
                                <p:outputPanel autoUpdate="true" id="of_statut_zone">
                                    <h:panelGrid columns="2" style="float: left; font-weight: 300; font-size: 0.8em" rendered="#{ordreFabrication.id gt 0}">
                                        <span>Reference.: </span>
                                        <h:outputText value="#{ordreFabrication.reference}" style="float: left;background: black;color: white"/>
                                        <span >Identification.:</span>                                          
                                        <h:outputText value="#{ordreFabrication.numIdentification}"  style="color: #003399"/>
                                    </h:panelGrid>
                                    <h:panelGroup  rendered="#{ordreFabrication.id gt 0}" id="zone_state_declare_prod">
                                        <p:commandLink value="Déclarations :" actionListener="#{managedOrdresF.loadDeclaration()}" styleClass="style_statut" style="margin-left: 10%" 
                                                       disabled="#{(ordreFabrication.statutDeclaration eq constantes.ETAT_TERMINE)}"
                                                       oncomplete="dlgDeclaration.show()" update=":main_form_declaration:blog_declaration"/>
                                        <h:outputText value="#{(ordreFabrication.statutDeclaration eq constantes.ETAT_TERMINE)?'Déclaré ':(ordreFabrication.statutDeclaration eq constantes.ETAT_ENCOURS)?'En cours':'En Attente'}"  styleClass="button-stateOF_actif" style="font-size: 0.8em"/>
                                    </h:panelGroup>
                                    <p:contextMenu for="panel_state">
                                        <p:menuitem value="Annuler l'Etape courante"  style="font-size: 0.8em" actionListener="#{managedOrdresF.changePreviousStateOf()}" update="panel_state tableOF"/>
                                    </p:contextMenu>
                                    <p:outputPanel id="panel_state" styleClass="yvs_form_of" style="font-size: 0.8em;float: right;margin-bottom: 10px" rendered="#{ordreFabrication.id gt 0}">  
                                        <p:commandLink value="EN ATTENTE" styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_ATTENTE)?'button-stateOF_actif':''}" 
                                                       disabled="#{((ordreFabrication.statusOrdre != constantes.STATUT_DOC_SUSPENDU) 
                                                                   and (ordreFabrication.statusOrdre != constantes.STATUT_PROD_LANCE)
                                                                   and (ordreFabrication.statusOrdre != constantes.STATUT_DOC_ENCOUR))}"
                                                       actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_ATTENTE)}"
                                                       process="@this" update="panel_state tableOF" />
                                        <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_PROD_LANCE)?'LANCER':'LANC&Eacute;'}" styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_PROD_LANCE)?'button-stateOF_actif':''}" 
                                                       disabled="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_ATTENTE)}" 
                                                       actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_PROD_LANCE)}"
                                                       process="@this" update="panel_state tableOF" title="Prêt pour le lancement"/>
                                        <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_SUSPENDU)?'SUSPENDRE':'SUSPENDU'}" styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_SUSPENDU)?'button-stateOF_actif':''}" 
                                                       disabled="#{((ordreFabrication.statusOrdre == constantes.STATUT_DOC_TERMINE) or (ordreFabrication.statusOrdre == constantes.STATUT_DOC_CLOTURE))}" 
                                                       actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_SUSPENDU)}"
                                                       process="@this" update="panel_state tableOF" />
                                        <p:commandLink value="En cours" styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_ENCOUR)?'button-stateOF_actif':''}" 
                                                       disabled="#{ordreFabrication.suiviOperations or ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ATTENTE}" title="En cours de fabrication"  actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_ENCOUR)}"
                                                       process="@this" update="panel_state tableOF"/>
                                        <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_TERMINE)?'TERMINER':'TERMIN&Eacute;'}" styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_TERMINE)?'button-stateOF_actif':''}" 
                                                       disabled="#{!(ordreFabrication.statusOrdre eq constantes.STATUT_DOC_ENCOUR)}" 
                                                       actionListener="#{managedOrdresF.finishOrdre()}"
                                                       process="@this" update="panel_state tableOF :formulaire_mainOrdreF:tablePhase_:table_phase" />
                                        <p:commandLink value="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_CLOTURE)?'CL&Ocirc;TURER':'CL&Ocirc;TUR&Eacute;'}"  styleClass="button-stateOF #{(ordreFabrication.statusOrdre==constantes.STATUT_DOC_CLOTURE)?'button-stateOF_actif':''}" 
                                                       disabled="#{(ordreFabrication.statusOrdre != constantes.STATUT_DOC_TERMINE)}" 
                                                       actionListener="#{managedOrdresF.changeStateOf(constantes.STATUT_DOC_CLOTURE)}" 
                                                       process="@this" update="panel_state tableOF" />
                                    </p:outputPanel>
                                </p:outputPanel>
                            </f:facet>
                            <h:panelGrid columns="9" id="of_depot" style="background: #ccc;border-top-left-radius: 10px; border-top-right-radius: 10px;
                                         font-size: 0.8em; color: #000; width: 100%" rendered="#{managedOrdresF.displayAll}"> 
                                <h:inputText value="#{ordreFabrication.id}" style="font-weight: bold; width: 80px; text-align: right; background: #CCC" disabled="true"/> 
                                <span>Site</span>
                                <h:selectOneMenu value="#{ordreFabrication.site.id}" style="min-width: 160px">
                                    <f:selectItem itemValue="0" itemLabel="" />
                                    <f:selectItems value="#{managedSiteProduction.sites}" var="i_site" itemValue="#{i_site.id}" itemLabel="#{i_site.designation}" />                                    
                                </h:selectOneMenu>
                                <span>Date début </span>
                                <h:panelGroup>
                                    <p:calendar value="#{ordreFabrication.dateDebutLancement}" pattern="dd-MM-yyyy" size="8" navigator="true"/>
                                    <pe:timePicker style="width: 70px" value="#{ordreFabrication.heureDeLancement}"  intervalMinutes="10" />
                                </h:panelGroup>                                                                        
                                <span>Date fin </span>
                                <h:panelGroup>
                                    <p:calendar value="#{ordreFabrication.dateFinFabrication}" pattern="dd-MM-yyyy" size="8" navigator="true"/>
                                    <pe:timePicker style="width: 70px" value="#{ordreFabrication.heureFinFabrication}"  intervalMinutes="10"  />
                                </h:panelGroup> 
                                <span>Priorité : </span>
                                <h:selectOneMenu value="#{ordreFabrication.priorite}">
                                    <f:selectItem itemValue="1" itemLabel="Très élevé" />
                                    <f:selectItem itemValue="2" itemLabel="Elevé" />
                                    <f:selectItem itemValue="3" itemLabel="Normale" />
                                    <f:selectItem itemValue="4" itemLabel="Faible" />
                                </h:selectOneMenu>
                                <f:facet name="footer">
                                    <h:panelGrid style="width: 100%" columns="4" styleClass="yvs_table" cellpadding="0" cellspacing="0">                                        
                                        <span>Dépôt Matières</span>                                    
                                        <h:panelGroup style="font-size: 0.8em" id="txt_depot_mp">
                                            <h:inputText value="#{ordreFabrication.depotMp.code}" style="width: 150px;color: #{ordreFabrication.depotMp.error?'red':''}">
                                                <p:ajax event="valueChange" listener="#{managedOrdresF.saisirDepot('MP', ordreFabrication.depotMp.code, false)}" update="txt_depot_mp"/>
                                            </h:inputText>
                                            <p:commandButton actionListener="#{managedOrdresF.openListDepots('MP', false)}" icon="ui-icon-search" style="width: 22px; height: 22px" />
                                            <h:outputText value="#{ordreFabrication.depotMp.designation}" style="font-weight: bold"/>
                                        </h:panelGroup>
                                        <span>Dépôt Produits finis</span>
                                        <h:panelGroup style="font-size: 0.8em" id="txt_depot_pf">
                                            <h:inputText value="#{ordreFabrication.depotPf.code}" style="width: 150px;color: #{ordreFabrication.depotPf.error?'red':''}">
                                                <p:ajax event="valueChange" listener="#{managedOrdresF.saisirDepot('PF', ordreFabrication.depotPf.code, false)}" update="txt_depot_pf"/>
                                            </h:inputText>
                                            <p:commandButton actionListener="#{managedOrdresF.openListDepots('PF', false)}" icon="ui-icon-search" style="width: 22px; height: 22px" />
                                            <h:outputText value="#{ordreFabrication.depotPf.designation}" style="font-weight: bold"/>
                                        </h:panelGroup>    
                                        <span>Type d'OF</span>
                                        <h:selectOneMenu value="#{ordreFabrication.typeOf}" >
                                            <f:selectItem itemValue="#{constantes.TYPE_OF_PRODUCTION}" itemLabel="Productions"/>
                                            <f:selectItem itemValue="#{constantes.TYPE_OF_REPETITIF}" itemLabel="Répétitif"/> 
                                        </h:selectOneMenu>                                        
                                        <span>Numéro de commande</span>
                                        <h:inputText value="#{ordreFabrication.numCommande}"  disabled="true" />
                                    </h:panelGrid>
                                </f:facet>
                            </h:panelGrid>
                            <p:outputPanel id="form_of" style="width: 100%">
                                <h:panelGrid columns="2">
                                    <span>Articles</span>
                                    <h:panelGroup id="txt_article_gammes_of" style="float: left; font-weight: normal;">                                    
                                        <h:inputText value="#{ordreFabrication.articles.refArt}" style="color: #{ordreFabrication.articles.error?'red':''};" disabled="#{ordreFabrication.id gt 0}" tabindex="100">
                                            <p:ajax event="blur"  listener="#{managedOrdresF.searchArticle(ordreFabrication.articles.refArt, false)}" 
                                                    update="txt_article_gammes_of form_of txt_article_des_gammes tablePhase_:table_phase tablePhase_:table_composantOF input_qte_bis chp_liaison_qte input_qte"/>
                                        </h:inputText>  
                                        <p:commandButton icon="ui-icon-note" style="width: 20px;height: 22px;background: white;margin-top: 5px" title="Liste Articles" global="false"
                                                         actionListener="#{managedOrdresF.initArticles(false)}" oncomplete="dlgListArticle.show()" disabled="#{ordreFabrication.id gt 0}"/>
                                        <p:spacer width="15"/>                                            
                                        <h:outputText id="txt_article_des_gammes" value="#{ordreFabrication.articles.designation}" style="color: #003399; font-size: 0.8em"/>
                                        <p:spacer width="15"/> 
                                        <h:panelGrid  id="input_qte_bis" columns="2" styleClass="yvs_noStyle" style="float: right" cellpadding="0" cellspacing="0" rendered="#{!managedOrdresF.displayAll}">                                                                                                           
                                            <span title="Quantité déjà réalisé">Quantité Déclaré :</span>
                                            <h:panelGroup id="txt-quantite_declare_of">
                                                <h:inputText value="#{ordreFabrication.quantiteDeclare}" disabled="true"  style="padding: 3px; background: #333; color: #FFF; width: 100px;text-align: right" converter="DN"/>                                        
                                                <h:inputText disabled="true" styleClass="input_dis" value="#{(ordreFabrication.nomenclature.unite.unite.id gt 0)?ordreFabrication.nomenclature.unite.unite.reference:'Aucune unité'}" 
                                                             style="color: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'#003399':'red'}; font-size: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'0.8em':'0.7em'}; width: 100px; text-align: center"/>

                                            </h:panelGroup>
                                            <span>Reste à déclarer:</span>
                                            <h:panelGroup id="txt-reste_a_declare_of">
                                                <h:inputText value="#{(ordreFabrication.quantitePrevu-ordreFabrication.quantiteDeclare)lt 0?0:(ordreFabrication.quantitePrevu-ordreFabrication.quantiteDeclare)}" disabled="true" readonly="true"  style="padding: 3px; background: #333; color: #FFF; width: 100px;text-align: right" converter="DNS"/>
                                                <h:inputText disabled="true" styleClass="input_dis" value="#{(ordreFabrication.nomenclature.unite.unite.id gt 0)?ordreFabrication.nomenclature.unite.unite.reference:'Aucune unité'}" 
                                                             style="color: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'#003399':'red'}; font-size: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'0.8em':'0.7em'}; width: 100px; text-align: center"/>

                                            </h:panelGroup>
                                            <span>Ecart.:</span>
                                            <h:panelGroup>
                                                <h:inputText value="#{ordreFabrication.quantitePrevu-ordreFabrication.quantitePrevu}" disabled="true"  style="padding: 3px; background: #333; color: #FFF; width: 100px;text-align: right" converter="DN"/>
                                                <h:inputText disabled="true" styleClass="input_dis" value="#{(ordreFabrication.nomenclature.unite.unite.id gt 0)?ordreFabrication.nomenclature.unite.unite.reference:'Aucune unité'}" 
                                                             style="color: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'#003399':'red'}; font-size: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'0.8em':'0.7em'}; width: 100px; text-align: center"/>

                                            </h:panelGroup>
                                        </h:panelGrid>
                                    </h:panelGroup>
                                </h:panelGrid>                                
                                <p:outputPanel layout="block" rendered="#{managedOrdresF.displayAll}">
                                    <div style="width: 50%; float: left">
                                        <div style="background: #CCC; width: 100%; height: 25px; padding: 5px; font-weight: bold">Propriétés de l'OF                                        
                                        </div>
                                        <h:panelGrid columns="2" styleClass="yvs_noStyle" cellpadding="0" cellspacing="0" id="prod_zone_ppte">
                                            <span>Nomenclature</span> 
                                            <h:panelGroup >
                                                <h:selectOneMenu value="#{ordreFabrication.nomenclature.id}" id="chp_nomenclature" valueChangeListener="#{managedOrdresF.selectNomenclature}" style="min-width: 140px"
                                                                 disabled="#{!(ordreFabrication.canEditable(managedOrdresF.autoriser('prod_update_of_encours')))}" tabindex="120">  
                                                    <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                                                    <f:selectItems value="#{ordreFabrication.articles.nomenclatures}" var="itemNom" itemValue="#{itemNom.id}" itemLabel="#{itemNom.reference}" />   
                                                    <p:ajax update="tablePhase_:table_composantOF input_qte_bis chp_liaison_qte input_qte" event="valueChange"/>
                                                </h:selectOneMenu>
                                                <p:selectBooleanCheckbox value="#{ordreFabrication.suiviOperations}"  itemLabel="Suivi des opérations requis" disabled="#{ordreFabrication.id gt 0}"  style="font-size: 0.9em">
                                                    <p:ajax event="valueChange" update="tablePhase_ prod_zone_ppte" global="false" />
                                                </p:selectBooleanCheckbox>
                                            </h:panelGroup>
                                            <span>Gamme</span>
                                            <h:panelGroup >
                                                <h:selectOneMenu value="#{ordreFabrication.gamme.id}" id="chp_gamme" valueChangeListener="#{managedOrdresF.selectGamme}" style="min-width: 140px" 
                                                                 disabled="#{!(ordreFabrication.canEditable(managedOrdresF.autoriser('prod_update_of_encours'))) or !ordreFabrication.suiviOperations}" tabindex="130">  
                                                    <f:selectItem itemValue="#{-1}" itemLabel="" noSelectionOption="true" />
                                                    <f:selectItems value="#{ordreFabrication.articles.gammes}" var="itemGam" itemValue="#{itemGam.id}" itemLabel="#{itemGam.codeRef}" />
                                                    <p:ajax update="tablePhase_:table_phase" event="valueChange"/>
                                                </h:selectOneMenu>  
                                                <p:selectBooleanCheckbox value="#{ordreFabrication.generateOfSousProduit}"  itemLabel="Générer OF produits Inter." disabled="#{ordreFabrication.id gt 0}" style="font-size: 0.9em"/>
                                            </h:panelGroup>
                                            <span style="float: right">Stock suivi par opération ? </span>
                                            <h:selectBooleanCheckbox value="#{ordreFabrication.suiviStockByOperation}" tabindex="140" disabled="#{!ordreFabrication.suiviOperations}">
                                                <p:ajax update="panel_state" global="false" event="valueChange"/>                                            
                                            </h:selectBooleanCheckbox>
                                            <span>Liaison quantitative  </span>
                                            <h:selectBooleanCheckbox id="chp_liaison_qte" value="#{ordreFabrication.nomenclature.qteLieAuxComposant}" tabindex="140" disabled="true"/>
                                        </h:panelGrid>
                                    </div>
                                    <div style="margin-left: 51%">
                                        <div style="background: #CCC; width: 100%; height: 25px; padding: 5px; font-weight: bold">
                                            Quantités de  l'OF
                                        </div>
                                        <h:panelGrid  id="input_qte" columns="3" styleClass="yvs_noStyle" style="width: 100%; clear: right" cellpadding="0" cellspacing="0">                                                                        
                                            <span>Quantité </span>
                                            <h:panelGroup>
                                                <pe:inputNumber value="#{ordreFabrication.quantitePrevu}"  style="width: 100px; text-align: center" disabled="#{!(ordreFabrication.canEditable(managedOrdresF.autoriser('prod_update_of_encours')))}" tabindex="110">
                                                    <p:ajax update="input_qte tablePhase_:table_composantOF zone_diplay_op" event="valueChange" listener="#{managedOrdresF.listenChangeValueQtePrevu()}"  />
                                                </pe:inputNumber> 
                                                <h:inputText disabled="true" styleClass="input_dis" value="#{(ordreFabrication.nomenclature.unite.unite.id gt 0)?ordreFabrication.nomenclature.unite.unite.reference:'Aucune unité'}" 
                                                             style="color: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'#003399':'red'}; font-size: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'0.8em':'0.7em'}; width: 100px; text-align: center" />
                                            </h:panelGroup>                                   
                                            <h:panelGrid columns="2">
                                                <span title="Quantité déjà réalisé">/ Quantité Déclaré :</span>
                                                <h:panelGroup>
                                                    <h:inputText value="#{ordreFabrication.quantiteDeclare}" disabled="true"  style="padding: 3px; background: #333; color: #FFF; width: 100px;text-align: right" converter="DN"/>                                        
                                                    <h:inputText disabled="true" styleClass="input_dis" value="#{(ordreFabrication.nomenclature.unite.unite.id gt 0)?ordreFabrication.nomenclature.unite.unite.reference:'Aucune unité'}" 
                                                                 style="color: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'#003399':'red'}; font-size: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'0.8em':'0.7em'}; width: 100px; text-align: center"/>

                                                </h:panelGroup>
                                                <span>Reste à déclarer:</span>
                                                <h:panelGroup>
                                                    <h:inputText value="#{(ordreFabrication.quantitePrevu-ordreFabrication.quantiteDeclare)lt 0?0:(ordreFabrication.quantitePrevu-ordreFabrication.quantiteDeclare)}" disabled="true" readonly="true"  style="padding: 3px; background: #333; color: #FFF; width: 100px;text-align: right" converter="DNS"/>
                                                    <h:inputText disabled="true" styleClass="input_dis" value="#{(ordreFabrication.nomenclature.unite.unite.id gt 0)?ordreFabrication.nomenclature.unite.unite.reference:'Aucune unité'}" 
                                                                 style="color: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'#003399':'red'}; font-size: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'0.8em':'0.7em'}; width: 100px; text-align: center"/>

                                                </h:panelGroup>
                                                <span>Ecart.:</span>
                                                <h:panelGroup>
                                                    <h:inputText value="#{ordreFabrication.quantitePrevu-ordreFabrication.quantitePrevu}" disabled="true"  style="padding: 3px; background: #333; color: #FFF; width: 100px;text-align: right" converter="DN"/>
                                                    <h:inputText disabled="true" styleClass="input_dis" value="#{(ordreFabrication.nomenclature.unite.unite.id gt 0)?ordreFabrication.nomenclature.unite.unite.reference:'Aucune unité'}" 
                                                                 style="color: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'#003399':'red'}; font-size: #{(ordreFabrication.nomenclature.unite.unite.id gt 0)?'0.8em':'0.7em'}; width: 100px; text-align: center"/>

                                                </h:panelGroup>
                                            </h:panelGrid>
                                        </h:panelGrid>
                                    </div>  
                                </p:outputPanel>
                            </p:outputPanel>  
                        </h:panelGrid>                   
                        <p:outputPanel style="width: 100%" id="zone_diplay_op">                            
                            <p:commandLink value="Voir le Résumé des flux de stocks" style="background: transparent; width: 100%; color: #000; border: none; font-size: 0.9em; display: block; background: #CCC; padding: 3px;text-align: center"
                                           actionListener="#{managedOrdresF.loadAllFluxComposant()}"/>                                
                            <div class="#{(ordreFabrication.listOperationsOf.size() gt 0 )?'wrap_zone_op':'t'}"  >
                                <ui:repeat value="#{ordreFabrication.listOperationsOf}" var="c_op" varStatus="i" rendered="#{(ordreFabrication.listOperationsOf.size() gt 0)}">
                                    <div class="care_op" style="width: #{98/ordreFabrication.listOperationsOf.size()}%; border: 2px double ##{c_op.indicateur ne null?c_op.indicateur.codeCouleur:'FFF'}" >
                                        <div style="width: 96.5%; float: left">
                                            <div class="header">
                                                <span class="num_op">#{c_op.numero}</span>
                                                <span class="titre_op" title="#{c_op.codeRef}">#{(c_op.codeRef.length() gt 8)?c_op.codeRef.substring(0,8).concat('...'):c_op.codeRef}</span>
                                                <h:panelGroup style="float: right;margin-top: 5px" id="btn_opt_op">
                                                    <p:commandLink value="En cours" styleClass="#{(c_op.statutOp==constantes.STATUT_DOC_ENCOUR)?'statut_valide':'etat_formation_true'}"   style="font-size: 0.8em"                                  
                                                                   process="@this"  actionListener="#{managedOrdresF.changeStatutOp(c_op, constantes.STATUT_DOC_ENCOUR, true)}"
                                                                   update=":formulaire_mainOrdreF:tablePhase_:table_phase :formulaire_mainOrdreF:tablePhase_:table_composantOF btn_op_flux0 btn_op_flux1 btn_opt_op"/>
                                                    <p:commandLink value="Terminé" styleClass="#{(c_op.statutOp==constantes.STATUT_DOC_TERMINE)?'statut_valide':'etat_formation_true'}"    style="font-size: 0.8em"
                                                                   process="@this"  actionListener="#{managedOrdresF.finishOperation(c_op,true)}" disabled="#{c_op.statutOp.equals(constantes.STATUT_DOC_ATTENTE)}"
                                                                   update=":formulaire_mainOrdreF:tablePhase_:table_phase :formulaire_mainOrdreF:tablePhase_:table_composantOF btn_op_flux0 btn_op_flux1 btn_opt_op"/>
                                                </h:panelGroup>
                                            </div>
                                            <h:panelGrid columns="2" styleClass="yvs_table" style="width: 100%;font-size: 0.9em" cellpadding="0" cellspacing="0">
                                                <f:facet name="header">
                                                    <div style="background: ##{c_op.indicateur ne null?c_op.indicateur.codeCouleur:'FFF'}; width: 100%">
                                                        Evolution
                                                        <h:outputText value="#{(c_op.indicateur ne null)?(100*c_op.indicateur.composant.quantiteFlux/c_op.indicateur.composant.quantite):'0'}" converter="DNS" rendered="false"/>
                                                        <h:outputText value="#{(c_op.indicateur ne null)?c_op.indicateur.giveTauxEvolution():'0'}" converter="DNS"/>
                                                        <span> %</span>
                                                        <h:outputText value=" + (" rendered="#{c_op.indicateur.giveTauxEvolutionSup() gt 0}"/>
                                                        <h:outputText value="#{(c_op.indicateur ne null)?c_op.indicateur.giveTauxEvolutionSup():'0'}" converter="DNS" rendered="#{c_op.indicateur.giveTauxEvolutionSup() gt 0}"/>
                                                        <h:outputText value=" )%" rendered="#{c_op.indicateur.giveTauxEvolutionSup() gt 0}"/>
                                                    </div>
                                                </f:facet>
                                                <span>Début :</span>
                                                <h:panelGroup>
                                                    <h:outputText value="#{c_op.dateDebut}" converter="DATE"/>
                                                    &nbsp;
                                                    <h:outputText value="#{c_op.heureDebut}" converter="TIME"/>
                                                </h:panelGroup>
                                                <span>Fin :</span>
                                                <h:panelGroup>
                                                    <h:outputText value="#{c_op.dateFin}" converter="DATE"/> 
                                                    &nbsp;
                                                    <h:outputText value="#{c_op.heureFin}" converter="TIME"/>
                                                </h:panelGroup>
                                                <f:facet name="footer">
                                                    <span>Durée Opération :</span>
                                                    <h:outputText value="#{c_op.tempsOperation}" converter="DNS" />
                                                    <span style="font-style: italic"> #{c_op.ordreFabrication.gamme.uniteTemps.reference}</span>
                                                    <span style="float: right">#{c_op.composants.size()}</span>
                                                </f:facet>
                                            </h:panelGrid>
                                            <p:commandButton id="btn_op_flux0" icon="ui-icon-newwin" value="Propriétés..." oncomplete="dlgProprieteOp.show()"  actionListener="#{managedOrdresF.openPropertiesOperation(c_op)}"  update=":formulaire_propriete_phase :formulaire_mainOrdreF:tablePhase_:table_phase"
                                                             disabled="#{ordreFabrication.id le 0}"/>
                                            <p:commandButton id="btn_op_flux1" icon="ui-icon-signal-diag" value="Flux de stocks" oncomplete="dlgEditFlux.show()"  actionListener="#{managedOrdresF.openFluxComposantOperation(c_op)}" style="float: right" update=":formulaire_update_edit_flux:header_detail_edit_flux :formulaire_update_edit_flux:zone_gear_operation" 
                                                             disabled="#{ordreFabrication.id le 0 or (c_op.statutOp ne constantes.STATUT_DOC_ENCOUR)}"/>
                                        </div>
                                        <div style="margin-left: 97%; background: #90bff5; vertical-align: middle; height: 100%; display: #{(i.index+1) lt ordreFabrication.listOperationsOf.size()?'block':'none'}">&rArr;</div>
                                    </div>
                                </ui:repeat>
                            </div>
                        </p:outputPanel>
                        <p:tabView style="width: 100%; overflow-x: auto" id="tablePhase_">
                            <p:tab title="Compositions">
                                <div align="right" style="float: right;margin-top: -20px">
                                    <p:commandButton icon="ui-icon-circle-plus"  title="Ajouter un nouveau composant" oncomplete="dlgProprieteComposant.show()"   
                                                     actionListener="#{managedOrdresF.resetComposant()}" update=":formulaire_mainOrdreF:tablePhase_:table_composantOF :formulaire_propriete_composant:headPPtC" disabled="#{!ordreFabrication.canEditable(managedOrdresF.autoriser('prod_update_of_encours'))}"/>
                                </div>
                                <p:dataTable id="table_composantOF" value="#{ordreFabrication.listComposantOf}" var="itemComposant" rowIndexVar="lineC"
                                             selectionMode="single" rowKey="#{itemComposant.id}" selection="#{managedOrdresF.selectedComposant}"
                                             editMode="cell" editable="true">
                                    <p:ajax event="cellEdit" listener="#{managedOrdresF.onEditQuantiteValide}"  update=":formulaire_mainOrdreF:tablePhase_:table_composantOF"/>
                                    <p:column  width="300" headerText="Composant" >                                        
                                        <h:outputText value="[#{itemComposant.article.refArt}]"  title="#{itemComposant.commentaire}" style="font-weight: bold"/>
                                        <h:outputText value=" #{itemComposant.article.designation}"  title="#{itemComposant.commentaire}"/>                                        
                                    </p:column>
                                    <p:column width="15" headerText="Unités" style="text-align: center">
                                        <h:outputText styleClass="style_unite" value="#{itemComposant.unite.unite.reference}" title="#{itemComposant.unite.unite.libelle}" />
                                    </p:column>
                                    <p:column width="100" headerText="Stock " style="text-align: right" >  
                                        <h:panelGroup rendered="#{itemComposant.article.suiviEnStock}">
                                            <h:outputText value="#{managedOrdresF.giveStockMp(itemComposant)}" converter="#{managedOrdresF.cproduction}"/>       
                                        </h:panelGroup>
                                        <h:outputText value="Non suivi" style="color: red;font-size: 0.8em; font-style: italic" rendered="#{!itemComposant.article.suiviEnStock}"/>
                                    </p:column>
                                    <p:column width="100" headerText="Quantité Prévue" style="text-align: right">
                                        <h:outputText value="#{itemComposant.quantitePrevu}" style="color: #{((itemComposant.stock lt itemComposant.quantitePrevu) and (itemComposant.type eq constantes.PROD_OP_TYPE_COMPOSANT_NORMAL))?'red':'blue'}" converter="DNS"/>                                                                                                     
                                    </p:column>
                                    <p:column width="100" style="text-align: right; color: #003333" >  
                                        <f:facet name="header"><span title="Quantité Réel entrée">Qté R Entrée</span></f:facet>
                                        <h:outputText value="#{managedOrdresF.findQteReelComposantOf(itemComposant, true)}" converter="#{managedOrdresF.cproduction}" title="Quantité déjà utilisé"/>           
                                    </p:column>  
                                    <p:column width="100" style="text-align: right; color: #790000" >     
                                        <f:facet name="header"><span title="Quantité Réel sortie">Qté R Sortie</span></f:facet>
                                        <h:outputText value="#{managedOrdresF.findQteReelComposantOf(itemComposant, false)}" converter="#{managedOrdresF.cproduction}" title="Quantité déjà utilisé"/>           
                                    </p:column>  
                                    <p:column headerText="Coefficient"  width="80" style="text-align: right" >     
                                        <p:cellEditor >
                                            <f:facet name="output">
                                                <h:outputText value="#{itemComposant.coefficient}" converter="DNS" title="Quantité déjà utilisé"/>           
                                            </f:facet>
                                            <f:facet name="input">
                                                <h:inputText value="#{itemComposant.coefficient}" disabled="#{ordreFabrication.suiviStockByOperation}"/>
                                            </f:facet>
                                        </p:cellEditor>                                                                             
                                    </p:column>  
                                    <p:column headerText="Ecart" width="100" style="text-align: right">
                                        <h:outputText value="#{(itemComposant.quantitePrevu-itemComposant.quantiteValide)}" style="color: #{(itemComposant.quantitePrevu lt itemComposant.quantiteValide)?'red':'blue'}" converter="#{managedOrdresF.cproduction}"/>                                                          
                                    </p:column>   
                                    <p:column headerText="Coût U." width="100" style="text-align: right">                                                             
                                        <h:outputText value="#{itemComposant.coutComposant}" converter="DNS"/>    
                                    </p:column>      
                                    <p:column  width="100" headerText="Lot" >
                                        <h:outputText value="#{itemComposant.lotSortie.numero}"  />                                           
                                    </p:column>                       
                                    <p:column width="30" headerText="" style="text-align: center">
                                        <p:contextMenu for="btn_opt_comp_of" event="left click">
                                            <p:menuitem value="Générer OF" icon="i-icon-extlink" oncomplete="dlgGenererOF.show()" actionListener="#{managedOrdresF.openInfosPFSousProduit(itemComposant)}"
                                                        update=":main_of_sous_produit" disabled="#{itemComposant.id lt 1}" rendered="#{itemComposant.article.categorie eq constantes.CAT_PSF or itemComposant.article.categorie eq constantes.CAT_PF}"/>
                                            <p:menuitem value="Propriétés" icon="ui-icon-gear" oncomplete="dlgProprieteComposant.show()" actionListener="#{managedOrdresF.openOneComposantToUpdate(itemComposant)}"
                                                        update=":formulaire_mainOrdreF:tablePhase_:table_composantOF :formulaire_propriete_composant:headPPtC" disabled="#{itemComposant.id lt 1}"/>
                                            <p:separator />
                                            <p:menuitem value="Supprimer" icon="ui-icon-trash" global="false" actionListener="#{managedOrdresF.setSelectedComposant(itemComposant)}" oncomplete="dlgConfirmDeleteComposant.show()"/>
                                        </p:contextMenu>
                                        <p:commandButton id="btn_opt_comp_of" type="button" icon="ui-icon-gear" style="width: 22px; height: 22px" />
                                    </p:column> 
                                </p:dataTable>
                            </p:tab>
                            <p:tab title="Opérations" >  
                                <div align="right" style="float: right;margin-top: -20px">
                                    <p:commandButton icon="ui-icon-circle-plus"  title="Ajouter une nouvelle opération" oncomplete="dlgProprieteOp.show()"   
                                                     actionListener="#{managedOrdresF.resetOperation()}" update=":formulaire_propriete_phase table_phase"/>
                                </div>
                                <p:dataTable value="#{ordreFabrication.listOperationsOf}" id="table_phase" editable="true" editMode="cell"
                                             var="itemOp" rowKey="#{itemOp.id}" selectionMode="single" selection="#{managedOrdresF.selectedOp}">
                                    <p:ajax event="rowEdit" listener="#{managedOrdresF.changeLineOperation}" />
                                    <p:column headerText="Id" styleClass="statut_#{itemOp.statutOp}">
                                        #{itemOp.id}
                                    </p:column>
                                    <p:column headerText="Numero" style="text-align: center" styleClass="statut_#{itemOp.statutOp}">
                                        #{itemOp.numero}
                                    </p:column>
                                    <p:column headerText="Reference" styleClass="statut_#{itemOp.statutOp}">
                                        #{itemOp.codeRef}                                        
                                    </p:column>
                                    <p:column headerText="Date Lancement" styleClass="statut_#{itemOp.statutOp}" style="text-align: center">
                                        <h:outputText value="#{itemOp.dateDebut}" converter="DATE"/>
                                        <span> - </span>
                                        <h:outputText value="#{itemOp.heureDebut}" converter="TIME"/>
                                    </p:column>
                                    <p:column headerText="Date Fin" styleClass="statut_#{itemOp.statutOp}" style="text-align: center">
                                        <h:outputText value="#{itemOp.dateFin}" converter="DATE"/>
                                        <span> - </span>
                                        <h:outputText value="#{itemOp.heureFin}" converter="TIME"/>
                                    </p:column>  
                                    <p:column headerText="Machine" styleClass="statut_#{itemOp.statutOp}">
                                        <span title="#{itemOp.machine.designation}">#{itemOp.machine.reference}</span>
                                    </p:column>
                                    <p:column headerText="Main d'Oeuvre" styleClass="statut_#{itemOp.statutOp}">
                                        <span title="#{itemOp.mainOeuvre.designation}">#{itemOp.mainOeuvre.reference}</span>
                                    </p:column>
                                    <p:column headerText="Temps Opération" styleClass="statut_#{itemOp.statutOp}" style="text-align: right">
                                        <h:outputText value="#{itemOp.tempsOperation}" converter="DNS" />
                                        <span style="font-style: italic"> #{ordreFabrication.gamme.uniteTemps.reference}</span>
                                    </p:column>          
                                    <p:column headerText="Temps Reglage" styleClass="statut_#{itemOp.statutOp}" style="text-align: right">
                                        <h:outputText value="#{itemOp.tempsReglage}" converter="DNS" />
                                        <span style="font-style: italic"> #{ordreFabrication.gamme.uniteTemps.reference}</span>
                                    </p:column>                        
                                    <p:column headerText="" style="text-align: center">
                                        <p:contextMenu for="btn_opt_op_of" event="left click">
                                            <p:menuitem value="Propriétés" icon="ui-icon-gear" oncomplete="dlgProprieteOp.show()"  actionListener="#{managedOrdresF.openPropertiesOperation(itemOp)}" disabled="#{itemOp.id lt 1}"
                                                        update=":formulaire_propriete_phase table_phase"/>
                                            <p:separator />
                                            <p:menuitem value="Supprimer" icon="ui-icon-trash" global="false" actionListener="#{managedOrdresF.setSelectedOp(itemOp)}" oncomplete="dlgConfirmDeleteOperation.show()"/>
                                        </p:contextMenu>
                                        <p:commandButton id="btn_opt_op_of" type="button" icon="ui-icon-gear" style="width: 22px; height: 22px" />
                                    </p:column>
                                </p:dataTable>                                    
                            </p:tab>                            
                            <p:tab title="Flux Composants" disabled="#{!ordreFabrication.suiviOperations}">
                                <div align="right" style="float: right;margin-top: -20px">
                                    <p:commandButton icon="ui-icon-refresh" value="Actualise" actionListener="#{managedOrdresF.displayFluxComposant()}" update="table_op_use_mp_" />
                                </div>
                                <p:dataTable  value="#{managedOrdresF.listeComposants}" var="i_flux" id="table_op_use_mp_" editMode="cell" editable="true" rowKey="#{i_flux.id}">                    
                                    <p:columnGroup type="header">
                                        <p:row>
                                            <p:column headerText="Opérations" style="width: 15%"/>
                                            <c:forEach items="#{managedOrdresF.colonnes}" var="head" varStatus="_head">
                                                <p:column headerText="#{head}" />
                                            </c:forEach>
                                        </p:row>
                                    </p:columnGroup>
                                    <p:column styleClass="ui-widget-header">                        
                                        <span style="font-weight: bold">#{i_flux.article.designation}</span>
                                    </p:column>                                        
                                    <p:columns width="100" value="#{i_flux.composantsUsed}" var="icol" columnIndexVar="i" style="text-align: right">                        
                                        <p:cellEditor>
                                            <f:facet name="output">
                                                <h:outputText value="#{i_flux.composantsUsed.get(i).quantite}" converter="DNS"/>
                                                <h:outputText styleClass="style_unite" value="#{i_flux.unite.unite.reference}" />
                                            </f:facet>
                                            <f:facet name="input">
                                                <h:inputText  value="#{i_flux.quantitePrevu}" style="width:70%"/>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:columns>                                        
                                </p:dataTable>
                            </p:tab>
                            <p:tab title="Déclarations" rendered="#{ordreFabrication.id gt 0 and ordreFabrication.declarations.size() gt 0}">
                                <p:dataTable id="data_declaration" value="#{ordreFabrication.declarations}" var="decl" rowIndexVar="dLIne" rowKey="#{decl.id}" selectionMode="single">
                                    <p:ajax event="rowSelect" listener="#{managedOrdresF.loadOnView}" update=":main_form_declaration:blog_declaration"
                                            oncomplete="dlgDeclaration.show()"/>
                                    <p:column headerText="N°" style="width: 5%" styleClass="statut_#{decl.statut}">
                                        <span>#{dLIne+1}</span>
                                    </p:column>
                                    <p:column headerText="Id" style="width: 5%" styleClass="statut_#{decl.statut}">
                                        <span>#{decl.id}</span>
                                    </p:column>
                                    <p:column headerText="Date Déclaration" styleClass="statut_#{decl.statut}" width="150">
                                        <h:outputText value="#{decl.dateDeclaration}" converter="DATE"/>        
                                    </p:column>
                                    <p:column headerText="Dépôt" styleClass="statut_#{decl.statut}">
                                        <span>#{decl.depot.designation}</span>          
                                    </p:column>
                                    <p:column headerText="Quantitée" styleClass="statut_#{decl.statut}" width="100">
                                        <h:outputText value="#{decl.quantite}" converter="DNS"/>
                                        <span title="#{decl.conditionnement.unite.libelle}" style="font-size: 0.8em;color: #003399">#{decl.conditionnement.unite.reference}</span>
                                    </p:column>
                                    <p:column headerText="Coût U." styleClass="statut_#{decl.statut}" width="100" style="text-align: right">
                                        <h:outputText value="#{decl.coutProduction}" converter="DNS" title="Côut unitaire de production"/>
                                    </p:column>
                                    <p:column width="25" style="text-align: center" styleClass="statut_#{decl.statut}">
                                        <p:contextMenu for="btn_option_tableOF" event="left click" style="font-size: 0.8em">
                                            <p:menuitem value="#{(decl.statut eq constantes.ETAT_VALIDE)?'Annuler':'Valider'}" icon="#{(decl.statut eq constantes.ETAT_VALIDE)?'ui-icon-circle-close':'ui-icon-circle-check'}" 
                                                        global="false" actionListener="#{managedOrdresF.changeStatutDeclaration(decl)}" 
                                                        update=":main_declaration:data_fiche_conditionnement :formulaire_mainOrdreF:tableOF data_declaration :formulaire_mainOrdreF:zone_state_declare_prod :formulaire_mainOrdreF:input_qte_bis :formulaire_mainOrdreF:input_qte"/>
                                            <p:separator />
                                            <p:menuitem value="Conditionner" icon="ui-icon-suitcase" global="false"  actionListener="#{managedOrdresF.beginConditionner(decl)}" 
                                                        update=":main_declaration:form_conditionnement :main_declaration:data_fiche_conditionnement"/>
                                            <p:menuitem value="Transférer" icon="ui-icon-circle-arrow-e" actionListener="#{managedOrdresF.openViewToConfirmTransfert(decl)}"/>
                                            <p:separator />
                                            <p:menuitem value="Supprimer" icon="ui-icon-trash" actionListener="#{managedOrdresF.openToConfirmDelete(decl)}"/>
                                        </p:contextMenu>   
                                        <p:commandButton icon="ui-icon-gear" type="button" id="btn_option_tableOF" style="width: 22px; height: 22px" />
                                    </p:column>
                                </p:dataTable>
                            </p:tab>
                        </p:tabView>
                    </div>
                    <div class="yvs_list_of">
                        <p:dataTable value="#{managedOrdresF.listeOrdreF}" var="itemOF" rowIndexVar="line"
                                     rowKey="#{itemOF.id}" selectionMode="single"  id="tableOF" style="width: 100%; overflow-x: auto; ">
                            <p:ajax event="rowSelect"  listener="#{managedOrdresF.openOfToupdate}" oncomplete="collapseForm('of');"
                                    update=":formulaire_mainOrdreF:of_depot :formulaire_mainOrdreF:formOF :formulaire_mainOrdreF:panel_state :formulaire_mainOrdreF:tablePhase_
                                    :formulaire_mainOrdreF:zone_diplay_op"/>
                            <p:column headerText="N°" width="25" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{itemOF.id eq ordreFabrication.id}"/>
                                #{line+1}
                            </p:column>
                            <p:column  width="150" headerText="Référence" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:outputText value="#{itemOF.codeRef}"  />
                                <h:graphicImage library="icones" name="drapeau.png" width="15" height="15" style="float: right" rendered="#{itemOF.statutDeclaration ne constantes.ETAT_TERMINE}"
                                                title="Déclaration de l'OF non encore atteint"/>
                            </p:column>
                            <p:column width="250" headerText="Article" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:outputText value="[#{itemOF.article.refArt}]" style="font-weight: bold"/>
                                <h:outputText value=" #{itemOF.article.designation}" /> 
                            </p:column>
                            <p:column  headerText="Quantité" width="90" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:outputText value="#{itemOF.quantite}" converter="#{managedOrdresF.cproduction}" />
                            </p:column>
                            <p:column width="120" headerText="Nomenclature" styleClass="statut_#{itemOF.statutOrdre}">                                                             
                                <h:outputText value="#{itemOF.nomenclature.reference}"/>
                            </p:column>
                            <p:column width="150" headerText="Gamme" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:outputText value="#{itemOF.gamme.codeRef}" />
                            </p:column>                                                                                
                            <p:column width="200" headerText="Lancement" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:outputText value="#{itemOF.dateDebut}" converter="DDMMYYYY" /> Au
                                <h:outputText value="#{itemOF.finValidite}" converter="DDMMYYYY" />
                            </p:column>
                            <p:column width="40" headerText="Statut" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:outputText value="#{itemOF.statutOrdre}" />
                            </p:column>
                            <p:column width="40" headerText="Evolution" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre}">
                                <h:outputText value="#{itemOF.tauxEvolution}" converter="DNS"/> %
                            </p:column>
                            <p:column width="25" style="text-align: center" styleClass="statut_#{itemOF.statutOrdre}">
                                <p:contextMenu for="btn_option_tableOF" event="left click" style="font-size: 0.8em">
                                    <p:menuitem value="Résumé" icon="ui-icon-transferthick-e-w" actionListener="#{managedOrdresF.loadAllFluxComposant()}" />
                                    <p:menuitem value="Mise en rebut" icon="ui-icon-transferthick-e-w"  />
                                    <p:menuitem value="Annuler " icon="ui-icon-circle-close" rendered="false"/>
                                    <p:separator  />
                                    <p:menuitem value="Supprimer" icon="ui-icon-trash" global="false" actionListener="#{managedOrdresF.setSelectedOf(itemOF)}" oncomplete="dlgConfirmDelete.show()"/>
                                </p:contextMenu>   
                                <p:commandButton icon="ui-icon-gear" type="button" id="btn_option_tableOF" style="width: 22px; height: 22px" />
                            </p:column>
                            <p:column width="25" >
                                <f:facet name="header">
                                    <h:selectBooleanCheckbox class="chek_all_line_of" onclick="selectionAllLineTab(#{managedOrdresF.listeOrdreF.size()}, 'of')" value="false" />
                                </f:facet>
                                <h:selectBooleanCheckbox class="chek_line_of" value="false" onclick="selectionLineTab(#{line}, 'of')"/>
                            </p:column>
                        </p:dataTable>  
                        <span style="margin-left: 35%; font-size: .8em; font-style: italic; color: #828c95" class="nbSelectof"></span>
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                            <p:commandButton actionListener="#{managedOrdresF.avance(false)}" update="tableOF" icon="ui-icon-circle-triangle-w" disabled="#{managedOrdresF.paginator.disPrev}"/>
                            <p:outputPanel >
                                <p:inplace label="#{managedOrdresF.paginator.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                    <pe:inputNumber value="#{managedOrdresF.paginator.page}" style="width: 30px;text-align: center" decimalPlaces="0">
                                        <p:ajax event="valueChange" listener="#{managedOrdresF.gotoPagePaginator()}" update="tableOF"/>
                                    </pe:inputNumber>
                                </p:inplace><p:outputLabel value="/#{managedOrdresF.paginator.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                            </p:outputPanel>
                            <p:commandButton actionListener="#{managedOrdresF.avance(true)}" update="tableOF" icon="ui-icon-circle-triangle-e" disabled="#{managedOrdresF.paginator.disNext}"/>
                            <p:selectOneMenu value="#{managedOrdresF.imax}" label="Nombre max Résultat" 
                                             valueChangeListener="#{managedOrdresF.choosePaginator}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                                <f:selectItems value="#{managedOrdresF.paginations}"/>
                                <p:ajax event="valueChange" update="tableOF"/>
                            </p:selectOneMenu>
                        </p:outputPanel> 
                    </div>                            
                    <div class="yvs_grid_of">
                        <p:dataTable value="#{managedOrdresF.declarations}" var="decls" rowIndexVar="line"
                                     rowKey="#{decls.id}" selectionMode="single"  id="data-declaration_of" style="width: 100%; overflow-x: auto; ">
                            <p:ajax event="rowSelect"  listener="#{managedOrdresF.loadOnViewDeclaration}" oncomplete="collapseForm('of');"
                                    update=":formulaire_mainOrdreF:of_depot :formulaire_mainOrdreF:formOF :formulaire_mainOrdreF:panel_state :formulaire_mainOrdreF:tablePhase_
                                    :formulaire_mainOrdreF:zone_diplay_op"/>
                            <p:column headerText="N°" width="25" styleClass="statut_#{decls.statut}">
                                <h:graphicImage library="img" name="pointe.png" width="17" height="15" rendered="#{decls.ordre.id eq ordreFabrication.id}"/>
                                #{line+1}
                            </p:column> 
                            <p:column headerText="Référence" styleClass="statut_#{decls.statut}">
                                <h:outputText value="#{decls.ordre.codeRef}"  />
                                <h:graphicImage library="icones" name="drapeau.png" width="15" height="15" style="float: right" rendered="#{decls.ordre.statutDeclaration ne constantes.ETAT_TERMINE}"/>
                            </p:column>                                                                             
                            <p:column width="100" headerText="Date" style="text-align: center" styleClass="statut_#{decls.statut}">
                                <h:outputText value="#{decls.dateDeclaration}" converter="DDMMYYYY" />
                            </p:column>
                            <p:column headerText="Article" styleClass="statut_#{decls.statut}">
                                <h:outputText value="[#{decls.conditionnement.article.refArt}]" style="font-weight: bold"/>
                                <h:outputText value=" #{decls.conditionnement.article.designation}" /> 
                            </p:column>
                            <p:column  headerText="Quantité" width="100" style="text-align: right" styleClass="statut_#{decls.statut}">
                                <h:outputText value="#{decls.quantite}" converter="#{managedOrdresF.cproduction}" />
                                <span title="#{decls.conditionnement.unite.libelle}" style="font-size: 0.6em;color: #003399">#{decls.conditionnement.unite.reference}</span>
                            </p:column>
                            <p:column width="100" headerText="Depot" styleClass="statut_#{decls.statut}">                                                             
                                <h:outputText value="#{decls.depot.designation}"/>
                            </p:column>
                            <p:column width="100" headerText="Tranche" styleClass="statut_#{decls.statut}">
                                <h:outputText value="#{decls.tranche.titre}" />
                            </p:column>  
                            <p:column width="100" headerText="Equipe" style="text-align: center" styleClass="statut_#{decls.statut}">
                                <h:outputText value="#{decls.equipe.reference}" />
                            </p:column>
                        </p:dataTable>  
                        <p:outputPanel autoUpdate="true" style="float: right" layout="block">
                            <p:commandButton actionListener="#{managedOrdresF.loadDeclaration(false, false)}" update="tableOF" icon="ui-icon-circle-triangle-w" disabled="#{managedOrdresF.p_declaration.disPrev}"/>
                            <p:outputPanel >
                                <p:inplace label="#{managedOrdresF.p_declaration.currentPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold">
                                    <pe:inputNumber value="#{managedOrdresF.p_declaration.page}" style="width: 30px;text-align: center" decimalPlaces="0">
                                        <p:ajax event="valueChange" listener="#{managedOrdresF.gotoPagePaginatorDeclaration()}" update="tableOF"/>
                                    </pe:inputNumber>
                                </p:inplace><p:outputLabel value="/#{managedOrdresF.p_declaration.nbPage}" style="margin-top: 15px; font-size: 0.8em; font-weight: bold" />
                            </p:outputPanel>
                            <p:commandButton actionListener="#{managedOrdresF.loadDeclaration(true, false)}" update="tableOF" icon="ui-icon-circle-triangle-e" disabled="#{managedOrdresF.p_declaration.disNext}"/>
                            <p:selectOneMenu value="#{managedOrdresF.p_declaration.rows}" label="Nombre max Résultat" 
                                             valueChangeListener="#{managedOrdresF.choosePaginatorDeclaration}" style="float: right; font-size: 0.9em;margin-top: 3px;min-width: 50px" >
                                <f:selectItems value="#{managedOrdresF.paginations}"/>
                                <p:ajax event="valueChange" global="false" update="tableOF"/>
                            </p:selectOneMenu>
                        </p:outputPanel> 
                    </div>                            
                </div>
            </h:form>
        </div>
    </ui:define>
    <ui:define name="zone_search">
        <script type="text/javascript">
            $(document).ready(function() {
                slideZoneSearche();
            });
        </script>
        <h:form prependId="false" style="background: #CCC">            
            <h:graphicImage library="img"  name="pointe_.png" style="border: none; position: relative; bottom: -20px" width="20" height="20"
                            styleClass="img_slide" title="cacher"/>  
            <div class="zone_find">
                <div class="yvs_form_of display_auteur" align="right"  style="font-style: italic;">
                    <p:outputPanel autoUpdate="true">
                        <span style="float: left">Enregistré le <h:outputText value="#{managedOrdresF.selectedOf.dateSave}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span> 
                        <span>Modifié le <h:outputText value="#{managedOrdresF.selectedOf.dateUpdate}" styleClass="valeur" converter="DTL" style="font-weight: bold"/></span>
                        <span>Par <h:outputText value="#{managedOrdresF.selectedOf.author.users.nomUsers}"  styleClass="valeur" style="font-weight: bold"/></span>
                    </p:outputPanel>
                </div>
                <div id="zone_search_of">
                    <h:panelGrid id="blog_search_fv" columns="2" style="width: 100%; font-size: 0.8em" cellpadding="0" cellspacing="0">
                        <h:panelGrid columns="6" style="float: left; font-size: 1.0em" cellpadding="0" cellspacing="0">
                            <h:outputText value="" />
                            <h:panelGroup>
                                <h:selectBooleanCheckbox value="#{managedOrdresF.date_}" valueChangeListener="#{managedOrdresF._chooseDateSearch}" style="float: left;margin-left: 5px">
                                    <p:ajax event="valueChange" oncomplete="collapseList('of')" update="blog_date_search_entete_facture_vente"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Date" />
                            </h:panelGroup>
                            <h:outputText value="Site" />
                            <h:outputText value="Article" />
                            <h:panelGroup>
                                <h:outputText value="Etat OF" style="float:left;margin-top: 2px"/>
                                <h:selectOneMenu value="#{managedOrdresF.egaliteStatutOf}" style="float:right;margin-right: 5px;">
                                    <f:selectItem itemLabel="égale" itemValue="IN"/>
                                    <f:selectItem itemLabel="différent" itemValue="NOT IN"/>
                                    <p:ajax event="valueChange" listener="#{managedOrdresF.searchByStatutOF()}" oncomplete="collapseList('of')"/>
                                </h:selectOneMenu>  
                            </h:panelGroup>
                            <h:panelGroup>                                
                                <h:outputText value="Statut Déclaration" style="float:left;margin-top: 2px"/>
                                <h:selectOneMenu value="#{managedOrdresF.egaliteStatutDec}" style="float:right;margin-right: 5px;">
                                    <f:selectItem itemLabel="égale" itemValue="="/>
                                    <f:selectItem itemLabel="différent" itemValue="!="/>
                                    <p:ajax event="valueChange" listener="#{managedOrdresF.searchByStatutDec()}" oncomplete="collapseList('of')"/>
                                </h:selectOneMenu>  
                            </h:panelGroup>
                            <p:commandButton icon="ui-icon-bullet" actionListener="#{managedOrdresF.clearParams()}" title="Reinitialiser les paramètres" style="width: 20px; height: 22px" 
                                             />
                            <h:panelGroup id="blog_date_search_entete_facture_vente">
                                <p:calendar value="#{managedOrdresF.dateDebut}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedOrdresF.date_}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect"  listener="#{managedOrdresF.addParamDate1}" oncomplete="collapseList('of')"/>
                                    <p:ajax event="valueChange"  listener="#{managedOrdresF.addParamDate2()}" oncomplete="collapseList('of')"/>
                                </p:calendar>
                                <p:spacer width="5px" style="background: black"/>
                                <p:calendar value="#{managedOrdresF.dateFin}" navigator="true" pattern="dd-MM-yyyy" disabled="#{!managedOrdresF.date_}" size="10" style="font-size: 0.8em">
                                    <p:ajax event="dateSelect" listener="#{managedOrdresF.addParamDate1}" oncomplete="collapseList('of')"/>
                                    <p:ajax event="valueChange" listener="#{managedOrdresF.addParamDate2()}" oncomplete="collapseList('of')"/>
                                </p:calendar>
                            </h:panelGroup>
                            <h:selectOneMenu value="#{managedOrdresF.siteSearch}" style="min-width: 160px">
                                <f:selectItem itemValue="0" itemLabel="" />
                                <f:selectItems value="#{managedSiteProduction.sites}" var="isS" itemValue="#{isS.id}" itemLabel="#{isS.designation}" />    
                                <p:ajax event="valueChange" listener="#{managedOrdresF.addParamSite()}" oncomplete="collapseList('of')"/>                                
                            </h:selectOneMenu>
                            <h:inputText value="#{managedOrdresF.article_}" style="min-width: 120px">
                                <p:ajax event="valueChange" listener="#{managedOrdresF.addParamArticle()}" oncomplete="collapseList('of')"/>
                            </h:inputText>                                                        
                            <h:selectOneMenu value="#{managedOrdresF.statutOf}"  valueChangeListener="#{managedOrdresF.addParamStatuOf}" style="min-width: 120px">
                                <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                                <f:selectItem itemLabel="LANCE" itemValue="#{constantes.ETAT_PROD_LANCE}"/>
                                <f:selectItem itemLabel="EN ATTENTE" itemValue="#{constantes.ETAT_ATTENTE}"/>
                                <f:selectItem itemLabel="EN COURS" itemValue="#{constantes.ETAT_ENCOURS}"/>
                                <f:selectItem itemLabel="TERMINE" itemValue="#{constantes.ETAT_TERMINE}"/>
                                <f:selectItem itemLabel="CLOTURE" itemValue="#{constantes.ETAT_CLOTURE}"/>
                                <f:selectItem itemLabel="SUSPENDU" itemValue="#{constantes.ETAT_SUSPENDU}"/>
                                <p:ajax event="valueChange" oncomplete="collapseList('of')"/>
                            </h:selectOneMenu>                            
                            <h:selectOneMenu value="#{managedOrdresF.statutDec}"  valueChangeListener="#{managedOrdresF.addParamStatuDeclaration}" style="min-width: 120px">
                                <f:selectItem itemLabel="TOUT" itemValue="#{null}"/>
                                <f:selectItem itemLabel="EN ATTENTE" itemValue="#{constantes.ETAT_ATTENTE}"/>
                                <f:selectItem itemLabel="EN COURS" itemValue="#{constantes.ETAT_ENCOURS}"/>
                                <f:selectItem itemLabel="TERMINE" itemValue="#{constantes.ETAT_TERMINE}"/>
                                <p:ajax event="valueChange" oncomplete="collapseList('of')"/>
                            </h:selectOneMenu>
                        </h:panelGrid>
                    </h:panelGrid>
                </div>      
                <div id="zone_find_of">
                    <h:panelGrid id="blog_fin_fv" columns="6" style="font-size: 0.8em" cellpadding="0" cellspacing="0">
                        <h:panelGroup>
                            <h:selectBooleanCheckbox value="#{managedOrdresF.addDateDSearch}">
                                <p:ajax event="valueChange" listener="#{managedOrdresF.addParamDateDeclaration()}" oncomplete="collapseGrid('of')" update="blog-date_search_declaration_of"/>
                            </h:selectBooleanCheckbox>
                            <h:outputText value="Dates"/>
                        </h:panelGroup>
                        <h:outputText value="Depot"/>
                        <h:outputText value="Tranche"/>
                        <h:outputText value="Equipe"/>
                        <h:outputText value="Article"/>
                        <h:outputText value="Reference"/>
                        <h:panelGroup id="blog-date_search_declaration_of">
                            <p:calendar value="#{managedOrdresF.dateDebutDSearch}" size="10" pattern="dd-MM-yyyy" disabled="#{!managedOrdresF.addDateDSearch}">
                                <p:ajax event="dateSelect" listener="#{managedOrdresF.addParamDateDeclaration()}" oncomplete="collapseGrid('of')"/>
                            </p:calendar>
                            <p:calendar value="#{managedOrdresF.dateFinDSearch}" size="10" pattern="dd-MM-yyyy" disabled="#{!managedOrdresF.addDateDSearch}">
                                <p:ajax event="dateSelect" listener="#{managedOrdresF.addParamDateDeclaration()}" oncomplete="collapseGrid('of')"/>
                            </p:calendar>
                        </h:panelGroup>
                        <h:selectOneMenu value="#{managedOrdresF.depotDSearch}" style="min-width: 200px">
                            <f:selectItem itemLabel="TOUT" itemValue="0"/>
                            <f:selectItems value="#{managedDepot.depots}" var="dep" itemLabel="#{dep.designation}" itemValue="#{dep.id}" />                                 
                            <p:ajax event="valueChange" listener="#{managedOrdresF.addParamDepotDeclaration()}" oncomplete="collapseGrid('of')" update="select-tranche_depot_declaration_of"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu id="select-tranche_depot_declaration_of" value="#{managedOrdresF.trancheDSearch}" style="min-width: 200px">
                            <f:selectItem itemLabel="TOUT" itemValue="0"/>
                            <f:selectItems value="#{managedOrdresF.tranchesSearch}" var="trd" itemLabel="#{trd.titre}" itemValue="#{trd.id}" />                                 
                            <p:ajax event="valueChange" listener="#{managedOrdresF.addParamTrancheDeclaration()}" oncomplete="collapseGrid('of')"/>
                        </h:selectOneMenu>
                        <h:selectOneMenu value="#{managedOrdresF.equipeDSearch}" style="min-width: 200px">
                            <f:selectItem itemLabel="TOUT" itemValue="0"/>
                            <f:selectItems value="#{managedEquipeProduction.equipes}" var="eqd" itemLabel="#{eqd.reference}" itemValue="#{eqd.id}" />                                 
                            <p:ajax event="valueChange" listener="#{managedOrdresF.addParamEquipeDeclaration()}" oncomplete="collapseGrid('of')"/>
                        </h:selectOneMenu>
                        <h:inputText value="#{managedOrdresF.articleDSearch}" style="min-width: 120px">                                
                            <p:ajax event="valueChange" listener="#{managedOrdresF.addParamArticleDeclaration()}" oncomplete="collapseGrid('of')"/>
                        </h:inputText>    
                        <h:inputText value="#{managedOrdresF.numeroDSearch}" style="min-width: 120px">                                
                            <p:ajax event="valueChange" listener="#{managedOrdresF.addParamReferenceDeclaration()}" oncomplete="collapseGrid('of')"/>
                        </h:inputText>    
                    </h:panelGrid>
                </div>          
            </div>
        </h:form>
    </ui:define>
</ui:composition>

